/*! For license information please see video.js.LICENSE.txt */
(()=>{var e={8608:(e,t,n)=>{"use strict";var i=n(4663),r=n(1413),s=r(i("String.prototype.indexOf"));e.exports=function(e,t){var n=i(e,!!t);return"function"==typeof n&&s(e,".prototype.")>-1?r(n):n}},1413:(e,t,n)=>{"use strict";var i=n(4672),r=n(4663),s=n(7319),o=r("%TypeError%"),a=r("%Function.prototype.apply%"),l=r("%Function.prototype.call%"),c=r("%Reflect.apply%",!0)||i.call(l,a),u=r("%Object.defineProperty%",!0),h=r("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}e.exports=function(e){if("function"!=typeof e)throw new o("a function is required");var t=c(i,l,arguments);return s(t,1+h(0,e.length-(arguments.length-1)),!0)};var d=function(){return c(i,a,arguments)};u?u(e.exports,"apply",{value:d}):e.exports.apply=d},8531:(e,t,n)=>{"use strict";var i=n(3219)(),r=n(4663),s=i&&r("%Object.defineProperty%",!0);if(s)try{s({},"a",{value:1})}catch(e){s=!1}var o=r("%SyntaxError%"),a=r("%TypeError%"),l=n(8337);e.exports=function(e,t,n){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new a("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new a("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new a("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new a("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new a("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new a("`loose`, if provided, must be a boolean");var i=arguments.length>3?arguments[3]:null,r=arguments.length>4?arguments[4]:null,c=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],h=!!l&&l(e,t);if(s)s(e,t,{configurable:null===c&&h?h.configurable:!c,enumerable:null===i&&h?h.enumerable:!i,value:n,writable:null===r&&h?h.writable:!r});else{if(!u&&(i||r||c))throw new o("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=n}}},9309:(e,t,n)=>{"use strict";const i=n(5176),r=n(2085),s=n(4715);e.exports={XMLParser:r,XMLValidator:i,XMLBuilder:s}},7256:(e,t)=>{"use strict";const n=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i="["+n+"]["+n+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*",r=new RegExp("^"+i+"$");t.isExist=function(e){return void 0!==e},t.isEmptyObject=function(e){return 0===Object.keys(e).length},t.merge=function(e,t,n){if(t){const i=Object.keys(t),r=i.length;for(let s=0;s<r;s++)e[i[s]]="strict"===n?[t[i[s]]]:t[i[s]]}},t.getValue=function(e){return t.isExist(e)?e:""},t.isName=function(e){return!(null==r.exec(e))},t.getAllMatches=function(e,t){const n=[];let i=t.exec(e);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const s=i.length;for(let e=0;e<s;e++)r.push(i[e]);n.push(r),i=t.exec(e)}return n},t.nameRegexp=i},5176:(e,t,n)=>{"use strict";const i=n(7256),r={allowBooleanAttributes:!1,unpairedTags:[]};function s(e){return" "===e||"\t"===e||"\n"===e||"\r"===e}function o(e,t){const n=t;for(;t<e.length;t++)if("?"!=e[t]&&" "!=e[t]);else{const i=e.substr(n,t-n);if(t>5&&"xml"===i)return p("InvalidXml","XML declaration allowed only at the start of the document.",m(e,t));if("?"==e[t]&&">"==e[t+1]){t++;break}}return t}function a(e,t){if(e.length>t+5&&"-"===e[t+1]&&"-"===e[t+2]){for(t+=3;t<e.length;t++)if("-"===e[t]&&"-"===e[t+1]&&">"===e[t+2]){t+=2;break}}else if(e.length>t+8&&"D"===e[t+1]&&"O"===e[t+2]&&"C"===e[t+3]&&"T"===e[t+4]&&"Y"===e[t+5]&&"P"===e[t+6]&&"E"===e[t+7]){let n=1;for(t+=8;t<e.length;t++)if("<"===e[t])n++;else if(">"===e[t]&&(n--,0===n))break}else if(e.length>t+9&&"["===e[t+1]&&"C"===e[t+2]&&"D"===e[t+3]&&"A"===e[t+4]&&"T"===e[t+5]&&"A"===e[t+6]&&"["===e[t+7])for(t+=8;t<e.length;t++)if("]"===e[t]&&"]"===e[t+1]&&">"===e[t+2]){t+=2;break}return t}t.validate=function(e,t){t=Object.assign({},r,t);const n=[];let l=!1,c=!1;"\ufeff"===e[0]&&(e=e.substr(1));for(let r=0;r<e.length;r++)if("<"===e[r]&&"?"===e[r+1]){if(r+=2,r=o(e,r),r.err)return r}else{if("<"!==e[r]){if(s(e[r]))continue;return p("InvalidChar","char '"+e[r]+"' is not expected.",m(e,r))}{let g=r;if(r++,"!"===e[r]){r=a(e,r);continue}{let y=!1;"/"===e[r]&&(y=!0,r++);let b="";for(;r<e.length&&">"!==e[r]&&" "!==e[r]&&"\t"!==e[r]&&"\n"!==e[r]&&"\r"!==e[r];r++)b+=e[r];if(b=b.trim(),"/"===b[b.length-1]&&(b=b.substring(0,b.length-1),r--),h=b,!i.isName(h)){let t;return t=0===b.trim().length?"Invalid space after '<'.":"Tag '"+b+"' is an invalid name.",p("InvalidTag",t,m(e,r))}const v=u(e,r);if(!1===v)return p("InvalidAttr","Attributes for '"+b+"' have open quote.",m(e,r));let w=v.value;if(r=v.index,"/"===w[w.length-1]){const n=r-w.length;w=w.substring(0,w.length-1);const i=d(w,t);if(!0!==i)return p(i.err.code,i.err.msg,m(e,n+i.err.line));l=!0}else if(y){if(!v.tagClosed)return p("InvalidTag","Closing tag '"+b+"' doesn't have proper closing.",m(e,r));if(w.trim().length>0)return p("InvalidTag","Closing tag '"+b+"' can't have attributes or invalid starting.",m(e,g));{const t=n.pop();if(b!==t.tagName){let n=m(e,t.tagStartPos);return p("InvalidTag","Expected closing tag '"+t.tagName+"' (opened in line "+n.line+", col "+n.col+") instead of closing tag '"+b+"'.",m(e,g))}0==n.length&&(c=!0)}}else{const i=d(w,t);if(!0!==i)return p(i.err.code,i.err.msg,m(e,r-w.length+i.err.line));if(!0===c)return p("InvalidXml","Multiple possible root nodes found.",m(e,r));-1!==t.unpairedTags.indexOf(b)||n.push({tagName:b,tagStartPos:g}),l=!0}for(r++;r<e.length;r++)if("<"===e[r]){if("!"===e[r+1]){r++,r=a(e,r);continue}if("?"!==e[r+1])break;if(r=o(e,++r),r.err)return r}else if("&"===e[r]){const t=f(e,r);if(-1==t)return p("InvalidChar","char '&' is not expected.",m(e,r));r=t}else if(!0===c&&!s(e[r]))return p("InvalidXml","Extra text at the end",m(e,r));"<"===e[r]&&r--}}}var h;return l?1==n.length?p("InvalidTag","Unclosed tag '"+n[0].tagName+"'.",m(e,n[0].tagStartPos)):!(n.length>0)||p("InvalidXml","Invalid '"+JSON.stringify(n.map((e=>e.tagName)),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):p("InvalidXml","Start tag expected.",1)};const l='"',c="'";function u(e,t){let n="",i="",r=!1;for(;t<e.length;t++){if(e[t]===l||e[t]===c)""===i?i=e[t]:i!==e[t]||(i="");else if(">"===e[t]&&""===i){r=!0;break}n+=e[t]}return""===i&&{value:n,index:t,tagClosed:r}}const h=new RegExp("(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['\"])(([\\s\\S])*?)\\5)?","g");function d(e,t){const n=i.getAllMatches(e,h),r={};for(let e=0;e<n.length;e++){if(0===n[e][1].length)return p("InvalidAttr","Attribute '"+n[e][2]+"' has no space in starting.",y(n[e]));if(void 0!==n[e][3]&&void 0===n[e][4])return p("InvalidAttr","Attribute '"+n[e][2]+"' is without value.",y(n[e]));if(void 0===n[e][3]&&!t.allowBooleanAttributes)return p("InvalidAttr","boolean attribute '"+n[e][2]+"' is not allowed.",y(n[e]));const i=n[e][2];if(!g(i))return p("InvalidAttr","Attribute '"+i+"' is an invalid name.",y(n[e]));if(r.hasOwnProperty(i))return p("InvalidAttr","Attribute '"+i+"' is repeated.",y(n[e]));r[i]=1}return!0}function f(e,t){if(";"===e[++t])return-1;if("#"===e[t])return function(e,t){let n=/\d/;for("x"===e[t]&&(t++,n=/[\da-fA-F]/);t<e.length;t++){if(";"===e[t])return t;if(!e[t].match(n))break}return-1}(e,++t);let n=0;for(;t<e.length;t++,n++)if(!(e[t].match(/\w/)&&n<20)){if(";"===e[t])break;return-1}return t}function p(e,t,n){return{err:{code:e,msg:t,line:n.line||n,col:n.col}}}function g(e){return i.isName(e)}function m(e,t){const n=e.substring(0,t).split(/\r?\n/);return{line:n.length,col:n[n.length-1].length+1}}function y(e){return e.startIndex+e[1].length}},4715:(e,t,n)=>{"use strict";const i=n(7063),r={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[]};function s(e){this.options=Object.assign({},r,e),this.options.ignoreAttributes||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=p),this.processTextOrObjNode=a,this.options.format?(this.indentate=f,this.tagEndChar=">\n",this.newLine="\n"):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine=""),this.options.suppressEmptyNode?(this.buildTextNode=d,this.buildObjNode=c):(this.buildTextNode=u,this.buildObjNode=l),this.buildTextValNode=u,this.buildObjectNode=l,this.replaceEntitiesValue=h,this.buildAttrPairStr=o}function o(e,t){return t=this.options.attributeValueProcessor(e,""+t),t=this.replaceEntitiesValue(t),this.options.suppressBooleanAttributes&&"true"===t?" "+e:" "+e+'="'+t+'"'}function a(e,t,n){const i=this.j2x(e,n+1);return void 0!==e[this.options.textNodeName]&&1===Object.keys(e).length?this.buildTextNode(e[this.options.textNodeName],t,i.attrStr,n):this.buildObjNode(i.val,t,i.attrStr,n)}function l(e,t,n,i){let r="</"+t+this.tagEndChar,s="";return"?"===t[0]&&(s="?",r=""),n&&-1===e.indexOf("<")?this.indentate(i)+"<"+t+n+s+">"+e+r:!1!==this.options.commentPropName&&t===this.options.commentPropName&&0===s.length?this.indentate(i)+`\x3c!--${e}--\x3e`+this.newLine:this.indentate(i)+"<"+t+n+s+this.tagEndChar+e+this.indentate(i)+r}function c(e,t,n,i){return""!==e?this.buildObjectNode(e,t,n,i):"?"===t[0]?this.indentate(i)+"<"+t+n+"?"+this.tagEndChar:this.indentate(i)+"<"+t+n+"/"+this.tagEndChar}function u(e,t,n,i){if(!1!==this.options.cdataPropName&&t===this.options.cdataPropName)return this.indentate(i)+`<![CDATA[${e}]]>`+this.newLine;if(!1!==this.options.commentPropName&&t===this.options.commentPropName)return this.indentate(i)+`\x3c!--${e}--\x3e`+this.newLine;{let r=this.options.tagValueProcessor(t,e);return r=this.replaceEntitiesValue(r),""===r&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(i)+"<"+t+this.tagEndChar:this.indentate(i)+"<"+t+"/"+this.tagEndChar:this.indentate(i)+"<"+t+n+">"+r+"</"+t+this.tagEndChar}}function h(e){if(e&&e.length>0&&this.options.processEntities)for(let t=0;t<this.options.entities.length;t++){const n=this.options.entities[t];e=e.replace(n.regex,n.val)}return e}function d(e,t,n,i){return""===e&&-1!==this.options.unpairedTags.indexOf(t)?this.options.suppressUnpairedNode?this.indentate(i)+"<"+t+this.tagEndChar:this.indentate(i)+"<"+t+"/"+this.tagEndChar:""!==e?this.buildTextValNode(e,t,n,i):"?"===t[0]?this.indentate(i)+"<"+t+n+"?"+this.tagEndChar:this.indentate(i)+"<"+t+n+"/"+this.tagEndChar}function f(e){return this.options.indentBy.repeat(e)}function p(e){return!!e.startsWith(this.options.attributeNamePrefix)&&e.substr(this.attrPrefixLen)}s.prototype.build=function(e){return this.options.preserveOrder?i(e,this.options):(Array.isArray(e)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(e={[this.options.arrayNodeName]:e}),this.j2x(e,0).val)},s.prototype.j2x=function(e,t){let n="",i="";for(let r in e)if(void 0===e[r]);else if(null===e[r])"?"===r[0]?i+=this.indentate(t)+"<"+r+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+r+"/"+this.tagEndChar;else if(e[r]instanceof Date)i+=this.buildTextNode(e[r],r,"",t);else if("object"!=typeof e[r]){const s=this.isAttribute(r);if(s)n+=this.buildAttrPairStr(s,""+e[r]);else if(r===this.options.textNodeName){let t=this.options.tagValueProcessor(r,""+e[r]);i+=this.replaceEntitiesValue(t)}else i+=this.buildTextNode(e[r],r,"",t)}else if(Array.isArray(e[r])){const n=e[r].length;for(let s=0;s<n;s++){const n=e[r][s];void 0===n||(null===n?"?"===r[0]?i+=this.indentate(t)+"<"+r+"?"+this.tagEndChar:i+=this.indentate(t)+"<"+r+"/"+this.tagEndChar:i+="object"==typeof n?this.processTextOrObjNode(n,r,t):this.buildTextNode(n,r,"",t))}}else if(this.options.attributesGroupName&&r===this.options.attributesGroupName){const t=Object.keys(e[r]),i=t.length;for(let s=0;s<i;s++)n+=this.buildAttrPairStr(t[s],""+e[r][t[s]])}else i+=this.processTextOrObjNode(e[r],r,t);return{attrStr:n,val:i}},e.exports=s},7063:e=>{function t(e,o,a,l){let c="",u="";o.format&&o.indentBy.length>0&&(u="\n"+o.indentBy.repeat(l));for(let h=0;h<e.length;h++){const d=e[h],f=n(d);let p="";if(p=0===a.length?f:`${a}.${f}`,f===o.textNodeName){let e=d[f];r(p,o)||(e=o.tagValueProcessor(f,e),e=s(e,o)),c+=u+e;continue}if(f===o.cdataPropName){c+=u+`<![CDATA[${d[f][0][o.textNodeName]}]]>`;continue}if(f===o.commentPropName){c+=u+`\x3c!--${d[f][0][o.textNodeName]}--\x3e`;continue}if("?"===f[0]){const e=i(d[":@"],o),t="?xml"===f?"":u;let n=d[f][0][o.textNodeName];n=0!==n.length?" "+n:"",c+=t+`<${f}${n}${e}?>`;continue}let g=u+`<${f}${i(d[":@"],o)}`,m=t(d[f],o,p,l+1);-1!==o.unpairedTags.indexOf(f)?o.suppressUnpairedNode?c+=g+">":c+=g+"/>":m&&0!==m.length||!o.suppressEmptyNode?c+=g+`>${m}${u}</${f}>`:c+=g+"/>"}return c}function n(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function i(e,t){let n="";if(e&&!t.ignoreAttributes)for(let i in e){let r=t.attributeValueProcessor(i,e[i]);r=s(r,t),!0===r&&t.suppressBooleanAttributes?n+=` ${i.substr(t.attributeNamePrefix.length)}`:n+=` ${i.substr(t.attributeNamePrefix.length)}="${r}"`}return n}function r(e,t){let n=(e=e.substr(0,e.length-t.textNodeName.length-1)).substr(e.lastIndexOf(".")+1);for(let i in t.stopNodes)if(t.stopNodes[i]===e||t.stopNodes[i]==="*."+n)return!0;return!1}function s(e,t){if(e&&e.length>0&&t.processEntities)for(let n=0;n<t.entities.length;n++){const i=t.entities[n];e=e.replace(i.regex,i.val)}return e}e.exports=function(e,n){return t(e,n,"",0)}},6436:e=>{const t=RegExp("^\\s([a-zA-z0-0]+)[ \t](['\"])([^&]+)\\2");function n(e,n){const i=t.exec(e);i&&(n[i[1]]={regx:RegExp(`&${i[1]};`,"g"),val:i[3]})}e.exports=function(e,t){const i={};if("O"!==e[t+3]||"C"!==e[t+4]||"T"!==e[t+5]||"Y"!==e[t+6]||"P"!==e[t+7]||"E"!==e[t+8])throw new Error("Invalid Tag instead of DOCTYPE");{t+=9;let r=1,s=!1,o=!1,a=!1,l="";for(;t<e.length;t++)if("<"===e[t]){if(s&&"!"===e[t+1]&&"E"===e[t+2]&&"N"===e[t+3]&&"T"===e[t+4]&&"I"===e[t+5]&&"T"===e[t+6]&&"Y"===e[t+7])t+=7,o=!0;else if(s&&"!"===e[t+1]&&"E"===e[t+2]&&"L"===e[t+3]&&"E"===e[t+4]&&"M"===e[t+5]&&"E"===e[t+6]&&"N"===e[t+7]&&"T"===e[t+8])t+=8;else{if("!"!==e[t+1]||"-"!==e[t+2]||"-"!==e[t+3])throw new Error("Invalid DOCTYPE");a=!0}r++,l=""}else if(">"===e[t]){if(a){if("-"!==e[t-1]||"-"!==e[t-2])throw new Error("Invalid XML comment in DOCTYPE");a=!1}else o&&(n(l,i),o=!1);if(r--,0===r)break}else"["===e[t]?s=!0:l+=e[t];if(0!==r)throw new Error("Unclosed DOCTYPE")}return{entities:i,i:t}}},686:(e,t)=>{const n={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0},tagValueProcessor:function(e,t){return t},attributeValueProcessor:function(e,t){return t},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1};t.buildOptions=function(e){return Object.assign({},n,e)},t.defaultOptions=n},361:(e,t,n)=>{"use strict";const i=n(7256),r=n(5475),s=n(6436),o=n(5326);function a(e){const t=Object.keys(e);for(let n=0;n<t.length;n++){const i=t[n];this.lastEntities[i]={regex:new RegExp("&"+i+";","g"),val:e[i]}}}function l(e,t,n,i,r,s,o){if(void 0!==e&&(this.options.trimValues&&!i&&(e=e.trim()),e.length>0)){o||(e=this.replaceEntitiesValue(e));const i=this.options.tagValueProcessor(t,e,n,r,s);return null==i?e:typeof i!=typeof e||i!==e?i:this.options.trimValues||e.trim()===e?v(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function c(e){if(this.options.removeNSPrefix){const t=e.split(":"),n="/"===e.charAt(0)?"/":"";if("xmlns"===t[0])return"";2===t.length&&(e=n+t[1])}return e}"<((!\\[CDATA\\[([\\s\\S]*?)(]]>))|((NAME:)?(NAME))([^>]*)>|((\\/)(NAME)\\s*>))([^<]*)".replace(/NAME/g,i.nameRegexp);const u=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function h(e,t){if(!this.options.ignoreAttributes&&"string"==typeof e){const n=i.getAllMatches(e,u),r=n.length,s={};for(let e=0;e<r;e++){const i=this.resolveNameSpace(n[e][1]);let r=n[e][4];const o=this.options.attributeNamePrefix+i;if(i.length)if(void 0!==r){this.options.trimValues&&(r=r.trim()),r=this.replaceEntitiesValue(r);const e=this.options.attributeValueProcessor(i,r,t);s[o]=null==e?r:typeof e!=typeof r||e!==r?e:v(r,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(s[o]=!0)}if(!Object.keys(s).length)return;if(this.options.attributesGroupName){const e={};return e[this.options.attributesGroupName]=s,e}return s}}const d=function(e){e=e.replace(/\r\n?/g,"\n");const t=new r("!xml");let n=t,i="",o="";for(let a=0;a<e.length;a++)if("<"===e[a])if("/"===e[a+1]){const t=m(e,">",a,"Closing Tag is not closed.");let r=e.substring(a+2,t).trim();if(this.options.removeNSPrefix){const e=r.indexOf(":");-1!==e&&(r=r.substr(e+1))}n&&(i=this.saveTextToParentTag(i,n,o)),o=o.substr(0,o.lastIndexOf(".")),n=this.tagsNodeStack.pop(),i="",a=t}else if("?"===e[a+1]){let t=y(e,a,!1,"?>");if(!t)throw new Error("Pi Tag is not closed.");if(i=this.saveTextToParentTag(i,n,o),this.options.ignoreDeclaration&&"?xml"===t.tagName||this.options.ignorePiTags);else{const e=new r(t.tagName);e.add(this.options.textNodeName,""),t.tagName!==t.tagExp&&t.attrExpPresent&&(e[":@"]=this.buildAttributesMap(t.tagExp,o)),n.addChild(e)}a=t.closeIndex+1}else if("!--"===e.substr(a+1,3)){const t=m(e,"--\x3e",a+4,"Comment is not closed.");if(this.options.commentPropName){const r=e.substring(a+4,t-2);i=this.saveTextToParentTag(i,n,o),n.add(this.options.commentPropName,[{[this.options.textNodeName]:r}])}a=t}else if("!D"===e.substr(a+1,2)){const t=s(e,a);this.docTypeEntities=t.entities,a=t.i}else if("!["===e.substr(a+1,2)){const t=m(e,"]]>",a,"CDATA is not closed.")-2,r=e.substring(a+9,t);if(i=this.saveTextToParentTag(i,n,o),this.options.cdataPropName)n.add(this.options.cdataPropName,[{[this.options.textNodeName]:r}]);else{let e=this.parseTextData(r,n.tagname,o,!0,!1,!0);e||(e=""),n.add(this.options.textNodeName,e)}a=t+2}else{let s=y(e,a,this.options.removeNSPrefix),l=s.tagName,c=s.tagExp,u=s.attrExpPresent,h=s.closeIndex;n&&i&&"!xml"!==n.tagname&&(i=this.saveTextToParentTag(i,n,o,!1)),l!==t.tagname&&(o+=o?"."+l:l);const d=n;if(d&&-1!==this.options.unpairedTags.indexOf(d.tagname)&&(n=this.tagsNodeStack.pop()),this.isItStopNode(this.options.stopNodes,o,l)){let t="";if(c.length>0&&c.lastIndexOf("/")===c.length-1)a=s.closeIndex;else if(-1!==this.options.unpairedTags.indexOf(l))a=s.closeIndex;else{const n=this.readStopNodeData(e,l,h+1);if(!n)throw new Error(`Unexpected end of ${l}`);a=n.i,t=n.tagContent}const i=new r(l);l!==c&&u&&(i[":@"]=this.buildAttributesMap(c,o)),t&&(t=this.parseTextData(t,l,o,!0,u,!0,!0)),o=o.substr(0,o.lastIndexOf(".")),i.add(this.options.textNodeName,t),n.addChild(i)}else{if(c.length>0&&c.lastIndexOf("/")===c.length-1){"/"===l[l.length-1]?(l=l.substr(0,l.length-1),c=l):c=c.substr(0,c.length-1);const e=new r(l);l!==c&&u&&(e[":@"]=this.buildAttributesMap(c,o)),o=o.substr(0,o.lastIndexOf(".")),n.addChild(e)}else{const e=new r(l);this.tagsNodeStack.push(n),l!==c&&u&&(e[":@"]=this.buildAttributesMap(c,o)),n.addChild(e),n=e}i="",a=h}}else i+=e[a];return t.child},f=function(e){if(this.options.processEntities){for(let t in this.docTypeEntities){const n=this.docTypeEntities[t];e=e.replace(n.regx,n.val)}for(let t in this.lastEntities){const n=this.lastEntities[t];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let t in this.htmlEntities){const n=this.htmlEntities[t];e=e.replace(n.regex,n.val)}}return e};function p(e,t,n,i){return e&&(void 0===i&&(i=0===Object.keys(t.child).length),void 0!==(e=this.parseTextData(e,t.tagname,n,!1,!!t[":@"]&&0!==Object.keys(t[":@"]).length,i))&&""!==e&&t.add(this.options.textNodeName,e),e=""),e}function g(e,t,n){const i="*."+n;for(const n in e){const r=e[n];if(i===r||t===r)return!0}return!1}function m(e,t,n,i){const r=e.indexOf(t,n);if(-1===r)throw new Error(i);return r+t.length-1}function y(e,t,n,i=">"){const r=function(e,t,n=">"){let i,r="";for(let s=t;s<e.length;s++){let t=e[s];if(i)t===i&&(i="");else if('"'===t||"'"===t)i=t;else if(t===n[0]){if(!n[1])return{data:r,index:s};if(e[s+1]===n[1])return{data:r,index:s}}else"\t"===t&&(t=" ");r+=t}}(e,t+1,i);if(!r)return;let s=r.data;const o=r.index,a=s.search(/\s/);let l=s,c=!0;if(-1!==a&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),n){const e=l.indexOf(":");-1!==e&&(l=l.substr(e+1),c=l!==r.data.substr(e+1))}return{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:c}}function b(e,t,n){const i=n;for(;n<e.length;n++)if("<"===e[n]&&"/"===e[n+1]){const r=m(e,">",n,`${t} is not closed`);if(e.substring(n+2,r).trim()===t)return{tagContent:e.substring(i,n),i:r};n=r}}function v(e,t,n){if(t&&"string"==typeof e){const t=e.trim();return"true"===t||"false"!==t&&o(e,n)}return i.isExist(e)?e:""}e.exports=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={amp:{regex:/&(amp|#38|#x26);/g,val:"&"},apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=a,this.parseXml=d,this.parseTextData=l,this.resolveNameSpace=c,this.buildAttributesMap=h,this.isItStopNode=g,this.replaceEntitiesValue=f,this.readStopNodeData=b,this.saveTextToParentTag=p}}},2085:(e,t,n)=>{const{buildOptions:i}=n(686),r=n(361),{prettify:s}=n(9046),o=n(5176);e.exports=class{constructor(e){this.externalEntities={},this.options=i(e)}parse(e,t){if("string"==typeof e);else{if(!e.toString)throw new Error("XML data is accepted in String or Bytes[] form.");e=e.toString()}if(t){!0===t&&(t={});const n=o.validate(e,t);if(!0!==n)throw Error(`${n.err.msg}:${n.err.line}:${n.err.col}`)}const n=new r(this.options);n.addExternalEntities(this.externalEntities);const i=n.parseXml(e);return this.options.preserveOrder||void 0===i?i:s(i,this.options)}addEntity(e,t){if(-1!==t.indexOf("&"))throw new Error("Entity value can't have '&'");if(-1!==e.indexOf("&")||-1!==e.indexOf(";"))throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");this.externalEntities[e]=t}}},9046:(e,t)=>{"use strict";function n(e,t,o){let a;const l={};for(let c=0;c<e.length;c++){const u=e[c],h=i(u);let d="";if(d=void 0===o?h:o+"."+h,h===t.textNodeName)void 0===a?a=u[h]:a+=""+u[h];else{if(void 0===h)continue;if(u[h]){let e=n(u[h],t,d);const i=s(e,t);u[":@"]?r(e,u[":@"],d,t):1!==Object.keys(e).length||void 0===e[t.textNodeName]||t.alwaysCreateTextNode?0===Object.keys(e).length&&(t.alwaysCreateTextNode?e[t.textNodeName]="":e=""):e=e[t.textNodeName],void 0!==l[h]?(Array.isArray(l[h])||(l[h]=[l[h]]),l[h].push(e)):t.isArray(h,d,i)?l[h]=[e]:l[h]=e}}}return"string"==typeof a?a.length>0&&(l[t.textNodeName]=a):void 0!==a&&(l[t.textNodeName]=a),l}function i(e){const t=Object.keys(e);for(let e=0;e<t.length;e++){const n=t[e];if(":@"!==n)return n}}function r(e,t,n,i){if(t){const r=Object.keys(t),s=r.length;for(let o=0;o<s;o++){const s=r[o];i.isArray(s,n+"."+s,!0,!0)?e[s]=[t[s]]:e[s]=t[s]}}}function s(e,t){const n=Object.keys(e).length;return!!(0===n||1===n&&e[t.textNodeName])}t.prettify=function(e,t){return n(e,t)}},5475:e=>{"use strict";e.exports=class{constructor(e){this.tagname=e,this.child=[],this[":@"]={}}add(e,t){this.child.push({[e]:t})}addChild(e){e[":@"]&&Object.keys(e[":@"]).length>0?this.child.push({[e.tagname]:e.child,":@":e[":@"]}):this.child.push({[e.tagname]:e.child})}}},3351:e=>{"use strict";var t=Object.prototype.toString,n=Math.max,i=function(e,t){for(var n=[],i=0;i<e.length;i+=1)n[i]=e[i];for(var r=0;r<t.length;r+=1)n[r+e.length]=t[r];return n};e.exports=function(e){var r=this;if("function"!=typeof r||"[object Function]"!==t.apply(r))throw new TypeError("Function.prototype.bind called on incompatible "+r);for(var s,o=function(e,t){for(var n=[],i=1,r=0;i<e.length;i+=1,r+=1)n[r]=e[i];return n}(arguments),a=n(0,r.length-o.length),l=[],c=0;c<a;c++)l[c]="$"+c;if(s=Function("binder","return function ("+function(e,t){for(var n="",i=0;i<e.length;i+=1)n+=e[i],i+1<e.length&&(n+=",");return n}(l)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var t=r.apply(this,i(o,arguments));return Object(t)===t?t:this}return r.apply(e,i(o,arguments))})),r.prototype){var u=function(){};u.prototype=r.prototype,s.prototype=new u,u.prototype=null}return s}},4672:(e,t,n)=>{"use strict";var i=n(3351);e.exports=Function.prototype.bind||i},4663:(e,t,n)=>{"use strict";var i,r=SyntaxError,s=Function,o=TypeError,a=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},u=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=n(4573)(),d=n(8912)(),f=Object.getPrototypeOf||(d?function(e){return e.__proto__}:null),p={},g="undefined"!=typeof Uint8Array&&f?f(Uint8Array):i,m={"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":h&&f?f([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":p,"%AsyncGenerator%":p,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":p,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":p,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h&&f?f(f([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h&&f?f((new Map)[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h&&f?f((new Set)[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h&&f?f(""[Symbol.iterator]()):i,"%Symbol%":h?Symbol:i,"%SyntaxError%":r,"%ThrowTypeError%":u,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet};if(f)try{null.error}catch(e){var y=f(f(e));m["%Error.prototype%"]=y}var b=function e(t){var n;if("%AsyncFunction%"===t)n=a("async function () {}");else if("%GeneratorFunction%"===t)n=a("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=a("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(n=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&f&&(n=f(r.prototype))}return m[t]=n,n},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=n(4672),S=n(2907),k=w.call(Function.call,Array.prototype.concat),x=w.call(Function.apply,Array.prototype.splice),E=w.call(Function.call,String.prototype.replace),_=w.call(Function.call,String.prototype.slice),O=w.call(Function.call,RegExp.prototype.exec),C=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,T=/\\(\\)?/g,A=function(e,t){var n,i=e;if(S(v,i)&&(i="%"+(n=v[i])[0]+"%"),S(m,i)){var s=m[i];if(s===p&&(s=b(i)),void 0===s&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:i,value:s}}throw new r("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===O(/^%?[^%]*%?$/,e))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(e){var t=_(e,0,1),n=_(e,-1);if("%"===t&&"%"!==n)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new r("invalid intrinsic syntax, expected opening `%`");var i=[];return E(e,C,(function(e,t,n,r){i[i.length]=n?E(r,T,"$1"):t||e})),i}(e),i=n.length>0?n[0]:"",s=A("%"+i+"%",t),a=s.name,c=s.value,u=!1,h=s.alias;h&&(i=h[0],x(n,k([0,1],h)));for(var d=1,f=!0;d<n.length;d+=1){var p=n[d],g=_(p,0,1),y=_(p,-1);if(('"'===g||"'"===g||"`"===g||'"'===y||"'"===y||"`"===y)&&g!==y)throw new r("property names with quotes must have matching quotes");if("constructor"!==p&&f||(u=!0),S(m,a="%"+(i+="."+p)+"%"))c=m[a];else if(null!=c){if(!(p in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&d+1>=n.length){var b=l(c,p);c=(f=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:c[p]}else f=S(c,p),c=c[p];f&&!u&&(m[a]=c)}}return c}},3452:(e,t,n)=>{var i;i="undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},e.exports=i},8337:(e,t,n)=>{"use strict";var i=n(4663)("%Object.getOwnPropertyDescriptor%",!0);if(i)try{i([],"length")}catch(e){i=null}e.exports=i},3219:(e,t,n)=>{"use strict";var i=n(4663)("%Object.defineProperty%",!0),r=function(){if(i)try{return i({},"a",{value:1}),!0}catch(e){return!1}return!1};r.hasArrayLengthDefineBug=function(){if(!r())return null;try{return 1!==i([],"length",{value:1}).length}catch(e){return!0}},e.exports=r},8912:e=>{"use strict";var t={foo:{}},n=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof n)}},4573:(e,t,n)=>{"use strict";var i="undefined"!=typeof Symbol&&Symbol,r=n(4283);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==typeof i("foo")&&"symbol"==typeof Symbol("bar")&&r()}},4283:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var i=Object.getOwnPropertySymbols(e);if(1!==i.length||i[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var r=Object.getOwnPropertyDescriptor(e,t);if(42!==r.value||!0!==r.enumerable)return!1}return!0}},2907:(e,t,n)=>{"use strict";var i=Function.prototype.call,r=Object.prototype.hasOwnProperty,s=n(4672);e.exports=s.call(i,r)},9427:(e,t,n)=>{"use strict";var i=n(1020),r=i.ValidatorResult,s=i.SchemaError,o={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0}},a=o.validators={};function l(e,t,n,i,r){var s=t.throwError,o=t.throwAll;t.throwError=!1,t.throwAll=!1;var a=this.validateSchema(e,r,t,n);return t.throwError=s,t.throwAll=o,!a.valid&&i instanceof Function&&i(a),a.valid}function c(e,t){if(Object.hasOwnProperty.call(e,t))return e[t];if(t in e)for(;e=Object.getPrototypeOf(e);)if(Object.propertyIsEnumerable.call(e,t))return e[t]}function u(e,t,n,i,r,s){if(this.types.object(e)&&(!t.properties||void 0===t.properties[r]))if(!1===t.additionalProperties)s.addError({name:"additionalProperties",argument:r,message:"is not allowed to have the additional property "+JSON.stringify(r)});else{var o=t.additionalProperties||{};"function"==typeof n.preValidateProperty&&n.preValidateProperty(e,r,o,n,i);var a=this.validateSchema(e[r],o,n,i.makeChild(o,r));a.instance!==s.instance[r]&&(s.instance[r]=a.instance),s.importErrors(a)}}a.type=function(e,t,n,i){if(void 0===e)return null;var s=new r(e,t,n,i),o=Array.isArray(t.type)?t.type:[t.type];if(!o.some(this.testType.bind(this,e,t,n,i))){var a=o.map((function(e){if(e){var t=e.$id||e.id;return t?"<"+t+">":e+""}}));s.addError({name:"type",argument:a,message:"is not of a type(s) "+a})}return s},a.anyOf=function(e,t,n,i){if(void 0===e)return null;var o=new r(e,t,n,i),a=new r(e,t,n,i);if(!Array.isArray(t.anyOf))throw new s("anyOf must be an array");if(!t.anyOf.some(l.bind(this,e,n,i,(function(e){a.importErrors(e)})))){var c=t.anyOf.map((function(e,t){var n=e.$id||e.id;return n?"<"+n+">":e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));n.nestedErrors&&o.importErrors(a),o.addError({name:"anyOf",argument:c,message:"is not any of "+c.join(",")})}return o},a.allOf=function(e,t,n,i){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new s("allOf must be an array");var o=new r(e,t,n,i),a=this;return t.allOf.forEach((function(t,r){var s=a.validateSchema(e,t,n,i);if(!s.valid){var l=t.$id||t.id||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+r+"]";o.addError({name:"allOf",argument:{id:l,length:s.errors.length,valid:s},message:"does not match allOf schema "+l+" with "+s.errors.length+" error[s]:"}),o.importErrors(s)}})),o},a.oneOf=function(e,t,n,i){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new s("oneOf must be an array");var o=new r(e,t,n,i),a=new r(e,t,n,i),c=t.oneOf.filter(l.bind(this,e,n,i,(function(e){a.importErrors(e)}))).length,u=t.oneOf.map((function(e,t){return e.$id||e.id||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));return 1!==c&&(n.nestedErrors&&o.importErrors(a),o.addError({name:"oneOf",argument:u,message:"is not exactly one from "+u.join(",")})),o},a.if=function(e,t,n,s){if(void 0===e)return null;if(!i.isSchema(t.if))throw new Error('Expected "if" keyword to be a schema');var o,a=l.call(this,e,n,s,null,t.if),c=new r(e,t,n,s);if(a){if(void 0===t.then)return;if(!i.isSchema(t.then))throw new Error('Expected "then" keyword to be a schema');o=this.validateSchema(e,t.then,n,s.makeChild(t.then)),c.importErrors(o)}else{if(void 0===t.else)return;if(!i.isSchema(t.else))throw new Error('Expected "else" keyword to be a schema');o=this.validateSchema(e,t.else,n,s.makeChild(t.else)),c.importErrors(o)}return c},a.propertyNames=function(e,t,n,o){if(this.types.object(e)){var a=new r(e,t,n,o),l=void 0!==t.propertyNames?t.propertyNames:{};if(!i.isSchema(l))throw new s('Expected "propertyNames" to be a schema (object or boolean)');for(var u in e)if(void 0!==c(e,u)){var h=this.validateSchema(u,l,n,o.makeChild(l));a.importErrors(h)}return a}},a.properties=function(e,t,n,i){if(this.types.object(e)){var o=new r(e,t,n,i),a=t.properties||{};for(var l in a){var u=a[l];if(void 0!==u){if(null===u)throw new s('Unexpected null, expected schema in "properties"');"function"==typeof n.preValidateProperty&&n.preValidateProperty(e,l,u,n,i);var h=c(e,l),d=this.validateSchema(h,u,n,i.makeChild(u,l));d.instance!==o.instance[l]&&(o.instance[l]=d.instance),o.importErrors(d)}}return o}},a.patternProperties=function(e,t,n,i){if(this.types.object(e)){var o=new r(e,t,n,i),a=t.patternProperties||{};for(var l in e){var c=!0;for(var h in a){var d=a[h];if(void 0!==d){if(null===d)throw new s('Unexpected null, expected schema in "patternProperties"');try{var f=new RegExp(h,"u")}catch(e){f=new RegExp(h)}if(f.test(l)){c=!1,"function"==typeof n.preValidateProperty&&n.preValidateProperty(e,l,d,n,i);var p=this.validateSchema(e[l],d,n,i.makeChild(d,l));p.instance!==o.instance[l]&&(o.instance[l]=p.instance),o.importErrors(p)}}}c&&u.call(this,e,t,n,i,l,o)}return o}},a.additionalProperties=function(e,t,n,i){if(this.types.object(e)){if(t.patternProperties)return null;var s=new r(e,t,n,i);for(var o in e)u.call(this,e,t,n,i,o,s);return s}},a.minProperties=function(e,t,n,i){if(this.types.object(e)){var s=new r(e,t,n,i);return Object.keys(e).length>=t.minProperties||s.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),s}},a.maxProperties=function(e,t,n,i){if(this.types.object(e)){var s=new r(e,t,n,i);return Object.keys(e).length<=t.maxProperties||s.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),s}},a.items=function(e,t,n,i){var s=this;if(this.types.array(e)&&void 0!==t.items){var o=new r(e,t,n,i);return e.every((function(e,r){if(Array.isArray(t.items))var a=void 0===t.items[r]?t.additionalItems:t.items[r];else a=t.items;if(void 0===a)return!0;if(!1===a)return o.addError({name:"items",message:"additionalItems not permitted"}),!1;var l=s.validateSchema(e,a,n,i.makeChild(a,r));return l.instance!==o.instance[r]&&(o.instance[r]=l.instance),o.importErrors(l),!0})),o}},a.contains=function(e,t,n,s){var o=this;if(this.types.array(e)&&void 0!==t.contains){if(!i.isSchema(t.contains))throw new Error('Expected "contains" keyword to be a schema');var a=new r(e,t,n,s);return!1===e.some((function(e,i){return 0===o.validateSchema(e,t.contains,n,s.makeChild(t.contains,i)).errors.length}))&&a.addError({name:"contains",argument:t.contains,message:"must contain an item matching given schema"}),a}},a.minimum=function(e,t,n,i){if(this.types.number(e)){var s=new r(e,t,n,i);return t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum||s.addError({name:"minimum",argument:t.minimum,message:"must be greater than "+t.minimum}):e>=t.minimum||s.addError({name:"minimum",argument:t.minimum,message:"must be greater than or equal to "+t.minimum}),s}},a.maximum=function(e,t,n,i){if(this.types.number(e)){var s=new r(e,t,n,i);return t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum||s.addError({name:"maximum",argument:t.maximum,message:"must be less than "+t.maximum}):e<=t.maximum||s.addError({name:"maximum",argument:t.maximum,message:"must be less than or equal to "+t.maximum}),s}},a.exclusiveMinimum=function(e,t,n,i){if("boolean"!=typeof t.exclusiveMinimum&&this.types.number(e)){var s=new r(e,t,n,i);return e>t.exclusiveMinimum||s.addError({name:"exclusiveMinimum",argument:t.exclusiveMinimum,message:"must be strictly greater than "+t.exclusiveMinimum}),s}},a.exclusiveMaximum=function(e,t,n,i){if("boolean"!=typeof t.exclusiveMaximum&&this.types.number(e)){var s=new r(e,t,n,i);return e<t.exclusiveMaximum||s.addError({name:"exclusiveMaximum",argument:t.exclusiveMaximum,message:"must be strictly less than "+t.exclusiveMaximum}),s}};var h=function(e,t,n,o,a,l){if(this.types.number(e)){var c=t[a];if(0==c)throw new s(a+" cannot be zero");var u=new r(e,t,n,o),h=i.getDecimalPlaces(e),d=i.getDecimalPlaces(c),f=Math.max(h,d),p=Math.pow(10,f);return Math.round(e*p)%Math.round(c*p)!=0&&u.addError({name:a,argument:c,message:l+JSON.stringify(c)}),u}};function d(e,t,n){var r,s=n.length;for(r=t+1;r<s;r++)if(i.deepCompareStrict(e,n[r]))return!1;return!0}a.multipleOf=function(e,t,n,i){return h.call(this,e,t,n,i,"multipleOf","is not a multiple of (divisible by) ")},a.divisibleBy=function(e,t,n,i){return h.call(this,e,t,n,i,"divisibleBy","is not divisible by (multiple of) ")},a.required=function(e,t,n,i){var s=new r(e,t,n,i);return void 0===e&&!0===t.required?s.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach((function(t){void 0===c(e,t)&&s.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})})),s},a.pattern=function(e,t,n,i){if(this.types.string(e)){var s=new r(e,t,n,i),o=t.pattern;try{var a=new RegExp(o,"u")}catch(e){a=new RegExp(o)}return e.match(a)||s.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern.toString())}),s}},a.format=function(e,t,n,s){if(void 0!==e){var o=new r(e,t,n,s);return o.disableFormat||i.isFormat(e,t.format,this)||o.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),o}},a.minLength=function(e,t,n,i){if(this.types.string(e)){var s=new r(e,t,n,i),o=e.match(/[\uDC00-\uDFFF]/g);return e.length-(o?o.length:0)>=t.minLength||s.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),s}},a.maxLength=function(e,t,n,i){if(this.types.string(e)){var s=new r(e,t,n,i),o=e.match(/[\uDC00-\uDFFF]/g);return e.length-(o?o.length:0)<=t.maxLength||s.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),s}},a.minItems=function(e,t,n,i){if(this.types.array(e)){var s=new r(e,t,n,i);return e.length>=t.minItems||s.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),s}},a.maxItems=function(e,t,n,i){if(this.types.array(e)){var s=new r(e,t,n,i);return e.length<=t.maxItems||s.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),s}},a.uniqueItems=function(e,t,n,i){if(!0===t.uniqueItems&&this.types.array(e)){var s=new r(e,t,n,i);return e.every(d)||s.addError({name:"uniqueItems",message:"contains duplicate item"}),s}},a.dependencies=function(e,t,n,i){if(this.types.object(e)){var s=new r(e,t,n,i);for(var o in t.dependencies)if(void 0!==e[o]){var a=t.dependencies[o],l=i.makeChild(a,o);if("string"==typeof a&&(a=[a]),Array.isArray(a))a.forEach((function(t){void 0===e[t]&&s.addError({name:"dependencies",argument:l.propertyPath,message:"property "+t+" not found, required by "+l.propertyPath})}));else{var c=this.validateSchema(e,a,n,l);s.instance!==c.instance&&(s.instance=c.instance),c&&c.errors.length&&(s.addError({name:"dependencies",argument:l.propertyPath,message:"does not meet dependency required by "+l.propertyPath}),s.importErrors(c))}}return s}},a.enum=function(e,t,n,o){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new s("enum expects an array",t);var a=new r(e,t,n,o);return t.enum.some(i.deepCompareStrict.bind(null,e))||a.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),a},a.const=function(e,t,n,s){if(void 0===e)return null;var o=new r(e,t,n,s);return i.deepCompareStrict(t.const,e)||o.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),o},a.not=a.disallow=function(e,t,n,i){var s=this;if(void 0===e)return null;var o=new r(e,t,n,i),a=t.not||t.disallow;return a?(Array.isArray(a)||(a=[a]),a.forEach((function(r){if(s.testType(e,t,n,i,r)){var a=r&&(r.$id||r.id)||r;o.addError({name:"not",argument:a,message:"is of prohibited type "+a})}})),o):null},e.exports=o},1020:(e,t,n)=>{"use strict";var i=n(8526),r=t.ValidationError=function(e,t,n,i,r,s){if(Array.isArray(i)?(this.path=i,this.property=i.reduce((function(e,t){return e+h(t)}),"instance")):void 0!==i&&(this.property=i),e&&(this.message=e),n){var o=n.$id||n.id;this.schema=o||n}void 0!==t&&(this.instance=t),this.name=r,this.argument=s,this.stack=this.toString()};r.prototype.toString=function(){return this.property+" "+this.message};var s=t.ValidatorResult=function(e,t,n,i){this.instance=e,this.schema=t,this.options=n,this.path=i.path,this.propertyPath=i.propertyPath,this.errors=[],this.throwError=n&&n.throwError,this.throwFirst=n&&n.throwFirst,this.throwAll=n&&n.throwAll,this.disableFormat=n&&!0===n.disableFormat};function o(e,t){return t+": "+e.toString()+"\n"}function a(e){Error.captureStackTrace&&Error.captureStackTrace(this,a),this.instance=e.instance,this.schema=e.schema,this.options=e.options,this.errors=e.errors}s.prototype.addError=function(e){var t;if("string"==typeof e)t=new r(e,this.instance,this.schema,this.path);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new r(e.message,this.instance,this.schema,this.path,e.name,e.argument)}if(this.errors.push(t),this.throwFirst)throw new a(this);if(this.throwError)throw t;return t},s.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&(this.errors=this.errors.concat(e.errors))},s.prototype.toString=function(e){return this.errors.map(o).join("")},Object.defineProperty(s.prototype,"valid",{get:function(){return!this.errors.length}}),e.exports.ValidatorResultError=a,a.prototype=new Error,a.prototype.constructor=a,a.prototype.name="Validation Error";var l=t.SchemaError=function e(t,n){this.message=t,this.schema=n,Error.call(this,t),Error.captureStackTrace(this,e)};l.prototype=Object.create(Error.prototype,{constructor:{value:l,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var c=t.SchemaContext=function(e,t,n,i,r){this.schema=e,this.options=t,Array.isArray(n)?(this.path=n,this.propertyPath=n.reduce((function(e,t){return e+h(t)}),"instance")):this.propertyPath=n,this.base=i,this.schemas=r};c.prototype.resolve=function(e){return i.resolve(this.base,e)},c.prototype.makeChild=function(e,t){var n=void 0===t?this.path:this.path.concat([t]),r=e.$id||e.id,s=i.resolve(this.base,r||""),o=new c(e,this.options,n,s,Object.create(this.schemas));return r&&!o.schemas[s]&&(o.schemas[s]=e),o};var u=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};u.regexp=u.regex,u.pattern=u.regex,u.ipv4=u["ip-address"],t.isFormat=function(e,t,n){if("string"==typeof e&&void 0!==u[t]){if(u[t]instanceof RegExp)return u[t].test(e);if("function"==typeof u[t])return u[t](e)}else if(n&&n.customFormats&&"function"==typeof n.customFormats[t])return n.customFormats[t](e);return!0};var h=t.makeSuffix=function(e){return(e=e.toString()).match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};function d(e,t,n,i){"object"==typeof n?t[i]=g(e[i],n):-1===e.indexOf(n)&&t.push(n)}function f(e,t,n){t[n]=e[n]}function p(e,t,n,i){"object"==typeof t[i]&&t[i]&&e[i]?n[i]=g(e[i],t[i]):n[i]=t[i]}function g(e,t){var n=Array.isArray(t),i=n&&[]||{};return n?(e=e||[],i=i.concat(e),t.forEach(d.bind(null,e,i))):(e&&"object"==typeof e&&Object.keys(e).forEach(f.bind(null,e,i)),Object.keys(t).forEach(p.bind(null,e,t,i))),i}function m(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}t.deepCompareStrict=function e(t,n){if(typeof t!=typeof n)return!1;if(Array.isArray(t))return!!Array.isArray(n)&&t.length===n.length&&t.every((function(i,r){return e(t[r],n[r])}));if("object"==typeof t){if(!t||!n)return t===n;var i=Object.keys(t),r=Object.keys(n);return i.length===r.length&&i.every((function(i){return e(t[i],n[i])}))}return t===n},e.exports.deepMerge=g,t.objectGetPath=function(e,t){for(var n,i=t.split("/").slice(1);"string"==typeof(n=i.shift());){var r=decodeURIComponent(n.replace(/~0/,"~").replace(/~1/g,"/"));if(!(r in e))return;e=e[r]}return e},t.encodePath=function(e){return e.map(m).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!=typeof e&&(e=Number(e));var n=e.toString().split("e");if(2===n.length){if("-"!==n[1][0])return t;t=Number(n[1].slice(1))}var i=n[0].split(".");return 2===i.length&&(t+=i[1].length),t},t.isSchema=function(e){return"object"==typeof e&&e||"boolean"==typeof e}},4445:(e,t,n)=>{"use strict";n(6719);n(1020).ValidatorResult,n(1020).ValidatorResultError,n(1020).ValidationError,n(1020).SchemaError,n(3107),n(3107).R},3107:(e,t,n)=>{"use strict";var i=n(8526),r=n(1020);function s(e,t){this.id=e,this.ref=t}e.exports.R=function(e,t){function n(e,t){if(t&&"object"==typeof t)if(t.$ref){var s=i.resolve(e,t.$ref);c[s]=c[s]?c[s]+1:0}else{var u=t.$id||t.id,h=u?i.resolve(e,u):e;if(h){if(h.indexOf("#")<0&&(h+="#"),l[h]){if(!r.deepCompareStrict(l[h],t))throw new Error("Schema <"+h+"> already exists with different definition");return l[h]}l[h]=t,"#"==h[h.length-1]&&(l[h.substring(0,h.length-1)]=t)}o(h+"/items",Array.isArray(t.items)?t.items:[t.items]),o(h+"/extends",Array.isArray(t.extends)?t.extends:[t.extends]),n(h+"/additionalItems",t.additionalItems),a(h+"/properties",t.properties),n(h+"/additionalProperties",t.additionalProperties),a(h+"/definitions",t.definitions),a(h+"/patternProperties",t.patternProperties),a(h+"/dependencies",t.dependencies),o(h+"/disallow",t.disallow),o(h+"/allOf",t.allOf),o(h+"/anyOf",t.anyOf),o(h+"/oneOf",t.oneOf),n(h+"/not",t.not)}}function o(e,t){if(Array.isArray(t))for(var i=0;i<t.length;i++)n(e+"/"+i,t[i])}function a(e,t){if(t&&"object"==typeof t)for(var i in t)n(e+"/"+i,t[i])}var l={},c={};return n(e,t),new s(l,c)}},6719:(e,t,n)=>{"use strict";var i=n(8526),r=n(9427),s=n(1020),o=n(3107).R,a=s.ValidatorResult,l=s.ValidatorResultError,c=s.SchemaError,u=s.SchemaContext,h=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(f),this.attributes=Object.create(r.validators)};function d(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}h.prototype.customFormats={},h.prototype.schemas=null,h.prototype.types=null,h.prototype.attributes=null,h.prototype.unresolvedRefs=null,h.prototype.addSchema=function(e,t){var n=this;if(!e)return null;var i=o(t||"/",e),r=t||e.$id||e.id;for(var s in i.id)this.schemas[s]=i.id[s];for(var s in i.ref)this.unresolvedRefs.push(s);return this.unresolvedRefs=this.unresolvedRefs.filter((function(e){return void 0===n.schemas[e]})),this.schemas[r]},h.prototype.addSubSchemaArray=function(e,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)this.addSubSchema(e,t[n])},h.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var n in t)this.addSubSchema(e,t[n])},h.prototype.setSchemas=function(e){this.schemas=e},h.prototype.getSchema=function(e){return this.schemas[e]},h.prototype.validate=function(e,t,n,r){if("boolean"!=typeof t&&"object"!=typeof t||null===t)throw new c("Expected `schema` to be an object or boolean");n||(n={});var s,h=t.$id||t.id,d=i.resolve(n.base||"/",h||"");if(!r){(r=new u(t,n,[],d,Object.create(this.schemas))).schemas[d]||(r.schemas[d]=t);var f=o(d,t);for(var p in f.id){var g=f.id[p];r.schemas[p]=g}}if(n.required&&void 0===e)return(s=new a(e,t,n,r)).addError("is required, but is undefined"),s;if(!(s=this.validateSchema(e,t,n,r)))throw new Error("Result undefined");if(n.throwAll&&s.errors.length)throw new l(s);return s},h.prototype.validateSchema=function(e,t,n,i){var o=new a(e,t,n,i);if("boolean"==typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(Array.isArray(t.extends)){var l={schema:t,ctx:i};t.extends.forEach(this.schemaTraverser.bind(this,l)),t=l.schema,l.schema=null,l.ctx=null,l=null}else t=s.deepMerge(t,this.superResolve(t.extends,i));var h=d(t);if(h){var f=this.resolve(t,h,i),p=new u(f.subschema,n,i.path,f.switchSchema,i.schemas);return this.validateSchema(e,f.subschema,n,p)}var g=n&&n.skipAttributes||[];for(var m in t)if(!r.ignoreProperties[m]&&g.indexOf(m)<0){var y=null,b=this.attributes[m];if(b)y=b.call(this,e,t,n,i);else if(!1===n.allowUnknownAttributes)throw new c("Unsupported attribute: "+m,t);y&&o.importErrors(y)}if("function"==typeof n.rewrite){var v=n.rewrite.call(this,e,t,n,i);o.instance=v}return o},h.prototype.schemaTraverser=function(e,t){e.schema=s.deepMerge(e.schema,this.superResolve(t,e.ctx))},h.prototype.superResolve=function(e,t){var n=d(e);return n?this.resolve(e,n,t).subschema:e},h.prototype.resolve=function(e,t,n){if(t=n.resolve(t),n.schemas[t])return{subschema:n.schemas[t],switchSchema:t};var r=i.parse(t),o=r&&r.hash,a=o&&o.length&&t.substr(0,t.length-o.length);if(!a||!n.schemas[a])throw new c("no such schema <"+t+">",e);var l=s.objectGetPath(n.schemas[a],o.substr(1));if(void 0===l)throw new c("no such schema "+o+" located in <"+a+">",e);return{subschema:l,switchSchema:t}},h.prototype.testType=function(e,t,n,i,r){if(void 0!==r){if(null===r)throw new c('Unexpected null in "type" keyword');if("function"==typeof this.types[r])return this.types[r].call(this,e);if(r&&"object"==typeof r){var s=this.validateSchema(e,r,n,i);return void 0===s||!(s&&s.errors.length)}return!0}};var f=h.prototype.types={};f.string=function(e){return"string"==typeof e},f.number=function(e){return"number"==typeof e&&isFinite(e)},f.integer=function(e){return"number"==typeof e&&e%1==0},f.boolean=function(e){return"boolean"==typeof e},f.array=function(e){return Array.isArray(e)},f.null=function(e){return null===e},f.date=function(e){return e instanceof Date},f.any=function(e){return!0},f.object=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date)},e.exports=h},201:(e,t,n)=>{var i="function"==typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=i&&r&&"function"==typeof r.get?r.get:null,o=i&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,u=a&&Set.prototype.forEach,h="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,d="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,f="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,g=Object.prototype.toString,m=Function.prototype.toString,y=String.prototype.match,b=String.prototype.slice,v=String.prototype.replace,w=String.prototype.toUpperCase,S=String.prototype.toLowerCase,k=RegExp.prototype.test,x=Array.prototype.concat,E=Array.prototype.join,_=Array.prototype.slice,O=Math.floor,C="function"==typeof BigInt?BigInt.prototype.valueOf:null,T=Object.getOwnPropertySymbols,A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"==typeof Symbol&&"object"==typeof Symbol.iterator,F="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,L=Object.prototype.propertyIsEnumerable,N=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function R(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||k.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var i=e<0?-O(-e):O(e);if(i!==e){var r=String(i),s=b.call(t,r.length+1);return v.call(r,n,"$&_")+"."+v.call(v.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(t,n,"$&_")}var I=n(6553),j=I.custom,M=V(j)?j:null;function D(e,t,n){var i="double"===(n.quoteStyle||t)?'"':"'";return i+e+i}function B(e){return v.call(String(e),/"/g,"&quot;")}function $(e){return!("[object Array]"!==W(e)||F&&"object"==typeof e&&F in e)}function U(e){return!("[object RegExp]"!==W(e)||F&&"object"==typeof e&&F in e)}function V(e){if(P)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!A)return!1;try{return A.call(e),!0}catch(e){}return!1}e.exports=function e(t,i,r,a){var l=i||{};if(z(l,"quoteStyle")&&"single"!==l.quoteStyle&&"double"!==l.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(z(l,"maxStringLength")&&("number"==typeof l.maxStringLength?l.maxStringLength<0&&l.maxStringLength!==1/0:null!==l.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var g=!z(l,"customInspect")||l.customInspect;if("boolean"!=typeof g&&"symbol"!==g)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(z(l,"indent")&&null!==l.indent&&"\t"!==l.indent&&!(parseInt(l.indent,10)===l.indent&&l.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(z(l,"numericSeparator")&&"boolean"!=typeof l.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var w=l.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return Z(t,l);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var k=String(t);return w?R(t,k):k}if("bigint"==typeof t){var O=String(t)+"n";return w?R(t,O):O}var T=void 0===l.depth?5:l.depth;if(void 0===r&&(r=0),r>=T&&T>0&&"object"==typeof t)return $(t)?"[Array]":"[Object]";var j,H=function(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;n=E.call(Array(e.indent+1)," ")}return{base:n,prev:E.call(Array(t+1),n)}}(l,r);if(void 0===a)a=[];else if(q(a,t)>=0)return"[Circular]";function X(t,n,i){if(n&&(a=_.call(a)).push(n),i){var s={depth:l.depth};return z(l,"quoteStyle")&&(s.quoteStyle=l.quoteStyle),e(t,s,r+1,a)}return e(t,l,r+1,a)}if("function"==typeof t&&!U(t)){var ee=function(e){if(e.name)return e.name;var t=y.call(m.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),te=Q(t,X);return"[Function"+(ee?": "+ee:" (anonymous)")+"]"+(te.length>0?" { "+E.call(te,", ")+" }":"")}if(V(t)){var ne=P?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):A.call(t);return"object"!=typeof t||P?ne:K(ne)}if((j=t)&&"object"==typeof j&&("undefined"!=typeof HTMLElement&&j instanceof HTMLElement||"string"==typeof j.nodeName&&"function"==typeof j.getAttribute)){for(var ie="<"+S.call(String(t.nodeName)),re=t.attributes||[],se=0;se<re.length;se++)ie+=" "+re[se].name+"="+D(B(re[se].value),"double",l);return ie+=">",t.childNodes&&t.childNodes.length&&(ie+="..."),ie+"</"+S.call(String(t.nodeName))+">"}if($(t)){if(0===t.length)return"[]";var oe=Q(t,X);return H&&!function(e){for(var t=0;t<e.length;t++)if(q(e[t],"\n")>=0)return!1;return!0}(oe)?"["+J(oe,H)+"]":"[ "+E.call(oe,", ")+" ]"}if(function(e){return!("[object Error]"!==W(e)||F&&"object"==typeof e&&F in e)}(t)){var ae=Q(t,X);return"cause"in Error.prototype||!("cause"in t)||L.call(t,"cause")?0===ae.length?"["+String(t)+"]":"{ ["+String(t)+"] "+E.call(ae,", ")+" }":"{ ["+String(t)+"] "+E.call(x.call("[cause]: "+X(t.cause),ae),", ")+" }"}if("object"==typeof t&&g){if(M&&"function"==typeof t[M]&&I)return I(t,{depth:T-r});if("symbol"!==g&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var le=[];return o&&o.call(t,(function(e,n){le.push(X(n,t,!0)+" => "+X(e,t))})),Y("Map",s.call(t),le,H)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var ce=[];return u&&u.call(t,(function(e){ce.push(X(e,t))})),Y("Set",c.call(t),ce,H)}if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return G("WeakMap");if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return G("WeakSet");if(function(e){if(!f||!e||"object"!=typeof e)return!1;try{return f.call(e),!0}catch(e){}return!1}(t))return G("WeakRef");if(function(e){return!("[object Number]"!==W(e)||F&&"object"==typeof e&&F in e)}(t))return K(X(Number(t)));if(function(e){if(!e||"object"!=typeof e||!C)return!1;try{return C.call(e),!0}catch(e){}return!1}(t))return K(X(C.call(t)));if(function(e){return!("[object Boolean]"!==W(e)||F&&"object"==typeof e&&F in e)}(t))return K(p.call(t));if(function(e){return!("[object String]"!==W(e)||F&&"object"==typeof e&&F in e)}(t))return K(X(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===n.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==W(e)||F&&"object"==typeof e&&F in e)}(t)&&!U(t)){var ue=Q(t,X),he=N?N(t)===Object.prototype:t instanceof Object||t.constructor===Object,de=t instanceof Object?"":"null prototype",fe=!he&&F&&Object(t)===t&&F in t?b.call(W(t),8,-1):de?"Object":"",pe=(he||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(fe||de?"["+E.call(x.call([],fe||[],de||[]),": ")+"] ":"");return 0===ue.length?pe+"{}":H?pe+"{"+J(ue,H)+"}":pe+"{ "+E.call(ue,", ")+" }"}return String(t)};var H=Object.prototype.hasOwnProperty||function(e){return e in this};function z(e,t){return H.call(e,t)}function W(e){return g.call(e)}function q(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function Z(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,i="... "+n+" more character"+(n>1?"s":"");return Z(b.call(e,0,t.maxStringLength),t)+i}return D(v.call(v.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,X),"single",t)}function X(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+w.call(t.toString(16))}function K(e){return"Object("+e+")"}function G(e){return e+" { ? }"}function Y(e,t,n,i){return e+" ("+t+") {"+(i?J(n,i):E.call(n,", "))+"}"}function J(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+E.call(e,","+n)+"\n"+t.prev}function Q(e,t){var n=$(e),i=[];if(n){i.length=e.length;for(var r=0;r<e.length;r++)i[r]=z(e,r)?t(e[r],e):""}var s,o="function"==typeof T?T(e):[];if(P){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in e)z(e,l)&&(n&&String(Number(l))===l&&l<e.length||P&&s["$"+l]instanceof Symbol||(k.call(/[^\w$]/,l)?i.push(t(l,e)+": "+t(e[l],e)):i.push(l+": "+t(e[l],e))));if("function"==typeof T)for(var c=0;c<o.length;c++)L.call(e,o[c])&&i.push("["+t(o[c])+"]: "+t(e[o[c]],e));return i}},2565:(e,t,n)=>{"use strict";var i=n(3298),r=/[\/\?<>\\:\*\|"]/g,s=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l=/[\. ]+$/;function c(e,t){if("string"!=typeof e)throw new Error("Input must be string");var n=e.replace(r,t).replace(s,t).replace(o,t).replace(a,t).replace(l,t);return i(n,255)}e.exports=function(e,t){var n=t&&t.replacement||"",i=c(e,n);return""===n?i:c(i,"")}},7319:(e,t,n)=>{"use strict";var i=n(4663),r=n(8531),s=n(3219)(),o=n(8337),a=i("%TypeError%"),l=i("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new a("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||l(t)!==t)throw new a("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],i=!0,c=!0;if("length"in e&&o){var u=o(e,"length");u&&!u.configurable&&(i=!1),u&&!u.writable&&(c=!1)}return(i||c||!n)&&(s?r(e,"length",t,!0,!0):r(e,"length",t)),e}},8959:(e,t,n)=>{"use strict";var i=n(4663),r=n(8608),s=n(201),o=i("%TypeError%"),a=i("%WeakMap%",!0),l=i("%Map%",!0),c=r("WeakMap.prototype.get",!0),u=r("WeakMap.prototype.set",!0),h=r("WeakMap.prototype.has",!0),d=r("Map.prototype.get",!0),f=r("Map.prototype.set",!0),p=r("Map.prototype.has",!0),g=function(e,t){for(var n,i=e;null!==(n=i.next);i=n)if(n.key===t)return i.next=n.next,n.next=e.next,e.next=n,n};e.exports=function(){var e,t,n,i={assert:function(e){if(!i.has(e))throw new o("Side channel does not contain "+s(e))},get:function(i){if(a&&i&&("object"==typeof i||"function"==typeof i)){if(e)return c(e,i)}else if(l){if(t)return d(t,i)}else if(n)return function(e,t){var n=g(e,t);return n&&n.value}(n,i)},has:function(i){if(a&&i&&("object"==typeof i||"function"==typeof i)){if(e)return h(e,i)}else if(l){if(t)return p(t,i)}else if(n)return function(e,t){return!!g(e,t)}(n,i);return!1},set:function(i,r){a&&i&&("object"==typeof i||"function"==typeof i)?(e||(e=new a),u(e,i,r)):l?(t||(t=new l),f(t,i,r)):(n||(n={key:{},next:null}),function(e,t,n){var i=g(e,t);i?i.value=n:e.next={key:t,next:e.next,value:n}}(n,i,r))}};return i}},5326:e=>{const t=/^[-+]?0x[a-fA-F0-9]+$/,n=/^([\-\+])?(0*)(\.[0-9]+([eE]\-?[0-9]+)?|[0-9]+(\.[0-9]+([eE]\-?[0-9]+)?)?)$/;!Number.parseInt&&window.parseInt&&(Number.parseInt=window.parseInt),!Number.parseFloat&&window.parseFloat&&(Number.parseFloat=window.parseFloat);const i={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0};e.exports=function(e,r={}){if(r=Object.assign({},i,r),!e||"string"!=typeof e)return e;let s=e.trim();if(void 0!==r.skipLike&&r.skipLike.test(s))return e;if(r.hex&&t.test(s))return Number.parseInt(s,16);{const t=n.exec(s);if(t){const n=t[1],i=t[2];let a=(o=t[3])&&-1!==o.indexOf(".")?("."===(o=o.replace(/0+$/,""))?o="0":"."===o[0]?o="0"+o:"."===o[o.length-1]&&(o=o.substr(0,o.length-1)),o):o;const l=t[4]||t[6];if(!r.leadingZeros&&i.length>0&&n&&"."!==s[2])return e;if(!r.leadingZeros&&i.length>0&&!n&&"."!==s[1])return e;{const t=Number(s),o=""+t;return-1!==o.search(/[eE]/)||l?r.eNotation?t:e:-1!==s.indexOf(".")?"0"===o&&""===a||o===a||n&&o==="-"+a?t:e:i?a===o||n+a===o?t:e:s===o||s===n+o?t:e}}return e}var o}},3298:(e,t,n)=>{"use strict";var i=n(2815),r=n(2875);e.exports=i.bind(null,r)},2815:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e,i,r){if("string"!=typeof i)throw new Error("Input must be string");for(var s,o,a=i.length,l=0,c=0;c<a;c+=1){if(s=i.charCodeAt(c),o=i[c],t(s)&&n(i.charCodeAt(c+1))&&(o+=i[c+=1]),(l+=e(o))===r)return i.slice(0,c+1);if(l>r)return i.slice(0,c-o.length+1)}return i}},9177:function(e,t,n){var i;e=n.nmd(e),function(r){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof n.g&&n.g;s.global!==s&&s.window!==s&&s.self;var o,a=2147483647,l=36,c=26,u=38,h=700,d=/^xn--/,f=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=l-1,y=Math.floor,b=String.fromCharCode;function v(e){throw new RangeError(g[e])}function w(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function S(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+w((e=e.replace(p,".")).split("."),t).join(".")}function k(e){for(var t,n,i=[],r=0,s=e.length;r<s;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<s?56320==(64512&(n=e.charCodeAt(r++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),r--):i.push(t);return i}function x(e){return w(e,(function(e){var t="";return e>65535&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+b(e)})).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function _(e,t,n){var i=0;for(e=n?y(e/h):e>>1,e+=y(e/t);e>m*c>>1;i+=l)e=y(e/m);return y(i+(m+1)*e/(e+u))}function O(e){var t,n,i,r,s,o,u,h,d,f,p,g=[],m=e.length,b=0,w=128,S=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&v("not-basic"),g.push(e.charCodeAt(i));for(r=n>0?n+1:0;r<m;){for(s=b,o=1,u=l;r>=m&&v("invalid-input"),((h=(p=e.charCodeAt(r++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:l)>=l||h>y((a-b)/o))&&v("overflow"),b+=h*o,!(h<(d=u<=S?1:u>=S+c?c:u-S));u+=l)o>y(a/(f=l-d))&&v("overflow"),o*=f;S=_(b-s,t=g.length+1,0==s),y(b/t)>a-w&&v("overflow"),w+=y(b/t),b%=t,g.splice(b++,0,w)}return x(g)}function C(e){var t,n,i,r,s,o,u,h,d,f,p,g,m,w,S,x=[];for(g=(e=k(e)).length,t=128,n=0,s=72,o=0;o<g;++o)(p=e[o])<128&&x.push(b(p));for(i=r=x.length,r&&x.push("-");i<g;){for(u=a,o=0;o<g;++o)(p=e[o])>=t&&p<u&&(u=p);for(u-t>y((a-n)/(m=i+1))&&v("overflow"),n+=(u-t)*m,t=u,o=0;o<g;++o)if((p=e[o])<t&&++n>a&&v("overflow"),p==t){for(h=n,d=l;!(h<(f=d<=s?1:d>=s+c?c:d-s));d+=l)S=h-f,w=l-f,x.push(b(E(f+S%w,0))),h=y(S/w);x.push(b(E(h,0))),s=_(n,m,i==r),n=0,++i}++n,++t}return x.join("")}o={version:"1.4.1",ucs2:{decode:k,encode:x},decode:O,encode:C,toASCII:function(e){return S(e,(function(e){return f.test(e)?"xn--"+C(e):e}))},toUnicode:function(e){return S(e,(function(e){return d.test(e)?O(e.slice(4).toLowerCase()):e}))}},void 0===(i=function(){return o}.call(t,n,t,e))||(e.exports=i)}()},7032:e=>{"use strict";var t=String.prototype.replace,n=/%20/g,i="RFC3986";e.exports={default:i,formatters:{RFC1738:function(e){return t.call(e,n,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:i}},3184:(e,t,n)=>{"use strict";var i=n(1645),r=n(5610),s=n(7032);e.exports={formats:s,parse:r,stringify:i}},5610:(e,t,n)=>{"use strict";var i=n(8206),r=Object.prototype.hasOwnProperty,s=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:i.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},l=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},c=function(e,t,n,i){if(e){var s=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(s),c=a?s.slice(0,a.index):s,u=[];if(c){if(!n.plainObjects&&r.call(Object.prototype,c)&&!n.allowPrototypes)return;u.push(c)}for(var h=0;n.depth>0&&null!==(a=o.exec(s))&&h<n.depth;){if(h+=1,!n.plainObjects&&r.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(a[1])}return a&&u.push("["+s.slice(a.index)+"]"),function(e,t,n,i){for(var r=i?t:l(t,n),s=e.length-1;s>=0;--s){var o,a=e[s];if("[]"===a&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var c="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,u=parseInt(c,10);n.parseArrays||""!==c?!isNaN(u)&&a!==c&&String(u)===c&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[])[u]=r:"__proto__"!==c&&(o[c]=r):o={0:r}}r=o}return r}(u,t,n,i)}};e.exports=function(e,t){var n=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?o.charset:e.charset;return{allowDots:void 0===e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||i.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var n,c={__proto__:null},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,h=t.parameterLimit===1/0?void 0:t.parameterLimit,d=u.split(t.delimiter,h),f=-1,p=t.charset;if(t.charsetSentinel)for(n=0;n<d.length;++n)0===d[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===d[n]?p="utf-8":"utf8=%26%2310003%3B"===d[n]&&(p="iso-8859-1"),f=n,n=d.length);for(n=0;n<d.length;++n)if(n!==f){var g,m,y=d[n],b=y.indexOf("]="),v=-1===b?y.indexOf("="):b+1;-1===v?(g=t.decoder(y,o.decoder,p,"key"),m=t.strictNullHandling?null:""):(g=t.decoder(y.slice(0,v),o.decoder,p,"key"),m=i.maybeMap(l(y.slice(v+1),t),(function(e){return t.decoder(e,o.decoder,p,"value")}))),m&&t.interpretNumericEntities&&"iso-8859-1"===p&&(m=a(m)),y.indexOf("[]=")>-1&&(m=s(m)?[m]:m),r.call(c,g)?c[g]=i.combine(c[g],m):c[g]=m}return c}(e,n):e,h=n.plainObjects?Object.create(null):{},d=Object.keys(u),f=0;f<d.length;++f){var p=d[f],g=c(p,u[p],n,"string"==typeof e);h=i.merge(h,g,n)}return!0===n.allowSparse?h:i.compact(h)}},1645:(e,t,n)=>{"use strict";var i=n(8959),r=n(8206),s=n(7032),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,l(t)?t:[t])},h=Date.prototype.toISOString,d=s.default,f={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:d,formatter:s.formatters[d],indices:!1,serializeDate:function(e){return h.call(e)},skipNulls:!1,strictNullHandling:!1},p={},g=function e(t,n,s,o,a,c,h,d,g,m,y,b,v,w,S,k){for(var x,E=t,_=k,O=0,C=!1;void 0!==(_=_.get(p))&&!C;){var T=_.get(t);if(O+=1,void 0!==T){if(T===O)throw new RangeError("Cyclic object value");C=!0}void 0===_.get(p)&&(O=0)}if("function"==typeof d?E=d(n,E):E instanceof Date?E=y(E):"comma"===s&&l(E)&&(E=r.maybeMap(E,(function(e){return e instanceof Date?y(e):e}))),null===E){if(a)return h&&!w?h(n,f.encoder,S,"key",b):n;E=""}if("string"==typeof(x=E)||"number"==typeof x||"boolean"==typeof x||"symbol"==typeof x||"bigint"==typeof x||r.isBuffer(E))return h?[v(w?n:h(n,f.encoder,S,"key",b))+"="+v(h(E,f.encoder,S,"value",b))]:[v(n)+"="+v(String(E))];var A,P=[];if(void 0===E)return P;if("comma"===s&&l(E))w&&h&&(E=r.maybeMap(E,h)),A=[{value:E.length>0?E.join(",")||null:void 0}];else if(l(d))A=d;else{var F=Object.keys(E);A=g?F.sort(g):F}for(var L=o&&l(E)&&1===E.length?n+"[]":n,N=0;N<A.length;++N){var R=A[N],I="object"==typeof R&&void 0!==R.value?R.value:E[R];if(!c||null!==I){var j=l(E)?"function"==typeof s?s(L,R):L:L+(m?"."+R:"["+R+"]");k.set(t,O);var M=i();M.set(p,k),u(P,e(I,j,s,o,a,c,"comma"===s&&w&&l(E)?null:h,d,g,m,y,b,v,w,S,M))}}return P};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return f;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||f.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=s.default;if(void 0!==e.format){if(!o.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var i=s.formatters[n],r=f.filter;return("function"==typeof e.filter||l(e.filter))&&(r=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:f.addQueryPrefix,allowDots:void 0===e.allowDots?f.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:f.charsetSentinel,delimiter:void 0===e.delimiter?f.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:f.encode,encoder:"function"==typeof e.encoder?e.encoder:f.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:f.encodeValuesOnly,filter:r,format:n,formatter:i,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:f.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:f.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:f.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):l(c.filter)&&(n=c.filter);var h,d=[];if("object"!=typeof r||null===r)return"";h=t&&t.arrayFormat in a?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=a[h];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var m="comma"===p&&t&&t.commaRoundTrip;n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var y=i(),b=0;b<n.length;++b){var v=n[b];c.skipNulls&&null===r[v]||u(d,g(r[v],v,p,m,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.format,c.formatter,c.encodeValuesOnly,c.charset,y))}var w=d.join(c.delimiter),S=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?S+="utf8=%26%2310003%3B&":S+="utf8=%E2%9C%93&"),w.length>0?S+w:""}},8206:(e,t,n)=>{"use strict";var i=n(7032),r=Object.prototype.hasOwnProperty,s=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},i=0;i<e.length;++i)void 0!==e[i]&&(n[i]=e[i]);return n};e.exports={arrayToObject:a,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],i=0;i<t.length;++i)for(var r=t[i],o=r.obj[r.prop],a=Object.keys(o),l=0;l<a.length;++l){var c=a[l],u=o[c];"object"==typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:o,prop:c}),n.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),n=t.obj[t.prop];if(s(n)){for(var i=[],r=0;r<n.length;++r)void 0!==n[r]&&i.push(n[r]);t.obj[t.prop]=i}}}(t),e},decode:function(e,t,n){var i=e.replace(/\+/g," ");if("iso-8859-1"===n)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(e){return i}},encode:function(e,t,n,r,s){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===n)return escape(a).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var l="",c=0;c<a.length;++c){var u=a.charCodeAt(c);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===i.RFC1738&&(40===u||41===u)?l+=a.charAt(c):u<128?l+=o[u]:u<2048?l+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?l+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(c+=1,u=65536+((1023&u)<<10|1023&a.charCodeAt(c)),l+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return l},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n}return t(e)},merge:function e(t,n,i){if(!n)return t;if("object"!=typeof n){if(s(t))t.push(n);else{if(!t||"object"!=typeof t)return[t,n];(i&&(i.plainObjects||i.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(n);var o=t;return s(t)&&!s(n)&&(o=a(t,i)),s(t)&&s(n)?(n.forEach((function(n,s){if(r.call(t,s)){var o=t[s];o&&"object"==typeof o&&n&&"object"==typeof n?t[s]=e(o,n,i):t.push(n)}else t[s]=n})),t):Object.keys(n).reduce((function(t,s){var o=n[s];return r.call(t,s)?t[s]=e(t[s],o,i):t[s]=o,t}),o)}}},8526:(e,t,n)=>{"use strict";var i=n(9177);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,a=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,l=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(l),u=["%","/","?",";","#"].concat(c),h=["/","?","#"],d=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,p={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},m={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=n(3184);function b(e,t,n){if(e&&"object"==typeof e&&e instanceof r)return e;var i=new r;return i.parse(e,t,n),i}r.prototype.parse=function(e,t,n){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),o=-1!==r&&r<e.indexOf("#")?"?":"#",l=e.split(o);l[0]=l[0].replace(/\\/g,"/");var b=e=l.join(o);if(b=b.trim(),!n&&1===e.split("#").length){var v=a.exec(b);if(v)return this.path=b,this.href=b,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=s.exec(b);if(w){var S=(w=w[0]).toLowerCase();this.protocol=S,b=b.substr(w.length)}if(n||w||b.match(/^\/\/[^@/]+@[^@/]+/)){var k="//"===b.substr(0,2);!k||w&&g[w]||(b=b.substr(2),this.slashes=!0)}if(!g[w]&&(k||w&&!m[w])){for(var x,E,_=-1,O=0;O<h.length;O++)-1!==(C=b.indexOf(h[O]))&&(-1===_||C<_)&&(_=C);for(-1!==(E=-1===_?b.lastIndexOf("@"):b.lastIndexOf("@",_))&&(x=b.slice(0,E),b=b.slice(E+1),this.auth=decodeURIComponent(x)),_=-1,O=0;O<u.length;O++){var C;-1!==(C=b.indexOf(u[O]))&&(-1===_||C<_)&&(_=C)}-1===_&&(_=b.length),this.host=b.slice(0,_),b=b.slice(_),this.parseHost(),this.hostname=this.hostname||"";var T="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!T)for(var A=this.hostname.split(/\./),P=(O=0,A.length);O<P;O++){var F=A[O];if(F&&!F.match(d)){for(var L="",N=0,R=F.length;N<R;N++)F.charCodeAt(N)>127?L+="x":L+=F[N];if(!L.match(d)){var I=A.slice(0,O),j=A.slice(O+1),M=F.match(f);M&&(I.push(M[1]),j.unshift(M[2])),j.length&&(b="/"+j.join(".")+b),this.hostname=I.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),T||(this.hostname=i.toASCII(this.hostname));var D=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+D,this.href+=this.host,T&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!p[S])for(O=0,P=c.length;O<P;O++){var $=c[O];if(-1!==b.indexOf($)){var U=encodeURIComponent($);U===$&&(U=escape($)),b=b.split($).join(U)}}var V=b.indexOf("#");-1!==V&&(this.hash=b.substr(V),b=b.slice(0,V));var H=b.indexOf("?");if(-1!==H?(this.search=b.substr(H),this.query=b.substr(H+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,H)):t&&(this.search="",this.query={}),b&&(this.pathname=b),m[S]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){D=this.pathname||"";var z=this.search||"";this.path=D+z}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",i=this.hash||"",r=!1,s="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||m[t])&&!1!==r?(r="//"+(r||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):r||(r=""),i&&"#"!==i.charAt(0)&&(i="#"+i),o&&"?"!==o.charAt(0)&&(o="?"+o),t+r+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(o=o.replace("#","%23"))+i},r.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if("string"==typeof e){var t=new r;t.parse(e,!1,!0),e=t}for(var n=new r,i=Object.keys(this),s=0;s<i.length;s++){var o=i[s];n[o]=this[o]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var a=Object.keys(e),l=0;l<a.length;l++){var c=a[l];"protocol"!==c&&(n[c]=e[c])}return m[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!m[e.protocol]){for(var u=Object.keys(e),h=0;h<u.length;h++){var d=u[h];n[d]=e[d]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||g[e.protocol])n.pathname=e.pathname;else{for(var f=(e.pathname||"").split("/");f.length&&!(e.host=f.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==f[0]&&f.unshift(""),f.length<2&&f.unshift(""),n.pathname=f.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var p=n.pathname||"",y=n.search||"";n.path=p+y}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=v||b||n.host&&e.pathname,S=w,k=n.pathname&&n.pathname.split("/")||[],x=(f=e.pathname&&e.pathname.split("/")||[],n.protocol&&!m[n.protocol]);if(x&&(n.hostname="",n.port=null,n.host&&(""===k[0]?k[0]=n.host:k.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===f[0]?f[0]=e.host:f.unshift(e.host)),e.host=null),w=w&&(""===f[0]||""===k[0])),v)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,k=f;else if(f.length)k||(k=[]),k.pop(),k=k.concat(f),n.search=e.search,n.query=e.query;else if(null!=e.search)return x&&(n.host=k.shift(),n.hostname=n.host,(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.hostname=T.shift(),n.host=n.hostname)),n.search=e.search,n.query=e.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!k.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var E=k.slice(-1)[0],_=(n.host||e.host||k.length>1)&&("."===E||".."===E)||""===E,O=0,C=k.length;C>=0;C--)"."===(E=k[C])?k.splice(C,1):".."===E?(k.splice(C,1),O++):O&&(k.splice(C,1),O--);if(!w&&!S)for(;O--;O)k.unshift("..");!w||""===k[0]||k[0]&&"/"===k[0].charAt(0)||k.unshift(""),_&&"/"!==k.join("/").substr(-1)&&k.push("");var T,A=""===k[0]||k[0]&&"/"===k[0].charAt(0);return x&&(n.hostname=A?"":k.length?k.shift():"",n.host=n.hostname,(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.hostname=T.shift(),n.host=n.hostname)),(w=w||n.host&&k.length)&&!A&&k.unshift(""),k.length>0?n.pathname=k.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){return"string"==typeof e&&(e=b(e)),e instanceof r?e.format():r.prototype.format.call(e)},t.Url=r},2875:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var i=e.length,r=0,s=null,o=null,a=0;a<i;a++)n(s=e.charCodeAt(a))?null!=o&&t(o)?r+=1:r+=3:s<=127?r+=1:s>=128&&s<=2047?r+=2:s>=2048&&s<=65535&&(r+=3),o=s;return r}},462:(e,t,n)=>{e.exports={WebVTT:n(5115).WebVTT,VTTCue:n(4747).VTTCue,VTTRegion:n(1271).VTTRegion}},5115:function(){!function(e){function t(e,t){return void 0===t&&(t=1),"rgba("+[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16),t].join(",")+")"}var n=1;function i(e,i,s){switch(s){case"webvtt.font.color":case"webvtt.font.opacity":var o=Services.prefs.getCharPref("webvtt.font.color"),a=Services.prefs.getIntPref("webvtt.font.opacity")/100;r.fontSet=t(o,a);break;case"webvtt.font.scale":n=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var l=Services.prefs.getCharPref("webvtt.bg.color"),c=Services.prefs.getIntPref("webvtt.bg.opacity")/100;r.backgroundSet=t(l,c);break;case"webvtt.edge.color":case"webvtt.edge.type":var u=Services.prefs.getIntPref("webvtt.edge.type"),h=Services.prefs.getCharPref("webvtt.edge.color");r.edgeSet=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "][u]+t(h)}}if("undefined"!=typeof Services){var r={};["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"].forEach((function(e){i(0,0,e),Services.prefs.addObserver(e,i,!1)}))}var s=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function o(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function a(e){function t(e,t,n,i){return 3600*(0|e)+60*(0|t)+(0|n)+(0|i)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function l(){this.values=s(null)}function c(e,t,n,i){var r=i?e.split(i):[e];for(var s in r)if("string"==typeof r[s]){var o=r[s].split(n);2===o.length&&t(o[0],o[1])}}function u(e,t,n){var i=e;function r(){var t=a(e);if(null===t)throw new o(o.Errors.BadTimeStamp,"Malformed timestamp: "+i);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=r(),s(),"--\x3e"!==e.substr(0,3))throw new o(o.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);e=e.substr(3),s(),t.endTime=r(),s(),function(e,t){var i=new l;c(e,(function(e,t){switch(e){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===t){i.set(e,n[r].region);break}break;case"vertical":i.alt(e,t,["rl","lr"]);break;case"line":var s=t.split(","),o=s[0];i.integer(e,o),i.percent(e,o)&&i.set("snapToLines",!1),i.alt(e,o,["auto"]),2===s.length&&i.alt("lineAlign",s[1],["start","middle","end"]);break;case"position":s=t.split(","),i.percent(e,s[0]),2===s.length&&i.alt("positionAlign",s[1],["start","middle","end"]);break;case"size":i.percent(e,t);break;case"align":i.alt(e,t,["start","middle","end","left","right"])}}),/:/,/\s/),t.region=i.get("region",null),t.vertical=i.get("vertical",""),t.line=i.get("line","auto"),t.lineAlign=i.get("lineAlign","start"),t.snapToLines=i.get("snapToLines",!0),t.size=i.get("size",100),t.align=i.get("align","middle"),t.position=i.get("position","auto"),t.positionAlign=i.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}(e,t)}o.prototype=s(Error.prototype),o.prototype.constructor=o,o.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},l.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var i=0;i<n.length;++i)if(t===n[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var h={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},d={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},f={v:"title",lang:"lang"},p={rt:"ruby"};function g(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]+>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function i(e){return h[e]}function r(e){for(;b=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)e=e.replace(b[0],i);return e}function s(e,t){return!p[t.localName]||p[t.localName]===e.localName}function o(t,n){var i=d[t];if(!i)return null;var r=e.document.createElement(i);r.localName=i;var s=f[t];return s&&n&&(r[s]=n.trim()),r}for(var l,c=e.document.createElement("div"),u=c,g=[];null!==(l=n());)if("<"!==l[0])u.appendChild(e.document.createTextNode(r(l)));else{if("/"===l[1]){g.length&&g[g.length-1]===l.substr(2).replace(">","")&&(g.pop(),u=u.parentNode);continue}var m,y=a(l.substr(1,l.length-2));if(y){m=e.document.createProcessingInstruction("timestamp",y),u.appendChild(m);continue}var b=l.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!b)continue;if(!(m=o(b[1],b[3])))continue;if(!s(u,m))continue;b[2]&&(m.className=b[2].substr(1).replace("."," ")),g.push(b[1]),u.appendChild(m),u=m}return c}var m=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function y(e){for(var t=0;t<m.length;t++){var n=m[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function b(){}function v(e,t,n){var i="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent),s="rgba(255, 255, 255, 1)",o="rgba(0, 0, 0, 0.8)",a="";void 0!==r&&(s=r.fontSet,o=r.backgroundSet,a=r.edgeSet),i&&(s="rgb(255, 255, 255)",o="rgb(0, 0, 0)"),b.call(this),this.cue=t,this.cueDiv=g(e,t.text);var l={color:s,backgroundColor:o,textShadow:a,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};i||(l.writingMode=""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",l.unicodeBidi="plaintext"),this.applyStyles(l,this.cueDiv),this.div=e.document.createElement("div"),l={textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},i||(l.direction=function(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function i(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function r(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var s=n.match(/^.*(\n|\r)/);return s?(e.length=0,s[0]):n}return"ruby"===t.tagName?r(e):t.childNodes?(i(e,t),r(e)):void 0}for(i(t,e);n=r(t);)for(var s=0;s<n.length;s++)if(y(n.charCodeAt(s)))return"rtl";return"ltr"}(this.cueDiv),l.writingMode=""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(l),this.div.appendChild(this.cueDiv);var c=0;switch(t.positionAlign){case"start":c=t.position;break;case"middle":c=t.position-t.size/2;break;case"end":c=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(c,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(c,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function w(e){var t,n,i,r,s="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent);if(e.div){n=e.div.offsetHeight,i=e.div.offsetWidth,r=e.div.offsetTop;var o=(o=e.div.childNodes)&&(o=o[0])&&o.getClientRects&&o.getClientRects();e=e.div.getBoundingClientRect(),t=o?Math.max(o[0]&&o[0].height||0,e.height/o.length):0}this.left=e.left,this.right=e.right,this.top=e.top||r,this.height=e.height||n,this.bottom=e.bottom||r+(e.height||n),this.width=e.width||i,this.lineHeight=void 0!==t?t:e.lineHeight,s&&!this.lineHeight&&(this.lineHeight=13)}function S(e,t,n,i){var r=new w(t),s=t.cue,o=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,i=0,r=0;r<n.length&&n[r]!==t;r++)"showing"===n[r].mode&&i++;return-1*++i}(s),a=[];if(s.snapToLines){var l;switch(s.vertical){case"":a=["+y","-y"],l="height";break;case"rl":a=["+x","-x"],l="width";break;case"lr":a=["-x","+x"],l="width"}var c=r.lineHeight,u=c*Math.round(o),h=n[l]+c,d=a[0];Math.abs(u)>h&&(u=u<0?-1:1,u*=Math.ceil(h/c)*c),o<0&&(u+=""===s.vertical?n.height:n.width,a=a.reverse()),r.move(d,u)}else{var f=r.lineHeight/n.height*100;switch(s.lineAlign){case"middle":o-=f/2;break;case"end":o-=f}switch(s.vertical){case"":t.applyStyles({top:t.formatStyle(o,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(o,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(o,"%")})}a=["+y","-x","+x","-y"],r=new w(t)}var p=function(e,t){for(var r,s=new w(e),o=1,a=0;a<t.length;a++){for(;e.overlapsOppositeAxis(n,t[a])||e.within(n)&&e.overlapsAny(i);)e.move(t[a]);if(e.within(n))return e;var l=e.intersectPercentage(n);o>l&&(r=new w(e),o=l),e=new w(s)}return r||s}(r,a);t.move(p.toCSSCompatValues(n))}function k(){}b.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},b.prototype.formatStyle=function(e,t){return 0===e?0:e+t},v.prototype=s(b.prototype),v.prototype.constructor=v,w.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},w.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},w.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},w.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},w.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},w.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},w.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},w.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,i=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||i,height:e.height||t,bottom:e.bottom||i+(e.height||t),width:e.width||n}},k.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},k.convertCueToDOMTree=function(e,t){return e&&t?g(e,t):null},k.processCues=function(e,t,i){if(!e||!t||!i)return null;for(;i.firstChild;)i.removeChild(i.firstChild);var r=e.document.createElement("div");if(r.style.position="absolute",r.style.left="0",r.style.right="0",r.style.top="0",r.style.bottom="0",r.style.margin="1.5%",i.appendChild(r),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var s=[],o=w.getSimpleBoxPosition(r),a={font:Math.round(.05*o.height*100)/100*n+"px sans-serif"};!function(){for(var n,i,l=0;l<t.length;l++)i=t[l],n=new v(e,i,a),r.appendChild(n.div),S(0,n,o,s),i.displayState=n.div,s.push(w.getSimpleBoxPosition(n))}()}else for(var l=0;l<t.length;l++)r.appendChild(t[l].displayState)},k.Parser=function(e,t){this.window=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]},k.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof o))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){for(var e=t.buffer,n=0;n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var i=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),i}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var r=(i=n()).match(/^WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new o(o.Errors.BadSignature);t.state="HEADER"}for(var s=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(s?s=!1:i=n(),t.state){case"HEADER":/:/.test(i)?c(i,(function(e,n){"Region"===e&&function(e){var n=new l;if(c(e,(function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var i=t.split(",");if(2!==i.length)break;var r=new l;if(r.percent("x",i[0]),r.percent("y",i[1]),!r.has("x")||!r.has("y"))break;n.set(e+"X",r.get("x")),n.set(e+"Y",r.get("y"));break;case"scroll":n.alt(e,t,["up"])}}),/=/,/\s/),n.has("id")){var i=new t.window.VTTRegion;i.width=n.get("width",100),i.lines=n.get("lines",3),i.regionAnchorX=n.get("regionanchorX",0),i.regionAnchorY=n.get("regionanchorY",100),i.viewportAnchorX=n.get("viewportanchorX",0),i.viewportAnchorY=n.get("viewportanchorY",100),i.scroll=n.get("scroll",""),t.onregion&&t.onregion(i),t.regionList.push({id:n.get("id"),region:i})}}(n)}),/:/):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new t.window.VTTCue(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":try{u(i,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var a=-1!==i.indexOf("--\x3e");if(!i||a&&(s=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new o(o.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.WebVTT=k}(this)},4747:function(e,t,n){var i;e.exports&&(this.VTTCue=this.VTTCue||n(1300).VTTCue),(i=this).VTTCue.prototype.toJSON=function(){var e={},t=this;return Object.keys(this).forEach((function(n){"getCueAsHTML"!==n&&"hasBeenReset"!==n&&"displayState"!==n&&(e[n]=t[n])})),e},i.VTTCue.create=function(e){if(!e.hasOwnProperty("startTime")||!e.hasOwnProperty("endTime")||!e.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");var t=new i.VTTCue(e.startTime,e.endTime,e.text);for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n]);return t},i.VTTCue.fromJSON=function(e){return this.create(JSON.parse(e))}},1300:function(){!function(e){var t={"":!0,lr:!0,rl:!0},n={start:!0,middle:!0,end:!0,left:!0,right:!0};function i(e){return"string"==typeof e&&!!n[e.toLowerCase()]&&e.toLowerCase()}function r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)e[i]=n[i]}return e}function s(e,n,s){var o=this,a=/MSIE\s8\.0/.test(navigator.userAgent),l={};a?o=document.createElement("custom"):l.enumerable=!0,o.hasBeenReset=!1;var c="",u=!1,h=e,d=n,f=s,p=null,g="",m=!0,y="auto",b="start",v=50,w="middle",S=50,k="middle";if(Object.defineProperty(o,"id",r({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",r({},l,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(o,"startTime",r({},l,{get:function(){return h},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");h=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",r({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",r({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",r({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",r({},l,{get:function(){return g},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",r({},l,{get:function(){return m},set:function(e){m=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",r({},l,{get:function(){return y},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",r({},l,{get:function(){return b},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",r({},l,{get:function(){return v},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",r({},l,{get:function(){return w},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");w=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",r({},l,{get:function(){return S},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");S=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",r({},l,{get:function(){return k},set:function(e){var t=i(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");k=t,this.hasBeenReset=!0}})),o.displayState=void 0,a)return o}s.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.VTTCue=e.VTTCue||s}(this)},1271:function(e,t,n){var i;e.exports&&(this.VTTRegion=n(8591).VTTRegion),(i=this).VTTRegion.create=function(e){var t=new i.VTTRegion;for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n]);return t},i.VTTRegion.fromJSON=function(e){return this.create(JSON.parse(e))}},8591:function(){!function(e){var t={"":!0,up:!0};function n(e){return"number"==typeof e&&e>=0&&e<=100}e.VTTRegion=e.VTTRegion||function(){var e=100,i=3,r=0,s=100,o=0,a=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!n(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return i},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");i=e}},regionAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!n(e))throw new Error("RegionAnchorX must be between 0 and 100.");s=e}},regionAnchorX:{enumerable:!0,get:function(){return r},set:function(e){if(!n(e))throw new Error("RegionAnchorY must be between 0 and 100.");r=e}},viewportAnchorY:{enumerable:!0,get:function(){return a},set:function(e){if(!n(e))throw new Error("ViewportAnchorY must be between 0 and 100.");a=e}},viewportAnchorX:{enumerable:!0,get:function(){return o},set:function(e){if(!n(e))throw new Error("ViewportAnchorX must be between 0 and 100.");o=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");l=n}}})}}(this)},6553:()=>{}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var s=t[i]={id:i,loaded:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";var e;function t(t,n,i,s){let o=n;for(let a=n;a>=0&&(o=a,!r(t,o,n,i,s,e.backward));--a);let a=o;for(let o=n;o<=t.length-1&&(a=o,!r(t,a,n,i,s,e.forward));++o);return t.slice(o,a+1)}function i(t,n,i){if(i===e.forward){for(let e=0;e<t.length;++e)if(t[e].start>=n)return e}else for(let e=t.length-1;e>=0;--e)if(t[e].start<=n)return e}function r(t,n,i,r,s,o){let a;return a=o==e.forward?n+1<t.length?t[n+1]:null:n-1>=0?t[n-1]:null,Math.abs(i-n)>=r&&(null===a||Math.abs(a.start-t[i].start)>=s)}function s(e,t,n,i,r,s){const o=e[t];return Math.abs(s-t)<=n||Math.abs(o.start-r)<=i}function o(e){const t=e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,((e,t)=>(t?"-":"")+e.toLowerCase()));return t.startsWith("webkit-")||t.startsWith("moz-")||t.startsWith("ms-")||t.startsWith("o-")?`-${t}`:t}function a(e,t){return 0===t?e:`${e} (${function(e,t=!1){const n=Math.floor(e/1e3);let i;i=t?Math.round(e/1e3%60*10)/10:n%60;const r=Math.floor(n/60)%60,s=Math.floor(n/3600);return s>0?s+"h"+String(r).padStart(2,"0")+"m"+String(i).padStart(2,"0")+"s":r+"m"+String(i).padStart(2,"0")+"s"}(t)})`}n(2565),function(e){e[e.forward=0]="forward",e[e.backward=1]="backward"}(e||(e={}));const l=async(e,t,n,i)=>new Promise(((r,s)=>{const o=new Image;o.onload=async()=>{const i=document.createElement("canvas"),a=window.devicePixelRatio,l=n.width*a,c=n.height*a;i.width=l,i.height=c;const u=i.getContext("2d");if(u.drawImage(o,n.left*a,n.top*a,l,c,0,0,l,c),e>0||t>0)try{await((e,t,n,i)=>new Promise(((r,s)=>{const o=n<=0?1:n/e.width,a=i<=0?1:i/e.height,l=Math.min(1,Math.min(o,a));if(l<1){const n=e.width*l,i=e.height*l;createImageBitmap(e,{resizeWidth:n,resizeHeight:i,resizeQuality:"high"}).then((s=>{e.width=n,e.height=i,t.drawImage(s,0,0),r(e)})).catch((e=>s(e)))}else r(e)})))(i,u,e,t),r(i.toDataURL("image/jpeg"))}catch(e){console.error("Failed to crop and resize image: "+e),s(e)}else r(i.toDataURL("image/jpeg"))},o.src=i}));var c,u,h,d,f;!function(e){e[e.drmProtected=1]="drmProtected",e[e.fileLinkLost=2]="fileLinkLost"}(c||(c={})),function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard",e[e.exportCard=3]="exportCard"}(u||(u={})),function(e){e[e.remember=0]="remember",e[e.play=1]="play",e[e.pause=2]="pause"}(h||(h={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(d||(d={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause",e[e.fastForward=4]="fastForward",e[e.repeat=5]="repeat"}(f||(f={}));class p{willStopShowing(e){e.end!==this.lastWillStopShowing?.end&&(this.onWillStopShowing?.(e),this.lastWillStopShowing=e)}startedShowing(e){e.start!==this.lastStartedShowing?.start&&(this.onStartedShowing?.(),this.lastStartedShowing=e)}clear(){this.lastStartedShowing=void 0,this.lastWillStopShowing=void 0}}class g{constructor(){this._cachedContentElements={},this._empty=!0}get empty(){return this._empty}clear(){this.offscreenElement?.remove(),this.offscreenElement=void 0,this._cachedContentElements={},this._empty=!0}add(e,t){const n=document.createElement("div");n.innerHTML=`${t}\n`,this._cachedContentElements[e]=n,this._offscreenElement().appendChild(n),this._empty=!1}return(e){this._offscreenElement().appendChild(e)}get(e,t){let n=this._cachedContentElements[e];if(!n){if(void 0===t)throw new Error(`Cached html not found for key ${e}`);n=document.createElement("div"),n.innerHTML=t(),this._cachedContentElements[e]=n,this._offscreenElement().appendChild(n)}return n}_offscreenElement(){if(this.offscreenElement)return this.offscreenElement;const e=document.createElement("div");return e.className="asbplayer-offscreen",document.body.append(e),this.offscreenElement=e,e}}class m{static async encode(e,t){return new Promise((async(n,i)=>{var r=new FileReader;r.onload=async e=>{try{const r=new AudioContext;if(null===e.target)return void i(new Error("Could not obtain buffer to encode"));const s=await r.decodeAudioData(e.target.result),o=[];for(let e=0;e<s.numberOfChannels;++e)o.push(s.getChannelData(e));const a=t(),l=a instanceof Worker?a:await a;l.postMessage({command:"encode",audioBuffer:{channels:o,numberOfChannels:s.numberOfChannels,length:s.length,sampleRate:s.sampleRate}}),l.onmessage=e=>{n(new Blob(e.data.buffer,{type:"audio/mp3"})),l.terminate()},l.onerror=e=>{const t=e?.error??new Error("MP3 encoding failed: "+e?.message);i(t),l.terminate()}}catch(e){i(e)}},r.readAsArrayBuffer(e)}))}}var y="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function b(e,t,n,i){e.addEventListener?e.addEventListener(t,n,i):e.attachEvent&&e.attachEvent("on".concat(t),(function(){n(window.event)}))}function v(e,t){for(var n=t.slice(0,t.length-1),i=0;i<n.length;i++)n[i]=e[n[i].toLowerCase()];return n}function w(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}for(var S={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":y?173:189,"=":y?61:187,";":y?59:186,"'":222,"[":219,"]":221,"\\":220},k={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},x={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},E={16:!1,18:!1,17:!1,91:!1},_={},O=1;O<20;O++)S["f".concat(O)]=111+O;var C=[],T=!1,A="all",P=[],F=function(e){return S[e.toLowerCase()]||k[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function L(e){A=e||"all"}function N(){return A||"all"}var R=function(e){var t=e.key,n=e.scope,i=e.method,r=e.splitKey,s=void 0===r?"+":r;w(t).forEach((function(e){var t=e.split(s),r=t.length,o=t[r-1],a="*"===o?"*":F(o);if(_[a]){n||(n=N());var l=r>1?v(k,t):[];_[a]=_[a].filter((function(e){return!((!i||e.method===i)&&e.scope===n&&function(e,t){for(var n=e.length>=t.length?e:t,i=e.length>=t.length?t:e,r=!0,s=0;s<n.length;s++)-1===i.indexOf(n[s])&&(r=!1);return r}(e.mods,l))}))}}))};function I(e,t,n,i){var r;if(t.element===i&&(t.scope===n||"all"===t.scope)){for(var s in r=t.mods.length>0,E)Object.prototype.hasOwnProperty.call(E,s)&&(!E[s]&&t.mods.indexOf(+s)>-1||E[s]&&-1===t.mods.indexOf(+s))&&(r=!1);(0!==t.mods.length||E[16]||E[18]||E[17]||E[91])&&!r&&"*"!==t.shortcut||!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}function j(e,t){var n=_["*"],i=e.keyCode||e.which||e.charCode;if(M.filter.call(this,e)){if(93!==i&&224!==i||(i=91),-1===C.indexOf(i)&&229!==i&&C.push(i),["ctrlKey","altKey","shiftKey","metaKey"].forEach((function(t){var n=x[t];e[t]&&-1===C.indexOf(n)?C.push(n):!e[t]&&C.indexOf(n)>-1?C.splice(C.indexOf(n),1):"metaKey"===t&&e[t]&&3===C.length&&(e.ctrlKey||e.shiftKey||e.altKey||(C=C.slice(C.indexOf(n))))})),i in E){for(var r in E[i]=!0,k)k[r]===i&&(M[r]=!0);if(!n)return}for(var s in E)Object.prototype.hasOwnProperty.call(E,s)&&(E[s]=e[x[s]]);e.getModifierState&&(!e.altKey||e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===C.indexOf(17)&&C.push(17),-1===C.indexOf(18)&&C.push(18),E[17]=!0,E[18]=!0);var o=N();if(n)for(var a=0;a<n.length;a++)n[a].scope===o&&("keydown"===e.type&&n[a].keydown||"keyup"===e.type&&n[a].keyup)&&I(e,n[a],o,t);if(i in _)for(var l=0;l<_[i].length;l++)if(("keydown"===e.type&&_[i][l].keydown||"keyup"===e.type&&_[i][l].keyup)&&_[i][l].key){for(var c=_[i][l],u=c.splitKey,h=c.key.split(u),d=[],f=0;f<h.length;f++)d.push(F(h[f]));d.sort().join("")===C.sort().join("")&&I(e,c,o,t)}}}function M(e,t,n){C=[];var i=w(e),r=[],s="all",o=document,a=0,l=!1,c=!0,u="+",h=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(s=t.scope),t.element&&(o=t.element),t.keyup&&(l=t.keyup),void 0!==t.keydown&&(c=t.keydown),void 0!==t.capture&&(h=t.capture),"string"==typeof t.splitKey&&(u=t.splitKey)),"string"==typeof t&&(s=t);a<i.length;a++)r=[],(e=i[a].split(u)).length>1&&(r=v(k,e)),(e="*"===(e=e[e.length-1])?"*":F(e))in _||(_[e]=[]),_[e].push({keyup:l,keydown:c,scope:s,mods:r,shortcut:i[a],method:n,key:i[a],splitKey:u,element:o});void 0!==o&&!function(e){return P.indexOf(e)>-1}(o)&&window&&(P.push(o),b(o,"keydown",(function(e){j(e,o)}),h),T||(T=!0,b(window,"focus",(function(){C=[]}),h)),b(o,"keyup",(function(e){j(e,o),function(e){var t=e.keyCode||e.which||e.charCode,n=C.indexOf(t);if(n>=0&&C.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&C.splice(0,C.length),93!==t&&224!==t||(t=91),t in E)for(var i in E[t]=!1,k)k[i]===t&&(M[i]=!1)}(e)}),h))}var D={getPressedKeyString:function(){return C.map((function(e){return t=e,Object.keys(S).find((function(e){return S[e]===t}))||function(e){return Object.keys(k).find((function(t){return k[t]===e}))}(e)||String.fromCharCode(e);var t}))},setScope:L,getScope:N,deleteScope:function(e,t){var n,i;for(var r in e||(e=N()),_)if(Object.prototype.hasOwnProperty.call(_,r))for(n=_[r],i=0;i<n.length;)n[i].scope===e?n.splice(i,1):i++;N()===e&&L(t||"all")},getPressedKeyCodes:function(){return C.slice(0)},isPressed:function(e){return"string"==typeof e&&(e=F(e)),-1!==C.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,i=!0;return!t.isContentEditable&&("INPUT"!==n&&"TEXTAREA"!==n&&"SELECT"!==n||t.readOnly)||(i=!1),i},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(_).forEach((function(n){var i=_[n].find((function(n){return n.scope===t&&n.shortcut===e}));i&&i.method&&i.method()}))},unbind:function(e){if(void 0===e)Object.keys(_).forEach((function(e){return delete _[e]}));else if(Array.isArray(e))e.forEach((function(e){e.key&&R(e)}));else if("object"==typeof e)e.key&&R(e);else if("string"==typeof e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var r=n[0],s=n[1];"function"==typeof r&&(s=r,r=""),R({key:e,scope:r,method:s,splitKey:"+"})}},keyMap:S,modifier:k,modifierMap:x};for(var B in D)Object.prototype.hasOwnProperty.call(D,B)&&(M[B]=D[B]);if("undefined"!=typeof window){var $=window.hotkeys;M.noConflict=function(e){return e&&window.hotkeys===M&&(window.hotkeys=$),M},window.hotkeys=M}function U(e,t,n){const i=t;let r=-1,s=Number.MAX_SAFE_INTEGER;for(let t=0;t<n.length;++t){const o=n[t],a=e?o.start-i:i-o.start;s<=a||(e&&i<o.start?(s=a,r=t):!e&&i>o.start&&(s=a,r=i<o.end?Math.max(0,t-1):t))}return-1!==r?n[r]:null}class V{constructor(e){this.keyBindSet=e}bindCopy(e,t,n,i=!1){const r=this.keyBindSet.copySubtitle.keys;if(!r)return()=>{};const s=this.copyHandler(e,t,n);return this._bind(r,i,s)}copyHandler(e,t,n){return i=>{if(t())return!1;const r=n();return!!r&&(e(i,r),!0)}}bindAnkiExport(e,t,n=!1){const i=this.keyBindSet.ankiExport.keys;if(!i)return()=>{};const r=this.ankiExportHandler(e,t);return this._bind(i,n,r)}ankiExportHandler(e,t){return n=>!t()&&(e(n),!0)}bindUpdateLastCard(e,t,n=!1){const i=this.keyBindSet.updateLastCard.keys;if(!i)return()=>{};const r=this.updateLastCardHandler(e,t);return this._bind(i,n,r)}updateLastCardHandler(e,t){return n=>!t()&&(e(n),!0)}bindTakeScreenshot(e,t,n=!1){const i=this.keyBindSet.takeScreenshot.keys;if(!i)return()=>{};const r=this.takeScreenshotHandler(e,t);return this._bind(i,n,r)}takeScreenshotHandler(e,t){return n=>!t()&&(e(n),!0)}bindSeekToSubtitle(e,t,n,i,r=!1){const s=(r,s)=>{if(t())return!1;const o=i();if(!o||0===o.length)return!1;const a=U(s,n(),o);return null!==a&&a.start>=0&&a.end>=0&&(e(r,a),!0)},o=this.keyBindSet.seekToPreviousSubtitle.keys,a=this.keyBindSet.seekToNextSubtitle.keys;let l,c;return o&&(l=this._bind(o,r,(e=>s(e,!1)))),a&&(c=this._bind(a,r,(e=>s(e,!0)))),()=>{l?.(),c?.()}}bindSeekToBeginningOfCurrentSubtitle(e,t,n,i,r=!1){const s=this.keyBindSet.seekToBeginningOfCurrentSubtitle.keys;return s?this._bind(s,r,(r=>{if(t())return!1;const s=i();if(!s||0===s.length)return!1;const o=this._currentOrPreviousSubtitle(n(),s);return void 0!==o&&o.start>=0&&o.end>=0&&(e(r,o),!0)})):()=>{}}_currentOrPreviousSubtitle(e,t){const n=e;let i,r,s=Number.MAX_SAFE_INTEGER;for(let e=0;e<t.length;++e){const o=t[e];if(o.start<0||o.end<0)continue;const a=n-o.start;n>=o.start&&n<o.end?a<s&&(i=o,s=a):n>o.end&&(r=o)}return i||r}bindSeekBackwardOrForward(e,t,n=!1){const i=(n,i)=>!t()&&(e(n,i),!0),r=this.keyBindSet.seekBackward.keys,s=this.keyBindSet.seekForward.keys;let o,a;return r&&(o=this._bind(r,n,(e=>i(e,!1)))),s&&(a=this._bind(s,n,(e=>i(e,!0)))),()=>{o?.(),a?.()}}bindOffsetToSubtitle(e,t,n,i,r=!1){const s=(r,s)=>{if(t())return!1;const o=i();if(!o||0===o.length)return!1;const a=n(),l=U(s,a,o);if(null!==l){const t=l.originalStart;return e(r,a-t),!0}return!1},o=this.keyBindSet.adjustOffsetToPreviousSubtitle.keys,a=this.keyBindSet.adjustOffsetToNextSubtitle.keys;let l,c;return o&&(l=this._bind(o,r,(e=>s(e,!1)))),a&&(c=this._bind(a,r,(e=>s(e,!0)))),()=>{l?.(),c?.()}}bindAdjustOffset(e,t,n,i=!1){const r=(i,r)=>{if(t())return!1;const s=n();if(!s||0===s.length)return!1;const o=s[0].start-s[0].originalStart;return e(i,o+(r?100:-100)),!0},s=this.keyBindSet.decreaseOffset.keys,o=this.keyBindSet.increaseOffset.keys,a=s?this._bind(s,i,(e=>r(e,!1))):()=>{},l=o?this._bind(o,i,(e=>r(e,!0))):()=>{};return()=>{a(),l()}}bindResetOffet(e,t,n){const i=this.keyBindSet.resetOffset.keys;return i?this._bind(i,n??!1,(n=>!t()&&(e(n),!0))):()=>{}}bindAdjustPlaybackRate(e,t,n=!1){const i=(n,i)=>!t()&&(e(n,i),!0),r=this.keyBindSet.increasePlaybackRate.keys,s=this.keyBindSet.decreasePlaybackRate.keys;let o,a;return s&&(o=this._bind(s,n,(e=>i(e,!1)))),r&&(a=this._bind(r,n,(e=>i(e,!0)))),()=>{o?.(),a?.()}}bindToggleSubtitles(e,t,n=!1){const i=this.keyBindSet.toggleSubtitles.keys;return i?this._bind(i,n,(n=>!t()&&(e(n),!0))):()=>{}}bindToggleSubtitleTrackInVideo(e,t,n=!1){const i=[this.keyBindSet.toggleVideoSubtitleTrack1.keys,this.keyBindSet.toggleVideoSubtitleTrack2.keys,this.keyBindSet.toggleVideoSubtitleTrack3.keys].filter((e=>e));if(0===i.length)return()=>{};const r=(n,i)=>!t()&&(e(n,i),!0);let s=[];for(let e=0;e<i.length;++e){const t=t=>r(t,e),o=i[e]?this._bind(i[e],n,t):()=>{};s.push(o)}return()=>{for(let e=0;e<i.length;++e)(0,s[e])()}}bindToggleSubtitleTrackInList(e,t,n=!1){const i=[this.keyBindSet.toggleAsbplayerSubtitleTrack1.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack2.keys,this.keyBindSet.toggleAsbplayerSubtitleTrack3.keys].filter((e=>e));if(0===i.length)return()=>{};const r=(n,i)=>!t()&&(e(n,i),!0);let s=[];for(let e=0;e<9;++e){const t=t=>r(t,e),o=i[e]?this._bind(i[e],n,t):()=>{};s.push(o)}return()=>{for(let e=0;e<9;++e)(0,s[e])()}}bindToggleBlurTrack(e,t,n=!1){const i=[this.keyBindSet.toggleAsbplayerBlurTrack1.keys,this.keyBindSet.toggleAsbplayerBlurTrack2.keys,this.keyBindSet.toggleAsbplayerBlurTrack3.keys].filter((e=>e));if(0===i.length)return()=>{};const r=(n,i)=>!t()&&(e(n,i),!0);let s=[];for(let e=0;e<i.length;++e){const t=t=>r(t,e),o=i[e]?this._bind(i[e],n,t):()=>{};s.push(o)}return()=>{for(let e=0;e<i.length;++e)(0,s[e])()}}bindPlay(e,t,n=!1){const i=this.keyBindSet.togglePlay.keys;return i?this._bind(i,n,(n=>!t()&&(e(n),!0))):()=>{}}bindAutoPause(e,t,n=!1){const i=this.keyBindSet.toggleAutoPause.keys;return i?this._bind(i,n,(n=>!t()&&(e(n),!0))):()=>{}}bindCondensedPlayback(e,t,n=!1){const i=this.keyBindSet.toggleCondensedPlayback.keys;return i?this._bind(i,n,(n=>!t()&&(e(n),!0))):()=>{}}bindFastForwardPlayback(e,t,n=!1){const i=this.keyBindSet.toggleFastForwardPlayback.keys;return i?this._bind(i,n,(n=>!t()&&(e(n),!0))):()=>{}}bindToggleSidePanel(e,t,n=!1){const i=this.keyBindSet.toggleSidePanel.keys;return i?this._bind(i,n,(n=>!t()&&(e(n),!0))):()=>{}}bindToggleRepeat(e,t,n=!1){const i=this.keyBindSet.toggleRepeat.keys;return this._bind(i,n,(n=>!t()&&(e(n),!0)))}_bind(e,t,n){let i;const r=e=>{"keydown"===e.type?i=n(e):"keyup"===e.type&&(i&&(e.preventDefault(),e.stopImmediatePropagation()),i=void 0)};return M(e,{capture:t,keydown:!0,keyup:!0},r),()=>M.unbind(e,r)}}const H=Object.keys({ankiConnectUrl:!0,deck:!0,noteType:!0,sentenceField:!0,definitionField:!0,audioField:!0,imageField:!0,wordField:!0,sourceField:!0,urlField:!0,track1Field:!0,track2Field:!0,track3Field:!0,customAnkiFields:!0,tags:!0,preferMp3:!0,audioPaddingStart:!0,audioPaddingEnd:!0,maxImageWidth:!0,maxImageHeight:!0,surroundingSubtitlesCountRadius:!0,surroundingSubtitlesTimeRadius:!0,ankiFieldSettings:!0,customAnkiFieldSettings:!0}),z=Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0});var W;Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0,imageBasedSubtitleScaleFactor:!0,subtitlePositionOffset:!0,subtitleAlignment:!0,subtitleTracksV2:!0}),function(e){e.noSubtitleList="noSubtitleList",e.app="app"}(W||(W={}));const q=(navigator.userAgentData?.platform??navigator.platform)?.toUpperCase()?.indexOf("MAC")>-1,Z={ankiConnectUrl:"http://127.0.0.1:8765",deck:"",noteType:"",sentenceField:"",definitionField:"",audioField:"",imageField:"",wordField:"",sourceField:"",urlField:"",track1Field:"",track2Field:"",track3Field:"",ankiFieldSettings:{sentence:{order:1,display:!0},definition:{order:2,display:!0},word:{order:3,display:!0},audio:{order:4,display:!0},image:{order:5,display:!0},source:{order:6,display:!0},url:{order:7,display:!0},track1:{order:8,display:!1},track2:{order:9,display:!1},track3:{order:10,display:!1}},customAnkiFieldSettings:{},subtitleSize:36,subtitleColor:"#ffffff",subtitleThickness:700,subtitleOutlineThickness:0,subtitleOutlineColor:"#000000",subtitleShadowThickness:3,subtitleShadowColor:"#000000",subtitleBackgroundColor:"#000000",subtitleBackgroundOpacity:0,subtitleFontFamily:"",subtitlePreview:"アあ安Aa",subtitleCustomStyles:[],subtitleBlur:!1,subtitlePositionOffset:75,subtitleAlignment:"bottom",subtitleTracksV2:[],audioPaddingStart:0,audioPaddingEnd:500,maxImageWidth:0,maxImageHeight:0,surroundingSubtitlesCountRadius:2,surroundingSubtitlesTimeRadius:1e4,autoPausePreference:d.atEnd,speedChangeStep:.1,fastForwardModePlaybackRate:2.7,keyBindSet:{togglePlay:{keys:"space"},toggleAutoPause:{keys:q?"⇧+P":"shift+P"},toggleCondensedPlayback:{keys:q?"⇧+O":"shift+O"},toggleFastForwardPlayback:{keys:q?"⇧+F":"shift+F"},toggleSubtitles:{keys:"down"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleVideoSubtitleTrack3:{keys:"3"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},toggleAsbplayerSubtitleTrack3:{keys:"W+3"},toggleAsbplayerBlurTrack1:{keys:"B+1"},toggleAsbplayerBlurTrack2:{keys:"B+2"},toggleAsbplayerBlurTrack3:{keys:"B+3"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"up"},adjustOffsetToPreviousSubtitle:{keys:q?"⇧+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:q?"⇧+right":"ctrl+right"},decreaseOffset:{keys:q?"⇧+⌃+right":"ctrl+shift+right"},increaseOffset:{keys:q?"⇧+⌃+left":"ctrl+shift+left"},resetOffset:{keys:q?"⇧+⌃+down":"ctrl+shift+down"},copySubtitle:{keys:q?"⇧+⌃+Z":"ctrl+shift+Z"},ankiExport:{keys:q?"⇧+⌃+X":"ctrl+shift+X"},updateLastCard:{keys:q?"⇧+⌃+U":"ctrl+shift+U"},takeScreenshot:{keys:q?"⇧+⌃+V":"ctrl+shift+V"},decreasePlaybackRate:{keys:q?"⇧+⌃+[":"ctrl+shift+["},increasePlaybackRate:{keys:q?"⇧+⌃+]":"ctrl+shift+]"},toggleSidePanel:{keys:"`"},toggleRepeat:{keys:q?"⇧+R":"shift+R"}},preferMp3:!0,tabName:"asbplayer",miningHistoryStorageLimit:25,preCacheSubtitleDom:!0,clickToMineDefaultAction:u.showAnkiDialog,postMiningPlaybackState:h.remember,themeType:"dark",copyToClipboardOnMine:!1,rememberSubtitleOffset:!0,lastSubtitleOffset:0,autoCopyCurrentSubtitle:!1,alwaysPlayOnSubtitleRepeat:!0,subtitleRegexFilter:"",subtitleRegexFilterTextReplacement:"",language:"en",customAnkiFields:{},tags:[],imageBasedSubtitleScaleFactor:1,streamingAppUrl:"https://killergerbah.github.io/asbplayer",streamingDisplaySubtitles:!0,streamingRecordMedia:!0,streamingTakeScreenshot:!0,streamingCleanScreenshot:!0,streamingCropScreenshot:!0,streamingSubsDragAndDrop:!0,streamingAutoSync:!1,streamingLastLanguagesSynced:{},streamingCondensedPlaybackMinimumSkipIntervalMs:1e3,streamingScreenshotDelay:1e3,streamingSubtitleListPreference:W.noSubtitleList,streamingEnableOverlay:!0,webSocketClientEnabled:!1,webSocketServerUrl:"ws://127.0.0.1:8766/ws"},X=e=>{const t=[];for(let n=0;n<=e.subtitleTracksV2.length;++n)t.push(K(e,n));return t},K=(e,t)=>{if(void 0===t){const t=t=>{const n=e[t];for(const i of e.subtitleTracksV2)if(!G(i[t],n))return!1;return!0};let n={};for(const i of z)t(i)?n[i]=e[i]:n[i]=void 0;return n}return 0===t||t>e.subtitleTracksV2.length?Object.fromEntries(z.map((t=>[t,e[t]]))):e.subtitleTracksV2[t-1]},G=(Object.fromEntries(Object.entries(Z).map((([e,t])=>{if("string"==typeof t)return[e,e=>e];if("boolean"==typeof t)return[e,e=>"true"===e];if("number"==typeof t)return[e,e=>Number(e)];if("object"==typeof t)return[e,e=>JSON.parse(e)];throw new Error("Could not determine deserializer for setting")}))),(e,t)=>{if(typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;const n=Object.keys(e),i=Object.keys(t);if(e.length!==t.length)return!1;for(const i of n)if(!G(e[i],t[i]))return!1;for(const n of i)if(!G(e[n],t[n]))return!1;return!0}),Y=Object.fromEntries(Object.keys(Z).filter((e=>"object"==typeof Z[e])).map((e=>[e,!0])));class J{constructor(e){this._complexValues={},this._storage=e}async getAll(){return this.get(Object.keys(Z))}async getSingle(e){return(await this.get([e]))[e]}async get(e){let t={};for(const n of e)t[n]=Z[n];const n=await this._storage.get(t),i={};for(const e in t){const t=n[e]??Z[e];if(Y[e]){const n=this._complexValues[e];void 0!==n&&G(n,t)?i[e]=n:(this._complexValues[e]=t,i[e]=t)}else i[e]=t}return this._ensureConsistencyOnRead(i)}_ensureConsistencyOnRead(e){let t=!1,n={},i=!1,r={};if(void 0!==e.keyBindSet){const i=e.keyBindSet;for(const e of Object.keys(Z.keyBindSet)){const r=e;void 0===i[r]?(n[r]=Z.keyBindSet[r],t=!0):n[r]=i[r]}}if(void 0!==e.ankiFieldSettings){const t=e.ankiFieldSettings;for(const e of Object.keys(Z.ankiFieldSettings)){const n=e;void 0===t[n]?(r[n]=Z.ankiFieldSettings[n],i=!0):r[n]=t[n]}}return i||t?{...e,ankiFieldSettings:r,keyBindSet:n}:e}async set(e){await this._storage.set(await this._ensureConsistencyOnWrite(e))}async _ensureConsistencyOnWrite(e){if(void 0===e.customAnkiFields)return e;const t=e.customAnkiFieldSettings??(await this._storage.get({customAnkiFieldSettings:Z.customAnkiFieldSettings})).customAnkiFieldSettings;let n=!1;for(const i of Object.keys(t))i in e.customAnkiFields||(delete t[i],n=!0);return n?{...e,customAnkiFieldSettings:t}:e}async activeProfile(){return await this._storage.activeProfile()}async setActiveProfile(e){await this._storage.setActiveProfile(e)}async profiles(){return await this._storage.profiles()}async addProfile(e){await this._storage.addProfile(e)}async removeProfile(e){await this._storage.removeProfile(e)}}const Q=(e,t)=>`${(e=>`_prof_${e}_`)(t)}${e}`,ee=(e,t)=>e.substring(t.length+7),te=(e,t)=>{const n={};for(const i of Object.keys(e))n[Q(i,t)]=e[i];return n};n(4445);const ne=["en","es","de","ja","pl","pt_BR","zh_CN","ru"];function ie(e){const t=e.toLowerCase().trim().split(/\s*;\s*/);return"banner"===t[0]?{name:t[0],delay:1*t[1]||0,leftToRight:1*t[2]||0,fadeAwayWidth:1*t[3]||0}:/^scroll\s/.test(t[0])?{name:t[0],y1:Math.min(1*t[1],1*t[2]),y2:Math.max(1*t[1],1*t[2]),delay:1*t[3]||0,fadeAwayHeight:1*t[4]||0}:null}function re(e){return e?e.toLowerCase().replace(/([+-]?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?)/g," $1 ").replace(/([mnlbspc])/g," $1 ").trim().replace(/\s+/g," ").split(/\s(?=[mnlbspc])/).map((e=>e.split(" ").filter(((e,t)=>!(t&&Number.isNaN(1*e)))))):[]}const se=["b","i","u","s","fsp","k","K","kf","ko","kt","fe","q","p","pbo","a","an","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"].map((e=>({name:e,regex:new RegExp(`^${e}-?\\d`)})));function oe(e){const t={};for(let n=0;n<se.length;n++){const{name:i,regex:r}=se[n];if(r.test(e))return t[i]=1*e.slice(i.length),t}if(/^fn/.test(e))t.fn=e.slice(2);else if(/^r/.test(e))t.r=e.slice(1);else if(/^fs[\d+-]/.test(e))t.fs=e.slice(2);else if(/^\d?c&?H?[0-9a-f]+|^\d?c$/i.test(e)){const[,n,i]=e.match(/^(\d?)c&?H?(\w*)/);t[`c${n||1}`]=i&&`000000${i}`.slice(-6)}else if(/^\da&?H?[0-9a-f]+/i.test(e)){const[,n,i]=e.match(/^(\d)a&?H?(\w\w)/);t[`a${n}`]=i}else if(/^alpha&?H?[0-9a-f]+/i.test(e))[,t.alpha]=e.match(/^alpha&?H?([0-9a-f]+)/i),t.alpha=`00${t.alpha}`.slice(-2);else if(/^(?:pos|org|move|fad|fade)\(/.test(e)){const[,n,i]=e.match(/^(\w+)\((.*?)\)?$/);t[n]=i.trim().split(/\s*,\s*/).map(Number)}else if(/^i?clip/.test(e)){const n=e.match(/^i?clip\((.*?)\)?$/)[1].trim().split(/\s*,\s*/);t.clip={inverse:/iclip/.test(e),scale:1,drawing:null,dots:null},1===n.length&&(t.clip.drawing=re(n[0])),2===n.length&&(t.clip.scale=1*n[0],t.clip.drawing=re(n[1])),4===n.length&&(t.clip.dots=n.map(Number))}else if(/^t\(/.test(e)){const n=e.match(/^t\((.*?)\)?$/)[1].trim().replace(/\\.*/,(e=>e.replace(/,/g,"\n"))).split(/\s*,\s*/);if(!n[0])return t;t.t={t1:0,t2:0,accel:1,tags:n[n.length-1].replace(/\n/g,",").split("\\").slice(1).map(oe)},2===n.length&&(t.t.accel=1*n[0]),3===n.length&&(t.t.t1=1*n[0],t.t.t2=1*n[1]),4===n.length&&(t.t.t1=1*n[0],t.t.t2=1*n[1],t.t.accel=1*n[2])}return t}function ae(e){const t=[];let n=0,i="";for(let r=0;r<e.length;r++){const s=e[r];"("===s&&n++,")"===s&&n--,n<0&&(n=0),n||"\\"!==s?i+=s:(i&&t.push(i),i="")}return t.push(i),t.map(oe)}function le(e){const t=e.split(/{([^{}]*?)}/),n=[];t[0].length&&n.push({tags:[],text:t[0],drawing:[]});for(let e=1;e<t.length;e+=2){const i=ae(t[e]),r=i.reduce(((e,t)=>void 0===t.p?e:!!t.p),!1);n.push({tags:i,text:r?"":t[e+1],drawing:r?re(t[e+1]):[]})}return{raw:e,combined:n.map((e=>e.text)).join(""),parsed:n}}function ce(e){const t=e.split(":");return 3600*t[0]+60*t[1]+1*t[2]}function ue(e,t){let n=e.split(",");if(n.length>t.length){const e=n.slice(t.length-1).join();n=n.slice(0,t.length-1),n.push(e)}const i={};for(let e=0;e<n.length;e++){const r=t[e],s=n[e].trim();switch(r){case"Layer":case"MarginL":case"MarginR":case"MarginV":i[r]=1*s;break;case"Start":case"End":i[r]=ce(s);break;case"Effect":i[r]=ie(s);break;case"Text":i[r]=le(s);break;default:i[r]=s}}return i}function he(e){return e.match(/Format\s*:\s*(.*)/i)[1].split(/\s*,\s*/)}const de=Object.assign||function(e,...t){for(let n=0;n<t.length;n++){if(!t[n])continue;const i=Object.keys(t[n]);for(let r=0;r<i.length;r++)e[i[r]]=t[n][i[r]]}return e};function fe(e,t){const n=e.match(/Style\s*:\s*(.*)/i)[1].split(/\s*,\s*/);return de({},...t.map(((e,t)=>({[e]:n[t]}))))}function pe(e){const t={type:null,prev:null,next:null,points:[]};/[mnlbs]/.test(e[0])&&(t.type=e[0].toUpperCase().replace("N","L").replace("B","C"));for(let n=e.length-!(1&e.length),i=1;i<n;i+=2)t.points.push({x:1*e[i],y:1*e[i+1]});return t}function ge(e){return!(!e.points.length||!e.type||/C|S/.test(e.type)&&e.points.length<3)}function me(e){return e.map((({type:e,points:t})=>e+t.map((({x:e,y:t})=>`${e},${t}`)).join(","))).join("")}function ye(e){const t=[];let n=0;for(;n<e.length;){const i=e[n],r=pe(i);if(ge(r)){if("S"===r.type){const{x:e,y:i}=(t[n-1]||{points:[{x:0,y:0}]}).points.slice(-1)[0];r.points.unshift({x:e,y:i})}n&&(r.prev=t[n-1].type,t[n-1].next=r.type),t.push(r),n++}else{if(n&&"S"===t[n-1].type){const e={p:r.points,c:t[n-1].points.slice(0,3)};t[n-1].points=t[n-1].points.concat((e[i[0]]||[]).map((({x:e,y:t})=>({x:e,y:t}))))}e.splice(n,1)}}const i=[].concat(...t.map((({type:e,points:t,prev:n,next:i})=>"S"===e?function(e,t,n){const i=[],r=[0,2/3,1/3,0],s=[0,1/3,2/3,0],o=[0,1/6,2/3,1/6],a=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];let l=[e[e.length-1].x,e[0].x,e[1].x,e[2].x],c=[e[e.length-1].y,e[0].y,e[1].y,e[2].y];i.push({type:"M"===t?"M":"L",points:[{x:a(o,l),y:a(o,c)}]});for(let t=3;t<e.length;t++)l=[e[t-3].x,e[t-2].x,e[t-1].x,e[t].x],c=[e[t-3].y,e[t-2].y,e[t-1].y,e[t].y],i.push({type:"C",points:[{x:a(r,l),y:a(r,c)},{x:a(s,l),y:a(s,c)},{x:a(o,l),y:a(o,c)}]});if("L"===n||"C"===n){const t=e[e.length-1];i.push({type:"L",points:[{x:t.x,y:t.y}]})}return i}(t,n,i):{type:e,points:t})));return de({instructions:i,d:me(i)},function(e){let t=1/0,n=1/0,i=-1/0,r=-1/0;return[].concat(...e.map((({points:e})=>e))).forEach((({x:e,y:s})=>{t=Math.min(t,e),n=Math.min(n,s),i=Math.max(i,e),r=Math.max(r,s)})),{minX:t,minY:n,width:i-t,height:r-n}}(t))}const be=["fs","clip","c1","c2","c3","c4","a1","a2","a3","a4","alpha","fscx","fscy","fax","fay","frx","fry","frz","fr","be","blur","bord","xbord","ybord","shad","xshad","yshad"];function ve(e,t,n={}){let i=e[t];if(void 0===i)return null;if("pos"===t||"org"===t)return 2===i.length?{[t]:{x:i[0],y:i[1]}}:null;if("move"===t){const[e,t,n,r,s=0,o=0]=i;return 4===i.length||6===i.length?{move:{x1:e,y1:t,x2:n,y2:r,t1:s,t2:o}}:null}if("fad"===t||"fade"===t){if(2===i.length){const[e,t]=i;return{fade:{type:"fad",t1:e,t2:t}}}if(7===i.length){const[e,t,n,r,s,o,a]=i;return{fade:{type:"fade",a1:e,a2:t,a3:n,t1:r,t2:s,t3:o,t4:a}}}return null}if("clip"===t){const{inverse:e,scale:t,drawing:n,dots:r}=i;if(n)return{clip:{inverse:e,scale:t,drawing:ye(n),dots:r}};if(r){const[i,s,o,a]=r;return{clip:{inverse:e,scale:t,drawing:n,dots:{x1:i,y1:s,x2:o,y2:a}}}}return null}if(/^[xy]?(bord|shad)$/.test(t)&&(i=Math.max(i,0)),"bord"===t)return{xbord:i,ybord:i};if("shad"===t)return{xshad:i,yshad:i};if(/^c\d$/.test(t))return{[t]:i||n[t]};if("alpha"===t)return{a1:i,a2:i,a3:i,a4:i};if("fr"===t)return{frz:i};if("fs"===t)return{fs:/^\+|-/.test(i)?(1*i>-10?1+i/10:1)*n.fs:1*i};if("K"===t)return{kf:i};if("t"===t){const{t1:e,accel:t,tags:r}=i,s=i.t2||1e3*(n.end-n.start),o={};return r.forEach((e=>{const t=Object.keys(e)[0];~be.indexOf(t)&&("clip"!==t||e[t].dots)&&de(o,ve(e,t,n))})),{t:{t1:e,t2:s,accel:t,tag:o}}}return{[t]:i}}const we=[null,1,2,3,null,7,8,9,null,4,5,6],Se=["r","a","an","pos","org","move","fade","fad","clip"];function ke({styles:e,style:t,parsed:n,start:i,end:r}){let s,o,a,l,c,u;const h=[];let d={style:t,fragments:[]},f={};for(let g=0;g<n.length;g++){const{tags:m,text:y,drawing:b}=n[g];let v;for(let e=0;e<m.length;e++){const t=m[e];v=void 0===t.r?v:t.r}const w={tag:void 0===v?(p=f,JSON.parse(JSON.stringify(de({},p,{k:void 0,kf:void 0,ko:void 0,kt:void 0})))):{},text:y,drawing:b.length?ye(b):null};for(let n=0;n<m.length;n++){const h=m[n];s=s||we[h.a||0]||h.an,o=o||ve(h,"pos"),a=a||ve(h,"org"),l=l||ve(h,"move"),c=c||ve(h,"fade")||ve(h,"fad"),u=ve(h,"clip")||u;const d=Object.keys(h)[0];if(d&&!~Se.indexOf(d)){const n=e[t].tag,{c1:s,c2:o,c3:a,c4:l}=n,c=ve(h,d,{start:i,end:r,c1:s,c2:o,c3:a,c4:l,fs:f.fs||n.fs});"t"===d?(w.tag.t=w.tag.t||[],w.tag.t.push(c.t)):de(w.tag,c)}}if(f=w.tag,void 0!==v&&(h.push(d),d={style:e[v]?v:t,fragments:[]}),w.text||w.drawing){const e=d.fragments[d.fragments.length-1]||{};e.text&&w.text&&!Object.keys(w.tag).length?e.text+=w.text:d.fragments.push(w)}}var p;return h.push(d),de({alignment:s,slices:h},o,a,l,c,u)}function xe({styles:e,dialogues:t}){let n=1/0;const i=[];for(let r=0;r<t.length;r++){const s=t[r];if(s.Start>=s.End)continue;e[s.Style]||(s.Style="Default");const o=e[s.Style].style,a=ke({styles:e,style:s.Style,parsed:s.Text.parsed,start:s.Start,end:s.End}),l=a.alignment||o.Alignment;n=Math.min(n,s.Layer),i.push(de({layer:s.Layer,start:s.Start,end:s.End,style:s.Style,name:s.Name,margin:{left:s.MarginL||o.MarginL,right:s.MarginR||o.MarginR,vertical:s.MarginV||o.MarginV},effect:s.Effect},a,{alignment:l}))}for(let e=0;e<i.length;e++)i[e].layer-=n;return i.sort(((e,t)=>e.start-t.start||e.end-t.end))}const Ee={Name:"Default",Fontname:"Arial",Fontsize:"20",PrimaryColour:"&H00FFFFFF&",SecondaryColour:"&H000000FF&",OutlineColour:"&H00000000&",BackColour:"&H00000000&",Bold:"0",Italic:"0",Underline:"0",StrikeOut:"0",ScaleX:"100",ScaleY:"100",Spacing:"0",Angle:"0",BorderStyle:"1",Outline:"2",Shadow:"2",Alignment:"2",MarginL:"10",MarginR:"10",MarginV:"10",Encoding:"1"};function _e(e){if(/^(&|H|&H)[0-9a-f]{6,}/i.test(e)){const[,t,n]=e.match(/&?H?([0-9a-f]{2})?([0-9a-f]{6})/i);return[t||"00",n]}const t=parseInt(e,10);if(!Number.isNaN(t)){const e=-2147483648;if(t<e)return["00","000000"];const n=e<=t&&t<=2147483647?`00000000${(t<0?t+4294967296:t).toString(16)}`.slice(-8):String(t).slice(0,8);return[n.slice(0,2),n.slice(2)]}return["00","000000"]}const Oe=class{endOfLine="\r\n";numericTimestamps=!1;constructor(e){null!=e&&(this.endOfLine=e.endOfLine??"\r\n",this.numericTimestamps=e.numericTimestamps??!1)}timestampToSeconds(e){const[t,n]=e.split(","),i=parseInt(n),[r,s,o]=t.split(":").map((e=>parseInt(e))),a=.001*i+o+60*s+3600*r;return Math.round(1e3*a)/1e3}secondsToTimestamp(e){const t=new Date(0,0,0,0,0,0,e),n=t.getHours(),i=t.getMinutes(),r=t.getSeconds(),s=Math.floor(e-(36e5*n+6e4*i+1e3*r));function o(e,t=2){return e.toString().padStart(t,"0")}return`${o(n)}:${o(i)}:${o(r)},${o(s,3)}`}correctFormat(e){const t=e.replace(".",","),[n,i]=t.split(","),r=this.fixedStrDigit(3,i),[s,o,a]=n.split(":");return`${this.fixedStrDigit(2,s,!1)}:${this.fixedStrDigit(2,o,!1)}:${this.fixedStrDigit(2,a,!1)},${r}`}fixedStrDigit(e,t,n=!0){return t.length===e?t:t.length>e?t.slice(0,e):n?t.padEnd(e,"0"):t.padStart(e,"0")}tryComma(e){const t=(e=e.replace(/\r/g,"")).split(/(\d+)\n(\d{1,2}:\d{2}:\d{2},\d{1,3}) --> (\d{1,2}:\d{2}:\d{2},\d{1,3})/g);return t.shift(),t}tryDot(e){const t=(e=e.replace(/\r/g,"")).split(/(\d+)\n(\d{1,2}:\d{2}:\d{2}\.\d{1,3}) --> (\d{1,2}:\d{2}:\d{2}\.\d{1,3})/g);return t.shift(),t}fromSrt(e){const t=e;let n=this.tryComma(t);0===n.length&&(n=this.tryDot(t));const i=[];for(let e=0;e<n.length;e+=4){let t=this.correctFormat(n[e+1].trim()),r=this.correctFormat(n[e+2].trim());this.numericTimestamps&&(t=this.timestampToSeconds(t),r=this.timestampToSeconds(r));const s={id:n[e].trim(),startTime:t,endTime:r,text:n[e+3].trim()};i.push(s)}return i}toSrt(e){const t=this.endOfLine;let n="";for(let i=0;i<e.length;i++){const r=e[i];let s=r.startTime,o=r.endTime;"number"==typeof s&&(s=this.secondsToTimestamp(s)),"number"==typeof o&&(o=this.secondsToTimestamp(o)),n+=r.id+t+s+" --\x3e "+o+t+r.text.replace("\n",t)+t+t}return n}};var Ce=n(462),Te=n(9309);const Ae=/<(\/)?c(\.[^>]*)?>/g,Pe=RegExp(/\\[nN]/,"ig"),Fe=document.createElement("div");class Le{constructor({regexFilter:e,regexFilterTextReplacement:t,pgsWorkerFactory:n}){let i;try{i=""===e.trim()?void 0:new RegExp(e,"g")}catch(e){i=void 0}this._textFilter=void 0===i?void 0:{regex:i,replacement:t},this._pgsWorkerFactory=n}async subtitles(e,t){return(await Promise.all(e.map(((e,n)=>this._subtitles(e,!0===t?0:n))))).flatMap((e=>e)).filter((e=>void 0!==e.textImage||""!==e.text)).sort(((e,t)=>e.start-t.start))}async _subtitles(e,t){if(e.name.endsWith(".srt"))return new Oe({numericTimestamps:!0}).fromSrt(await e.text()).map((e=>({start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:this._filterText(e.text,!0),track:t})));if(e.name.endsWith(".vtt")||e.name.endsWith(".nfvtt"))return new Promise((async(n,i)=>{const r=e.name.endsWith(".nfvtt"),s=new Ce.WebVTT.Parser(window,Ce.WebVTT.StringDecoder()),o=[];s.oncue=e=>{if(e.text=this._filterText(e.text.replaceAll(Ae,""),!0),r){const t=e.text.split("\n"),n=[];for(const e of t)n.push(this._fixRTL(e));e.text=n.join("\n")}o.push(e)},s.onflush=()=>n(o.map((e=>({start:Math.floor(1e3*e.startTime),end:Math.floor(1e3*e.endTime),text:e.text,track:t})))),s.parse(await e.text()),s.flush()}));if(e.name.endsWith(".ass"))return function(e,t={}){const n=function(e){const t={info:{},styles:{format:[],style:[]},events:{format:[],comment:[],dialogue:[]}},n=e.split(/\r?\n/);let i=0;for(let e=0;e<n.length;e++){const r=n[e].trim();if(!/^;/.test(r)&&(/^\[Script Info\]/i.test(r)?i=1:/^\[V4\+? Styles\]/i.test(r)?i=2:/^\[Events\]/i.test(r)?i=3:/^\[.*\]/.test(r)&&(i=0),0!==i)){if(1===i&&/:/.test(r)){const[,e,n]=r.match(/(.*?)\s*:\s*(.*)/);t.info[e]=n}if(2===i&&(/^Format\s*:/i.test(r)&&(t.styles.format=he(r)),/^Style\s*:/i.test(r)&&t.styles.style.push(fe(r,t.styles.format))),3===i&&(/^Format\s*:/i.test(r)&&(t.events.format=he(r)),/^(?:Comment|Dialogue)\s*:/i.test(r))){const[,e,n]=r.match(/^(\w+?)\s*:\s*(.*)/i);t.events[e.toLowerCase()].push(ue(n,t.events.format))}}}return t}(e),i=function({info:e,style:t,defaultStyle:n}){const i={},r=[de({},Ee,n,{Name:"Default"})].concat(t);for(let t=0;t<r.length;t++){const n=r[t];/^(\*+)Default$/.test(n.Name)&&(n.Name="Default"),Object.keys(n).forEach((e=>{"Name"===e||"Fontname"===e||/Colour/.test(e)||(n[e]*=1)}));const[s,o]=_e(n.PrimaryColour),[a,l]=_e(n.SecondaryColour),[c,u]=_e(n.OutlineColour),[h,d]=_e(n.BackColour),f={fn:n.Fontname,fs:n.Fontsize,c1:o,a1:s,c2:l,a2:a,c3:u,a3:c,c4:d,a4:h,b:Math.abs(n.Bold),i:Math.abs(n.Italic),u:Math.abs(n.Underline),s:Math.abs(n.StrikeOut),fscx:n.ScaleX,fscy:n.ScaleY,fsp:n.Spacing,frz:n.Angle,xbord:n.Outline,ybord:n.Outline,xshad:n.Shadow,yshad:n.Shadow,fe:n.Encoding,q:/^[0-3]$/.test(e.WrapStyle)?1*e.WrapStyle:2};i[n.Name]={style:n,tag:f}}return i}({info:n.info,style:n.styles.style,defaultStyle:t.defaultStyle||{}});return{info:n.info,width:1*n.info.PlayResX||null,height:1*n.info.PlayResY||null,collisions:n.info.Collisions||"Normal",styles:i,dialogues:xe({styles:i,dialogues:n.events.dialogue})}}(await e.text(),{}).dialogues.map((e=>({start:Math.round(1e3*e.start),end:Math.round(1e3*e.end),text:this._filterText(e.slices.flatMap((e=>e.fragments.map((e=>e.text)))).join(""),!1).replace(Pe,"\n"),track:t})));if(e.name.endsWith(".ytxml")){const n=await e.text(),i=this._xmlParser().parse(n);if(0===Object.keys(i).length)return[];const r=i.transcript.text,s=[];let o,a=0;for(let e=0,n=r.length;e<n;e++){const n=r[e];if(!("#text"in n)||!("@_dur"in n)||!("@_start"in n))continue;const i=parseFloat(n["@_start"]),l={start:Math.floor(1e3*i),end:Math.floor(1e3*(i+parseFloat(n["@_dur"]))),text:this._filterText(this._decodeHTML(String(n["#text"])),!0),track:t};void 0!==o&&o.end>l.start&&++a,s.push(l),o=l}return s.length>0&&a/s.length>.5?s.map(((e,t)=>t<s.length-1?{...e,end:Math.max(e.start,Math.min(s[t+1].start-1,e.end))}:e)):s}if(e.name.endsWith(".sup"))return await this._parsePgs(e,t);if(e.name.endsWith(".dfxp")||e.name.endsWith("ttml2")){const n=await e.text(),i=(new DOMParser).parseFromString(n,"application/xml"),r=this._xmlNodePath(i.documentElement,["body","div"]),s=[];for(let e=0,n=r.length;e<n;e++){const n=r[e],i=n.getAttribute("begin"),o=n.getAttribute("end");if(null===i||null===o)continue;const a=this._decodeHTML(n.innerHTML.replaceAll(/<br(\s[^\s]+)?(\/)?>/g,"\n"));s.push({text:this._filterText(a,!1),start:this._parseTtmlTimestamp(i),end:this._parseTtmlTimestamp(o),track:t})}return s}if(e.name.endsWith(".bbjson"))return JSON.parse(await e.text()).body.map((e=>({text:e.content,start:1e3*e.from,end:1e3*e.to,track:t})));throw new Error("Unsupported subtitle file format")}_parsePgs(e,t){const n=[];return new Promise((async(i,r)=>{const s=await this._pgsWorkerFactory();s.onmessage=async e=>{switch(e.data.command){case"subtitle":const o={...e.data.subtitle,track:t},a=e.data.imageBlob;o.textImage.dataUrl=await this._blobToDataUrl(a),n.push(o);break;case"finished":s.terminate(),i(n);break;case"error":s.terminate(),r(e.data.error)}},s.onerror=e=>{const t=e?.error??new Error("PGS decoding failed: "+e?.message);r(t),s.terminate()};const o=document.createElement("canvas").transferControlToOffscreen(),a=await e.stream();s.postMessage({fileStream:a,canvas:o},[a,o])}))}_blobToDataUrl(e){return new Promise(((t,n)=>{var i=new FileReader;i.readAsDataURL(e),i.onloadend=()=>{t(i.result)}}))}_parseTtmlTimestamp(e){const t=e.split(":");return Math.floor(1e3*parseFloat(t[t.length-1]))+6e4*(t.length<2?0:Number(t[t.length-2]))+36e5*(t.length<3?0:Number(t[t.length-3]))}_xmlNodePath(e,t){if(0===t.length){const t=[];for(let n=0;n<e.children.length;++n){const i=e.children[n];t.push(i)}return t}for(let n=0;n<e.children.length;++n){const i=e.children[n];if(this._dropTagNamespace(i.tagName)===t[0])return this._xmlNodePath(i,t.slice(1))}throw new Error("Failied to parse XML path")}_dropTagNamespace(e){const t=e.lastIndexOf(":");return-1!==t?e.substring(t+1):e}_fixRTL(e){const t=e.indexOf("&lrm;"),n=e.indexOf("&rlm;");let i="";return t>-1?(i=e.substring(0,t)+"‪"+e.substring(t+5)+"‬",this._fixRTL(i)):n>-1?(i=e.substring(0,n)+"‫"+e.substring(n+5)+"‬",this._fixRTL(i)):e}_decodeHTML(e){Fe.innerHTML=e;const t=[...Fe.getElementsByTagName("rt")];for(const e of t)e.remove();return Fe.textContent??Fe.innerText}_xmlParser(){return void 0===this.xmlParser&&(this.xmlParser=new Te.XMLParser({ignoreAttributes:!1})),this.xmlParser}_filterText(e,t){return e=void 0===this._textFilter?e:e.replace(this._textFilter.regex,this._textFilter.replacement).trim(),t&&(e=this._decodeHTML(e)),e}subtitlesToSrt(e){const t=new Oe({numericTimestamps:!0}),n=e.map(((e,t)=>({id:String(t),startTime:e.start,endTime:e.end,text:e.text})));return t.toSrt(n)}async filesToSrt(e){return this.subtitlesToSrt(await this.subtitles(e))}}const Ne="activeSettingsProfile",Re="settingsProfiles";class Ie{constructor(e){this._storage=e??chrome.storage.local}async get(e){const t=await this.activeProfile();return void 0===t?await this._storage.get(e):((e,t)=>{const n={};for(const i of Object.keys(e))n[ee(i,t)]=e[i];return n})(await this._storage.get(te(e,t.name)),t.name)}async set(e){const t=await this.activeProfile();void 0===t?await this._storage.set(e):await this._storage.set(te(e,t.name))}async activeProfile(){const e=(await this._storage.get(Ne))[Ne];if(void 0!==e)return(await this.profiles()).find((t=>t.name===e))}async setActiveProfile(e){if(void 0===e)await this._storage.remove(Ne);else{if(void 0===(await this.profiles()).find((t=>t.name===e)))throw new Error(`Cannot set active profile to non-existant profile ${e}`);await this._storage.set({[Ne]:e})}}async profiles(){return(await this._storage.get({[Re]:[]}))[Re]??[]}async addProfile(e){const t=await this.profiles();void 0===t.find((t=>t.name===e))&&t.push({name:e}),await this._storage.set({[Re]:t});const n=await this._storage.get(Object.keys(Z));await this._storage.set(te(n,e))}async removeProfile(e){const t=await this.profiles(),n=await this.activeProfile();if(e===n?.name)throw new Error("Cannot remove active profile");const i=t.filter((t=>t.name!==e)),r=Object.keys(te(Z,e));await this._storage.remove(r),await this._storage.set({[Re]:i})}async clear(){await this._storage.clear()}}new J(new Ie),chrome.storage.local;const je=(new J(new Ie),async e=>await De(e)??await Me(e)??await Me("en")),Me=async e=>{for(const t of ne)if(e===t)return{lang:e,strings:await(await fetch(chrome.runtime.getURL(`asbplayer-locales/${e}.json`))).json()}},De=async e=>{const t=(e=>`locStrings-${e}`)(e),n=(await chrome.storage.local.get(t))[t];if(void 0!==n)return{lang:e,strings:n}};class Be{constructor(e,t){this.frame=e,this.fetchOptions=t,this.bindPromise=void 0}async bind(){return this.bindPromise=this.bindPromise||this._bindClient(),this.bindPromise}updateState(e){if(!this.frameId)throw new Error("Attempted to update state when frame is not ready");this.frame.contentWindow?.postMessage({sender:"asbplayer-video",message:{command:"sendClientMessage",message:{command:"updateState",state:e},frameId:this.frameId}},"*")}sendMessage(e){if(!this.frameId)throw new Error("Attempted to send message when frame is not ready");this.frame.contentWindow?.postMessage({sender:"asbplayer-video",message:{command:"sendClientMessage",message:e,frameId:this.frameId}},"*")}onMessage(e){this.serverMessageListener=e}unbind(){this.windowMessageListener&&(window.removeEventListener("message",this.windowMessageListener),this.windowMessageListener=void 0),this.serverMessageListener=void 0}_bindClient(){return new Promise(((e,t)=>{let n=!1;this.windowMessageListener=t=>{if(t.source!==this.frame.contentWindow||"asbplayer-frame"!==t.data.sender)return;const i=t.data.message;switch(i.command){case"ready":this.frameId=t.data.message.frameId,n=!0,e();break;case"onServerMessage":"http-post"===i.message.command?this._resolveHttpPost(i.message):this.serverMessageListener&&this.serverMessageListener(i.message)}},setTimeout((()=>{n||(t(new Error("Timed out waiting for frame to be ready")),this.windowMessageListener&&(window.removeEventListener("message",this.windowMessageListener),this.windowMessageListener=void 0))}),1e4),window.addEventListener("message",this.windowMessageListener)}))}_resolveHttpPost(e){if(void 0===this.fetchOptions)return;if(void 0===this.fetchOptions.allowedFetchUrl||e.url!==this.fetchOptions.allowedFetchUrl)return;let t;const n={command:"http-post",url:e.url,body:e.body,messageId:e.messageId};t=void 0===this.fetchOptions.videoSrc?{sender:"asbplayer-video-tab",message:n}:{sender:"asbplayer-video",message:n,src:this.fetchOptions.videoSrc},chrome.runtime.sendMessage(t,(t=>{const n=t?{...t,messageId:e.messageId}:{error:chrome.runtime.lastError?.message,messageId:e.messageId};this.frame.contentWindow?.postMessage({sender:"asbplayer-video",message:{command:"sendClientMessage",message:n,frameId:this.frameId}},"*")}))}}class $e{constructor(e){this._language="en",this._dirty=!0,this._bound=!1,this._html=e}set fetchOptions(e){this._dirty=this._dirty||this._fetchOptions?.allowedFetchUrl!==e.allowedFetchUrl||this._fetchOptions?.videoSrc!==e.videoSrc,this._fetchOptions=e}set language(e){this._dirty=this._dirty||this._language!==e,this._language=e}get hidden(){return void 0===this._frame||this._frame.classList.contains("asbplayer-hide")}get bound(){return this._bound}get frame(){return this._frame}async bind(){return await this._init()}async client(){return await this._init(),this._client}async _init(){if(!this._dirty)return!1;this._dirty=!1,this._bound=!0,this._client?.unbind(),this._frame?.remove(),this._frame=document.createElement("iframe"),this._frame.className="asbplayer-ui-frame",this._frame.style.colorScheme=(()=>{const e=document.querySelector('meta[name="color-scheme"]');if(null===e)return"normal";const t=e.content,n=t.includes("light"),i=t.includes("dark");return n&&i?"none":n?"light":i?"dark":"normal"})(),this._frame.setAttribute("allowtransparency","true"),this._client=new Be(this._frame,this._fetchOptions),document.body.appendChild(this._frame);{const e=this._frame.contentDocument;e.open(),e.write(await this._html(this._language)),e.close()}return await this._client.bind(),!0}show(){this._frame?.classList.remove("asbplayer-hide")}hide(){this._frame?.classList.add("asbplayer-hide"),this._frame?.blur()}unbind(){this._dirty=!0,this._client?.unbind(),this._frame?.remove()}}async function Ue(e){const t=await(await fetch(chrome.runtime.getURL("./mp3-encoder-worker.js"))).text();return`<!DOCTYPE html>\n                <html lang="en">\n                <head>\n                    <meta charset="utf-8" />\n                    <meta name="viewport" content="width=device-width, initial-scale=1" />\n                    <title>asbplayer - Anki</title>\n                    <style>\n                        @import url(${chrome.runtime.getURL("./assets/fonts.css")});\n                    </style>\n                </head>\n                <body>\n                    <div id="root" style="width:100%;height:100vh;"></div>\n                    <script type="application/json" id="loc">${JSON.stringify(await je(e))}<\/script>\n                    <script id="mp3-encoder-worker" type="javascript/worker">${t}<\/script>\n                    <script src="${chrome.runtime.getURL("./anki-ui.js")}"><\/script>\n                </body>\n            </html>`}class Ve{constructor(){this.frame=new $e(Ue)}get ankiSettings(){return this._ankiSettings}set ankiSettings(e){this._ankiSettings=e,this.frame?.bound&&this.frame.client().then((t=>t.sendMessage({command:"ankiSettings",value:e})))}get showing(){return!this.frame.hidden}async show(e,{subtitle:t,surroundingSubtitles:n,image:i,audio:r,text:s,definition:o,word:l,customFieldValues:c}){if(!this._ankiSettings)throw new Error("Unable to show Anki UI because settings are missing.");this._prepareShow(e);const u=await this._client(e),h=e.url,d=await e.settings.getSingle("themeType"),f={type:"initial",open:!0,canRerecord:!0,settingsProvider:this._ankiSettings,source:a(e.subtitleFileName(),t.start),url:h,subtitle:t,surroundingSubtitles:n,image:i,audio:r,themeType:d,dialogRequestedTimestamp:1e3*e.video.currentTime,text:s,word:l,definition:o,customFieldValues:c};u.updateState(f)}async showAfterRerecord(e,t){if(!this._ankiSettings)throw new Error("Unable to show Anki UI after rerecording because anki settings are undefined");this._prepareShow(e);const n=await this._client(e),i=await e.settings.getSingle("themeType"),r={...t,type:"resume",open:!0,canRerecord:!0,settingsProvider:this._ankiSettings,themeType:i,dialogRequestedTimestamp:1e3*e.video.currentTime};n.updateState(r)}async showAfterRetakingScreenshot(e,t){if(!this._ankiSettings)throw new Error("Unable to show Anki UI after retaking screenshot because anki settings are undefined");this._prepareShow(e);const n=await this._client(e),i=await e.settings.getSingle("themeType"),r={...t,type:"resume",open:!0,canRerecord:!0,settingsProvider:this._ankiSettings,themeType:i};n.updateState(r)}async requestRewind(e){(await this._client(e)).sendMessage({command:"rewind"})}_prepareShow(e){e.pause(),document.activeElement&&(this.activeElement=document.activeElement),document.fullscreenElement&&(this.fullscreenElement=document.fullscreenElement,document.exitFullscreen()),e.keyBindings.unbind(),e.subtitleController.forceHideSubtitles=!0,e.mobileVideoOverlayController.forceHide=!0}async _client(e){this.frame.fetchOptions={videoSrc:e.video.src,allowedFetchUrl:this._ankiSettings.ankiConnectUrl},this.frame.language=await e.settings.getSingle("language");const t=await this.frame.bind(),n=await this.frame.client();return t&&(this.focusInListener=e=>{void 0===this.frame||this.frame.hidden||n.sendMessage({command:"focus"})},window.addEventListener("focusin",this.focusInListener),n.onMessage((t=>{switch(t.command){case"openSettings":const n={sender:"asbplayer-video",message:{command:"open-asbplayer-settings"},src:e.video.src};return void chrome.runtime.sendMessage(n);case"copy-to-clipboard":const i={sender:"asbplayer-video",message:{command:"copy-to-clipboard",dataUrl:t.dataUrl},src:e.video.src};return void chrome.runtime.sendMessage(i)}if(e.keyBindings.bind(e),e.subtitleController.forceHideSubtitles=!1,e.mobileVideoOverlayController.forceHide=!1,this.frame?.hide(),this.fullscreenElement&&(this.fullscreenElement.requestFullscreen(),this.fullscreenElement=void 0),this.activeElement){const e=this.activeElement;"function"==typeof e.focus&&e.focus(),this.activeElement=void 0}else window.focus();switch(t.command){case"resume":const n=t;if(e.ankiUiSavedState=n.uiState,n.cardExported&&0!==n.uiState.dialogRequestedTimestamp){const t=n.uiState.dialogRequestedTimestamp/1e3;e.video.currentTime!==t&&e.seek(t)}switch(e.postMinePlayback){case h.remember:e.wasPlayingBeforeRecordingMedia&&e.play();break;case h.play:e.play();case h.pause:}break;case"rewind":const i=t;e.ankiUiSavedState=i.uiState,e.pause(),e.seek(i.uiState.subtitle.start/1e3);break;case"rerecord":const r=t;e.rerecord(r.recordStart,r.recordEnd,r.uiState);break;default:console.error("Unknown message received from bridge: "+t.command)}}))),this.frame.show(),n}unbind(){this.frame.unbind(),this.focusInListener&&(window.removeEventListener("focusin",this.focusInListener),this.focusInListener=void 0)}}class He{constructor(e){this.video=e,this.elements=[]}show(){for(const e of this.elements)e.classList.remove("asbplayer-hide")}hide(){this._garbageCollectElements(),this._findElements();for(const e of this.elements)e.classList.add("asbplayer-hide");return new Promise(((e,t)=>{setTimeout((()=>e(void 0)),0)}))}_garbageCollectElements(){this.elements=this.elements.filter((e=>this.video.getRootNode().contains(e)))}_findElements(){const e=this.video.getRootNode();if("function"==typeof e.elementFromPoint)for(const t of this._samplePoints())for(const n of this._path(e.elementFromPoint(t.x,t.y),e))!n||this._contains(this.elements,n)||n.classList.contains("asbplayer-ui-frame")||this.elements.push(n)}*_samplePoints(){const e=this.video.getBoundingClientRect(),t=e.width/25,n=e.height/25,i=e.width+e.x,r=e.height+e.y;for(let s=e.x;s<=i;s+=t)for(let o=e.y;o<=r;o+=n){const a={x:this._withNoise(s,t/2,e.x,i),y:this._withNoise(o,n/2,e.y,r)};yield a}}_withNoise(e,t,n,i){return Math.min(i,Math.max(n,e+(Math.random()*t*2-t)))}*_path(e,t){if(!e||e.contains(this.video))return;const n=t.host;let i=e;for(yield i;;){const e=i.parentElement;if(!e||e.contains(this.video)||void 0!==n&&e.contains(n))break;i=e,yield i}}_contains(e,t){for(const n of e)if(n.isSameNode(t))return!0;return!1}}class ze{constructor(e){this.video=e}element(){if(this.imageElement)return this.imageElement;const e=document.createElement("div");e.classList.add("asbplayer-image-container"),e.classList.add("asbplayer-hide");const t=document.createElement("img");return t.classList.add("asbplayer-image"),t.src=chrome.runtime.getURL("assets/image.png"),this._applyImageContainerStyles(t,e),e.appendChild(t),document.body.appendChild(e),this.imageElementStylesInterval=setInterval((()=>this._applyImageContainerStyles(t,e)),1e3),this.imageElement=e,this.imageElement}_applyImageContainerStyles(e,t){const n=this.video.getBoundingClientRect(),i=.9*Math.min(window.innerWidth,n.width),r=.9*Math.min(window.innerHeight,n.height);t.style.top=n.top+window.scrollY+.05*n.height+"px",t.style.left=n.left+.05*n.width+"px",t.style.width=i+"px",t.style.height=r+"px";const s=Math.min(1,Math.min(i/300,r/300)),o=300*s,a=300*s,l=(r-a)/2,c=(i-o)/2;e.style.top=l+"px",e.style.left=c+"px",e.style.width=o+"px",e.style.height=a+"px"}remove(){this.imageElementStylesInterval&&(clearInterval(this.imageElementStylesInterval),this.imageElementStylesInterval=void 0),this.imageElement&&(this.imageElement.remove(),this.imageElement=void 0)}}class We{constructor(e){this.dragEnterElement=null,this.bodyDragEnterElement=null,this.video=e,this.imageElement=new ze(e),this.bound=!1}bind(e){if(this.bound)return;this.dropListener=async t=>{if(t.preventDefault(),this.dragEnterElement=null,this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide"),!t.dataTransfer?.files||0===t.dataTransfer?.files.length)return;const n=[];for(let e=0;e<t.dataTransfer.files.length;++e){const i=t.dataTransfer.files[e],r=i.name.lastIndexOf(".");if(-1===r)return!1;const s=i.name.substring(r+1,i.name.length);"ass"!==s&&"srt"!==s&&"vtt"!==s&&"sup"!==s&&"dfxp"!==s&&"ttml2"!==s||n.push(i)}e.loadSubtitles(n,!1)},this.dragOverListener=e=>e.preventDefault(),this.dragEnterListener=e=>{e.preventDefault(),this.dragEnterElement=e.target,this.imageElement.element().classList.add("asbplayer-drag-image"),this.imageElement.element().classList.remove("asbplayer-hide"),this.imageElement.element().classList.add("asbplayer-image-fade-in")},this.dragLeaveListener=e=>{e.preventDefault(),this.dragEnterElement===e.target&&(this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide"))},this.bodyDropListener=e=>{e.preventDefault(),this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide")},this.bodyDragOverListener=e=>e.preventDefault(),this.bodyDragEnterListener=e=>{e.preventDefault(),this.bodyDragEnterElement=e.target,this._dragElement().classList.add("asbplayer-drag-zone-dragging"),this._dragElement().classList.remove("asbplayer-hide")},this.bodyDragLeaveListener=e=>{e.preventDefault(),this.bodyDragEnterElement===e.target&&(this.imageElement.element().classList.add("asbplayer-hide"),this.imageElement.element().classList.remove("asbplayer-image-fade-in"),this._dragElement().classList.remove("asbplayer-drag-zone-dragging"),this._dragElement().classList.add("asbplayer-hide"))};const t=this._dragElement();t.addEventListener("drop",this.dropListener),t.addEventListener("dragover",this.dragOverListener),t.addEventListener("dragenter",this.dragEnterListener),t.addEventListener("dragleave",this.dragLeaveListener),document.body.addEventListener("drop",this.bodyDropListener),document.body.addEventListener("dragover",this.bodyDragOverListener),document.body.addEventListener("dragenter",this.bodyDragEnterListener),document.body.addEventListener("dragleave",this.bodyDragLeaveListener),this.bound=!0}_dragElement(){if(this.dragElement)return this.dragElement;const e=document.createElement("div");return e.classList.add("asbplayer-drag-zone-initial"),this.dragElement=e,this._applyDragElementStyles(e),document.body.appendChild(e),this.dragElementStylesInterval=setInterval((()=>this._applyDragElementStyles(e)),1e3),this.dragElement}_applyDragElementStyles(e){const t=this.video.getBoundingClientRect();e.style.top=t.top+window.scrollY+.05*t.height+"px",e.style.left=t.left+.05*t.width+"px",e.style.height=.9*Math.min(window.innerHeight,t.height)+"px",e.style.width=.9*Math.min(window.innerWidth,t.width)+"px"}unbind(){this.dropListener&&(this.dragElement?.removeEventListener("drop",this.dropListener,!0),this.dropListener=void 0),this.dragOverListener&&(this.dragElement?.removeEventListener("dragover",this.dragOverListener,!0),this.dragOverListener=void 0),this.dragEnterListener&&(this.dragElement?.removeEventListener("dragenter",this.dragEnterListener,!0),this.dragEnterListener=void 0),this.dragLeaveListener&&(this.dragElement?.removeEventListener("dragleave",this.dragLeaveListener,!0),this.dragLeaveListener=void 0),this.bodyDropListener&&(document.body.removeEventListener("drop",this.bodyDropListener),this.bodyDropListener=void 0),this.bodyDragOverListener&&(document.body.removeEventListener("dragover",this.bodyDragOverListener),this.bodyDragOverListener=void 0),this.bodyDragEnterListener&&(document.body.removeEventListener("dragenter",this.bodyDragEnterListener),this.bodyDragEnterListener=void 0),this.bodyDragLeaveListener&&(document.body.removeEventListener("dragleave",this.bodyDragLeaveListener),this.bodyDragLeaveListener=void 0),this.dragElementStylesInterval&&(clearInterval(this.dragElementStylesInterval),this.dragElementStylesInterval=void 0),this.dragElement&&(this.dragElement.remove(),this.dragElement=void 0),this.imageElement.remove(),this.dragEnterElement=null,this.bound=!1}}class qe{constructor(e){this._bound=!1,this._context=e}bind(){this._bound||(this._startTouchListener=e=>{this._startTouch={x:e.changedTouches[0].clientX,timestamp:Date.now()}},this._endTouchListener=e=>{if(!this._startTouch)return;const t=e.changedTouches[0].clientX,n=e.changedTouches[0].clientY;this._insideRect(t,n)&&Date.now()-this._startTouch.timestamp<500&&(this._startTouch.x>=t+50?this.onSwipeLeft?.():this._startTouch.x<=t-50&&this.onSwipeRight?.()),this._startTouch=void 0},document.addEventListener("touchstart",this._startTouchListener,!0),document.addEventListener("touchend",this._endTouchListener,!0),this._bound=!0)}_insideRect(e,t){const n=this._context.video.getBoundingClientRect();return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}unbind(){this._startTouchListener&&(document.removeEventListener("touchstart",this._startTouchListener,!0),this._startTouchListener=void 0),this._endTouchListener&&(document.removeEventListener("touchend",this._endTouchListener,!0),this._endTouchListener=void 0),this.onSwipeLeft=void 0,this.onSwipeRight=void 0,this._startTouch=void 0,this._bound=!1}}var Ze;!function(e){e[e.bottom=0]="bottom",e[e.top=1]="top"}(Ze||(Ze={}));class Xe{constructor({targetElement:e,nonFullscreenContainerClassName:t,nonFullscreenContentClassName:n,fullscreenContainerClassName:i,fullscreenContentClassName:r,offsetAnchor:s,contentPositionOffset:o}){this.domCache=new g,this.offsetAnchor=Ze.bottom,this.targetElement=e,this.nonFullscreenContainerClassName=t,this.nonFullscreenContentClassName=n,this.fullscreenContainerClassName=i,this.fullscreenContentClassName=r,this.offsetAnchor=s,this.contentPositionOffset=o??75}uncacheHtml(){this.domCache.clear()}cacheHtml(e,t){this.domCache.add(e,t)}setHtml(e){document.fullscreenElement?this._displayFullscreenContentElementsWithHtml(e):this._displayNonFullscreenContentElementsWithHtml(e)}_displayNonFullscreenContentElementsWithHtml(e){this._displayNonFullscreenContentElements(e.map((e=>this._cachedContentElement(e.html,e.key))))}_displayNonFullscreenContentElements(e){for(const t of e)t.className=this.nonFullscreenContentClassName;this._setChildren(this._nonFullscreenContainerElement(),e)}_displayFullscreenContentElementsWithHtml(e){this._displayFullscreenContentElements(e.map((e=>this._cachedContentElement(e.html,e.key))))}_displayFullscreenContentElements(e){for(const t of e)t.className=this.fullscreenContentClassName;this._setChildren(this._fullscreenContainerElement(),e)}_nonFullscreenContainerElement(){if(this.nonFullscreenContainerElement)return this.nonFullscreenContainerElement;const e=document.createElement("div");e.className=this.nonFullscreenContainerClassName,this._applyContainerStyles(e),document.body.appendChild(e);const t=()=>{document.fullscreenElement?e.style.display="none":(e.style.display="",this.fullscreenContainerElement&&this._transferChildren(this.fullscreenContainerElement,e))};return t(),this.nonFullscreenElementFullscreenChangeListener=e=>t(),this.nonFullscreenStylesInterval=setInterval((()=>this._applyContainerStyles(e)),1e3),this.nonFullscreenElementFullscreenPollingInterval=setInterval((()=>t()),1e3),document.addEventListener("fullscreenchange",this.nonFullscreenElementFullscreenChangeListener),this.nonFullscreenContainerElement=e,e}_fullscreenContainerElement(){if(this.fullscreenContainerElement)return this.fullscreenContainerElement;const e=document.createElement("div");e.className=this.fullscreenContainerClassName,this._applyContainerStyles(e),this._findFullscreenParentElement(e).appendChild(e),e.style.display="none";const t=this,n=()=>{document.fullscreenElement?("none"===e.style.display&&(e.style.display="",e.remove(),t._findFullscreenParentElement(e).appendChild(e)),this.nonFullscreenContainerElement&&this._transferChildren(this.nonFullscreenContainerElement,e)):document.fullscreenElement||(e.style.display="none")};return n(),this.fullscreenElementFullscreenChangeListener=e=>n(),this.fullscreenStylesInterval=setInterval((()=>this._applyContainerStyles(e)),1e3),this.fullscreenElementFullscreenPollingInterval=setInterval((()=>n()),1e3),document.addEventListener("fullscreenchange",this.fullscreenElementFullscreenChangeListener),this.fullscreenContainerElement=e,this.fullscreenContainerElement}_findFullscreenParentElement(e){const t=e.cloneNode(!0);t.innerHTML="&nbsp;";let n,i=this.targetElement.parentElement;if(!i)return document.body;do{const e=i.getBoundingClientRect();if(e.height>0&&(void 0===n||e.height>=n.getBoundingClientRect().height)&&this._clickable(i,t)){n=i;break}i=i.parentElement}while(i&&!i.isSameNode(document.body.parentElement));return n||document.body}_transferChildren(e,t){if(e)for(;e.firstChild;)t.appendChild(e.firstChild)}_setChildren(e,t){for(;e.firstChild;)this.domCache.return(e.lastChild);for(const n of t)e.appendChild(n)}_cachedContentElement(e,t){return void 0===t?(this.defaultContentElement||(this.defaultContentElement=document.createElement("div")),this.defaultContentElement.innerHTML=e(),this.defaultContentElement):this.domCache.get(t,e)}appendHtml(e){document.fullscreenElement?this._appendHtml(`${e}\n`,this.fullscreenContentClassName,this._fullscreenContainerElement()):this._appendHtml(`${e}\n`,this.nonFullscreenContentClassName,this._nonFullscreenContainerElement())}_appendHtml(e,t,n){const i=document.createElement("br"),r=document.createElement("div");r.innerHTML=e,r.className=t,n.appendChild(i),n.appendChild(r)}refresh(){this.fullscreenContainerElement&&this._applyContainerStyles(this.fullscreenContainerElement),this.nonFullscreenContainerElement&&this._applyContainerStyles(this.nonFullscreenContainerElement)}hide(){this.nonFullscreenElementFullscreenChangeListener&&document.removeEventListener("fullscreenchange",this.nonFullscreenElementFullscreenChangeListener),this.nonFullscreenStylesInterval&&clearInterval(this.nonFullscreenStylesInterval),this.nonFullscreenElementFullscreenPollingInterval&&clearInterval(this.nonFullscreenElementFullscreenPollingInterval),this.fullscreenElementFullscreenChangeListener&&document.removeEventListener("fullscreenchange",this.fullscreenElementFullscreenChangeListener),this.fullscreenStylesInterval&&clearInterval(this.fullscreenStylesInterval),this.fullscreenElementFullscreenPollingInterval&&clearInterval(this.fullscreenElementFullscreenPollingInterval),this.defaultContentElement?.remove(),this.defaultContentElement=void 0,this.nonFullscreenContainerElement?.remove(),this.nonFullscreenContainerElement=void 0,this.fullscreenContainerElement?.remove(),this.fullscreenContainerElement=void 0}_applyContainerStyles(e){const t=this.targetElement.getBoundingClientRect();e.style.left=t.left+t.width/2+"px",e.style.maxWidth=t.width+"px";const n=Math.max(t.top+window.scrollY,0);if(this.offsetAnchor===Ze.bottom){const i=Math.min(n+t.height,window.innerHeight);e.style.top=i-this.contentPositionOffset+"px",e.style.bottom=""}else e.style.top=n+this.contentPositionOffset+"px",e.style.bottom=""}_clickable(e,t){e.appendChild(t);const n=t.getBoundingClientRect(),i=document.elementFromPoint(n.x,n.y),r=t.isSameNode(i)||t.contains(i);return t.remove(),r}dispose(){this.hide(),this.domCache.clear()}}class Ke{constructor({targetElement:e,nonFullscreenContainerClassName:t,nonFullscreenContentClassName:n,fullscreenContainerClassName:i,fullscreenContentClassName:r,offsetAnchor:s,contentPositionOffset:o}){this.offsetAnchor=Ze.bottom,this.targetElement=e,this.nonFullscreenContainerClassName=t,this.nonFullscreenContentClassName=n,this.fullscreenContainerClassName=i,this.fullscreenContentClassName=r,this.offsetAnchor=s,this.contentPositionOffset=o??75}uncacheHtml(){}cacheHtml(e,t){}setHtml(e){const t=`${e.map((e=>e.html())).join("\n")}\n`;this._nonFullscreenContentElement().innerHTML=t,this._fullscreenContentElement().innerHTML=t}appendHtml(e){const t=this._nonFullscreenContentElement().innerHTML,n=t&&t.length>0?t+"<br>"+e:e;this._nonFullscreenContentElement().innerHTML=`${n}\n`,this._fullscreenContentElement().innerHTML=`${n}\n`}refresh(){this.fullscreenContainerElement&&this._applyContainerStyles(this.fullscreenContainerElement),this.nonFullscreenContainerElement&&this._applyContainerStyles(this.nonFullscreenContainerElement)}hide(){this.nonFullscreenContentElement&&(this.nonFullscreenElementFullscreenChangeListener&&document.removeEventListener("fullscreenchange",this.nonFullscreenElementFullscreenChangeListener),this.nonFullscreenStylesInterval&&clearInterval(this.nonFullscreenStylesInterval),this.nonFullscreenElementFullscreenPollingInterval&&clearInterval(this.nonFullscreenElementFullscreenPollingInterval),this.nonFullscreenContentElement.remove(),this.nonFullscreenContainerElement?.remove(),this.nonFullscreenContainerElement=void 0,this.nonFullscreenContentElement=void 0),this.fullscreenContentElement&&(this.fullscreenElementFullscreenChangeListener&&document.removeEventListener("fullscreenchange",this.fullscreenElementFullscreenChangeListener),this.fullscreenStylesInterval&&clearInterval(this.fullscreenStylesInterval),this.fullscreenElementFullscreenPollingInterval&&clearInterval(this.fullscreenElementFullscreenPollingInterval),this.fullscreenContentElement.remove(),this.fullscreenContainerElement?.remove(),this.fullscreenContainerElement=void 0,this.fullscreenContentElement=void 0)}_nonFullscreenContentElement(){if(this.nonFullscreenContentElement)return this.nonFullscreenContentElement;const e=document.createElement("div"),t=document.createElement("div");function n(){document.fullscreenElement?t.style.display="none":t.style.display=""}return t.appendChild(e),t.className=this.nonFullscreenContainerClassName,e.className=this.nonFullscreenContentClassName,this._applyContainerStyles(t),document.body.appendChild(t),n(),this.nonFullscreenElementFullscreenChangeListener=e=>n(),this.nonFullscreenStylesInterval=setInterval((()=>this._applyContainerStyles(t)),1e3),this.nonFullscreenElementFullscreenPollingInterval=setInterval((()=>n()),1e3),document.addEventListener("fullscreenchange",this.nonFullscreenElementFullscreenChangeListener),this.nonFullscreenContentElement=e,this.nonFullscreenContainerElement=t,this.nonFullscreenContentElement}_applyContainerStyles(e){const t=this.targetElement.getBoundingClientRect();e.style.left=t.left+t.width/2+"px",e.style.maxWidth=t.width+"px";const n=Math.max(t.top+window.scrollY,0);if(this.offsetAnchor===Ze.bottom){const i=Math.min(n+t.height,window.innerHeight);e.style.top=i-this.contentPositionOffset+"px",e.style.bottom=""}else e.style.top=n+this.contentPositionOffset+"px",e.style.bottom=""}_fullscreenContentElement(){if(this.fullscreenContentElement)return this.fullscreenContentElement;const e=document.createElement("div"),t=document.createElement("div");t.appendChild(e),t.className=this.fullscreenContainerClassName,e.className=this.fullscreenContentClassName,this._applyContainerStyles(t),this._findFullscreenParentElement(t).appendChild(t),t.style.display="none";const n=this;function i(){document.fullscreenElement&&"none"===t.style.display?(t.style.display="",t.remove(),n._findFullscreenParentElement(t).appendChild(t)):document.fullscreenElement||(t.style.display="none")}return i(),this.fullscreenElementFullscreenChangeListener=e=>i(),this.fullscreenStylesInterval=setInterval((()=>this._applyContainerStyles(t)),1e3),this.fullscreenElementFullscreenPollingInterval=setInterval((()=>i()),1e3),document.addEventListener("fullscreenchange",this.fullscreenElementFullscreenChangeListener),this.fullscreenContentElement=e,this.fullscreenContainerElement=t,this.fullscreenContentElement}_findFullscreenParentElement(e){const t=e.cloneNode(!0);t.innerHTML="&nbsp;";let n,i=this.targetElement.parentElement;if(!i)return document.body;do{const e=i.getBoundingClientRect();if(e.height>0&&(void 0===n||e.height>=n.getBoundingClientRect().height)&&this._clickable(i,t)){n=i;break}i=i.parentElement}while(i&&!i.isSameNode(document.body.parentElement));return n||document.body}_clickable(e,t){e.appendChild(t);const n=t.getBoundingClientRect(),i=document.elementFromPoint(n.x,n.y),r=t.isSameNode(i)||t.contains(i);return t.remove(),r}dispose(){this.hide()}}class Ge{constructor(e,t){this._forceHiding=!1,this._showing=!1,this._uiInitialized=!1,this._bound=!1,this._context=e,this._overlay=Ge._elementOverlay(e.video,t)}static _elementOverlay(e,t){const n=t===Ze.top?"asbplayer-mobile-video-overlay-container-top":"asbplayer-mobile-video-overlay-container-bottom";return new Xe({targetElement:e,nonFullscreenContainerClassName:n,fullscreenContainerClassName:n,nonFullscreenContentClassName:"asbplayer-mobile-video-overlay",fullscreenContentClassName:"asbplayer-mobile-video-overlay",offsetAnchor:t,contentPositionOffset:8})}set offsetAnchor(e){this._overlay.offsetAnchor!==e&&(this._overlay.dispose(),this._overlay=Ge._elementOverlay(this._context.video,e),this._showing&&this._doShow())}set forceHide(e){this._bound&&(e?(this._showing&&this._doHide(),this._forceHiding=!0):this._forceHiding&&(this._forceHiding=!1,this._show()))}bind(){this._bound||(this._pauseListener=()=>{this._show()},this._playListener=()=>{this._hide()},this._seekedListener=()=>{this.updateModel()},this._context.video.addEventListener("pause",this._pauseListener),this._context.video.addEventListener("play",this._playListener),this._context.video.addEventListener("seeked",this._seekedListener),this._messageListener=(e,t,n)=>{if("asbplayer-mobile-overlay-to-video"===e.sender&&"request-mobile-overlay-model"===e.message.command&&e.src===this._context.video.src)return this._model().then(n),this._uiInitialized=!0,!0},chrome.runtime.onMessage.addListener(this._messageListener),this._bound=!0,this._context.video.paused&&this._show())}async updateModel(){if(!this._bound||!this._uiInitialized)return;const e={sender:"asbplayer-video",message:{command:"update-mobile-overlay-model",model:await this._model()},src:this._context.video.src};chrome.runtime.sendMessage(e)}async _model(){const e=this._context.subtitleController.subtitles,t=e.length>0&&null!==this._context.subtitleController.currentSubtitle()[0],n=1e3*this._context.video.currentTime,{language:i,clickToMineDefaultAction:r}=await this._context.settings.get(["language","clickToMineDefaultAction"]);return{offset:0===e.length?0:e[0].start-e[0].originalStart,emptySubtitleTrack:0===e.length,recordingEnabled:this._context.recordMedia,recording:this._context.recordingMedia,previousSubtitleTimestamp:U(!1,n,e)?.originalStart??void 0,nextSubtitleTimestamp:U(!0,n,e)?.originalStart??void 0,currentTimestamp:n,language:i,postMineAction:r,subtitleDisplaying:t}}show(){this._bound&&this._show()}disposeOverlay(){this._overlay.dispose(),this._overlay=Ge._elementOverlay(this._context.video,this._overlay.offsetAnchor)}_show(){this._context.synced&&!this._forceHiding&&this._doShow()}_doShow(){const e=this._overlay.offsetAnchor===Ze.bottom?"bottom":"top";this._overlay.setHtml([{key:"ui",html:()=>`<iframe style="border: 0; color-scheme: normal; width: 400px; height: 108px" src="${chrome.runtime.getURL("mobile-video-overlay-ui.html")}?src=${encodeURIComponent(this._context.video.src)}&anchor=${e}"/>`}]),this._showing=!0}hide(){this._bound&&this._hide()}_hide(){this._context.synced&&!this._context.recordingMedia&&this._doHide()}_doHide(){this._overlay.hide(),this._showing=!1}unbind(){this._pauseListener&&(this._context.video.removeEventListener("pause",this._pauseListener),this._pauseListener=void 0),this._playListener&&(this._context.video.removeEventListener("play",this._playListener),this._playListener=void 0),this._seekedListener&&(this._context.video.removeEventListener("seeked",this._seekedListener),this._seekedListener=void 0),this._messageListener&&(chrome.runtime.onMessage.removeListener(this._messageListener),this._messageListener=void 0),this._overlay.dispose(),this._overlay=Ge._elementOverlay(this._context.video,this._overlay.offsetAnchor),this._showing=!1,this._bound=!1}}class Ye{constructor(e){this._context=e,this._frame=new $e((async e=>`<!DOCTYPE html>\n                    <html lang="en">\n                    <head>\n                        <meta charset="utf-8" />\n                        <meta name="viewport" content="width=device-width, initial-scale=1" />\n                        <title>asbplayer</title>\n                        <style>\n                        @import url(${chrome.runtime.getURL("./assets/fonts.css")});\n                        </style>\n                    </head>\n                    <body>\n                        <div id="root" style="width:100%;height:100vh;"></div>\n                        <script type="application/json" id="loc">${JSON.stringify(await je(e))}<\/script>\n                        <script src="${chrome.runtime.getURL("./notification-ui.js")}"><\/script>\n                    </body>\n                </html>`))}get showing(){return!this._frame.hidden}hide(){this._frame.hide()}async show(e,t){await this._prepareAndShowFrame("asbplayer-ui-frame"),document.fullscreenElement&&document.exitFullscreen(),this._client.updateState({themeType:await this._context.settings.getSingle("themeType"),titleLocKey:e,messageLocKey:t,alertLocKey:""}),this._context.pause()}async updateAlert(e){await this._prepareAndShowFrame("asbplayer-alert"),this._client.updateState({themeType:await this._context.settings.getSingle("themeType"),titleLocKey:"",messageLocKey:"",newVersion:e})}async _prepareAndShowFrame(e){this._frame.language=await this._context.settings.getSingle("language");const t=await this._frame.bind();this._frame.frame.className=e,this._client=await this._frame.client(),t&&this._client.onMessage((e=>{"close"===e.command&&(this._context.subtitleController.forceHideSubtitles=!1,this._context.mobileVideoOverlayController.forceHide=!1,this._context.controlsController.show(),this._frame.hide(),this.onClose?.())})),this._frame.show()}unbind(){this._frame?.unbind()}}const Je=class e{constructor(e,t){this.low=e,this.high=t}clone(){return new e(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low==e.low&&this.high<e.high}equal_to(e){return this.low==e.low&&this.high==e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(t){return new e(void 0===this.low?t.low:Math.min(this.low,t.low),void 0===this.high?t.high:Math.max(this.high,t.high))}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}};class Qe{constructor(e=void 0,t=void 0,n=null,i=null,r=null,s=1){this.left=n,this.right=i,this.parent=r,this.color=s,this.item={key:e,value:t},e&&e instanceof Array&&2==e.length&&(Number.isNaN(e[0])||Number.isNaN(e[1])||(this.item.key=new Je(Math.min(e[0],e[1]),Math.max(e[0],e[1])))),this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&1===this.color}less_than(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.less_than(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value;return this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&t}}equal_to(e){if(this.item.value===this.item.key&&e.item.value===e.item.key)return this.item.key.equal_to(e.item.key);{let t=this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value==e.item.value;return this.item.key.equal_to(e.item.key)&&t}}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){const e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){return(0,this.item.key.constructor.comparable_less_than)(void 0!==this.left.max.high?this.left.max.high:this.left.max,e.item.key.low)}not_intersect_right_subtree(e){const t=this.item.key.constructor.comparable_less_than;let n=void 0!==this.right.max.low?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,n)}}class et{constructor(){this.root=null,this.nil_node=new Qe}get size(){let e=0;return this.tree_walk(this.root,(()=>e++)),e}get keys(){let e=[];return this.tree_walk(this.root,(t=>e.push(t.item.key.output?t.item.key.output():t.item.key))),e}get values(){let e=[];return this.tree_walk(this.root,(t=>e.push(t.item.value))),e}get items(){let e=[];return this.tree_walk(this.root,(t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value}))),e}isEmpty(){return null==this.root||this.root==this.nil_node}clear(){this.root=null}insert(e,t=e){if(void 0===e)return;let n=new Qe(e,t,this.nil_node,this.nil_node,null,0);return this.tree_insert(n),this.recalc_max(n),n}exist(e,t=e){let n=new Qe(e,t);return!!this.tree_search(this.root,n)}remove(e,t=e){let n=new Qe(e,t),i=this.tree_search(this.root,n);return i&&this.tree_delete(i),i}search(e,t=((e,t)=>e===t?t.output():e)){let n=new Qe(e),i=[];return this.tree_search_interval(this.root,n,i),i.map((e=>t(e.item.value,e.item.key)))}intersect_any(e){let t=new Qe(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,(t=>e(t.item.key,t.item.value)))}map(e){const t=new et;return this.tree_walk(this.root,(n=>t.insert(n.item.key,e(n.item.value,n.item.key)))),t}recalc_max(e){let t=e;for(;null!=t.parent;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,n=null;if(null==this.root||this.root==this.nil_node)this.root=e;else{for(;t!=this.nil_node;)n=t,t=e.less_than(t)?t.left:t.right;e.parent=n,e.less_than(n)?n.left=e:n.right=e}this.insert_fixup(e)}insert_fixup(e){let t,n;for(t=e;t!=this.root&&0==t.parent.color;)t.parent==t.parent.parent.left?(n=t.parent.parent.right,0==n.color?(t.parent.color=1,n.color=1,t.parent.parent.color=0,t=t.parent.parent):(t==t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_right(t.parent.parent))):(n=t.parent.parent.left,0==n.color?(t.parent.color=1,n.color=1,t.parent.parent.color=0,t=t.parent.parent):(t==t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_left(t.parent.parent)));this.root.color=1}tree_delete(e){let t,n;t=e.left==this.nil_node||e.right==this.nil_node?e:this.tree_successor(e),n=t.left!=this.nil_node?t.left:t.right,n.parent=t.parent,t==this.root?this.root=n:(t==t.parent.left?t.parent.left=n:t.parent.right=n,t.parent.update_max()),this.recalc_max(n),t!=e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),1==t.color&&this.delete_fixup(n)}delete_fixup(e){let t,n=e;for(;n!=this.root&&null!=n.parent&&1==n.color;)n==n.parent.left?(t=n.parent.right,0==t.color&&(t.color=1,n.parent.color=0,this.rotate_left(n.parent),t=n.parent.right),1==t.left.color&&1==t.right.color?(t.color=0,n=n.parent):(1==t.right.color&&(t.color=0,t.left.color=1,this.rotate_right(t),t=n.parent.right),t.color=n.parent.color,n.parent.color=1,t.right.color=1,this.rotate_left(n.parent),n=this.root)):(t=n.parent.left,0==t.color&&(t.color=1,n.parent.color=0,this.rotate_right(n.parent),t=n.parent.left),1==t.left.color&&1==t.right.color?(t.color=0,n=n.parent):(1==t.left.color&&(t.color=0,t.right.color=1,this.rotate_left(t),t=n.parent.left),t.color=n.parent.color,n.parent.color=1,t.left.color=1,this.rotate_right(n.parent),n=this.root));n.color=1}tree_search(e,t){if(null!=e&&e!=this.nil_node)return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_interval(e,t,n){null!=e&&e!=this.nil_node&&(e.left==this.nil_node||e.not_intersect_left_subtree(t)||this.tree_search_interval(e.left,t,n),e.intersect(t)&&n.push(e),e.right==this.nil_node||e.not_intersect_right_subtree(t)||this.tree_search_interval(e.right,t,n))}tree_find_any_interval(e,t){let n=!1;return null!=e&&e!=this.nil_node&&(e.left==this.nil_node||e.not_intersect_left_subtree(t)||(n=this.tree_find_any_interval(e.left,t)),n||(n=e.intersect(t)),n||e.right==this.nil_node||e.not_intersect_right_subtree(t)||(n=this.tree_find_any_interval(e.right,t))),n}local_minimum(e){let t=e;for(;null!=t.left&&t.left!=this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;null!=t.right&&t.right!=this.nil_node;)t=t.right;return t}tree_successor(e){let t,n,i;if(e.right!=this.nil_node)t=this.local_minimum(e.right);else{for(n=e,i=e.parent;null!=i&&i.right==n;)n=i,i=i.parent;t=i}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!=this.nil_node&&(t.left.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,null!=e&&e!=this.nil_node&&e.update_max(),t=e.parent,null!=t&&t!=this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!=this.nil_node&&(t.right.parent=e),t.parent=e.parent,e==this.root?this.root=t:e==e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,null!=e&&e!=this.nil_node&&e.update_max(),t=e.parent,null!=t&&t!=this.nil_node&&t.update_max()}tree_walk(e,t){null!=e&&e!=this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,(function(t){0==t.color&&(1==t.left.color&&1==t.right.color||(e=!1))})),e}testBlackHeightProperty(e){let t=0,n=0,i=0;if(1==e.color&&t++,n=e.left!=this.nil_node?this.testBlackHeightProperty(e.left):1,i=e.right!=this.nil_node?this.testBlackHeightProperty(e.right):1,n!=i)throw new Error("Red-black height property violated");return t+=n,t}}const tt=et;class nt{constructor(e,t={}){if(this.tree=new tt,this.options=t,t.returnLastShown||t.returnNextToShow){let t;this.gapsTree=new tt,e.length>0&&e[0].start>0&&this.gapsTree.insert([0,e[0].start-1],e[0]);for(const n of e)this.tree.insert([n.start,n.end],n),void 0!==t&&t.end<n.start&&this.gapsTree.insert([t.end+1,n.start-1],t),t=n}else for(const t of e)this.tree.insert([t.start,t.end],t)}static empty(){return nt.emptySubtitleCollection}subtitlesAt(e){const t=[e,e],n=this.tree.search(t);let i,r,s,o;if(0===n.length){if(void 0!==this.gapsTree){const e=[];if(i=this.gapsTree.search(t,((t,n)=>(e.push(n),t))),i.length>0&&this.options.returnNextToShow){const t=e[0].high+1;r=this.tree.search([t,t])}}}else if(void 0!==this.options.showingCheckRadiusMs)for(const t of n)if(void 0===o&&t.end<e+this.options.showingCheckRadiusMs&&(o=t),void 0===s&&e-this.options.showingCheckRadiusMs<t.start&&(s=t),void 0!==s&&void 0!==o)break;return{showing:n,lastShown:i,nextToShow:r,startedShowing:s,willStopShowing:o}}}function it(e){return it="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},it(e)}function rt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function st(e){var t=function(e,t){if("object"!==it(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==it(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===it(t)?t:String(t)}function ot(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,st(i.key),i)}}function at(e,t,n){return t&&ot(e.prototype,t),n&&ot(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e,t){return ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ct(e,t)}function ut(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ct(e,t)}function ht(e,t){if(t&&("object"===it(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return lt(e)}function dt(e){return dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},dt(e)}function ft(e,t,n){return(t=st(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function gt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gt(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}nt.emptySubtitleCollection=new nt([]);var yt={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},bt=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};rt(this,e),this.init(t,n)}return at(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||yt,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,i){return i&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,mt(mt({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}()),vt=function(){function e(){rt(this,e),this.observers={}}return at(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)})),this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function wt(){var e,t,n=new Promise((function(n,i){e=n,t=i}));return n.resolve=e,n.reject=t,n}function St(e){return null==e?"":""+e}function kt(e,t,n){function i(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function r(){return!e||"string"==typeof e}for(var s="string"!=typeof t?[].concat(t):t.split(".");s.length>1;){if(r())return{};var o=i(s.shift());!e[o]&&n&&(e[o]=new n),e=Object.prototype.hasOwnProperty.call(e,o)?e[o]:{}}return r()?{}:{obj:e,k:i(s.shift())}}function xt(e,t,n){var i=kt(e,t,Object);i.obj[i.k]=n}function Et(e,t){var n=kt(e,t),i=n.obj,r=n.k;if(i)return i[r]}function _t(e,t,n){for(var i in t)"__proto__"!==i&&"constructor"!==i&&(i in e?"string"==typeof e[i]||e[i]instanceof String||"string"==typeof t[i]||t[i]instanceof String?n&&(e[i]=t[i]):_t(e[i],t[i],n):e[i]=t[i]);return e}function Ot(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var Ct={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function Tt(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return Ct[e]})):e}var At="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,Pt=[" ",",","?","!",";"];function Ft(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var i=t.split(n),r=e,s=0;s<i.length;++s){if(!r)return;if("string"==typeof r[i[s]]&&s+1<i.length)return;if(void 0===r[i[s]]){for(var o=2,a=i.slice(s,s+o).join(n),l=r[a];void 0===l&&i.length>s+o;)o++,l=r[a=i.slice(s,s+o).join(n)];if(void 0===l)return;if(null===l)return null;if(t.endsWith(a)){if("string"==typeof l)return l;if(a&&"string"==typeof l[a])return l[a]}var c=i.slice(s+o).join(n);return c?Ft(l,c,n):void 0}r=r[i[s]]}return r}}function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Rt=function(e){ut(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=dt(t);if(n){var r=dt(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return ht(this,e)});function r(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return rt(this,r),t=i.call(this),At&&vt.call(lt(t)),t.data=e||{},t.options=n,void 0===t.options.keySeparator&&(t.options.keySeparator="."),void 0===t.options.ignoreJSONStructure&&(t.options.ignoreJSONStructure=!0),t}return at(r,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,s=void 0!==i.ignoreJSONStructure?i.ignoreJSONStructure:this.options.ignoreJSONStructure,o=[e,t];n&&"string"!=typeof n&&(o=o.concat(n)),n&&"string"==typeof n&&(o=o.concat(r?n.split(r):n)),e.indexOf(".")>-1&&(o=e.split("."));var a=Et(this.data,o);return a||!s||"string"!=typeof n?a:Ft(this.data&&this.data[e]&&this.data[e][t],n,r)}},{key:"addResource",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},s=this.options.keySeparator;void 0===s&&(s=".");var o=[e,t];n&&(o=o.concat(s?n.split(s):n)),e.indexOf(".")>-1&&(i=t,t=(o=e.split("."))[1]),this.addNamespaces(t),xt(this.data,o,i),r.silent||this.emit("added",e,t,n,i)}},{key:"addResources",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var r in n)"string"!=typeof n[r]&&"[object Array]"!==Object.prototype.toString.apply(n[r])||this.addResource(e,t,r,n[r],{silent:!0});i.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,i,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},o=[e,t];e.indexOf(".")>-1&&(i=n,n=t,t=(o=e.split("."))[1]),this.addNamespaces(t);var a=Et(this.data,o)||{};i?_t(a,n,r):a=Nt(Nt({},a),n),xt(this.data,o,a),s.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?Nt(Nt({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),r}(vt),It={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,i,r){var s=this;return e.forEach((function(e){s.processors[e]&&(t=s.processors[e].process(t,n,i,r))})),t}};function jt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Dt={},Bt=function(e){ut(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=dt(t);if(n){var r=dt(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return ht(this,e)});function r(e){var t,n,s,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return rt(this,r),t=i.call(this),At&&vt.call(lt(t)),n=e,s=lt(t),["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"].forEach((function(e){n[e]&&(s[e]=n[e])})),t.options=o,void 0===t.options.keySeparator&&(t.options.keySeparator="."),t.logger=bt.create("translator"),t}return at(r,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,r=t.ns||this.options.defaultNS||[],s=n&&e.indexOf(n)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,n){t=t||"",n=n||"";var i=Pt.filter((function(e){return t.indexOf(e)<0&&n.indexOf(e)<0}));if(0===i.length)return!0;var r=new RegExp("(".concat(i.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),s=!r.test(e);if(!s){var o=e.indexOf(n);o>0&&!r.test(e.substring(0,o))&&(s=!0)}return s}(e,n,i));if(s&&!o){var a=e.match(this.interpolator.nestingRegexp);if(a&&a.length>0)return{key:e,namespaces:r};var l=e.split(n);(n!==i||n===i&&this.options.ns.indexOf(l[0])>-1)&&(r=l.shift()),e=l.join(i)}return"string"==typeof r&&(r=[r]),{key:e,namespaces:r}}},{key:"translate",value:function(e,t,n){var i=this;if("object"!==it(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var s=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,o=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,a=this.extractFromKey(e[e.length-1],t),l=a.key,c=a.namespaces,u=c[c.length-1],h=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(h&&"cimode"===h.toLowerCase()){if(d){var f=t.nsSeparator||this.options.nsSeparator;return s?{res:"".concat(u).concat(f).concat(l),usedKey:l,exactUsedKey:l,usedLng:h,usedNS:u}:"".concat(u).concat(f).concat(l)}return s?{res:l,usedKey:l,exactUsedKey:l,usedLng:h,usedNS:u}:l}var p=this.resolve(e,t),g=p&&p.res,m=p&&p.usedKey||l,y=p&&p.exactUsedKey||l,b=Object.prototype.toString.apply(g),v=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,w=!this.i18nFormat||this.i18nFormat.handleAsObject;if(w&&g&&"string"!=typeof g&&"boolean"!=typeof g&&"number"!=typeof g&&["[object Number]","[object Function]","[object RegExp]"].indexOf(b)<0&&("string"!=typeof v||"[object Array]"!==b)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var S=this.options.returnedObjectHandler?this.options.returnedObjectHandler(m,g,Mt(Mt({},t),{},{ns:c})):"key '".concat(l," (").concat(this.language,")' returned an object instead of string.");return s?(p.res=S,p):S}if(o){var k="[object Array]"===b,x=k?[]:{},E=k?y:m;for(var _ in g)if(Object.prototype.hasOwnProperty.call(g,_)){var O="".concat(E).concat(o).concat(_);x[_]=this.translate(O,Mt(Mt({},t),{joinArrays:!1,ns:c})),x[_]===O&&(x[_]=g[_])}g=x}}else if(w&&"string"==typeof v&&"[object Array]"===b)(g=g.join(v))&&(g=this.extendTranslation(g,e,t,n));else{var C=!1,T=!1,A=void 0!==t.count&&"string"!=typeof t.count,P=r.hasDefaultValue(t),F=A?this.pluralResolver.getSuffix(h,t.count,t):"",L=t["defaultValue".concat(F)]||t.defaultValue;!this.isValidLookup(g)&&P&&(C=!0,g=L),this.isValidLookup(g)||(T=!0,g=l);var N=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&T?void 0:g,R=P&&L!==g&&this.options.updateMissing;if(T||C||R){if(this.logger.log(R?"updateKey":"missingKey",h,u,l,R?L:g),o){var I=this.resolve(l,Mt(Mt({},t),{},{keySeparator:!1}));I&&I.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var j=[],M=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&M&&M[0])for(var D=0;D<M.length;D++)j.push(M[D]);else"all"===this.options.saveMissingTo?j=this.languageUtils.toResolveHierarchy(t.lng||this.language):j.push(t.lng||this.language);var B=function(e,n,r){var s=P&&r!==g?r:N;i.options.missingKeyHandler?i.options.missingKeyHandler(e,u,n,s,R,t):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,u,n,s,R,t),i.emit("missingKey",e,u,n,g)};this.options.saveMissing&&(this.options.saveMissingPlurals&&A?j.forEach((function(e){i.pluralResolver.getSuffixes(e,t).forEach((function(n){B([e],l+n,t["defaultValue".concat(n)]||L)}))})):B(j,l,L))}g=this.extendTranslation(g,e,t,p,n),T&&g===l&&this.options.appendNamespaceToMissingKey&&(g="".concat(u,":").concat(l)),(T||C)&&this.options.parseMissingKeyHandler&&(g="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(u,":").concat(l):l,C?g:void 0):this.options.parseMissingKeyHandler(g))}return s?(p.res=g,p):g}},{key:"extendTranslation",value:function(e,t,n,i,r){var s=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,Mt(Mt({},this.options.interpolation.defaultVariables),n),i.usedLng,i.usedNS,i.usedKey,{resolved:i});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(Mt(Mt({},n),{interpolation:Mt(Mt({},this.options.interpolation),n.interpolation)}));var o,a="string"==typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){var l=e.match(this.interpolator.nestingRegexp);o=l&&l.length}var c=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(c=Mt(Mt({},this.options.interpolation.defaultVariables),c)),e=this.interpolator.interpolate(e,c,n.lng||this.language,n),a){var u=e.match(this.interpolator.nestingRegexp);o<(u&&u.length)&&(n.nest=!1)}!n.lng&&"v1"!==this.options.compatibilityAPI&&i&&i.res&&(n.lng=i.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];return r&&r[0]===i[0]&&!n.context?(s.logger.warn("It seems you are nesting recursively key: ".concat(i[0]," in key: ").concat(t[0])),null):s.translate.apply(s,i.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var h=n.postProcess||this.options.postProcess,d="string"==typeof h?[h]:h;return null!=e&&d&&d.length&&!1!==n.applyPostProcessor&&(e=It.handle(d,e,t,this.options&&this.options.postProcessPassResolved?Mt({i18nResolved:i},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,i,r,s,o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!o.isValidLookup(t)){var l=o.extractFromKey(e,a),c=l.key;n=c;var u=l.namespaces;o.options.fallbackNS&&(u=u.concat(o.options.fallbackNS));var h=void 0!==a.count&&"string"!=typeof a.count,d=h&&!a.ordinal&&0===a.count&&o.pluralResolver.shouldUseIntlApi(),f=void 0!==a.context&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,p=a.lngs?a.lngs:o.languageUtils.toResolveHierarchy(a.lng||o.language,a.fallbackLng);u.forEach((function(e){o.isValidLookup(t)||(s=e,!Dt["".concat(p[0],"-").concat(e)]&&o.utils&&o.utils.hasLoadedNamespace&&!o.utils.hasLoadedNamespace(s)&&(Dt["".concat(p[0],"-").concat(e)]=!0,o.logger.warn('key "'.concat(n,'" for languages "').concat(p.join(", "),'" won\'t get resolved as namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),p.forEach((function(n){if(!o.isValidLookup(t)){r=n;var s,l=[c];if(o.i18nFormat&&o.i18nFormat.addLookupKeys)o.i18nFormat.addLookupKeys(l,c,n,e,a);else{var u;h&&(u=o.pluralResolver.getSuffix(n,a.count,a));var p="".concat(o.options.pluralSeparator,"zero");if(h&&(l.push(c+u),d&&l.push(c+p)),f){var g="".concat(c).concat(o.options.contextSeparator).concat(a.context);l.push(g),h&&(l.push(g+u),d&&l.push(g+p))}}for(;s=l.pop();)o.isValidLookup(t)||(i=s,t=o.getResource(n,e,s,a))}})))}))}})),{res:t,usedKey:n,exactUsedKey:i,usedLng:r,usedNS:s}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,i):this.resourceStore.getResource(e,t,n,i)}}],[{key:"hasDefaultValue",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}]),r}(vt);function $t(e){return e.charAt(0).toUpperCase()+e.slice(1)}var Ut=function(){function e(t){rt(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=bt.create("languageUtils")}return at(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=$t(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=$t(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=$t(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var i=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(i)||(t=i)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var i=n.getLanguagePartFromCode(e);if(n.isSupportedCode(i))return t=i;t=n.options.supportedLngs.find((function(e){return e===i?e:e.indexOf("-")<0&&i.indexOf("-")<0?void 0:0===e.indexOf(i)?e:void 0}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,i=this.getFallbackCodes(t||this.options.fallbackLng||[],e),r=[],s=function(e){e&&(n.isSupportedCode(e)?r.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):"string"==typeof e&&s(this.formatLanguageCode(e)),i.forEach((function(e){r.indexOf(e)<0&&s(n.formatLanguageCode(e))})),r}}]),e}(),Vt=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Ht={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},zt=["v1","v2","v3"],Wt={zero:0,one:1,two:2,few:3,many:4,other:5},qt=function(){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};rt(this,e),this.languageUtils=t,this.options=i,this.logger=bt.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(n={},Vt.forEach((function(e){e.lngs.forEach((function(t){n[t]={numbers:e.nr,plurals:Ht[e.fc]}}))})),n)}return at(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.getRule(e,n);return i?this.shouldUseIntlApi()?i.resolvedOptions().pluralCategories.sort((function(e,t){return Wt[e]-Wt[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):i.numbers.map((function(i){return t.getSuffix(e,i,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getRule(e,n);return i?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(i.select(t)):this.getSuffixRetroCompatible(i,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,i=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),r=e.numbers[i];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===r?r="plural":1===r&&(r=""));var s=function(){return n.options.prepend&&r.toString()?n.options.prepend+r.toString():r.toString()};return"v1"===this.options.compatibilityJSON?1===r?"":"number"==typeof r?"_plural_".concat(r.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?s():this.options.prepend&&i.toString()?this.options.prepend+i.toString():i.toString()}},{key:"shouldUseIntlApi",value:function(){return!zt.includes(this.options.compatibilityJSON)}}]),e}();function Zt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zt(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Kt(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=function(e,t,n){var i=Et(e,n);return void 0!==i?i:Et(t,n)}(e,t,n);return!s&&r&&"string"==typeof n&&void 0===(s=Ft(e,n,i))&&(s=Ft(t,n,i)),s}var Gt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};rt(this,e),this.logger=bt.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return at(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:Tt,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?Ot(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?Ot(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?Ot(t.nestingPrefix):t.nestingPrefixEscaped||Ot("$t("),this.nestingSuffix=t.nestingSuffix?Ot(t.nestingSuffix):t.nestingSuffixEscaped||Ot(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,i){var r,s,o,a=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function c(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(a.formatSeparator)<0){var r=Kt(t,l,e,a.options.keySeparator,a.options.ignoreJSONStructure);return a.alwaysFormat?a.format(r,void 0,n,Xt(Xt(Xt({},i),t),{},{interpolationkey:e})):r}var s=e.split(a.formatSeparator),o=s.shift().trim(),c=s.join(a.formatSeparator).trim();return a.format(Kt(t,l,o,a.options.keySeparator,a.options.ignoreJSONStructure),c,n,Xt(Xt(Xt({},i),t),{},{interpolationkey:o}))};this.resetRegExp();var h=i&&i.missingInterpolationHandler||this.options.missingInterpolationHandler,d=i&&i.interpolation&&void 0!==i.interpolation.skipOnVariables?i.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return c(e)}},{regex:this.regexp,safeValue:function(e){return a.escapeValue?c(a.escape(e)):c(e)}}].forEach((function(t){for(o=0;r=t.regex.exec(e);){var n=r[1].trim();if(void 0===(s=u(n)))if("function"==typeof h){var l=h(e,r,i);s="string"==typeof l?l:""}else if(i&&Object.prototype.hasOwnProperty.call(i,n))s="";else{if(d){s=r[0];continue}a.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),s=""}else"string"==typeof s||a.useRawValueToEscape||(s=St(s));var c=t.safeValue(s);if(e=e.replace(r[0],c),d?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=r[0].length):t.regex.lastIndex=0,++o>=a.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,i,r,s=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function a(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var i=e.split(new RegExp("".concat(n,"[ ]*{"))),s="{".concat(i[1]);e=i[0];var o=(s=this.interpolate(s,r)).match(/'/g),a=s.match(/"/g);(o&&o.length%2==0&&!a||a.length%2!=0)&&(s=s.replace(/'/g,'"'));try{r=JSON.parse(s),t&&(r=Xt(Xt({},t),r))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(n).concat(s)}return delete r.defaultValue,e}for(;n=this.nestingRegexp.exec(e);){var l=[];(r=(r=Xt({},o)).replace&&"string"!=typeof r.replace?r.replace:r).applyPostProcessor=!1,delete r.defaultValue;var c=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=u.shift(),l=u,c=!0}if((i=t(a.call(this,n[1].trim(),r),r))&&n[0]===e&&"string"!=typeof i)return i;"string"!=typeof i&&(i=St(i)),i||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),i=""),c&&(i=l.reduce((function(e,t){return s.format(e,t,o.lng,Xt(Xt({},o),{},{interpolationkey:n[1].trim()}))}),i.trim())),e=e.replace(n[0],i),this.regexp.lastIndex=0}return e}}]),e}();function Yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qt(e){var t={};return function(n,i,r){var s=i+JSON.stringify(r),o=t[s];return o||(o=e(i,r),t[s]=o),o(n)}}var en=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};rt(this,e),this.logger=bt.create("formatter"),this.options=t,this.formats={number:Qt((function(e,t){var n=new Intl.NumberFormat(e,Jt({},t));return function(e){return n.format(e)}})),currency:Qt((function(e,t){var n=new Intl.NumberFormat(e,Jt(Jt({},t),{},{style:"currency"}));return function(e){return n.format(e)}})),datetime:Qt((function(e,t){var n=new Intl.DateTimeFormat(e,Jt({},t));return function(e){return n.format(e)}})),relativetime:Qt((function(e,t){var n=new Intl.RelativeTimeFormat(e,Jt({},t));return function(e){return n.format(e,t.range||"day")}})),list:Qt((function(e,t){var n=new Intl.ListFormat(e,Jt({},t));return function(e){return n.format(e)}}))},this.init(t)}return at(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=Qt(t)}},{key:"format",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.split(this.formatSeparator).reduce((function(e,t){var s=function(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var i=e.split("(");t=i[0].toLowerCase().trim();var r=i[1].substring(0,i[1].length-1);"currency"===t&&r.indexOf(":")<0?n.currency||(n.currency=r.trim()):"relativetime"===t&&r.indexOf(":")<0?n.range||(n.range=r.trim()):r.split(";").forEach((function(e){if(e){var t=function(e){if(Array.isArray(e))return e}(s=e.split(":"))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(s)||function(e,t){if(e){if("string"==typeof e)return pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(e,t):void 0}}(s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),i=t[0],r=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[i.trim()]||(n[i.trim()]=r),"false"===r&&(n[i.trim()]=!1),"true"===r&&(n[i.trim()]=!0),isNaN(r)||(n[i.trim()]=parseInt(r,10))}var s}))}return{formatName:t,formatOptions:n}}(t),o=s.formatName,a=s.formatOptions;if(i.formats[o]){var l=e;try{var c=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},u=c.locale||c.lng||r.locale||r.lng||n;l=i.formats[o](e,u,Jt(Jt(Jt({},a),r),c))}catch(e){i.logger.warn(e)}return l}return i.logger.warn("there was no format function for ".concat(o)),e}),e)}}]),e}();function tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function nn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var rn=function(e){ut(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=dt(t);if(n){var r=dt(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return ht(this,e)});function r(e,t,n){var s,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return rt(this,r),s=i.call(this),At&&vt.call(lt(s)),s.backend=e,s.store=t,s.services=n,s.languageUtils=n.languageUtils,s.options=o,s.logger=bt.create("backendConnector"),s.waitingReads=[],s.maxParallelReads=o.maxParallelReads||10,s.readingCalls=0,s.maxRetries=o.maxRetries>=0?o.maxRetries:5,s.retryTimeout=o.retryTimeout>=1?o.retryTimeout:350,s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(n,o.backend,o),s}return at(r,[{key:"queueLoad",value:function(e,t,n,i){var r=this,s={},o={},a={},l={};return e.forEach((function(e){var i=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!n.reload&&r.store.hasResourceBundle(e,t)?r.state[a]=2:r.state[a]<0||(1===r.state[a]?void 0===o[a]&&(o[a]=!0):(r.state[a]=1,i=!1,void 0===o[a]&&(o[a]=!0),void 0===s[a]&&(s[a]=!0),void 0===l[t]&&(l[t]=!0)))})),i||(a[e]=!0)})),(Object.keys(s).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:i}),{toLoad:Object.keys(s),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(e,t,n){var i=e.split("|"),r=i[0],s=i[1];t&&this.emit("failedLoading",r,s,t),n&&this.store.addResourceBundle(r,s,n),this.state[e]=t?-1:2;var o={};this.queue.forEach((function(n){!function(e,t,n,i){var r=kt(e,t,Object),s=r.obj,o=r.k;s[o]=s[o]||[],s[o].push(n)}(n.loaded,[r],s),function(e,t){void 0!==e.pending[t]&&(delete e.pending[t],e.pendingCount--)}(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((function(e){o[e]||(o[e]={});var t=n.loaded[e];t.length&&t.forEach((function(t){void 0===o[e][t]&&(o[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",o),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var i=this,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,o=arguments.length>5?arguments[5]:void 0;if(!e.length)return o(null,{});if(this.readingCalls>=this.maxParallelReads)this.waitingReads.push({lng:e,ns:t,fcName:n,tried:r,wait:s,callback:o});else{this.readingCalls++;var a=function(a,l){if(i.readingCalls--,i.waitingReads.length>0){var c=i.waitingReads.shift();i.read(c.lng,c.ns,c.fcName,c.tried,c.wait,c.callback)}a&&l&&r<i.maxRetries?setTimeout((function(){i.read.call(i,e,t,n,r+1,2*s,o)}),s):o(a,l)},l=this.backend[n].bind(this.backend);if(2!==l.length)return l(e,t,a);try{var c=l(e,t);c&&"function"==typeof c.then?c.then((function(e){return a(null,e)})).catch(a):a(null,c)}catch(e){a(e)}}}},{key:"prepareLoading",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),r&&r();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var s=this.queueLoad(e,t,i,r);if(!s.toLoad.length)return s.pending.length||r(),null;s.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=e.split("|"),r=i[0],s=i[1];this.read(r,s,"read",void 0,void 0,(function(i,o){i&&t.logger.warn("".concat(n,"loading namespace ").concat(s," for language ").concat(r," failed"),i),!i&&o&&t.logger.log("".concat(n,"loaded namespace ").concat(s," for language ").concat(r),o),t.loaded(e,i,o)}))}},{key:"saveMissing",value:function(e,t,n,i,r){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=n&&""!==n){if(this.backend&&this.backend.create){var a=nn(nn({},s),{},{isUpdate:r}),l=this.backend.create.bind(this.backend);if(l.length<6)try{var c;(c=5===l.length?l(e,t,n,i,a):l(e,t,n,i))&&"function"==typeof c.then?c.then((function(e){return o(null,e)})).catch(o):o(null,c)}catch(e){o(e)}else l(e,t,n,i,o,a)}e&&e[0]&&this.store.addResource(e[0],t,n,i)}}}]),r}(vt);function sn(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===it(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===it(e[2])||"object"===it(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,i){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function on(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function an(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?an(Object(n),!0).forEach((function(t){ft(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):an(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cn(){}var un=function(e){ut(r,e);var t,n,i=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,i=dt(t);if(n){var r=dt(this).constructor;e=Reflect.construct(i,arguments,r)}else e=i.apply(this,arguments);return ht(this,e)});function r(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if(rt(this,r),e=i.call(this),At&&vt.call(lt(e)),e.options=on(n),e.services={},e.logger=bt,e.modules={external:[]},t=lt(e),Object.getOwnPropertyNames(Object.getPrototypeOf(t)).forEach((function(e){"function"==typeof t[e]&&(t[e]=t[e].bind(t))})),s&&!e.isInitialized&&!n.isClone){if(!e.options.initImmediate)return e.init(n,s),ht(e,lt(e));setTimeout((function(){e.init(n,s)}),0)}return e}return at(r,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(n=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var i=sn();function r(e){return e?"function"==typeof e?new e:e:null}if(this.options=ln(ln(ln({},i),this.options),on(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=ln(ln({},i.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var s;this.modules.logger?bt.init(r(this.modules.logger),this.options):bt.init(null,this.options),this.modules.formatter?s=this.modules.formatter:"undefined"!=typeof Intl&&(s=en);var o=new Ut(this.options);this.store=new Rt(this.options.resources,this.options);var a=this.services;a.logger=bt,a.resourceStore=this.store,a.languageUtils=o,a.pluralResolver=new qt(o,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!s||this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format||(a.formatter=r(s),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new Gt(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new rn(r(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit.apply(e,[t].concat(i))})),this.modules.languageDetector&&(a.languageDetector=r(this.modules.languageDetector),a.languageDetector.init&&a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=r(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new Bt(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit.apply(e,[t].concat(i))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,n||(n=cn),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var c=wt(),u=function(){var t=function(t,i){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),c.resolve(i),n(t,i)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?u():setTimeout(u,0),c}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn,i="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(i&&"cimode"===i.toLowerCase())return n();var r=[],s=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){r.indexOf(e)<0&&r.push(e)}))};i?s(i):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return s(e)})),this.options.preload&&this.options.preload.forEach((function(e){return s(e)})),this.services.backendConnector.load(r,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,n){var i=wt();return e||(e=this.languages),t||(t=this.options.ns),n||(n=cn),this.services.backendConnector.reload(e,t,(function(e){i.resolve(),n(e)})),i}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&It.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var i=wt();this.emit("languageChanging",e);var r=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},s=function(s){e||s||!n.services.languageDetector||(s=[]);var o="string"==typeof s?s:n.services.languageUtils.getBestMatchFromCodes(s);o&&(n.language||r(o),n.translator.language||n.translator.changeLanguage(o),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage&&n.services.languageDetector.cacheUserLanguage(o)),n.loadResources(o,(function(e){!function(e,s){s?(r(s),n.translator.changeLanguage(s),n.isLanguageChangingTo=void 0,n.emit("languageChanged",s),n.logger.log("languageChanged",s)):n.isLanguageChangingTo=void 0,i.resolve((function(){return n.t.apply(n,arguments)})),t&&t(e,(function(){return n.t.apply(n,arguments)}))}(e,o)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),i}},{key:"getFixedT",value:function(e,t,n){var i=this,r=function e(t,r){var s;if("object"!==it(r)){for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];s=i.options.overloadTranslationOptionHandler([t,r].concat(a))}else s=ln({},r);s.lng=s.lng||e.lng,s.lngs=s.lngs||e.lngs,s.ns=s.ns||e.ns,s.keyPrefix=s.keyPrefix||n||e.keyPrefix;var c,u=i.options.keySeparator||".";return c=s.keyPrefix&&Array.isArray(t)?t.map((function(e){return"".concat(s.keyPrefix).concat(u).concat(e)})):s.keyPrefix?"".concat(s.keyPrefix).concat(u).concat(t):t,i.t(c,s)};return"string"==typeof e?r.lng=e:r.lngs=e,r.ns=t,r.keyPrefix=n,r}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var i=this.resolvedLanguage||this.languages[0],r=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===i.toLowerCase())return!0;var o=function(e,n){var i=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===i||2===i};if(n.precheck){var a=n.precheck(this,o);if(void 0!==a)return a}return!(!this.hasResourceBundle(i,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!o(i,e)||r&&!o(s,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,i=wt();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){i.resolve(),t&&t(e)})),i):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=wt();"string"==typeof e&&(e=[e]);var i=this.options.preload||[],r=e.filter((function(e){return i.indexOf(e)<0}));return r.length?(this.options.preload=i.concat(r),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";var t=this.services&&this.services.languageUtils||new Ut(sn());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cn,i=ln(ln(ln({},this.options),t),{isClone:!0}),s=new r(i);return void 0===t.debug&&void 0===t.prefix||(s.logger=s.logger.clone(t)),["store","services","language"].forEach((function(t){s[t]=e[t]})),s.services=ln({},this.services),s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s.translator=new Bt(s.services,s.options),s.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];s.emit.apply(s,[e].concat(n))})),s.init(i,n),s.translator.options=s.options,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),r}(vt);ft(un,"createInstance",(function(){return new un(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var hn=un.createInstance();hn.createInstance=un.createInstance,hn.createInstance,hn.dir,hn.init,hn.loadResources,hn.reloadResources,hn.use,hn.changeLanguage,hn.getFixedT,hn.t,hn.exists,hn.setDefaultNamespace,hn.hasLoadedNamespace,hn.loadNamespaces,hn.loadLanguages;class dn{constructor(e,t){this.autoPauseContext=new p,this.video=e,this.settings=t,this._subtitleAlignment="bottom",this._preCacheDom=!1;const{subtitlesElementOverlay:n,notificationElementOverlay:i}=this._overlays(this._subtitleAlignment,this._preCacheDom);this.subtitlesElementOverlay=n,this.notificationElementOverlay=i,this._subtitles=[],this.subtitleCollection=new nt([]),this.showingSubtitles=[],this.disabledSubtitleTracks={},this._forceHideSubtitles=!1,this._displaySubtitles=!0,this.lastLoadedMessageTimestamp=0,this.lastOffsetChangeTimestamp=0,this.showingOffset=void 0,this.surroundingSubtitlesCountRadius=1,this.surroundingSubtitlesTimeRadius=5e3,this.showingLoadedMessage=!1,this.autoCopyCurrentSubtitle=!1}get subtitles(){return this._subtitles}set subtitles(e){this._subtitles=e,this.subtitleCollection=new nt(e,{showingCheckRadiusMs:150,returnNextToShow:!0}),this.autoPauseContext.clear()}get preCacheDom(){return this._preCacheDom}set preCacheDom(e){this._preCacheDom!==e&&(this._resetOverlays(this._subtitleAlignment,e),this._preCacheDom=e)}cacheHtml(){if(!(this.subtitlesElementOverlay instanceof Xe))return;this.subtitlesElementOverlay.uncacheHtml();const e=this._buildSubtitlesHtml(this.subtitles);for(const t of e)this.subtitlesElementOverlay.cacheHtml(t.key,t.html())}set subtitlePositionOffset(e){this.subtitlesElementOverlay.contentPositionOffset=e}setSubtitleSettings(e){const t=this._computeStyles(e),n=this._computeClasses(e);void 0!==this.subtitleStyles&&this._arrayEquals(t,this.subtitleStyles,((e,t)=>e===t))&&void 0!==this.subtitleClasses&&this._arrayEquals(n,this.subtitleClasses,((e,t)=>e===t))||(this.subtitleStyles=t,this.subtitleClasses=n,this.cacheHtml()),this.subtitleSettings=e}_computeStyles(e){return X(e).map((e=>function(e){const t=function({subtitleColor:e,subtitleSize:t,subtitleThickness:n,subtitleOutlineThickness:i,subtitleOutlineColor:r,subtitleShadowThickness:s,subtitleShadowColor:o,subtitleBackgroundOpacity:a,subtitleBackgroundColor:l,subtitleFontFamily:c,subtitleCustomStyles:u}){const h={color:e,fontSize:`${t}px`,fontWeight:String(n)};if(i>0){const e=i,t=r;h.WebkitTextStroke=`${t} ${e}px`}if(s>0&&(h.textShadow=`0 0 ${s}px ${o}, 0 0 ${s}px ${o}, 0 0 ${s}px ${o}, 0 0 ${s}px ${o}`),a>0){const e=a,t=l,{r:n,g:i,b:r}=(d=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t))?{r:parseInt(d[1],16),g:parseInt(d[2],16),b:parseInt(d[3],16)}:{r:255,g:255,b:255};h.backgroundColor=`rgba(${n}, ${i}, ${r}, ${e})`}var d;c&&c.length>0&&(h.fontFamily=`'${c}'`);for(const e of u){let t;t=e.key.startsWith("webkit")||e.key.startsWith("moz")||e.key.startsWith("ms")||/^o[A-Z].*/.test(e.key)?e.key.charAt(0).toUpperCase()+e.key.slice(1):e.key,isNaN(Number(t))&&(h[t]=e.value)}return h}(e),n=[];for(const[e,i]of Object.entries(t))n.push(`${o(e)}: ${i} !important`);return n.join(";")}(e)))}_computeClasses(e){return X(e).map((e=>this._computeClassesForTrack(e)))}_computeClassesForTrack(e){return e.subtitleBlur?"asbplayer-subtitles-blurred":""}set subtitleAlignment(e){if(this._subtitleAlignment===e)return;const{subtitleOverlayParams:t,notificationOverlayParams:n}=this._elementOverlayParams(e);this._applyElementOverlayParams(this.subtitlesElementOverlay,t),this._applyElementOverlayParams(this.notificationElementOverlay,n),this.subtitlesElementOverlay.hide(),this.notificationElementOverlay.hide(),this._subtitleAlignment=e}get subtitleAlignment(){return this._subtitleAlignment}_applyElementOverlayParams(e,t){e.offsetAnchor=t.offsetAnchor,e.fullscreenContainerClassName=t.fullscreenContainerClassName,e.fullscreenContentClassName=t.fullscreenContentClassName,e.nonFullscreenContainerClassName=t.nonFullscreenContainerClassName,e.nonFullscreenContentClassName=t.nonFullscreenContentClassName}set displaySubtitles(e){this._displaySubtitles=e,this.showingSubtitles=void 0}set forceHideSubtitles(e){this._forceHideSubtitles=e,this.showingSubtitles=void 0}_resetOverlays(e,t,n=!1){this.subtitlesElementOverlay.dispose(),this.notificationElementOverlay.dispose();const{subtitlesElementOverlay:i,notificationElementOverlay:r}=this._overlays(e,t);i.contentPositionOffset=this.subtitlesElementOverlay.contentPositionOffset,r.contentPositionOffset=this.notificationElementOverlay.contentPositionOffset,this.subtitlesElementOverlay=i,this.notificationElementOverlay=r,n||this.cacheHtml()}_overlays(e,t){const{subtitleOverlayParams:n,notificationOverlayParams:i}=this._elementOverlayParams(e);return t?{subtitlesElementOverlay:new Xe(n),notificationElementOverlay:new Xe(i)}:{subtitlesElementOverlay:new Ke(n),notificationElementOverlay:new Ke(i)}}_elementOverlayParams(e){let t,n;switch(e){case"bottom":t={targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-subtitles-container-bottom",nonFullscreenContentClassName:"asbplayer-subtitles",fullscreenContainerClassName:"asbplayer-subtitles-container-bottom",fullscreenContentClassName:"asbplayer-fullscreen-subtitles",offsetAnchor:Ze.bottom},n={targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-notification-container-top",nonFullscreenContentClassName:"asbplayer-notification",fullscreenContainerClassName:"asbplayer-notification-container-top",fullscreenContentClassName:"asbplayer-notification",offsetAnchor:Ze.top};break;case"top":t={targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-subtitles-container-top",nonFullscreenContentClassName:"asbplayer-subtitles",fullscreenContainerClassName:"asbplayer-subtitles-container-top",fullscreenContentClassName:"asbplayer-fullscreen-subtitles",offsetAnchor:Ze.top},n={targetElement:this.video,nonFullscreenContainerClassName:"asbplayer-notification-container-bottom",nonFullscreenContentClassName:"asbplayer-notification",fullscreenContainerClassName:"asbplayer-notification-container-bottom",fullscreenContentClassName:"asbplayer-notification",offsetAnchor:Ze.bottom}}return{subtitleOverlayParams:t,notificationOverlayParams:n}}bind(){this.subtitlesInterval=setInterval((()=>{if(this.lastLoadedMessageTimestamp>0&&Date.now()-this.lastLoadedMessageTimestamp<1e3)return;if(this.showingLoadedMessage&&(this._setSubtitlesHtml([{html:()=>""}]),this.showingLoadedMessage=!1),0===this.subtitles.length)return;const e=this.lastOffsetChangeTimestamp>0&&Date.now()-this.lastOffsetChangeTimestamp<1e3,t=e?this._computeOffset():0,n=1e3*this.video.currentTime;let i=[];const r=this.subtitleCollection.subtitlesAt(n);i=r.showing.filter((e=>this._trackEnabled(e))).sort(((e,t)=>e.track-t.track)),this.onSlice?.(r),r.willStopShowing&&this._trackEnabled(r.willStopShowing)&&this.autoPauseContext.willStopShowing(r.willStopShowing),r.startedShowing&&this._trackEnabled(r.startedShowing)&&this.autoPauseContext.startedShowing(r.startedShowing),r.nextToShow&&r.nextToShow.length>0&&this.onNextToShow?.(r.nextToShow[0]);const s=void 0===this.showingSubtitles||!this._arrayEquals(i,this.showingSubtitles,((e,t)=>e.index===t.index));s&&(this.showingSubtitles=i,this._autoCopyToClipboard(i));const o=e&&t!==this.showingOffset||!e&&void 0!==this.showingOffset;!e&&!this._displaySubtitles||this._forceHideSubtitles?this.subtitlesElementOverlay.hide():(s||o)&&(this._renderSubtitles(i),e?(this._appendSubtitlesHtml(this._buildTextHtml(this._formatOffset(t))),this.showingOffset=t):this.showingOffset=void 0)}),100)}_renderSubtitles(e){this._setSubtitlesHtml(this._buildSubtitlesHtml(e))}_autoCopyToClipboard(e){if(this.autoCopyCurrentSubtitle&&e.length>0&&document.hasFocus()){const t=e.map((e=>e.text)).filter((e=>""!==e)).join("\n");if(""!==t){const e={sender:"asbplayer-video",message:{command:"copy-to-clipboard",dataUrl:`data:,${encodeURIComponent(t)}`},src:this.video.src};chrome.runtime.sendMessage(e)}}}_trackEnabled(e){return void 0===e.track||!this.disabledSubtitleTracks[e.track]}_buildSubtitlesHtml(e){return e.map((e=>({html:()=>{if(e.textImage){const t=this.subtitleClasses?.[e.track]??"";return`\n                            <div style="max-width:${(this.subtitleSettings?.imageBasedSubtitleScaleFactor??1)*this.video.getBoundingClientRect().width/e.textImage.screen.width*e.textImage.image.width}px;" class="${t}"}">\n                                <img\n                                    style="width:100%;"\n                                    alt="subtitle"\n                                    src="${e.textImage.dataUrl}"\n                                />\n                            </div>\n                        `}return this._buildTextHtml(e.text,e.track)},key:String(e.index)})))}_buildTextHtml(e,t){return`<span class="${this._subtitleClasses(t)}" style="${this._subtitleStyles(t)}">${e}</span>`}unbind(){this.subtitlesInterval&&(clearInterval(this.subtitlesInterval),this.subtitlesInterval=void 0),this.notificationElementOverlayHideTimeout&&(clearTimeout(this.notificationElementOverlayHideTimeout),this.notificationElementOverlayHideTimeout=void 0),this.subtitlesElementOverlay.dispose(),this.notificationElementOverlay.dispose()}refresh(){this.subtitlesElementOverlay.refresh(),this.notificationElementOverlay.refresh()}currentSubtitle(){const e=1e3*this.video.currentTime;let n=null,i=null;for(let t=0;t<this.subtitles.length;++t){const r=this.subtitles[t];if(e>=r.start&&e<r.end&&(void 0===r.track||!this.disabledSubtitleTracks[r.track])){n=r,i=t;break}}return null===n||null===i?[null,null]:[n,t(this.subtitles,i,this.surroundingSubtitlesCountRadius,this.surroundingSubtitlesTimeRadius)]}offset(e,t=!1){if(this.subtitles&&0!==this.subtitles.length){if(this.subtitles=this.subtitles.map((t=>({text:t.text,textImage:t.textImage,start:t.originalStart+e,originalStart:t.originalStart,end:t.originalEnd+e,originalEnd:t.originalEnd,track:t.track,index:t.index}))),this.lastOffsetChangeTimestamp=Date.now(),!t){const t={sender:"asbplayer-video",message:{command:"offset",value:e},src:this.video.src};chrome.runtime.sendMessage(t)}this.onOffsetChange?.(),this.settings.getSingle("rememberSubtitleOffset").then((t=>{t&&this.settings.set({lastSubtitleOffset:e})}))}}_computeOffset(){if(!this.subtitles||0===this.subtitles.length)return 0;const e=this.subtitles[0];return e.start-e.originalStart}_formatOffset(e){const t=Math.floor(e);return t>=0?"+"+t+" ms":t+" ms"}notification(e,t){const n=hn.t(e,t??{});this.notificationElementOverlay.setHtml([{html:()=>this._buildTextHtml(n)}]),this.notificationElementOverlayHideTimeout&&clearTimeout(this.notificationElementOverlayHideTimeout),this.notificationElementOverlayHideTimeout=setTimeout((()=>{this.notificationElementOverlay.hide(),this.notificationElementOverlayHideTimeout=void 0}),3e3)}showLoadedMessage(e){if(!this.subtitleFileNames)return;let t;const n=this._nonEmptySubtitleNames(e);if(t=0===n.length?this.subtitleFileNames[0]:n.join("<br>"),this.subtitles.length>0){const e=this.subtitles[0].start-this.subtitles[0].originalStart;0!==e&&(t+=`<br>${this._formatOffset(e)}`)}this._setSubtitlesHtml([{html:()=>this._buildTextHtml(t)}]),this.showingLoadedMessage=!0,this.lastLoadedMessageTimestamp=Date.now()}_nonEmptySubtitleNames(e){if(0===e.length)return[];const t=[];for(let n=0;n<e.length;n++)t.push(this.subtitleFileNames[e[n]]);return t}_setSubtitlesHtml(e){this.subtitlesElementOverlay.setHtml(e)}_appendSubtitlesHtml(e){this.subtitlesElementOverlay.appendHtml(e)}_subtitleClasses(e){return void 0===e||void 0===this.subtitleClasses?"":this.subtitleClasses[e]??this.subtitleClasses}_subtitleStyles(e){return void 0===this.subtitleStyles?"":void 0===e?this.subtitleStyles[0]??"":this.subtitleStyles[e]??this.subtitleStyles[0]??""}_arrayEquals(e,t,n){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!n(e[i],t[i]))return!1;return!0}}function fn(e){let t="";const n=new Uint8Array(e),i=n.byteLength;for(let e=0;e<i;++e)t+=String.fromCharCode(n[e]);return window.btoa(t)}const pn=JSON.parse('{"L":[{"host":"www\\\\.netflix\\\\.com","script":"netflix-page.js","path":"watch","autoSync":{"enabled":true}},{"host":"(m|www)\\\\.youtube\\\\.com","script":"youtube-page.js","path":"watch","autoSync":{"enabled":true}},{"host":"tver\\\\.jp","script":"tver-page.js","path":"episodes","autoSync":{"enabled":true}},{"host":"www\\\\.b-ch\\\\.com","script":"bandai-channel-page.js","path":"titles","autoSync":{"enabled":true}},{"host":"www\\\\.amazon\\\\..+|www\\\\.primevideo\\\\.com","script":"amazon-prime-page.js","path":".*","autoSync":{"enabled":true,"videoSrc":"^blob:.+"},"ignore":{"class":"tst-video-overlay-player-html5","style":{"display":"none"}}},{"host":"www\\\\.hulu\\\\..+","script":"hulu-page.js","path":"watch","autoSync":{"enabled":true,"elementId":"content-video-player"}},{"host":"www\\\\.disneyplus\\\\..+","script":"disney-plus-page.js","path":"video|play","searchShadowRoots":true,"autoSync":{"enabled":true}},{"host":"www\\\\.apps\\\\.disneyplus\\\\..+","script":"apps-disney-plus-page.js","path":"watch","searchShadowRoots":true,"autoSync":{"enabled":true}},{"host":"video.unext.jp","script":"unext-page.js","path":"play","autoSync":{"enabled":false}},{"host":".+\\\\.viki\\\\.(io|com)","script":"viki-page.js","path":"videos","autoSync":{"enabled":true}},{"host":"emby*|:8096*","script":"emby-page.js","hash":"#!/videoosd/videoosd.html","autoSync":{"enabled":true}},{"host":"www.twitch.tv","allowBlankSrc":true},{"host":"osnplus.com","script":"osnplus-page.js","path":"watch","autoSync":{"enabled":true}},{"host":"www.bilibili.tv","script":"bilibili-page.js","path":"play|video","autoSync":{"enabled":true}}]}');function gn(){const e=new URL(window.location.href);for(const t of pn.L)if(new RegExp(t.host).test(e.host))return new mn(t,e)}class mn{constructor(e,t){this.config=e,this.url=t}loadScripts(){if(void 0===this.config.script)return;const e=document.createElement("script");e.src=chrome.runtime.getURL(`pages/${this.config.script}`),e.onload=()=>e.remove(),(document.head||document.documentElement).appendChild(e)}shouldIgnore(e){if(void 0===this.config.ignore)return!1;if(void 0!==this.config.ignore.class&&e.classList.contains(this.config.ignore.class))return!0;if(void 0!==this.config.ignore.style)for(const t of Object.keys(this.config.ignore.style))if(e.style[t]===this.config.ignore.style[t])return!0;return!1}canAutoSync(e){return void 0!==this.config.autoSync&&this.config.autoSync.enabled&&(void 0===this.config.autoSync.elementId||e.id===this.config.autoSync.elementId)&&(void 0===this.config.autoSync.videoSrc||new RegExp(this.config.autoSync.videoSrc).test(e.src))}isVideoPage(){var e=!0,t=!0;return this.config.hash&&(e=new RegExp(this.config.hash).test(this.url.hash)),this.config.path&&(t=new RegExp(this.config.path).test(this.url.pathname)),e&&t}}var yn=function(){function e(){this.listeners={}}var t=e.prototype;return t.on=function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)},t.off=function(e,t){if(!this.listeners[e])return!1;var n=this.listeners[e].indexOf(t);return this.listeners[e]=this.listeners[e].slice(0),this.listeners[e].splice(n,1),n>-1},t.trigger=function(e){var t=this.listeners[e];if(t)if(2===arguments.length)for(var n=t.length,i=0;i<n;++i)t[i].call(this,arguments[1]);else for(var r=Array.prototype.slice.call(arguments,1),s=t.length,o=0;o<s;++o)t[o].apply(this,r)},t.dispose=function(){this.listeners={}},t.pipe=function(e){this.on("data",(function(t){e.push(t)}))},e}();function bn(){return bn=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},bn.apply(this,arguments)}var vn=n(3452),wn=n.n(vn);function Sn(e){for(var t,n=(t=e,wn().atob?wn().atob(t):Buffer.from(t,"base64").toString("binary")),i=new Uint8Array(n.length),r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return i}class kn extends yn{constructor(){super(),this.buffer=""}push(e){let t;for(this.buffer+=e,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}const xn=String.fromCharCode(9),En=function(e){const t=/([0-9.]*)?@?([0-9.]*)?/.exec(e||""),n={};return t[1]&&(n.length=parseInt(t[1],10)),t[2]&&(n.offset=parseInt(t[2],10)),n},_n=function(e){const t={};if(!e)return t;const n=e.split(new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))'));let i,r=n.length;for(;r--;)""!==n[r]&&(i=/([^=]*)=(.*)/.exec(n[r]).slice(1),i[0]=i[0].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^\s+|\s+$/g,""),i[1]=i[1].replace(/^['"](.*)['"]$/g,"$1"),t[i[0]]=i[1]);return t};class On extends yn{constructor(){super(),this.customParsers=[],this.tagMappers=[]}push(e){let t,n;0!==(e=e.trim()).length&&("#"===e[0]?this.tagMappers.reduce(((t,n)=>{const i=n(e);return i===e?t:t.concat([i])}),[e]).forEach((e=>{for(let t=0;t<this.customParsers.length;t++)if(this.customParsers[t].call(this,e))return;if(0===e.indexOf("#EXT"))if(e=e.replace("\r",""),t=/^#EXTM3U/.exec(e),t)this.trigger("data",{type:"tag",tagType:"m3u"});else{if(t=/^#EXTINF:([0-9\.]*)?,?(.*)?$/.exec(e),t)return n={type:"tag",tagType:"inf"},t[1]&&(n.duration=parseFloat(t[1])),t[2]&&(n.title=t[2]),void this.trigger("data",n);if(t=/^#EXT-X-TARGETDURATION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"targetduration"},t[1]&&(n.duration=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-VERSION:([0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"version"},t[1]&&(n.version=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-MEDIA-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"media-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-DISCONTINUITY-SEQUENCE:(\-?[0-9.]*)?/.exec(e),t)return n={type:"tag",tagType:"discontinuity-sequence"},t[1]&&(n.number=parseInt(t[1],10)),void this.trigger("data",n);if(t=/^#EXT-X-PLAYLIST-TYPE:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"playlist-type"},t[1]&&(n.playlistType=t[1]),void this.trigger("data",n);if(t=/^#EXT-X-BYTERANGE:(.*)?$/.exec(e),t)return n=bn(En(t[1]),{type:"tag",tagType:"byterange"}),void this.trigger("data",n);if(t=/^#EXT-X-ALLOW-CACHE:(YES|NO)?/.exec(e),t)return n={type:"tag",tagType:"allow-cache"},t[1]&&(n.allowed=!/NO/.test(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-MAP:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"map"},t[1]){const e=_n(t[1]);e.URI&&(n.uri=e.URI),e.BYTERANGE&&(n.byterange=En(e.BYTERANGE))}this.trigger("data",n)}else if(t=/^#EXT-X-STREAM-INF:(.*)$/.exec(e),t){if(n={type:"tag",tagType:"stream-inf"},t[1]){if(n.attributes=_n(t[1]),n.attributes.RESOLUTION){const e=n.attributes.RESOLUTION.split("x"),t={};e[0]&&(t.width=parseInt(e[0],10)),e[1]&&(t.height=parseInt(e[1],10)),n.attributes.RESOLUTION=t}n.attributes.BANDWIDTH&&(n.attributes.BANDWIDTH=parseInt(n.attributes.BANDWIDTH,10)),n.attributes["FRAME-RATE"]&&(n.attributes["FRAME-RATE"]=parseFloat(n.attributes["FRAME-RATE"])),n.attributes["PROGRAM-ID"]&&(n.attributes["PROGRAM-ID"]=parseInt(n.attributes["PROGRAM-ID"],10))}this.trigger("data",n)}else{if(t=/^#EXT-X-MEDIA:(.*)$/.exec(e),t)return n={type:"tag",tagType:"media"},t[1]&&(n.attributes=_n(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-ENDLIST/.exec(e),t)this.trigger("data",{type:"tag",tagType:"endlist"});else if(t=/^#EXT-X-DISCONTINUITY/.exec(e),t)this.trigger("data",{type:"tag",tagType:"discontinuity"});else{if(t=/^#EXT-X-PROGRAM-DATE-TIME:(.*)$/.exec(e),t)return n={type:"tag",tagType:"program-date-time"},t[1]&&(n.dateTimeString=t[1],n.dateTimeObject=new Date(t[1])),void this.trigger("data",n);if(t=/^#EXT-X-KEY:(.*)$/.exec(e),t)return n={type:"tag",tagType:"key"},t[1]&&(n.attributes=_n(t[1]),n.attributes.IV&&("0x"===n.attributes.IV.substring(0,2).toLowerCase()&&(n.attributes.IV=n.attributes.IV.substring(2)),n.attributes.IV=n.attributes.IV.match(/.{8}/g),n.attributes.IV[0]=parseInt(n.attributes.IV[0],16),n.attributes.IV[1]=parseInt(n.attributes.IV[1],16),n.attributes.IV[2]=parseInt(n.attributes.IV[2],16),n.attributes.IV[3]=parseInt(n.attributes.IV[3],16),n.attributes.IV=new Uint32Array(n.attributes.IV))),void this.trigger("data",n);if(t=/^#EXT-X-START:(.*)$/.exec(e),t)return n={type:"tag",tagType:"start"},t[1]&&(n.attributes=_n(t[1]),n.attributes["TIME-OFFSET"]=parseFloat(n.attributes["TIME-OFFSET"]),n.attributes.PRECISE=/YES/.test(n.attributes.PRECISE)),void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT-CONT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out-cont"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-OUT:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-out"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-CUE-IN:(.*)?$/.exec(e),t)return n={type:"tag",tagType:"cue-in"},t[1]?n.data=t[1]:n.data="",void this.trigger("data",n);if(t=/^#EXT-X-SKIP:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"skip"},n.attributes=_n(t[1]),n.attributes.hasOwnProperty("SKIPPED-SEGMENTS")&&(n.attributes["SKIPPED-SEGMENTS"]=parseInt(n.attributes["SKIPPED-SEGMENTS"],10)),n.attributes.hasOwnProperty("RECENTLY-REMOVED-DATERANGES")&&(n.attributes["RECENTLY-REMOVED-DATERANGES"]=n.attributes["RECENTLY-REMOVED-DATERANGES"].split(xn)),void this.trigger("data",n);if(t=/^#EXT-X-PART:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part"},n.attributes=_n(t[1]),["DURATION"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["INDEPENDENT","GAP"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))})),n.attributes.hasOwnProperty("BYTERANGE")&&(n.attributes.byterange=En(n.attributes.BYTERANGE)),void this.trigger("data",n);if(t=/^#EXT-X-SERVER-CONTROL:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"server-control"},n.attributes=_n(t[1]),["CAN-SKIP-UNTIL","PART-HOLD-BACK","HOLD-BACK"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),["CAN-SKIP-DATERANGES","CAN-BLOCK-RELOAD"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=/YES/.test(n.attributes[e]))})),void this.trigger("data",n);if(t=/^#EXT-X-PART-INF:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"part-inf"},n.attributes=_n(t[1]),["PART-TARGET"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseFloat(n.attributes[e]))})),void this.trigger("data",n);if(t=/^#EXT-X-PRELOAD-HINT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"preload-hint"},n.attributes=_n(t[1]),["BYTERANGE-START","BYTERANGE-LENGTH"].forEach((function(e){if(n.attributes.hasOwnProperty(e)){n.attributes[e]=parseInt(n.attributes[e],10);const t="BYTERANGE-LENGTH"===e?"length":"offset";n.attributes.byterange=n.attributes.byterange||{},n.attributes.byterange[t]=n.attributes[e],delete n.attributes[e]}})),void this.trigger("data",n);if(t=/^#EXT-X-RENDITION-REPORT:(.*)$/.exec(e),t&&t[1])return n={type:"tag",tagType:"rendition-report"},n.attributes=_n(t[1]),["LAST-MSN","LAST-PART"].forEach((function(e){n.attributes.hasOwnProperty(e)&&(n.attributes[e]=parseInt(n.attributes[e],10))})),void this.trigger("data",n);this.trigger("data",{type:"tag",data:e.slice(4)})}}}else this.trigger("data",{type:"comment",text:e.slice(1)})})):this.trigger("data",{type:"uri",uri:e}))}addParser({expression:e,customType:t,dataParser:n,segment:i}){"function"!=typeof n&&(n=e=>e),this.customParsers.push((r=>{if(e.exec(r))return this.trigger("data",{type:"custom",data:n(r),customType:t,segment:i}),!0}))}addTagMapper({expression:e,map:t}){this.tagMappers.push((n=>e.test(n)?t(n):n))}}const Cn=function(e){const t={};return Object.keys(e).forEach((function(n){var i;t[(i=n,i.toLowerCase().replace(/-(\w)/g,(e=>e[1].toUpperCase())))]=e[n]})),t},Tn=function(e){const{serverControl:t,targetDuration:n,partTargetDuration:i}=e;if(!t)return;const r="#EXT-X-SERVER-CONTROL",s="holdBack",o="partHoldBack",a=n&&3*n,l=i&&2*i;n&&!t.hasOwnProperty(s)&&(t[s]=a,this.trigger("info",{message:`${r} defaulting HOLD-BACK to targetDuration * 3 (${a}).`})),a&&t[s]<a&&(this.trigger("warn",{message:`${r} clamping HOLD-BACK (${t[s]}) to targetDuration * 3 (${a})`}),t[s]=a),i&&!t.hasOwnProperty(o)&&(t[o]=3*i,this.trigger("info",{message:`${r} defaulting PART-HOLD-BACK to partTargetDuration * 3 (${t[o]}).`})),i&&t[o]<l&&(this.trigger("warn",{message:`${r} clamping PART-HOLD-BACK (${t[o]}) to partTargetDuration * 2 (${l}).`}),t[o]=l)};class An extends yn{constructor(){super(),this.lineStream=new kn,this.parseStream=new On,this.lineStream.pipe(this.parseStream);const e=this,t=[];let n,i,r={},s=!1;const o=function(){},a={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};let l=0;this.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};let c=0,u=0;this.on("end",(()=>{r.uri||!r.parts&&!r.preloadHints||(!r.map&&n&&(r.map=n),!r.key&&i&&(r.key=i),r.timeline||"number"!=typeof l||(r.timeline=l),this.manifest.preloadSegment=r)})),this.parseStream.on("data",(function(h){let d,f;({tag(){({version(){h.version&&(this.manifest.version=h.version)},"allow-cache"(){this.manifest.allowCache=h.allowed,"allowed"in h||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange(){const e={};"length"in h&&(r.byterange=e,e.length=h.length,"offset"in h||(h.offset=c)),"offset"in h&&(r.byterange=e,e.offset=h.offset),c=e.offset+e.length},endlist(){this.manifest.endList=!0},inf(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"})),"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"})),h.duration>0&&(r.duration=h.duration),0===h.duration&&(r.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"})),this.manifest.segments=t},key(){if(h.attributes)if("NONE"!==h.attributes.METHOD)if(h.attributes.URI){if("com.apple.streamingkeydelivery"===h.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.apple.fps.1_0"]={attributes:h.attributes});if("com.microsoft.playready"===h.attributes.KEYFORMAT)return this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.microsoft.playready"]={uri:h.attributes.URI});if("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"===h.attributes.KEYFORMAT)return-1===["SAMPLE-AES","SAMPLE-AES-CTR","SAMPLE-AES-CENC"].indexOf(h.attributes.METHOD)?void this.trigger("warn",{message:"invalid key method provided for Widevine"}):("SAMPLE-AES-CENC"===h.attributes.METHOD&&this.trigger("warn",{message:"SAMPLE-AES-CENC is deprecated, please use SAMPLE-AES-CTR instead"}),"data:text/plain;base64,"!==h.attributes.URI.substring(0,23)?void this.trigger("warn",{message:"invalid key URI provided for Widevine"}):h.attributes.KEYID&&"0x"===h.attributes.KEYID.substring(0,2)?(this.manifest.contentProtection=this.manifest.contentProtection||{},void(this.manifest.contentProtection["com.widevine.alpha"]={attributes:{schemeIdUri:h.attributes.KEYFORMAT,keyId:h.attributes.KEYID.substring(2)},pssh:Sn(h.attributes.URI.split(",")[1])})):void this.trigger("warn",{message:"invalid key ID provided for Widevine"}));h.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"}),i={method:h.attributes.METHOD||"AES-128",uri:h.attributes.URI},void 0!==h.attributes.IV&&(i.iv=h.attributes.IV)}else this.trigger("warn",{message:"ignoring key declaration without URI"});else i=null;else this.trigger("warn",{message:"ignoring key declaration without attribute list"})},"media-sequence"(){isFinite(h.number)?this.manifest.mediaSequence=h.number:this.trigger("warn",{message:"ignoring invalid media sequence: "+h.number})},"discontinuity-sequence"(){isFinite(h.number)?(this.manifest.discontinuitySequence=h.number,l=h.number):this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+h.number})},"playlist-type"(){/VOD|EVENT/.test(h.playlistType)?this.manifest.playlistType=h.playlistType:this.trigger("warn",{message:"ignoring unknown playlist type: "+h.playlist})},map(){n={},h.uri&&(n.uri=h.uri),h.byterange&&(n.byterange=h.byterange),i&&(n.key=i)},"stream-inf"(){this.manifest.playlists=t,this.manifest.mediaGroups=this.manifest.mediaGroups||a,h.attributes?(r.attributes||(r.attributes={}),bn(r.attributes,h.attributes)):this.trigger("warn",{message:"ignoring empty stream-inf attributes"})},media(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||a,!(h.attributes&&h.attributes.TYPE&&h.attributes["GROUP-ID"]&&h.attributes.NAME))return void this.trigger("warn",{message:"ignoring incomplete or missing media group"});const e=this.manifest.mediaGroups[h.attributes.TYPE];e[h.attributes["GROUP-ID"]]=e[h.attributes["GROUP-ID"]]||{},d=e[h.attributes["GROUP-ID"]],f={default:/yes/i.test(h.attributes.DEFAULT)},f.default?f.autoselect=!0:f.autoselect=/yes/i.test(h.attributes.AUTOSELECT),h.attributes.LANGUAGE&&(f.language=h.attributes.LANGUAGE),h.attributes.URI&&(f.uri=h.attributes.URI),h.attributes["INSTREAM-ID"]&&(f.instreamId=h.attributes["INSTREAM-ID"]),h.attributes.CHARACTERISTICS&&(f.characteristics=h.attributes.CHARACTERISTICS),h.attributes.FORCED&&(f.forced=/yes/i.test(h.attributes.FORCED)),d[h.attributes.NAME]=f},discontinuity(){l+=1,r.discontinuity=!0,this.manifest.discontinuityStarts.push(t.length)},"program-date-time"(){void 0===this.manifest.dateTimeString&&(this.manifest.dateTimeString=h.dateTimeString,this.manifest.dateTimeObject=h.dateTimeObject),r.dateTimeString=h.dateTimeString,r.dateTimeObject=h.dateTimeObject},targetduration(){!isFinite(h.duration)||h.duration<0?this.trigger("warn",{message:"ignoring invalid target duration: "+h.duration}):(this.manifest.targetDuration=h.duration,Tn.call(this,this.manifest))},start(){h.attributes&&!isNaN(h.attributes["TIME-OFFSET"])?this.manifest.start={timeOffset:h.attributes["TIME-OFFSET"],precise:h.attributes.PRECISE}:this.trigger("warn",{message:"ignoring start declaration without appropriate attribute list"})},"cue-out"(){r.cueOut=h.data},"cue-out-cont"(){r.cueOutCont=h.data},"cue-in"(){r.cueIn=h.data},skip(){this.manifest.skip=Cn(h.attributes),this.warnOnMissingAttributes_("#EXT-X-SKIP",h.attributes,["SKIPPED-SEGMENTS"])},part(){s=!0;const e=this.manifest.segments.length,t=Cn(h.attributes);r.parts=r.parts||[],r.parts.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=u),u=t.byterange.offset+t.byterange.length);const n=r.parts.length-1;this.warnOnMissingAttributes_(`#EXT-X-PART #${n} for segment #${e}`,h.attributes,["URI","DURATION"]),this.manifest.renditionReports&&this.manifest.renditionReports.forEach(((e,t)=>{e.hasOwnProperty("lastPart")||this.trigger("warn",{message:`#EXT-X-RENDITION-REPORT #${t} lacks required attribute(s): LAST-PART`})}))},"server-control"(){const e=this.manifest.serverControl=Cn(h.attributes);e.hasOwnProperty("canBlockReload")||(e.canBlockReload=!1,this.trigger("info",{message:"#EXT-X-SERVER-CONTROL defaulting CAN-BLOCK-RELOAD to false"})),Tn.call(this,this.manifest),e.canSkipDateranges&&!e.hasOwnProperty("canSkipUntil")&&this.trigger("warn",{message:"#EXT-X-SERVER-CONTROL lacks required attribute CAN-SKIP-UNTIL which is required when CAN-SKIP-DATERANGES is set"})},"preload-hint"(){const e=this.manifest.segments.length,t=Cn(h.attributes),n=t.type&&"PART"===t.type;r.preloadHints=r.preloadHints||[],r.preloadHints.push(t),t.byterange&&(t.byterange.hasOwnProperty("offset")||(t.byterange.offset=n?u:0,n&&(u=t.byterange.offset+t.byterange.length)));const i=r.preloadHints.length-1;if(this.warnOnMissingAttributes_(`#EXT-X-PRELOAD-HINT #${i} for segment #${e}`,h.attributes,["TYPE","URI"]),t.type)for(let n=0;n<r.preloadHints.length-1;n++){const s=r.preloadHints[n];s.type&&s.type===t.type&&this.trigger("warn",{message:`#EXT-X-PRELOAD-HINT #${i} for segment #${e} has the same TYPE ${t.type} as preload hint #${n}`})}},"rendition-report"(){const e=Cn(h.attributes);this.manifest.renditionReports=this.manifest.renditionReports||[],this.manifest.renditionReports.push(e);const t=this.manifest.renditionReports.length-1,n=["LAST-MSN","URI"];s&&n.push("LAST-PART"),this.warnOnMissingAttributes_(`#EXT-X-RENDITION-REPORT #${t}`,h.attributes,n)},"part-inf"(){this.manifest.partInf=Cn(h.attributes),this.warnOnMissingAttributes_("#EXT-X-PART-INF",h.attributes,["PART-TARGET"]),this.manifest.partInf.partTarget&&(this.manifest.partTargetDuration=this.manifest.partInf.partTarget),Tn.call(this,this.manifest)}}[h.tagType]||o).call(e)},uri(){r.uri=h.uri,t.push(r),this.manifest.targetDuration&&!("duration"in r)&&(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),r.duration=this.manifest.targetDuration),i&&(r.key=i),r.timeline=l,n&&(r.map=n),u=0,r={}},comment(){},custom(){h.segment?(r.custom=r.custom||{},r.custom[h.customType]=h.data):(this.manifest.custom=this.manifest.custom||{},this.manifest.custom[h.customType]=h.data)}})[h.type].call(e)}))}warnOnMissingAttributes_(e,t,n){const i=[];n.forEach((function(e){t.hasOwnProperty(e)||i.push(e)})),i.length&&this.trigger("warn",{message:`${e} lacks required attribute(s): ${i.join(", ")}`})}push(e){this.lineStream.push(e)}end(){this.lineStream.push("\n"),this.trigger("end")}addParser(e){this.parseStream.addParser(e)}addTagMapper(e){this.parseStream.addTagMapper(e)}}async function Pn(e){return`<!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="utf-8" />\n                <meta name="viewport" content="width=device-width, initial-scale=1" />\n                <title>asbplayer - Video Data Sync</title>\n                <style>\n                    @import url(${chrome.runtime.getURL("./assets/fonts.css")});\n                </style>\n            </head>\n            <body>\n                <div id="root" style="width:100%;height:100vh;"></div>\n                <script type="application/json" id="loc">${JSON.stringify(await je(e))}<\/script>\n                <script src="${chrome.runtime.getURL("./video-data-sync-ui.js")}"><\/script>\n            </body>\n            </html>`}class Fn{constructor(e,t){this._autoSyncing=!1,this._waitingForSubtitles=!1,this._context=e,this._settings=t,this._videoSelectBound=!1,this._imageElement=new ze(e.video),this._doneListener,this._autoSync=!1,this._lastLanguagesSynced={},this._emptySubtitle={language:"",url:"-",label:hn.t("extension.videoDataSync.emptySubtitleTrack"),extension:"srt"},this._boundFunction,this._domain=new URL(window.location.href).host,this._frame=new $e(Pn)}get lastLanguageSynced(){return this._lastLanguagesSynced[this._domain]??[]}set lastLanguageSynced(e){this._lastLanguagesSynced[this._domain]=e}bindVideoSelect(e){if(this._videoSelectBound)throw new Error("Video select container already bound");const t=this._imageElement.element();t.classList.remove("asbplayer-hide"),t.classList.add("asbplayer-mouse-over-image"),t.addEventListener("click",(t=>{t.preventDefault(),this._doneListener=e,this.show({userRequested:!0,openedFromMiningCommand:!1})})),this._videoSelectBound=!0}unbind(){this._boundFunction&&document.removeEventListener("asbplayer-synced-data",this._boundFunction,!1),this._boundFunction=void 0,this._syncedData=void 0,this.unbindVideoSelect()}unbindVideoSelect(){this._imageElement.remove(),this._frame.unbind(),this._wasPaused=void 0,this._videoSelectBound=!1,this._doneListener=void 0}updateSettings({streamingAutoSync:e,streamingLastLanguagesSynced:t}){this._autoSync=e,this._lastLanguagesSynced=t}requestSubtitles(){if(this._context.subSyncAvailable&&gn()?.isVideoPage()){if(this._syncedData=void 0,!this._boundFunction){let e=!0;this._boundFunction=t=>{const n=t.detail,i=e&&void 0!==n.subtitles;this._waitingForSubtitles=void 0===n.subtitles,this._setSyncedData(n,i),i&&(e=!1)},document.addEventListener("asbplayer-synced-data",this._boundFunction,!1)}document.dispatchEvent(new CustomEvent("asbplayer-get-synced-data")),this._waitingForSubtitles=!0}}async show({userRequested:e,openedFromMiningCommand:t}){if(!e&&void 0===this._syncedData?.subtitles)return;const n=this._syncedData?.subtitles??[],i=this._matchLastSyncedWithAvailableTracks(),r=i.autoSelectedTracks;if(!i.completeMatch||e||this._syncedData?.error){const e=i.completeMatch,s=await this._context.settings.getSingle("themeType");let o=this._syncedData?{open:!0,isLoading:void 0===this._syncedData.subtitles,suggestedName:this._syncedData.basename,selectedSubtitle:["-"],subtitles:n,error:this._syncedData.error,themeType:s,openedFromMiningCommand:t,defaultCheckboxState:e}:{open:!0,isLoading:this._context.subSyncAvailable&&this._waitingForSubtitles,suggestedName:document.title,selectedSubtitle:["-"],error:"",showSubSelect:!0,subtitles:n,themeType:s,openedFromMiningCommand:t,defaultCheckboxState:e};o.selectedSubtitle=r.map((e=>e.url||"-"));const a=await this._client();this._prepareShow(),a.updateState(o)}else if(!this._autoSyncing){this._autoSyncing=!0;try{await this._syncData(r)&&this._doneListener&&this._doneListener()}finally{this._autoSyncing=!1}}}_matchLastSyncedWithAvailableTracks(){const e=this._syncedData?.subtitles??[];let t={autoSelectedTracks:[this._emptySubtitle,this._emptySubtitle,this._emptySubtitle],completeMatch:!1};if(e.length||""!==this.lastLanguageSynced.join("")){let n=0;for(let i=0;i<this.lastLanguageSynced.length;i++){const r=this.lastLanguageSynced[i];for(let s=0;s<e.length;s++){if(""===r){n++;break}if(r===e[s].language){t.autoSelectedTracks[i]=e[s],n++;break}}}n===this.lastLanguageSynced.length&&(t.completeMatch=!0)}else t.completeMatch=!0;return t}_defaultVideoName(e,t){return"-"===t.url?e??"":e?`${e} - ${t.label}`:t.label}_setSyncedData(e,t){this._syncedData=e,t&&this._canAutoSync()&&this.show({userRequested:!1,openedFromMiningCommand:!1})}_canAutoSync(){const e=gn();return void 0===e?this._autoSync??!1:!0===this._autoSync&&e.canAutoSync(this._context.video)}async _client(){this._frame.language=await this._settings.getSingle("language");const e=await this._frame.bind(),t=await this._frame.client();return e&&t.onMessage((async e=>{let t=!0;if("confirm"===e.command){const n=e;n.shouldRememberTrackChoices&&(this.lastLanguageSynced=n.data.map((e=>e.language)),await this._context.settings.set({streamingLastLanguagesSynced:this._lastLanguagesSynced}).catch((()=>{})));const i=n.data;t=await this._syncDataArray(i)}else if("openFile"===e.command){const n=e.subtitles;try{this._syncSubtitles(n,!1),t=!0}catch(e){e instanceof Error&&this._reportError(e.message)}}t&&(this._context.keyBindings.bind(this._context),this._context.subtitleController.forceHideSubtitles=!1,this._context.mobileVideoOverlayController.forceHide=!1,this._frame?.hide(),this._fullscreenElement&&(this._fullscreenElement.requestFullscreen(),this._fullscreenElement=void 0),this._activeElement?("function"==typeof this._activeElement.focus&&this._activeElement.focus(),this._activeElement=void 0):window.focus(),this._wasPaused||this._context.play(),this._wasPaused=void 0,this._doneListener&&this._doneListener())})),this._frame.show(),t}_prepareShow(){this._wasPaused=this._wasPaused??this._context.video.paused,this._context.pause(),document.fullscreenElement&&(this._fullscreenElement=document.fullscreenElement,document.exitFullscreen()),document.activeElement&&(this._activeElement=document.activeElement),this._context.keyBindings.unbind(),this._context.subtitleController.forceHideSubtitles=!0,this._context.mobileVideoOverlayController.forceHide=!0}async _syncData(e){try{let t=[];for(let n=0;n<e.length;n++){const{extension:i,url:r,m3U8BaseUrl:s}=e[n],o=await this._subtitlesForUrl(this._defaultVideoName(this._syncedData?.basename,e[n]),i,r,s);void 0!==o&&t.push(...o)}return this._syncSubtitles(t,e.some((e=>void 0!==e.m3U8BaseUrl))),!0}catch(e){return void 0!==e.message&&this._reportError(`Data Sync failed: ${e.message}`),!1}}async _syncDataArray(e){try{let t=[];for(let n=0;n<e.length;n++){const{name:i,extension:r,subtitleUrl:s,m3U8BaseUrl:o}=e[n],a=await this._subtitlesForUrl(i,r,s,o);void 0!==a&&t.push(...a)}return this._syncSubtitles(t,e.some((e=>void 0!==e.m3U8BaseUrl))),!0}catch(e){return void 0!==e.message&&this._reportError(`Data Sync failed: ${e.message}`),!1}}async _syncSubtitles(e,t){if(await this._settings.getSingle("streamingSubtitleListPreference")===W.app){const n={sender:"asbplayer-video",message:{command:"sync",subtitles:e,flatten:t},src:this._context.video.src};chrome.runtime.sendMessage(n)}else{const n=await Promise.all(e.map((async e=>new File([await(await fetch("data:text/plain;base64,"+e.base64)).blob()],e.name))));this._context.loadSubtitles(n,t)}}async _subtitlesForUrl(e,t,n,i){if("-"===n)return[{name:`${e}.${t}`,base64:""}];const r=await fetch(n).catch((e=>{this._reportError(e.message)}));if(r){if("m3u8"===t){const t=await fetch(n),r=new An;if(r.push(await t.text()),r.end(),!r.manifest.segments||0===r.manifest.segments.length)return;const s=r.manifest.segments[0].uri,o=s.substring(s.lastIndexOf(".")+1),a=r.manifest.segments.filter((e=>!e.discontinuity&&e.uri)).map((e=>fetch(`${i}/${e.uri}`))),l=[];for(const t of a){const n=await t;if(!n.ok)throw new Error(`Subtitle Retrieval failed with Status ${n.status}/${n.statusText}...`);l.push({name:`${e}.${o}`,base64:fn(await n.arrayBuffer())})}return l}if(!r.ok)throw new Error(`Subtitle Retrieval failed with Status ${r.status}/${r.statusText}...`);return[{name:`${e}.${t}`,base64:r?fn(await r.arrayBuffer()):""}]}}async _reportError(e){const t=await this._client(),n=await this._context.settings.getSingle("themeType");this._prepareShow();const i=this._syncedData?.subtitles??[];let r=[this._emptySubtitle,this._emptySubtitle,this._emptySubtitle];for(let e=0;e<this.lastLanguageSynced.length;e++){const t=this.lastLanguageSynced[e];for(let n=0;n<i.length;n++)if(t===i[n].language){r[e]=i[n];break}}return t.updateState({open:!0,isLoading:!1,showSubSelect:!0,subtitles:this._syncedData?.subtitles||[],selectedSubtitle:r.map((e=>e.url))||"-",error:e,themeType:n})}}class Ln{constructor(){this.recording=!1,this.recorder=null,this.stream=null,this.blobPromise=null}startWithTimeout(e,t,n){return new Promise((async(i,r)=>{try{if(this.recording)return console.error("Already recording, cannot start with timeout."),void r("Already recording");await this.start(e),n(),setTimeout((async()=>{i(await this.stop())}),t)}catch(e){r(e)}}))}start(e){return new Promise(((t,n)=>{if(this.recording)n("Already recording, cannot start");else try{const n=new MediaRecorder(e),i=[];n.ondataavailable=e=>{i.push(e.data)},this.blobPromise=new Promise(((e,t)=>{n.onstop=t=>{e(new Blob(i))}})),n.start();const r=new AudioContext;r.createMediaStreamSource(e).connect(r.destination),this.recorder=n,this.recording=!0,this.stream=e,t(void 0)}catch(e){n(e)}}))}async stop(){if(!this.recording)throw new Error("Not recording, unable to stop");this.recording=!1,this.recorder?.stop(),this.recorder=null,this.stream?.getTracks()?.forEach((e=>e.stop())),this.stream=null;const e=await this.blobPromise;return this.blobPromise=null,await fn(await e.arrayBuffer())}}const Nn=navigator.userAgent.toLowerCase().includes("android")??navigator.userAgentData?.mobile??!1;let Rn;const In={};class jn{constructor(){this._unbindPlay=!1,this._unbindAutoPause=!1,this._unbindCondensedPlayback=!1,this._unbindFastForwardPlayback=!1,this._unbindSeekToSubtitle=!1,this._unbindSeekToBeginningOfCurrentSubtitle=!1,this._unbindSeekBackwardOrForward=!1,this._unbindToggleSubtitles=!1,this._unbindToggleSubtitleTrackInVideo=!1,this._unbindToggleSubtitleTrackInList=!1,this._unbindToggleBlurTrack=!1,this._unbindOffsetToSubtitle=!1,this._unbindAdjustOffset=!1,this._unbindResetOffset=!1,this._unbindAdjustPlaybackRate=!1,this._unbindToggleRepeat=!1,this._bound=!1}setKeyBindSet(e,t){this._keyBinder=new V(t),this.unbind(),this.bind(e)}bind(e){this._keyBinder&&(this._bound&&this.unbind(),this._unbindPlay=this._keyBinder.bindPlay((t=>{t.preventDefault(),t.stopImmediatePropagation(),e.video.paused?e.play():e.pause()}),(()=>!e.synced),!0),this._unbindAutoPause=this._keyBinder.bindAutoPause((t=>{t.preventDefault(),t.stopImmediatePropagation(),e.playMode=e.playMode===f.autoPause?f.normal:f.autoPause}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindCondensedPlayback=this._keyBinder.bindCondensedPlayback((t=>{t.preventDefault(),t.stopImmediatePropagation(),e.playMode=e.playMode===f.condensed?f.normal:f.condensed}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindToggleRepeat=this._keyBinder.bindToggleRepeat((t=>{t.preventDefault(),t.stopImmediatePropagation();const[n]=e.subtitleController.currentSubtitle();n&&(e.playMode=e.playMode===f.repeat?f.normal:f.repeat)}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindFastForwardPlayback=this._keyBinder.bindFastForwardPlayback((t=>{t.preventDefault(),t.stopImmediatePropagation(),e.playMode=e.playMode===f.fastForward?f.normal:f.fastForward}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindSeekToSubtitle=this._keyBinder.bindSeekToSubtitle(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation(),e.seek(n.start/1e3)}),(()=>0===e.subtitleController.subtitles.length),(()=>1e3*e.video.currentTime),(()=>e.subtitleController.subtitles),!0),this._unbindSeekBackwardOrForward=this._keyBinder.bindSeekBackwardOrForward(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation(),n?e.seek(Math.min(e.video.duration,e.video.currentTime+10)):e.seek(Math.max(0,e.video.currentTime-10))}),(()=>!e.synced),!0),this._unbindSeekToBeginningOfCurrentSubtitle=this._keyBinder.bindSeekToBeginningOfCurrentSubtitle(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation(),e.seek(n.start/1e3),e.alwaysPlayOnSubtitleRepeat&&e.play()}),(()=>0===e.subtitleController.subtitles.length),(()=>1e3*e.video.currentTime),(()=>e.subtitleController.subtitles),!0),this._unbindToggleSubtitles=this._keyBinder.bindToggleSubtitles((t=>{t.preventDefault(),t.stopImmediatePropagation();const n={sender:"asbplayer-video",message:{command:"toggle-subtitles"},src:e.video.src};chrome.runtime.sendMessage(n)}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindToggleSubtitleTrackInVideo=this._keyBinder.bindToggleSubtitleTrackInVideo(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.disabledSubtitleTracks[n]=!e.subtitleController.disabledSubtitleTracks[n]}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindToggleBlurTrack=this._keyBinder.bindToggleBlurTrack(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation();const i={sender:"asbplayer-video",message:{command:"blur-subtitles",track:n,trackCount:Math.max(...e.subtitleController.subtitles.map((e=>e.track)))+1},src:e.video.src};chrome.runtime.sendMessage(i)}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindToggleSubtitleTrackInList=this._keyBinder.bindToggleSubtitleTrackInList(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation();const i={sender:"asbplayer-video",message:{command:"toggleSubtitleTrackInList",track:n},src:e.video.src};chrome.runtime.sendMessage(i)}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindOffsetToSubtitle=this._keyBinder.bindOffsetToSubtitle(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.offset(n)}),(()=>0===e.subtitleController.subtitles.length),(()=>1e3*e.video.currentTime),(()=>e.subtitleController.subtitles),!0),this._unbindAdjustOffset=this._keyBinder.bindAdjustOffset(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.offset(n)}),(()=>0===e.subtitleController.subtitles.length),(()=>e.subtitleController.subtitles),!0),this._unbindResetOffset=this._keyBinder.bindResetOffet((t=>{t.preventDefault(),t.stopImmediatePropagation(),e.subtitleController.offset(0)}),(()=>0===e.subtitleController.subtitles.length),!0),this._unbindAdjustPlaybackRate=this._keyBinder.bindAdjustPlaybackRate(((t,n)=>{t.preventDefault(),t.stopImmediatePropagation();const i=e.video.playbackRate,r=10*e.speedChangeStep;e.playMode=f.normal,e.video.playbackRate=n?Math.min(5,Math.round(10*i+r)/10):Math.max(.1,Math.round(10*i-r)/10)}),(()=>!e.synced),!0),this._bound=!0)}unbind(){this._unbindPlay&&(this._unbindPlay(),this._unbindPlay=!1),this._unbindAutoPause&&(this._unbindAutoPause(),this._unbindAutoPause=!1),this._unbindCondensedPlayback&&(this._unbindCondensedPlayback(),this._unbindCondensedPlayback=!1),this._unbindFastForwardPlayback&&(this._unbindFastForwardPlayback(),this._unbindFastForwardPlayback=!1),this._unbindSeekToSubtitle&&(this._unbindSeekToSubtitle(),this._unbindSeekToSubtitle=!1),this._unbindSeekToBeginningOfCurrentSubtitle&&(this._unbindSeekToBeginningOfCurrentSubtitle(),this._unbindSeekToBeginningOfCurrentSubtitle=!1),this._unbindSeekBackwardOrForward&&(this._unbindSeekBackwardOrForward(),this._unbindSeekBackwardOrForward=!1),this._unbindToggleSubtitles&&(this._unbindToggleSubtitles(),this._unbindToggleSubtitles=!1),this._unbindToggleSubtitleTrackInVideo&&(this._unbindToggleSubtitleTrackInVideo(),this._unbindToggleSubtitleTrackInVideo=!1),this._unbindToggleSubtitleTrackInList&&(this._unbindToggleSubtitleTrackInList(),this._unbindToggleSubtitleTrackInList=!1),this._unbindToggleBlurTrack&&(this._unbindToggleBlurTrack(),this._unbindToggleBlurTrack=!1),this._unbindOffsetToSubtitle&&(this._unbindOffsetToSubtitle(),this._unbindOffsetToSubtitle=!1),this._unbindAdjustOffset&&(this._unbindAdjustOffset(),this._unbindAdjustOffset=!1),this._unbindResetOffset&&(this._unbindResetOffset(),this._unbindResetOffset=!1),this._unbindToggleRepeat&&(this._unbindToggleRepeat(),this._unbindToggleRepeat=!1),this._unbindAdjustPlaybackRate&&(this._unbindAdjustPlaybackRate(),this._unbindAdjustPlaybackRate=!1),this._bound=!1}}const Mn="shouldShowUpdateAlert";let Dn=!1;var Bn,$n;document.addEventListener("asbplayer-netflix-enabled",(e=>{Dn=e.detail})),document.dispatchEvent(new CustomEvent("asbplayer-query-netflix")),function(e){e[e.requested=0]="requested",e[e.started=1]="started",e[e.notRecording=2]="notRecording"}(Bn||(Bn={}));class Un{constructor(e,t,n){this.subscribed=!1,this.recordingState=Bn.notRecording,this.postMinePlayback=h.remember,this._playMode=f.normal,this._speedChangeStep=.1,this._audioRecorder=new Ln,this.condensedPlaybackMinimumSkipIntervalMs=1e3,this.fastForwardPlaybackMinimumGapMs=600,this.fastForwardModePlaybackRate=2.7,this.imageDelay=0,this.video=e,this.subSyncAvailable=t,this.settings=new J(new Ie),this.subtitleController=new dn(e,this.settings),this.videoDataSyncController=new Fn(this,this.settings),this.controlsController=new He(e),this.dragController=new We(e),this.keyBindings=new jn,this.ankiUiController=new Ve,this.notificationController=new Ye(this),this.mobileVideoOverlayController=new Ge(this,Ze.top),this.subtitleController.onOffsetChange=()=>this.mobileVideoOverlayController.updateModel(),this.mobileGestureController=new qe(this),this.recordMedia=!0,this.takeScreenshot=!0,this.cleanScreenshot=!0,this.audioPaddingStart=0,this.audioPaddingEnd=500,this.maxImageWidth=0,this.maxImageHeight=0,this.autoPausePreference=d.atEnd,this.copyToClipboardOnMine=!1,this.alwaysPlayOnSubtitleRepeat=!0,this.postMinePlayback=h.remember,this._synced=!1,this.recordingMediaWithScreenshot=!1,this.frameId=n}get recordingMedia(){return this.recordingState!==Bn.notRecording}get synced(){return this._synced}get url(){return window.location!==window.parent.location?document.referrer:document.location.href}get speedChangeStep(){return this._speedChangeStep}get playMode(){return this._playMode}set playMode(e){const t=()=>{this.subtitleController.onNextToShow=void 0,this.subtitleController.notification("info.disabledCondensedPlayback")},n=()=>{this.subtitleController.onSlice=void 0,this.video.playbackRate=1,this.subtitleController.notification("info.disabledFastForwardPlayback")};switch(e){case f.autoPause:this.subtitleController.autoPauseContext.onStartedShowing=()=>{this.recordingMedia||this.autoPausePreference!==d.atStart||this.pause()},this.subtitleController.autoPauseContext.onWillStopShowing=()=>{this.recordingMedia||this.autoPausePreference!==d.atEnd||this.pause()},this.subtitleController.notification("info.enabledAutoPause");break;case f.condensed:this._playMode===f.fastForward&&n();let i=!1;this.subtitleController.onNextToShow=async e=>{try{if(this.recordingMedia||i||this.video.paused||e.start-1e3*this.video.currentTime<=this.condensedPlaybackMinimumSkipIntervalMs)return;i=!0,this.seek(e.start/1e3),await this.play(),i=!1}finally{i=!1}},this.subtitleController.notification("info.enabledCondensedPlayback");break;case f.fastForward:this._playMode===f.condensed&&t(),this.subtitleController.onSlice=async e=>{const t=e=>e&&Math.abs(e-1e3*this.video.currentTime)>this.fastForwardPlaybackMinimumGapMs;0===e.showing.length&&t(Math.max.apply(void 0,(e?.lastShown||[]).map((e=>e.end))))&&t(Math.min.apply(void 0,(e?.nextToShow||[]).map((e=>e.start))))?this.video.playbackRate=this.fastForwardModePlaybackRate:this.video.playbackRate=1},this.subtitleController.notification("info.enabledFastForwardPlayback");break;case f.repeat:const[r]=this.subtitleController.currentSubtitle();r&&(this.subtitleController.autoPauseContext.onWillStopShowing=()=>{this.seek(r.start/1e3)},this.subtitleController.notification("info.enabledRepeatPlayback"));break;case f.normal:this._playMode===f.repeat?(this.subtitleController.autoPauseContext.onWillStopShowing=void 0,this.subtitleController.notification("info.disabledRepeatPlayback")):this._playMode===f.autoPause?(this.subtitleController.autoPauseContext.onStartedShowing=void 0,this.subtitleController.autoPauseContext.onWillStopShowing=void 0,this.subtitleController.notification("info.disabledAutoPause")):this._playMode===f.condensed?t():this._playMode===f.fastForward&&n();break;default:console.error("Unknown play mode "+e)}this._playMode=e}subtitleFileName(e=0){return this.subtitleController.subtitleFileNames?.[e]??""}get _imageCaptureParams(){const e=this.video.getBoundingClientRect();return{maxWidth:this.maxImageWidth,maxHeight:this.maxImageHeight,rect:{left:e.left,top:e.top,width:e.width,height:e.height},frameId:this.frameId}}bind(){let e=!1;4===this.video.readyState?(this._bind(),e=!0):this.video.addEventListener("canplay",(t=>{e||(this._bind(),e=!0);const n={sender:"asbplayer-video",message:{command:"readyState",value:4},src:this.video.src};chrome.runtime.sendMessage(n)}))}_bind(){this._notifyReady(),this._subscribe(),this._refreshSettings().then((()=>{this.videoDataSyncController.requestSubtitles()})),this.subtitleController.bind(),this.dragController.bind(this),this.mobileGestureController.bind();const e=e=>{const t=U(e,1e3*this.video.currentTime,this.subtitleController.subtitles);null!==t&&this.seek(t.start/1e3)};this.mobileGestureController.onSwipeLeft=()=>e(!1),this.mobileGestureController.onSwipeRight=()=>e(!0)}_notifyReady(){const e={sender:"asbplayer-video",message:{command:"ready",duration:this.video.duration,currentTime:this.video.currentTime,paused:this.video.paused,audioTracks:void 0,selectedAudioTrack:void 0,playbackRate:this.video.playbackRate},src:this.video.src};chrome.runtime.sendMessage(e)}_subscribe(){this.playListener=e=>{const t={sender:"asbplayer-video",message:{command:"play",echo:!1},src:this.video.src};chrome.runtime.sendMessage(t)},this.pauseListener=e=>{const t={sender:"asbplayer-video",message:{command:"pause",echo:!1},src:this.video.src};chrome.runtime.sendMessage(t)},this.seekedListener=e=>{const t={sender:"asbplayer-video",message:{command:"currentTime",value:this.video.currentTime,echo:!1},src:this.video.src},n={sender:"asbplayer-video",message:{command:"readyState",value:this.video.readyState},src:this.video.src};chrome.runtime.sendMessage(t),chrome.runtime.sendMessage(n),this.subtitleController.autoPauseContext.clear()},this.playbackRateListener=e=>{const t={sender:"asbplayer-video",message:{command:"playbackRate",value:this.video.playbackRate,echo:!1},src:this.video.src};chrome.runtime.sendMessage(t),this._synced&&this._playMode!==f.fastForward&&this.subtitleController.notification("info.playbackRate",{rate:this.video.playbackRate.toFixed(1)})},this.video.addEventListener("play",this.playListener),this.video.addEventListener("pause",this.pauseListener),this.video.addEventListener("seeked",this.seekedListener),this.video.addEventListener("ratechange",this.playbackRateListener),this.subSyncAvailable&&(this.videoChangeListener=()=>{this.videoDataSyncController.requestSubtitles(),this.mobileVideoOverlayController.disposeOverlay()},this.video.addEventListener("loadedmetadata",this.videoChangeListener)),this.heartbeatInterval=setInterval((()=>{const e={sender:"asbplayer-video",message:{command:"heartbeat",subscribed:this.subscribed,synced:this._synced,syncedTimestamp:this._syncedTimestamp,loadedSubtitles:this.subtitleController.subtitles.length>0},src:this.video.src};chrome.runtime.sendMessage(e)}),1e3),window.addEventListener("beforeunload",(e=>{this.heartbeatInterval&&clearInterval(this.heartbeatInterval)})),this.listener=(e,t,n)=>{if("asbplayer-extension-to-video"===e.sender&&e.src===this.video.src){switch(e.message.command){case"init":this._notifyReady();break;case"ready":case"close":case"subtitleSettings":case"ankiSettings":case"miscSettings":case"alert":break;case"play":this.play();break;case"pause":this.pause();break;case"currentTime":const t=e.message;this.seek(t.value);break;case"subtitles":const i=e.message,r=i.value;this._updateSubtitles(r.map(((e,t)=>({...e,index:t}))),i.names||[i.name]);break;case"request-subtitles":n({subtitles:this.subtitleController.subtitles,subtitleFileNames:this.subtitleController.subtitleFileNames??[]});break;case"offset":const s=e.message;this.subtitleController.offset(s.value,!0);break;case"playbackRate":const o=e.message;this.video.playbackRate=o.value;break;case"settings-updated":this._refreshSettings();break;case"copy-subtitle":const l=e.message;if(this._synced){if(void 0!==l.subtitle&&void 0!==l.surroundingSubtitles)this._copySubtitle(l);else if(this.subtitleController.subtitles.length>0){const[e,t]=this.subtitleController.currentSubtitle();null!==e&&null!==t&&this._copySubtitle({...l,subtitle:e,surroundingSubtitles:t})}else this._toggleRecordingMedia(l.postMineAction);this.mobileVideoOverlayController.updateModel()}break;case"toggle-recording":this._synced&&(this._toggleRecordingMedia(u.showAnkiDialog),this.mobileVideoOverlayController.updateModel());break;case"card-updated":case"card-exported":case"card-saved":const c=e.message;let d;switch(c.command){case"card-updated":d="info.updatedCard";break;case"card-exported":d="info.exportedCard";break;case"card-saved":d="info.copiedSubtitle2"}this.subtitleController.notification(d,{result:e.message.cardName}),this.ankiUiSavedState={...c,text:c.text??"",definition:c.definition??"",word:c.word??c.cardName,source:a(this.subtitleFileName(),c.subtitle.start),url:c.url??"",customFieldValues:c.customFieldValues??{},timestampInterval:[c.subtitle.start,c.subtitle.end],initialTimestampInterval:[c.subtitle.start,c.subtitle.end],lastAppliedTimestampIntervalToText:[c.subtitle.start,c.subtitle.end],lastAppliedTimestampIntervalToAudio:[c.subtitle.start,c.subtitle.end],dialogRequestedTimestamp:1e3*this.video.currentTime},this.mobileVideoOverlayController.updateModel();break;case"notify-error":const f=e.message;this.subtitleController.notification("info.error",{message:f.message});break;case"recording-started":this.recordingState=Bn.started;break;case"recording-finished":switch(this.recordingState=Bn.notRecording,this.recordingMediaStartedTimestamp=void 0,this.postMinePlayback){case h.remember:this.wasPlayingBeforeRecordingMedia?this.video.paused||this.mobileVideoOverlayController.hide():this.video.pause();break;case h.play:this.mobileVideoOverlayController.hide();break;case h.pause:this.video.pause()}break;case"show-anki-ui":const p=e.message;this.ankiUiController.show(this,p);break;case"show-anki-ui-after-rerecord":const g=e.message;this.ankiUiController.showAfterRerecord(this,g.uiState);break;case"take-screenshot":this._synced&&(this.ankiUiController.showing?this.ankiUiController.requestRewind(this):this._takeScreenshot());break;case"screenshot-taken":const m=e.message;this.subtitleController.forceHideSubtitles=!1,this.mobileVideoOverlayController.forceHide=!1,this.controlsController.show(),!this.recordingMedia&&m.ankiUiState&&this.ankiUiController.showAfterRetakingScreenshot(this,m.ankiUiState);break;case"request-active-tab-permission":this.notificationController.onClose=()=>{this._notifyRequestingActiveTabPermission(!1)},this.notificationController.show("activeTabPermissionRequest.title","activeTabPermissionRequest.prompt"),this._notifyRequestingActiveTabPermission(!0);break;case"granted-active-tab-permission":this.notificationController.showing&&this.notificationController.show("activeTabPermissionRequest.grantedTitle","activeTabPermissionRequest.grantedPrompt");break;case"load-subtitles":this.showVideoDataDialog(!1);break;case"start-recording-audio-with-timeout":const y=e.message;return this._captureStream().then((e=>this._audioRecorder.startWithTimeout(e,y.timeout,(()=>n(!0))))).then((e=>this._sendAudioBase64(e,y.preferMp3))).then((()=>this._resumeAudioAfterRecording())).catch((e=>{console.error(e instanceof Error?e.message:String(e)),n(!1)})),!0;case"start-recording-audio":return this._captureStream().then((e=>this._audioRecorder.start(e))).then((()=>n(!0))).then((()=>this._resumeAudioAfterRecording())).catch((e=>{console.error(e instanceof Error?e.message:String(e)),n(!1)})),!0;case"stop-recording-audio":const b=e.message;this._audioRecorder.stop().then((e=>this._sendAudioBase64(e,b.preferMp3)));break;case"notification-dialog":const v=e.message;this.notificationController.show(v.titleLocKey,v.messageLocKey)}if("messageId"in e.message){const t={sender:"asbplayer-video",message:{command:"ack-message",messageId:e.message.messageId},src:this.video.src};chrome.runtime.sendMessage(t)}}},chrome.runtime.onMessage.addListener(this.listener),this.subscribed=!0}async _refreshSettings(){const e=await this.settings.getAll();var t;this._speedChangeStep=e.speedChangeStep,this.recordMedia=e.streamingRecordMedia,this.takeScreenshot=e.streamingTakeScreenshot,this.cleanScreenshot=e.streamingTakeScreenshot&&e.streamingCleanScreenshot,this.condensedPlaybackMinimumSkipIntervalMs=e.streamingCondensedPlaybackMinimumSkipIntervalMs,this.fastForwardModePlaybackRate=e.fastForwardModePlaybackRate,this.imageDelay=e.streamingScreenshotDelay,this.audioPaddingStart=e.audioPaddingStart,this.audioPaddingEnd=e.audioPaddingEnd,this.maxImageWidth=e.maxImageWidth,this.maxImageHeight=e.maxImageHeight,this.copyToClipboardOnMine=e.copyToClipboardOnMine,this.autoPausePreference=e.autoPausePreference,this.alwaysPlayOnSubtitleRepeat=e.alwaysPlayOnSubtitleRepeat,this.subtitleController.displaySubtitles=e.streamingDisplaySubtitles,this.subtitleController.subtitlePositionOffset=e.subtitlePositionOffset,this.subtitleController.subtitleAlignment=e.subtitleAlignment,this.subtitleController.surroundingSubtitlesCountRadius=e.surroundingSubtitlesCountRadius,this.subtitleController.surroundingSubtitlesTimeRadius=e.surroundingSubtitlesTimeRadius,this.subtitleController.autoCopyCurrentSubtitle=e.autoCopyCurrentSubtitle,this.subtitleController.preCacheDom=e.preCacheSubtitleDom,this.subtitleController.setSubtitleSettings(e),this.subtitleController.refresh(),this.videoDataSyncController.updateSettings(e),this.ankiUiController.ankiSettings=(t=e,Object.fromEntries(H.map((e=>[e,t[e]])))),this.postMinePlayback=e.postMiningPlaybackState,this.keyBindings.setKeyBindSet(this,e.keyBindSet),e.streamingSubsDragAndDrop?this.dragController.bind(this):this.dragController.unbind(),e.streamingEnableOverlay?(this.mobileVideoOverlayController.offsetAnchor="bottom"===e.subtitleAlignment?Ze.top:Ze.bottom,this.mobileVideoOverlayController.bind(),this.mobileVideoOverlayController.updateModel()):this.mobileVideoOverlayController.unbind(),await(async e=>{if(Rn){if(await Rn,!(e in In)){const t=await je(e);hn.addResourceBundle(t.lang,"translation",t.strings),In[e]=t.lang}const t=In[e];hn.language!==t&&hn.changeLanguage(t)}else Rn=new Promise((async(t,n)=>{try{const n=await je(e);hn.init({resources:{[n.lang]:{translation:n.strings}},lng:n.lang,fallbackLng:n.lang,debug:!1,ns:"translation",defaultNS:"translation",interpolation:{escapeValue:!1}}),In[e]=n.lang,t()}catch(e){n(e)}})),await Rn})(e.language)}unbind(){this.playListener&&(this.video.removeEventListener("play",this.playListener),this.playListener=void 0),this.pauseListener&&(this.video.removeEventListener("pause",this.pauseListener),this.pauseListener=void 0),this.seekedListener&&(this.video.removeEventListener("seeked",this.seekedListener),this.seekedListener=void 0),this.playbackRateListener&&(this.video.removeEventListener("ratechange",this.playbackRateListener),this.playbackRateListener=void 0),this.videoChangeListener&&(this.video.removeEventListener("loadedmetadata",this.videoChangeListener),this.videoChangeListener=void 0),this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=void 0),this.listener&&(chrome.runtime.onMessage.removeListener(this.listener),this.listener=void 0),this.subtitleController.unbind(),this.dragController.unbind(),this.keyBindings.unbind(),this.videoDataSyncController.unbind(),this.mobileVideoOverlayController.unbind(),this.mobileGestureController.unbind(),this.notificationController.unbind(),this.subscribed=!1;const e={sender:"asbplayer-video",message:{command:"video-disappeared"},src:this.video.src};chrome.runtime.sendMessage(e)}async _takeScreenshot(){if(!this.takeScreenshot)return;await this._prepareScreenshot();const e={sender:"asbplayer-video",message:{command:"take-screenshot",ankiUiState:this.ankiUiSavedState,...this._imageCaptureParams,subtitleFileName:this.subtitleFileName(),mediaTimestamp:1e3*this.video.currentTime},src:this.video.src};chrome.runtime.sendMessage(e),this.ankiUiSavedState=void 0}async _copySubtitle({postMineAction:e,subtitle:t,surroundingSubtitles:n,text:i,definition:r,word:s,customFieldValues:o}){if(!t||!n)return;if(this.recordMedia&&this.recordingMedia)return;if(this.copyToClipboardOnMine&&navigator.clipboard.writeText(t.text),this.takeScreenshot&&await this._prepareScreenshot(),this.recordMedia){this.recordingState=Bn.requested,this.wasPlayingBeforeRecordingMedia=!this.video.paused,this.recordingMediaStartedTimestamp=1e3*this.video.currentTime,this.recordingMediaWithScreenshot=this.takeScreenshot;const e=Math.max(0,t.start-this.audioPaddingStart);this.seek(e/1e3),await this.play()}i&&!t.text.includes(i.trim())||(i=function(e,t,n){if(0===t.length)return e.text;const i=[e.start,e.end];return r=t.filter((e=>function(e,t){const n=Math.max(0,e.end-e.start);if(0===n)return!1;const i=Math.max(e.start,t[0]);return Math.min(e.end,t[1])-i>=n/2}(e,i))).filter((e=>void 0===n||e.track===n)),r.filter((e=>""!==e.text.trim())).map((e=>e.text)).join("\n");var r}(t,n));const a={sender:"asbplayer-video",message:{command:"record-media-and-forward-subtitle",subtitle:t,surroundingSubtitles:n,record:this.recordMedia,screenshot:this.takeScreenshot,url:this.url,mediaTimestamp:1e3*this.video.currentTime,subtitleFileName:this.subtitleFileName(t.track),postMineAction:e,audioPaddingStart:this.audioPaddingStart,audioPaddingEnd:this.audioPaddingEnd,imageDelay:this.imageDelay,playbackRate:this.video.playbackRate,text:i,definition:r,word:s,customFieldValues:o,...this._imageCaptureParams},src:this.video.src};chrome.runtime.sendMessage(a)}async _toggleRecordingMedia(e){if(this.recordingState!==Bn.requested)if(this.recordingState===Bn.started){const t=1e3*this.video.currentTime,n={sender:"asbplayer-video",message:{command:"stop-recording-media",postMineAction:e,startTimestamp:this.recordingMediaStartedTimestamp,endTimestamp:t,playbackRate:this.video.playbackRate,screenshot:this.recordingMediaWithScreenshot,videoDuration:1e3*this.video.duration,url:this.url,subtitleFileName:this.subtitleFileName(),...this._imageCaptureParams,...this._surroundingSubtitlesAroundInterval(this.recordingMediaStartedTimestamp,t)},src:this.video.src};chrome.runtime.sendMessage(n)}else{this.ankiUiSavedState=void 0,this.takeScreenshot&&await this._prepareScreenshot();const t=1e3*this.video.currentTime;this.recordMedia&&(this.recordingState=Bn.requested,this.wasPlayingBeforeRecordingMedia=!this.video.paused,this.recordingMediaStartedTimestamp=t,this.recordingMediaWithScreenshot=this.takeScreenshot,this.video.paused&&await this.play());const n={sender:"asbplayer-video",message:{command:"start-recording-media",mediaTimestamp:t,record:this.recordMedia,postMineAction:e,screenshot:this.takeScreenshot,url:this.url,subtitleFileName:this.subtitleFileName(),imageDelay:this.imageDelay,...this._imageCaptureParams},src:this.video.src};chrome.runtime.sendMessage(n)}}_surroundingSubtitlesAroundInterval(t,n){return function(t,n,r,o,a){if(0===t.length)return{};let l=0;const c=i(t,n,e.forward)??t.length-1;for(let e=0;e<t.length&&(l=e,!s(t,e,o,a,n,c));++e);let u=t.length-1;const h=i(t,r,e.backward)??0;for(let e=t.length-1;e>=0&&(u=e,!s(t,e,o,a,r,h));--e);return u<=l?{}:{surroundingSubtitles:t.slice(l,u+1),subtitle:t[c]}}(this.subtitleController.subtitles,t,n,this.ankiUiController.ankiSettings.surroundingSubtitlesCountRadius,this.ankiUiController.ankiSettings.surroundingSubtitlesTimeRadius)}async _prepareScreenshot(){this.cleanScreenshot&&(this.notificationController.hide(),this.subtitleController.forceHideSubtitles=!0,this.mobileVideoOverlayController.forceHide=!0,await this.controlsController.hide())}async rerecord(e,t,n){if(this.recordingMedia)return;const i=0===this.subtitleController.subtitles.length,r=i?0:this.audioPaddingStart,s=i?0:this.audioPaddingEnd;this.recordingState=Bn.requested,this.recordingMediaStartedTimestamp=1e3*this.video.currentTime,this.seek(Math.max(0,e-r)/1e3),await this.play();const o={sender:"asbplayer-video",message:{command:"rerecord-media",duration:t-e,uiState:n,audioPaddingStart:r,audioPaddingEnd:s,playbackRate:this.video.playbackRate,timestamp:e,subtitleFileName:this.subtitleFileName()},src:this.video.src};chrome.runtime.sendMessage(o)}seek(e){var t,n;Dn?document.dispatchEvent(new CustomEvent("asbplayer-netflix-seek",{detail:1e3*e})):(n=e,(t=this.video).currentTime=n,t.currentTime<n&&(t.currentTime=Math.min(t.duration,t.currentTime+.01)),t.currentTime)}async play(){if(Dn)await this._playNetflix();else try{await this.video.play()}catch(e){if(4!==this.video.readyState)return new Promise(((e,t)=>{const n=async t=>{for(let e=0;e<3;++e)try{await this.video.play();break}catch(e){console.error(e)}e(void 0),this.video.removeEventListener("canplay",n)};this.video.addEventListener("canplay",n)}))}}_playNetflix(){return new Promise(((e,t)=>{const n=async t=>{this.video.removeEventListener("play",n),this.video.removeEventListener("playing",n),e(void 0)};this.video.addEventListener("play",n),this.video.addEventListener("playing",n),document.dispatchEvent(new CustomEvent("asbplayer-netflix-play"))}))}pause(){Dn?document.dispatchEvent(new CustomEvent("asbplayer-netflix-pause")):this.video.pause()}bindVideoSelect(e){this.videoDataSyncController.bindVideoSelect(e)}unbindVideoSelect(){this.videoDataSyncController.unbindVideoSelect()}showVideoDataDialog(e){this.videoDataSyncController.show({userRequested:!0,openedFromMiningCommand:e})}async cropAndResize(e){const t=this.video.getBoundingClientRect(),n=this.maxImageWidth,i=this.maxImageHeight;return await l(n,i,t,e)}async loadSubtitles(e,t){const{streamingSubtitleListPreference:n,subtitleRegexFilter:i,subtitleRegexFilterTextReplacement:r,rememberSubtitleOffset:s,lastSubtitleOffset:o}=await this.settings.get(["streamingSubtitleListPreference","subtitleRegexFilter","subtitleRegexFilterTextReplacement","rememberSubtitleOffset","lastSubtitleOffset"]);switch(n){case W.noSubtitleList:const n=new Le({regexFilter:i,regexFilterTextReplacement:r,pgsWorkerFactory:async()=>{const e=await(await fetch(chrome.runtime.getURL("./pgs-parser-worker.js"))).text(),t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}}),a=s?o:0,l=await n.subtitles(e,t);this._updateSubtitles(l.map(((e,t)=>({start:e.start+a,end:e.end+a,text:e.text,textImage:e.textImage,track:e.track,index:t,originalStart:e.start,originalEnd:e.end}))),e.map((e=>e.name)));break;case W.app:const c={sender:"asbplayer-video",message:{command:"sync",subtitles:await Promise.all(e.map((async e=>{const t=await fn(await e.arrayBuffer());return{name:e.name,base64:t}})))},src:this.video.src};chrome.runtime.sendMessage(c)}}_updateSubtitles(e,t){this.subtitleController.subtitles=e,this.subtitleController.subtitleFileNames=t,this.subtitleController.cacheHtml(),this._playMode===f.normal||e&&0!==e.length||(this.playMode=f.normal);let n=[];for(let t=0;t<e.length;t++)n.includes(e[t].track)||n.push(e[t].track);this.subtitleController.showLoadedMessage(n),this.videoDataSyncController.unbindVideoSelect(),this.ankiUiSavedState=void 0,this._synced=!0,this._syncedTimestamp=Date.now(),this.video.paused&&this.mobileVideoOverlayController.show(),this.mobileVideoOverlayController.updateModel(),!Nn&&e.length>0&&this.settings.get(["streamingDisplaySubtitles","keyBindSet"]).then((({streamingDisplaySubtitles:e,keyBindSet:t})=>{!e&&t.toggleSubtitles.keys&&this.subtitleController.notification("info.toggleSubtitlesShortcut",{keys:t.toggleSubtitles.keys})})),(async()=>{const e=(await chrome.storage.local.get({[Mn]:!1}))[Mn];return e&&(await chrome.storage.local.remove(Mn),await chrome.storage.local.set({lastUpdateAlertVersion:chrome.runtime.getManifest().version})),e})().then((e=>{e&&this.notificationController.updateAlert(chrome.runtime.getManifest().version)}))}_captureStream(){return new Promise(((e,t)=>{try{let n;if("function"==typeof this.video.captureStream&&(n=this.video.captureStream()),"function"==typeof this.video.mozCaptureStreamUntilEnded&&(n=this.video.mozCaptureStreamUntilEnded()),void 0===n)return void t(new Error("Unable to capture stream from audio"));const i=new MediaStream;for(const e of n.getVideoTracks())e.stop();for(const e of n.getAudioTracks())e.enabled&&i.addTrack(e);e(i)}catch(e){t(e)}}))}async _resumeAudioAfterRecording(){const e=await this._captureStream(),t=new AudioContext;t.createMediaStreamSource(e).connect(t.destination)}async _sendAudioBase64(e,t){if(t){const t=await(await fetch("data:audio/webm;base64,"+e)).blob(),n=await m.encode(t,(async()=>{const e=await(await fetch(chrome.runtime.getURL("./mp3-encoder-worker.js"))).text(),t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}));e=fn(await n.arrayBuffer())}const n={sender:"asbplayer-video",message:{command:"audio-base64",base64:e},src:this.video.src};chrome.runtime.sendMessage(n)}_notifyRequestingActiveTabPermission(e){const t={sender:"asbplayer-video",message:{command:"requesting-active-tab-permission",requesting:e},src:this.video.src};chrome.runtime.sendMessage(t)}}class Vn{constructor(e){this._settings=new J(new Ie),this._bindings=e,this._frame=new $e((async e=>`<!DOCTYPE html>\n                <html lang="en">\n                <head>\n                    <meta charset="utf-8" />\n                    <meta name="viewport" content="width=device-width, initial-scale=1" />\n                    <title>asbplayer - Video Select</title>\n                    <style>\n                        @import url(${chrome.runtime.getURL("./assets/fonts.css")});\n                    </style>\n                </head>\n                <body>\n                    <div id="root" style="width:100%;height:100vh;"></div>\n                    <script type="application/json" id="loc">${JSON.stringify(await je(e))}<\/script>\n                    <script src="${chrome.runtime.getURL("./video-select-ui.js")}"><\/script>\n                </body>\n            </html>`))}bind(){this.messageListener=(e,t,n)=>{if("asbplayer-extension-to-video"===e.sender)switch(e.message.command){case"toggle-video-select":this._trigger(!1);break;case"copy-subtitle":case"toggle-recording":case"take-screenshot":void 0===this._bindings.find((e=>e.synced))&&this._trigger(!0);break;case"subtitles":this._hideUi()}},chrome.runtime.onMessage.addListener(this.messageListener)}unbind(){this._frame.unbind(),this.messageListener&&(chrome.runtime.onMessage.removeListener(this.messageListener),this.messageListener=void 0)}async _trigger(e){if(1===this._bindings.length){const t=this._bindings[0];t.subscribed&&t.showVideoDataDialog(e)}else this._bindings.length>1&&this._showUi(e)}async _showUi(e){const t=await chrome.runtime.sendMessage({sender:"asbplayer-foreground",message:{command:"capture-visible-tab"}}),n=this._bindings.map((async e=>({src:e.video.src,imageDataUrl:await e.cropAndResize(t)}))),i=[];for(const e of n)i.push(await e);const r=await this._prepareAndShowFrame(),s=await this._settings.getSingle("themeType");r.updateState({open:!0,themeType:s,videoElements:i,openedFromMiningCommand:e})}async _prepareAndShowFrame(){this._frame.language=await this._settings.getSingle("language");const e=await this._frame.bind(),t=await this._frame.client();return e&&t.onMessage((e=>{"confirm"===e.command?(t.updateState({open:!1}),this._frame.hide(),this._bindings.find((t=>t.video.src===e.selectedVideoElementSrc))?.showVideoDataDialog(!1)):"cancel"===e.command&&(t.updateState({open:!1}),this._frame.hide())})),this._frame.show(),t}async _hideUi(){this._frame.hidden||((await this._frame.client()).updateState({open:!1}),this._frame.hide())}}var Hn=new Uint8Array(16);function zn(){if(!$n&&!($n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $n(Hn)}const Wn=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var qn=[],Zn=0;Zn<256;++Zn)qn.push((Zn+256).toString(16).substr(1));const Xn=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(qn[e[t+0]]+qn[e[t+1]]+qn[e[t+2]]+qn[e[t+3]]+"-"+qn[e[t+4]]+qn[e[t+5]]+"-"+qn[e[t+6]]+qn[e[t+7]]+"-"+qn[e[t+8]]+qn[e[t+9]]+"-"+qn[e[t+10]]+qn[e[t+11]]+qn[e[t+12]]+qn[e[t+13]]+qn[e[t+14]]+qn[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&Wn.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},Kn=function(e,t,n){var i=(e=e||{}).random||(e.rng||zn)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=i[r];return t}return Xn(i)};class Gn{constructor(){this.frameId=Kn(),this._bound=!1}bind(){this._bound||(this._broadcastInterval=setInterval((()=>this._broadcast()),1e4),this._broadcast(),this._bound=!0)}_broadcast(){window.parent.postMessage({sender:"asbplayer-video",message:{frameId:this.frameId}},"*")}unbind(){void 0!==this._broadcastInterval&&(clearInterval(this._broadcastInterval),this._broadcastInterval=void 0),this._bound=!1}}class Yn{constructor(){this.iframesById={},this._bound=!1}bind(){this._bound||(this._listener=e=>{if("asbplayer-video"!==e.data?.sender)return;const t=this._sourceIframeForEvent(e);if(void 0===t)return;const n=e.data.message.frameId;n&&(this.iframesById[n]=t)},window.addEventListener("message",this._listener),this._bound=!0)}unbind(){void 0!==this._listener&&(window.removeEventListener("message",this._listener),this._listener=void 0),this._bound=!1}_sourceIframeForEvent(e){const t=document.getElementsByTagName("iframe");for(const n of t)if(n.contentWindow===e.source)return n}}async function Jn(e){const t=await(await fetch(chrome.runtime.getURL("./mp3-encoder-worker.js"))).text();return`<!DOCTYPE html>\n                <html lang="en">\n                <head>\n                    <meta charset="utf-8" />\n                    <meta name="viewport" content="width=device-width, initial-scale=1" />\n                    <title>asbplayer - Anki</title>\n                    <style>\n                        @import url(${chrome.runtime.getURL("./assets/fonts.css")});\n                    </style>\n                </head>\n                <body>\n                    <div id="root" style="width:100%;height:100vh;"></div>\n                    <script type="application/json" id="loc">${JSON.stringify(await je(e))}<\/script>\n                    <script id="mp3-encoder-worker" type="javascript/worker">${t}<\/script>\n                    <script src="${chrome.runtime.getURL("./anki-ui.js")}"><\/script>\n                </body>\n            </html>`}class Qn{constructor(e){this._frame=new $e(Jn),this._settings=e}async show(e){const{themeType:t,language:n,...i}=await this._settings.get(["themeType","language",...H]),r=await this._client(n,i),s={type:"initial",open:!0,canRerecord:!1,settingsProvider:i,source:a(e.subtitleFileName,e.mediaTimestamp??0),themeType:t,dialogRequestedTimestamp:0,...e};r.updateState(s)}async updateSettings(){const e=await this._settings.get([...H]);this._frame.bound&&this._frame.client().then((t=>t.sendMessage({command:"ankiSettings",value:e})))}async _client(e,t){this._frame.fetchOptions={allowedFetchUrl:t.ankiConnectUrl},this._frame.language=e;const n=await this._frame.bind(),i=await this._frame.client();return n&&i.onMessage((e=>{switch(e.command){case"openSettings":const t={sender:"asbplayer-video-tab",message:{command:"open-asbplayer-settings"}};return void chrome.runtime.sendMessage(t);case"copy-to-clipboard":const n={sender:"asbplayer-video-tab",message:{command:"copy-to-clipboard",dataUrl:e.dataUrl}};return void chrome.runtime.sendMessage(n);case"resume":return void this._frame.hide()}})),this._frame.show(),i}unbind(){this._frame.unbind()}}const ei=[],ti=[],ni=()=>{if((()=>{let e=0;for(;e<ei.length;){const t=ei[e];document.contains(t)&&t.shadowRoot?++e:ei.splice(e,1)}})(),0===ti.length){if(ei.length>0)return;ti.push(document)}let e=0;for(;ti.length>0&&++e<100;){const e=ti.pop();if(e){e.shadowRoot&&ei.push(e);for(const t of e.childNodes)ti.push(t)}}},ii=new Ie,ri=new J(ii);let si;const oi=()=>{ri.getSingle("keyBindSet").then((e=>{si?.(),si=new V(e).bindToggleSidePanel((e=>{e.preventDefault(),e.stopImmediatePropagation(),chrome.runtime.sendMessage({sender:"asbplayer-video-tab",message:{command:"toggle-side-panel"}})}),(()=>!1),!0)}))},ai=(e,t)=>{if(t?.config?.allowBlankSrc)return!0;if(e.src)return!0;for(let t=0,n=e.children.length;t<n;t++){const n=e.children[t];if("SOURCE"===n.tagName&&n.src)return!0}return!1},li=()=>{const e=[],t=gn();let n,i,r=void 0!==t?.config.script;const s=window.self===window.top;s?(n=new Yn,n.bind()):i=new Gn;const o=()=>{const n=[...document.getElementsByTagName("video")];for(const e of ei)if(e.shadowRoot)for(const t of e.shadowRoot.querySelectorAll("video"))n.push(t);for(let s=0;s<n.length;++s){const o=n[s];if(!(e.filter((e=>e.video.isSameNode(o))).length>0)&&ai(o,t)&&!t?.shouldIgnore(o)){const t=new Un(o,r,i?.frameId);t.bind(),e.push(t)}}for(let i=e.length-1;i>=0;--i){const r=e[i];let s=!1;for(let e=0;e<n.length;++e){const i=n[e];if(i.isSameNode(r.video)&&ai(i,t)){s=!0;break}}s||(e.splice(i,1),r.unbind())}0===e.length?i?.unbind():i?.bind()};o();const a=setInterval(o,1e3),c=t?.config.searchShadowRoots?setInterval(ni,100):void 0,u=new Vn(e);u.bind();const h=new Qn(ri);s&&oi();const d=(e,t,i)=>{if(s&&"asbplayer-extension-to-video"===e.sender)switch(e.message.command){case"copy-to-clipboard":const t=e.message;fetch(t.dataUrl).then((e=>e.blob())).then((e=>{navigator.clipboard.write([new ClipboardItem({[e.type]:e})]).catch(console.error)}));break;case"crop-and-resize":const r=e.message;let s=r.rect;if(void 0!==r.frameId){const e=n?.iframesById?.[r.frameId];if(void 0!==e){const t=e.getBoundingClientRect();s={left:s.left+t.left,top:s.top+t.top,width:s.width,height:s.height}}}return l(r.maxWidth,r.maxHeight,s,r.dataUrl).then((e=>i({dataUrl:e}))),!0;case"show-anki-ui":void 0===e.src&&h.show(e.message);break;case"settings-updated":oi(),h.updateSettings()}};chrome.runtime.onMessage.addListener(d),window.addEventListener("beforeunload",(t=>{for(let t of e)t.unbind();e.length=0,clearInterval(a),void 0!==c&&clearInterval(c),u.unbind(),n?.unbind(),i?.unbind(),si?.(),chrome.runtime.onMessage.removeListener(d)}))};"complete"===document.readyState?li():document.addEventListener("readystatechange",(e=>{"complete"===document.readyState&&li()}))})()})();