/*! For license information please see background.js.LICENSE.txt */
(()=>{var e={8608:(e,t,r)=>{"use strict";var n=r(4663),i=r(1413),s=i(n("String.prototype.indexOf"));e.exports=function(e,t){var r=n(e,!!t);return"function"==typeof r&&s(e,".prototype.")>-1?i(r):r}},1413:(e,t,r)=>{"use strict";var n=r(4672),i=r(4663),s=r(7319),a=i("%TypeError%"),o=i("%Function.prototype.apply%"),c=i("%Function.prototype.call%"),l=i("%Reflect.apply%",!0)||n.call(c,o),u=i("%Object.defineProperty%",!0),d=i("%Math.max%");if(u)try{u({},"a",{value:1})}catch(e){u=null}e.exports=function(e){if("function"!=typeof e)throw new a("a function is required");var t=l(n,c,arguments);return s(t,1+d(0,e.length-(arguments.length-1)),!0)};var h=function(){return l(n,o,arguments)};u?u(e.exports,"apply",{value:h}):e.exports.apply=h},8531:(e,t,r)=>{"use strict";var n=r(3219)(),i=r(4663),s=n&&i("%Object.defineProperty%",!0);if(s)try{s({},"a",{value:1})}catch(e){s=!1}var a=i("%SyntaxError%"),o=i("%TypeError%"),c=r(8337);e.exports=function(e,t,r){if(!e||"object"!=typeof e&&"function"!=typeof e)throw new o("`obj` must be an object or a function`");if("string"!=typeof t&&"symbol"!=typeof t)throw new o("`property` must be a string or a symbol`");if(arguments.length>3&&"boolean"!=typeof arguments[3]&&null!==arguments[3])throw new o("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&"boolean"!=typeof arguments[4]&&null!==arguments[4])throw new o("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&"boolean"!=typeof arguments[5]&&null!==arguments[5])throw new o("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&"boolean"!=typeof arguments[6])throw new o("`loose`, if provided, must be a boolean");var n=arguments.length>3?arguments[3]:null,i=arguments.length>4?arguments[4]:null,l=arguments.length>5?arguments[5]:null,u=arguments.length>6&&arguments[6],d=!!c&&c(e,t);if(s)s(e,t,{configurable:null===l&&d?d.configurable:!l,enumerable:null===n&&d?d.enumerable:!n,value:r,writable:null===i&&d?d.writable:!i});else{if(!u&&(n||i||l))throw new a("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.");e[t]=r}}},3351:e=>{"use strict";var t=Object.prototype.toString,r=Math.max,n=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var i=0;i<t.length;i+=1)r[i+e.length]=t[i];return r};e.exports=function(e){var i=this;if("function"!=typeof i||"[object Function]"!==t.apply(i))throw new TypeError("Function.prototype.bind called on incompatible "+i);for(var s,a=function(e,t){for(var r=[],n=1,i=0;n<e.length;n+=1,i+=1)r[i]=e[n];return r}(arguments),o=r(0,i.length-a.length),c=[],l=0;l<o;l++)c[l]="$"+l;if(s=Function("binder","return function ("+function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=",");return r}(c)+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof s){var t=i.apply(this,n(a,arguments));return Object(t)===t?t:this}return i.apply(e,n(a,arguments))})),i.prototype){var u=function(){};u.prototype=i.prototype,s.prototype=new u,u.prototype=null}return s}},4672:(e,t,r)=>{"use strict";var n=r(3351);e.exports=Function.prototype.bind||n},4663:(e,t,r)=>{"use strict";var n,i=SyntaxError,s=Function,a=TypeError,o=function(e){try{return s('"use strict"; return ('+e+").constructor;")()}catch(e){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(e){c=null}var l=function(){throw new a},u=c?function(){try{return l}catch(e){try{return c(arguments,"callee").get}catch(e){return l}}}():l,d=r(4573)(),h=r(8912)(),p=Object.getPrototypeOf||(h?function(e){return e.__proto__}:null),f={},m="undefined"!=typeof Uint8Array&&p?p(Uint8Array):n,y={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":d&&p?p([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":f,"%AsyncGenerator%":f,"%AsyncGeneratorFunction%":f,"%AsyncIteratorPrototype%":f,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?n:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":s,"%GeneratorFunction%":f,"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&p?p(p([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&d&&p?p((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&d&&p?p((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&p?p(""[Symbol.iterator]()):n,"%Symbol%":d?Symbol:n,"%SyntaxError%":i,"%ThrowTypeError%":u,"%TypedArray%":m,"%TypeError%":a,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet};if(p)try{null.error}catch(e){var g=p(p(e));y["%Error.prototype%"]=g}var b=function e(t){var r;if("%AsyncFunction%"===t)r=o("async function () {}");else if("%GeneratorFunction%"===t)r=o("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=o("async function* () {}");else if("%AsyncGenerator%"===t){var n=e("%AsyncGeneratorFunction%");n&&(r=n.prototype)}else if("%AsyncIteratorPrototype%"===t){var i=e("%AsyncGenerator%");i&&p&&(r=p(i.prototype))}return y[t]=r,r},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},w=r(4672),_=r(2907),A=w.call(Function.call,Array.prototype.concat),x=w.call(Function.apply,Array.prototype.splice),S=w.call(Function.call,String.prototype.replace),k=w.call(Function.call,String.prototype.slice),F=w.call(Function.call,RegExp.prototype.exec),P=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,E=/\\(\\)?/g,O=function(e,t){var r,n=e;if(_(v,n)&&(n="%"+(r=v[n])[0]+"%"),_(y,n)){var s=y[n];if(s===f&&(s=b(n)),void 0===s&&!t)throw new a("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:n,value:s}}throw new i("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new a('"allowMissing" argument must be a boolean');if(null===F(/^%?[^%]*%?$/,e))throw new i("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=function(e){var t=k(e,0,1),r=k(e,-1);if("%"===t&&"%"!==r)throw new i("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new i("invalid intrinsic syntax, expected opening `%`");var n=[];return S(e,P,(function(e,t,r,i){n[n.length]=r?S(i,E,"$1"):t||e})),n}(e),n=r.length>0?r[0]:"",s=O("%"+n+"%",t),o=s.name,l=s.value,u=!1,d=s.alias;d&&(n=d[0],x(r,A([0,1],d)));for(var h=1,p=!0;h<r.length;h+=1){var f=r[h],m=k(f,0,1),g=k(f,-1);if(('"'===m||"'"===m||"`"===m||'"'===g||"'"===g||"`"===g)&&m!==g)throw new i("property names with quotes must have matching quotes");if("constructor"!==f&&p||(u=!0),_(y,o="%"+(n+="."+f)+"%"))l=y[o];else if(null!=l){if(!(f in l)){if(!t)throw new a("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&h+1>=r.length){var b=c(l,f);l=(p=!!b)&&"get"in b&&!("originalValue"in b.get)?b.get:l[f]}else p=_(l,f),l=l[f];p&&!u&&(y[o]=l)}}return l}},8337:(e,t,r)=>{"use strict";var n=r(4663)("%Object.getOwnPropertyDescriptor%",!0);if(n)try{n([],"length")}catch(e){n=null}e.exports=n},3219:(e,t,r)=>{"use strict";var n=r(4663)("%Object.defineProperty%",!0),i=function(){if(n)try{return n({},"a",{value:1}),!0}catch(e){return!1}return!1};i.hasArrayLengthDefineBug=function(){if(!i())return null;try{return 1!==n([],"length",{value:1}).length}catch(e){return!0}},e.exports=i},8912:e=>{"use strict";var t={foo:{}},r=Object;e.exports=function(){return{__proto__:t}.foo===t.foo&&!({__proto__:null}instanceof r)}},4573:(e,t,r)=>{"use strict";var n="undefined"!=typeof Symbol&&Symbol,i=r(4283);e.exports=function(){return"function"==typeof n&&"function"==typeof Symbol&&"symbol"==typeof n("foo")&&"symbol"==typeof Symbol("bar")&&i()}},4283:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(e,t);if(42!==i.value||!0!==i.enumerable)return!1}return!0}},2907:(e,t,r)=>{"use strict";var n=Function.prototype.call,i=Object.prototype.hasOwnProperty,s=r(4672);e.exports=s.call(n,i)},9427:(e,t,r)=>{"use strict";var n=r(1020),i=n.ValidatorResult,s=n.SchemaError,a={ignoreProperties:{id:!0,default:!0,description:!0,title:!0,additionalItems:!0,then:!0,else:!0,$schema:!0,$ref:!0,extends:!0}},o=a.validators={};function c(e,t,r,n,i){var s=t.throwError,a=t.throwAll;t.throwError=!1,t.throwAll=!1;var o=this.validateSchema(e,i,t,r);return t.throwError=s,t.throwAll=a,!o.valid&&n instanceof Function&&n(o),o.valid}function l(e,t){if(Object.hasOwnProperty.call(e,t))return e[t];if(t in e)for(;e=Object.getPrototypeOf(e);)if(Object.propertyIsEnumerable.call(e,t))return e[t]}function u(e,t,r,n,i,s){if(this.types.object(e)&&(!t.properties||void 0===t.properties[i]))if(!1===t.additionalProperties)s.addError({name:"additionalProperties",argument:i,message:"is not allowed to have the additional property "+JSON.stringify(i)});else{var a=t.additionalProperties||{};"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,i,a,r,n);var o=this.validateSchema(e[i],a,r,n.makeChild(a,i));o.instance!==s.instance[i]&&(s.instance[i]=o.instance),s.importErrors(o)}}o.type=function(e,t,r,n){if(void 0===e)return null;var s=new i(e,t,r,n),a=Array.isArray(t.type)?t.type:[t.type];if(!a.some(this.testType.bind(this,e,t,r,n))){var o=a.map((function(e){if(e){var t=e.$id||e.id;return t?"<"+t+">":e+""}}));s.addError({name:"type",argument:o,message:"is not of a type(s) "+o})}return s},o.anyOf=function(e,t,r,n){if(void 0===e)return null;var a=new i(e,t,r,n),o=new i(e,t,r,n);if(!Array.isArray(t.anyOf))throw new s("anyOf must be an array");if(!t.anyOf.some(c.bind(this,e,r,n,(function(e){o.importErrors(e)})))){var l=t.anyOf.map((function(e,t){var r=e.$id||e.id;return r?"<"+r+">":e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));r.nestedErrors&&a.importErrors(o),a.addError({name:"anyOf",argument:l,message:"is not any of "+l.join(",")})}return a},o.allOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.allOf))throw new s("allOf must be an array");var a=new i(e,t,r,n),o=this;return t.allOf.forEach((function(t,i){var s=o.validateSchema(e,t,r,n);if(!s.valid){var c=t.$id||t.id||t.title&&JSON.stringify(t.title)||t.$ref&&"<"+t.$ref+">"||"[subschema "+i+"]";a.addError({name:"allOf",argument:{id:c,length:s.errors.length,valid:s},message:"does not match allOf schema "+c+" with "+s.errors.length+" error[s]:"}),a.importErrors(s)}})),a},o.oneOf=function(e,t,r,n){if(void 0===e)return null;if(!Array.isArray(t.oneOf))throw new s("oneOf must be an array");var a=new i(e,t,r,n),o=new i(e,t,r,n),l=t.oneOf.filter(c.bind(this,e,r,n,(function(e){o.importErrors(e)}))).length,u=t.oneOf.map((function(e,t){return e.$id||e.id||e.title&&JSON.stringify(e.title)||e.$ref&&"<"+e.$ref+">"||"[subschema "+t+"]"}));return 1!==l&&(r.nestedErrors&&a.importErrors(o),a.addError({name:"oneOf",argument:u,message:"is not exactly one from "+u.join(",")})),a},o.if=function(e,t,r,s){if(void 0===e)return null;if(!n.isSchema(t.if))throw new Error('Expected "if" keyword to be a schema');var a,o=c.call(this,e,r,s,null,t.if),l=new i(e,t,r,s);if(o){if(void 0===t.then)return;if(!n.isSchema(t.then))throw new Error('Expected "then" keyword to be a schema');a=this.validateSchema(e,t.then,r,s.makeChild(t.then)),l.importErrors(a)}else{if(void 0===t.else)return;if(!n.isSchema(t.else))throw new Error('Expected "else" keyword to be a schema');a=this.validateSchema(e,t.else,r,s.makeChild(t.else)),l.importErrors(a)}return l},o.propertyNames=function(e,t,r,a){if(this.types.object(e)){var o=new i(e,t,r,a),c=void 0!==t.propertyNames?t.propertyNames:{};if(!n.isSchema(c))throw new s('Expected "propertyNames" to be a schema (object or boolean)');for(var u in e)if(void 0!==l(e,u)){var d=this.validateSchema(u,c,r,a.makeChild(c));o.importErrors(d)}return o}},o.properties=function(e,t,r,n){if(this.types.object(e)){var a=new i(e,t,r,n),o=t.properties||{};for(var c in o){var u=o[c];if(void 0!==u){if(null===u)throw new s('Unexpected null, expected schema in "properties"');"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,c,u,r,n);var d=l(e,c),h=this.validateSchema(d,u,r,n.makeChild(u,c));h.instance!==a.instance[c]&&(a.instance[c]=h.instance),a.importErrors(h)}}return a}},o.patternProperties=function(e,t,r,n){if(this.types.object(e)){var a=new i(e,t,r,n),o=t.patternProperties||{};for(var c in e){var l=!0;for(var d in o){var h=o[d];if(void 0!==h){if(null===h)throw new s('Unexpected null, expected schema in "patternProperties"');try{var p=new RegExp(d,"u")}catch(e){p=new RegExp(d)}if(p.test(c)){l=!1,"function"==typeof r.preValidateProperty&&r.preValidateProperty(e,c,h,r,n);var f=this.validateSchema(e[c],h,r,n.makeChild(h,c));f.instance!==a.instance[c]&&(a.instance[c]=f.instance),a.importErrors(f)}}}l&&u.call(this,e,t,r,n,c,a)}return a}},o.additionalProperties=function(e,t,r,n){if(this.types.object(e)){if(t.patternProperties)return null;var s=new i(e,t,r,n);for(var a in e)u.call(this,e,t,r,n,a,s);return s}},o.minProperties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n);return Object.keys(e).length>=t.minProperties||s.addError({name:"minProperties",argument:t.minProperties,message:"does not meet minimum property length of "+t.minProperties}),s}},o.maxProperties=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n);return Object.keys(e).length<=t.maxProperties||s.addError({name:"maxProperties",argument:t.maxProperties,message:"does not meet maximum property length of "+t.maxProperties}),s}},o.items=function(e,t,r,n){var s=this;if(this.types.array(e)&&void 0!==t.items){var a=new i(e,t,r,n);return e.every((function(e,i){if(Array.isArray(t.items))var o=void 0===t.items[i]?t.additionalItems:t.items[i];else o=t.items;if(void 0===o)return!0;if(!1===o)return a.addError({name:"items",message:"additionalItems not permitted"}),!1;var c=s.validateSchema(e,o,r,n.makeChild(o,i));return c.instance!==a.instance[i]&&(a.instance[i]=c.instance),a.importErrors(c),!0})),a}},o.contains=function(e,t,r,s){var a=this;if(this.types.array(e)&&void 0!==t.contains){if(!n.isSchema(t.contains))throw new Error('Expected "contains" keyword to be a schema');var o=new i(e,t,r,s);return!1===e.some((function(e,n){return 0===a.validateSchema(e,t.contains,r,s.makeChild(t.contains,n)).errors.length}))&&o.addError({name:"contains",argument:t.contains,message:"must contain an item matching given schema"}),o}},o.minimum=function(e,t,r,n){if(this.types.number(e)){var s=new i(e,t,r,n);return t.exclusiveMinimum&&!0===t.exclusiveMinimum?e>t.minimum||s.addError({name:"minimum",argument:t.minimum,message:"must be greater than "+t.minimum}):e>=t.minimum||s.addError({name:"minimum",argument:t.minimum,message:"must be greater than or equal to "+t.minimum}),s}},o.maximum=function(e,t,r,n){if(this.types.number(e)){var s=new i(e,t,r,n);return t.exclusiveMaximum&&!0===t.exclusiveMaximum?e<t.maximum||s.addError({name:"maximum",argument:t.maximum,message:"must be less than "+t.maximum}):e<=t.maximum||s.addError({name:"maximum",argument:t.maximum,message:"must be less than or equal to "+t.maximum}),s}},o.exclusiveMinimum=function(e,t,r,n){if("boolean"!=typeof t.exclusiveMinimum&&this.types.number(e)){var s=new i(e,t,r,n);return e>t.exclusiveMinimum||s.addError({name:"exclusiveMinimum",argument:t.exclusiveMinimum,message:"must be strictly greater than "+t.exclusiveMinimum}),s}},o.exclusiveMaximum=function(e,t,r,n){if("boolean"!=typeof t.exclusiveMaximum&&this.types.number(e)){var s=new i(e,t,r,n);return e<t.exclusiveMaximum||s.addError({name:"exclusiveMaximum",argument:t.exclusiveMaximum,message:"must be strictly less than "+t.exclusiveMaximum}),s}};var d=function(e,t,r,a,o,c){if(this.types.number(e)){var l=t[o];if(0==l)throw new s(o+" cannot be zero");var u=new i(e,t,r,a),d=n.getDecimalPlaces(e),h=n.getDecimalPlaces(l),p=Math.max(d,h),f=Math.pow(10,p);return Math.round(e*f)%Math.round(l*f)!=0&&u.addError({name:o,argument:l,message:c+JSON.stringify(l)}),u}};function h(e,t,r){var i,s=r.length;for(i=t+1;i<s;i++)if(n.deepCompareStrict(e,r[i]))return!1;return!0}o.multipleOf=function(e,t,r,n){return d.call(this,e,t,r,n,"multipleOf","is not a multiple of (divisible by) ")},o.divisibleBy=function(e,t,r,n){return d.call(this,e,t,r,n,"divisibleBy","is not divisible by (multiple of) ")},o.required=function(e,t,r,n){var s=new i(e,t,r,n);return void 0===e&&!0===t.required?s.addError({name:"required",message:"is required"}):this.types.object(e)&&Array.isArray(t.required)&&t.required.forEach((function(t){void 0===l(e,t)&&s.addError({name:"required",argument:t,message:"requires property "+JSON.stringify(t)})})),s},o.pattern=function(e,t,r,n){if(this.types.string(e)){var s=new i(e,t,r,n),a=t.pattern;try{var o=new RegExp(a,"u")}catch(e){o=new RegExp(a)}return e.match(o)||s.addError({name:"pattern",argument:t.pattern,message:"does not match pattern "+JSON.stringify(t.pattern.toString())}),s}},o.format=function(e,t,r,s){if(void 0!==e){var a=new i(e,t,r,s);return a.disableFormat||n.isFormat(e,t.format,this)||a.addError({name:"format",argument:t.format,message:"does not conform to the "+JSON.stringify(t.format)+" format"}),a}},o.minLength=function(e,t,r,n){if(this.types.string(e)){var s=new i(e,t,r,n),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)>=t.minLength||s.addError({name:"minLength",argument:t.minLength,message:"does not meet minimum length of "+t.minLength}),s}},o.maxLength=function(e,t,r,n){if(this.types.string(e)){var s=new i(e,t,r,n),a=e.match(/[\uDC00-\uDFFF]/g);return e.length-(a?a.length:0)<=t.maxLength||s.addError({name:"maxLength",argument:t.maxLength,message:"does not meet maximum length of "+t.maxLength}),s}},o.minItems=function(e,t,r,n){if(this.types.array(e)){var s=new i(e,t,r,n);return e.length>=t.minItems||s.addError({name:"minItems",argument:t.minItems,message:"does not meet minimum length of "+t.minItems}),s}},o.maxItems=function(e,t,r,n){if(this.types.array(e)){var s=new i(e,t,r,n);return e.length<=t.maxItems||s.addError({name:"maxItems",argument:t.maxItems,message:"does not meet maximum length of "+t.maxItems}),s}},o.uniqueItems=function(e,t,r,n){if(!0===t.uniqueItems&&this.types.array(e)){var s=new i(e,t,r,n);return e.every(h)||s.addError({name:"uniqueItems",message:"contains duplicate item"}),s}},o.dependencies=function(e,t,r,n){if(this.types.object(e)){var s=new i(e,t,r,n);for(var a in t.dependencies)if(void 0!==e[a]){var o=t.dependencies[a],c=n.makeChild(o,a);if("string"==typeof o&&(o=[o]),Array.isArray(o))o.forEach((function(t){void 0===e[t]&&s.addError({name:"dependencies",argument:c.propertyPath,message:"property "+t+" not found, required by "+c.propertyPath})}));else{var l=this.validateSchema(e,o,r,c);s.instance!==l.instance&&(s.instance=l.instance),l&&l.errors.length&&(s.addError({name:"dependencies",argument:c.propertyPath,message:"does not meet dependency required by "+c.propertyPath}),s.importErrors(l))}}return s}},o.enum=function(e,t,r,a){if(void 0===e)return null;if(!Array.isArray(t.enum))throw new s("enum expects an array",t);var o=new i(e,t,r,a);return t.enum.some(n.deepCompareStrict.bind(null,e))||o.addError({name:"enum",argument:t.enum,message:"is not one of enum values: "+t.enum.map(String).join(",")}),o},o.const=function(e,t,r,s){if(void 0===e)return null;var a=new i(e,t,r,s);return n.deepCompareStrict(t.const,e)||a.addError({name:"const",argument:t.const,message:"does not exactly match expected constant: "+t.const}),a},o.not=o.disallow=function(e,t,r,n){var s=this;if(void 0===e)return null;var a=new i(e,t,r,n),o=t.not||t.disallow;return o?(Array.isArray(o)||(o=[o]),o.forEach((function(i){if(s.testType(e,t,r,n,i)){var o=i&&(i.$id||i.id)||i;a.addError({name:"not",argument:o,message:"is of prohibited type "+o})}})),a):null},e.exports=a},1020:(e,t,r)=>{"use strict";var n=r(8526),i=t.ValidationError=function(e,t,r,n,i,s){if(Array.isArray(n)?(this.path=n,this.property=n.reduce((function(e,t){return e+d(t)}),"instance")):void 0!==n&&(this.property=n),e&&(this.message=e),r){var a=r.$id||r.id;this.schema=a||r}void 0!==t&&(this.instance=t),this.name=i,this.argument=s,this.stack=this.toString()};i.prototype.toString=function(){return this.property+" "+this.message};var s=t.ValidatorResult=function(e,t,r,n){this.instance=e,this.schema=t,this.options=r,this.path=n.path,this.propertyPath=n.propertyPath,this.errors=[],this.throwError=r&&r.throwError,this.throwFirst=r&&r.throwFirst,this.throwAll=r&&r.throwAll,this.disableFormat=r&&!0===r.disableFormat};function a(e,t){return t+": "+e.toString()+"\n"}function o(e){Error.captureStackTrace&&Error.captureStackTrace(this,o),this.instance=e.instance,this.schema=e.schema,this.options=e.options,this.errors=e.errors}s.prototype.addError=function(e){var t;if("string"==typeof e)t=new i(e,this.instance,this.schema,this.path);else{if(!e)throw new Error("Missing error detail");if(!e.message)throw new Error("Missing error message");if(!e.name)throw new Error("Missing validator type");t=new i(e.message,this.instance,this.schema,this.path,e.name,e.argument)}if(this.errors.push(t),this.throwFirst)throw new o(this);if(this.throwError)throw t;return t},s.prototype.importErrors=function(e){"string"==typeof e||e&&e.validatorType?this.addError(e):e&&e.errors&&(this.errors=this.errors.concat(e.errors))},s.prototype.toString=function(e){return this.errors.map(a).join("")},Object.defineProperty(s.prototype,"valid",{get:function(){return!this.errors.length}}),e.exports.ValidatorResultError=o,o.prototype=new Error,o.prototype.constructor=o,o.prototype.name="Validation Error";var c=t.SchemaError=function e(t,r){this.message=t,this.schema=r,Error.call(this,t),Error.captureStackTrace(this,e)};c.prototype=Object.create(Error.prototype,{constructor:{value:c,enumerable:!1},name:{value:"SchemaError",enumerable:!1}});var l=t.SchemaContext=function(e,t,r,n,i){this.schema=e,this.options=t,Array.isArray(r)?(this.path=r,this.propertyPath=r.reduce((function(e,t){return e+d(t)}),"instance")):this.propertyPath=r,this.base=n,this.schemas=i};l.prototype.resolve=function(e){return n.resolve(this.base,e)},l.prototype.makeChild=function(e,t){var r=void 0===t?this.path:this.path.concat([t]),i=e.$id||e.id,s=n.resolve(this.base,i||""),a=new l(e,this.options,r,s,Object.create(this.schemas));return i&&!a.schemas[s]&&(a.schemas[s]=e),a};var u=t.FORMAT_REGEXPS={"date-time":/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])[tT ](2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])(\.\d+)?([zZ]|[+-]([0-5][0-9]):(60|[0-5][0-9]))$/,date:/^\d{4}-(?:0[0-9]{1}|1[0-2]{1})-(3[01]|0[1-9]|[12][0-9])$/,time:/^(2[0-4]|[01][0-9]):([0-5][0-9]):(60|[0-5][0-9])$/,duration:/P(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S)|\d+(D|M(\d+D)?|Y(\d+M(\d+D)?)?)(T\d+(H(\d+M(\d+S)?)?|M(\d+S)?|S))?|\d+W)/i,email:/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/,"idn-email":/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u,"ip-address":/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,ipv6:/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,uri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"uri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/,iri:/^[a-zA-Z][a-zA-Z0-9+.-]*:[^\s]*$/,"iri-reference":/^(((([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:?)?)|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?)?))#(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|(([A-Za-z][+\-.0-9A-Za-z]*)?%[0-9A-Fa-f]{2}|[!$&-.0-9;=@_~-\u{10FFFF}]|[A-Za-z][+\-.0-9A-Za-z]*[!$&-*,;=@_~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-.0-9;=@-Z_a-z~-\u{10FFFF}])*((([/?](%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?#|[/?])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*)?|([A-Za-z][+\-.0-9A-Za-z]*(:%[0-9A-Fa-f]{2}|:[!$&-.0-;=?-Z_a-z~-\u{10FFFF}]|[/?])|\?)(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|([A-Za-z][+\-.0-9A-Za-z]*:)?\/((%[0-9A-Fa-f]{2}|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)(:\d*)?[/?]|[!$&-.0-;=?-Z_a-z~-\u{10FFFF}])(%[0-9A-Fa-f]{2}|[!$&-;=?-Z_a-z~-\u{10FFFF}])*|\/((%[0-9A-Fa-f]{2}|[!$&-.0-9;=A-Z_a-z~-\u{10FFFF}])+(:\d*)?|(\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?:\d*|\[(([Vv][0-9A-Fa-f]+\.[!$&-.0-;=A-Z_a-z~-\u{10FFFF}]+)?|[.0-:A-Fa-f]+)\])?)?|[A-Za-z][+\-.0-9A-Za-z]*:?)?$/u,uuid:/^[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}$/i,"uri-template":/(%[0-9a-f]{2}|[!#$&(-;=?@\[\]_a-z~]|\{[!#&+,./;=?@|]?(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?(,(%[0-9a-f]{2}|[0-9_a-z])(\.?(%[0-9a-f]{2}|[0-9_a-z]))*(:[1-9]\d{0,3}|\*)?)*\})*/iu,"json-pointer":/^(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*$/iu,"relative-json-pointer":/^\d+(#|(\/([\x00-\x2e0-@\[-}\x7f]|~[01])*)*)$/iu,hostname:/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"host-name":/^(?=.{1,255}$)[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?(?:\.[0-9A-Za-z](?:(?:[0-9A-Za-z]|-){0,61}[0-9A-Za-z])?)*\.?$/,"utc-millisec":function(e){return"string"==typeof e&&parseFloat(e)===parseInt(e,10)&&!isNaN(e)},regex:function(e){var t=!0;try{new RegExp(e)}catch(e){t=!1}return t},style:/[\r\n\t ]*[^\r\n\t ][^:]*:[\r\n\t ]*[^\r\n\t ;]*[\r\n\t ]*;?/,color:/^(#?([0-9A-Fa-f]{3}){1,2}\b|aqua|black|blue|fuchsia|gray|green|lime|maroon|navy|olive|orange|purple|red|silver|teal|white|yellow|(rgb\(\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*,\s*\b([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\b\s*\))|(rgb\(\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*,\s*(\d?\d%|100%)+\s*\)))$/,phone:/^\+(?:[0-9] ?){6,14}[0-9]$/,alpha:/^[a-zA-Z]+$/,alphanumeric:/^[a-zA-Z0-9]+$/};u.regexp=u.regex,u.pattern=u.regex,u.ipv4=u["ip-address"],t.isFormat=function(e,t,r){if("string"==typeof e&&void 0!==u[t]){if(u[t]instanceof RegExp)return u[t].test(e);if("function"==typeof u[t])return u[t](e)}else if(r&&r.customFormats&&"function"==typeof r.customFormats[t])return r.customFormats[t](e);return!0};var d=t.makeSuffix=function(e){return(e=e.toString()).match(/[.\s\[\]]/)||e.match(/^[\d]/)?e.match(/^\d+$/)?"["+e+"]":"["+JSON.stringify(e)+"]":"."+e};function h(e,t,r,n){"object"==typeof r?t[n]=m(e[n],r):-1===e.indexOf(r)&&t.push(r)}function p(e,t,r){t[r]=e[r]}function f(e,t,r,n){"object"==typeof t[n]&&t[n]&&e[n]?r[n]=m(e[n],t[n]):r[n]=t[n]}function m(e,t){var r=Array.isArray(t),n=r&&[]||{};return r?(e=e||[],n=n.concat(e),t.forEach(h.bind(null,e,n))):(e&&"object"==typeof e&&Object.keys(e).forEach(p.bind(null,e,n)),Object.keys(t).forEach(f.bind(null,e,t,n))),n}function y(e){return"/"+encodeURIComponent(e).replace(/~/g,"%7E")}t.deepCompareStrict=function e(t,r){if(typeof t!=typeof r)return!1;if(Array.isArray(t))return!!Array.isArray(r)&&t.length===r.length&&t.every((function(n,i){return e(t[i],r[i])}));if("object"==typeof t){if(!t||!r)return t===r;var n=Object.keys(t),i=Object.keys(r);return n.length===i.length&&n.every((function(n){return e(t[n],r[n])}))}return t===r},e.exports.deepMerge=m,t.objectGetPath=function(e,t){for(var r,n=t.split("/").slice(1);"string"==typeof(r=n.shift());){var i=decodeURIComponent(r.replace(/~0/,"~").replace(/~1/g,"/"));if(!(i in e))return;e=e[i]}return e},t.encodePath=function(e){return e.map(y).join("")},t.getDecimalPlaces=function(e){var t=0;if(isNaN(e))return t;"number"!=typeof e&&(e=Number(e));var r=e.toString().split("e");if(2===r.length){if("-"!==r[1][0])return t;t=Number(r[1].slice(1))}var n=r[0].split(".");return 2===n.length&&(t+=n[1].length),t},t.isSchema=function(e){return"object"==typeof e&&e||"boolean"==typeof e}},4445:(e,t,r)=>{"use strict";r(6719);r(1020).ValidatorResult,r(1020).ValidatorResultError,r(1020).ValidationError,r(1020).SchemaError,r(3107),r(3107).R},3107:(e,t,r)=>{"use strict";var n=r(8526),i=r(1020);function s(e,t){this.id=e,this.ref=t}e.exports.R=function(e,t){function r(e,t){if(t&&"object"==typeof t)if(t.$ref){var s=n.resolve(e,t.$ref);l[s]=l[s]?l[s]+1:0}else{var u=t.$id||t.id,d=u?n.resolve(e,u):e;if(d){if(d.indexOf("#")<0&&(d+="#"),c[d]){if(!i.deepCompareStrict(c[d],t))throw new Error("Schema <"+d+"> already exists with different definition");return c[d]}c[d]=t,"#"==d[d.length-1]&&(c[d.substring(0,d.length-1)]=t)}a(d+"/items",Array.isArray(t.items)?t.items:[t.items]),a(d+"/extends",Array.isArray(t.extends)?t.extends:[t.extends]),r(d+"/additionalItems",t.additionalItems),o(d+"/properties",t.properties),r(d+"/additionalProperties",t.additionalProperties),o(d+"/definitions",t.definitions),o(d+"/patternProperties",t.patternProperties),o(d+"/dependencies",t.dependencies),a(d+"/disallow",t.disallow),a(d+"/allOf",t.allOf),a(d+"/anyOf",t.anyOf),a(d+"/oneOf",t.oneOf),r(d+"/not",t.not)}}function a(e,t){if(Array.isArray(t))for(var n=0;n<t.length;n++)r(e+"/"+n,t[n])}function o(e,t){if(t&&"object"==typeof t)for(var n in t)r(e+"/"+n,t[n])}var c={},l={};return r(e,t),new s(c,l)}},6719:(e,t,r)=>{"use strict";var n=r(8526),i=r(9427),s=r(1020),a=r(3107).R,o=s.ValidatorResult,c=s.ValidatorResultError,l=s.SchemaError,u=s.SchemaContext,d=function e(){this.customFormats=Object.create(e.prototype.customFormats),this.schemas={},this.unresolvedRefs=[],this.types=Object.create(p),this.attributes=Object.create(i.validators)};function h(e){var t="string"==typeof e?e:e.$ref;return"string"==typeof t&&t}d.prototype.customFormats={},d.prototype.schemas=null,d.prototype.types=null,d.prototype.attributes=null,d.prototype.unresolvedRefs=null,d.prototype.addSchema=function(e,t){var r=this;if(!e)return null;var n=a(t||"/",e),i=t||e.$id||e.id;for(var s in n.id)this.schemas[s]=n.id[s];for(var s in n.ref)this.unresolvedRefs.push(s);return this.unresolvedRefs=this.unresolvedRefs.filter((function(e){return void 0===r.schemas[e]})),this.schemas[i]},d.prototype.addSubSchemaArray=function(e,t){if(Array.isArray(t))for(var r=0;r<t.length;r++)this.addSubSchema(e,t[r])},d.prototype.addSubSchemaObject=function(e,t){if(t&&"object"==typeof t)for(var r in t)this.addSubSchema(e,t[r])},d.prototype.setSchemas=function(e){this.schemas=e},d.prototype.getSchema=function(e){return this.schemas[e]},d.prototype.validate=function(e,t,r,i){if("boolean"!=typeof t&&"object"!=typeof t||null===t)throw new l("Expected `schema` to be an object or boolean");r||(r={});var s,d=t.$id||t.id,h=n.resolve(r.base||"/",d||"");if(!i){(i=new u(t,r,[],h,Object.create(this.schemas))).schemas[h]||(i.schemas[h]=t);var p=a(h,t);for(var f in p.id){var m=p.id[f];i.schemas[f]=m}}if(r.required&&void 0===e)return(s=new o(e,t,r,i)).addError("is required, but is undefined"),s;if(!(s=this.validateSchema(e,t,r,i)))throw new Error("Result undefined");if(r.throwAll&&s.errors.length)throw new c(s);return s},d.prototype.validateSchema=function(e,t,r,n){var a=new o(e,t,r,n);if("boolean"==typeof t)!0===t?t={}:!1===t&&(t={type:[]});else if(!t)throw new Error("schema is undefined");if(t.extends)if(Array.isArray(t.extends)){var c={schema:t,ctx:n};t.extends.forEach(this.schemaTraverser.bind(this,c)),t=c.schema,c.schema=null,c.ctx=null,c=null}else t=s.deepMerge(t,this.superResolve(t.extends,n));var d=h(t);if(d){var p=this.resolve(t,d,n),f=new u(p.subschema,r,n.path,p.switchSchema,n.schemas);return this.validateSchema(e,p.subschema,r,f)}var m=r&&r.skipAttributes||[];for(var y in t)if(!i.ignoreProperties[y]&&m.indexOf(y)<0){var g=null,b=this.attributes[y];if(b)g=b.call(this,e,t,r,n);else if(!1===r.allowUnknownAttributes)throw new l("Unsupported attribute: "+y,t);g&&a.importErrors(g)}if("function"==typeof r.rewrite){var v=r.rewrite.call(this,e,t,r,n);a.instance=v}return a},d.prototype.schemaTraverser=function(e,t){e.schema=s.deepMerge(e.schema,this.superResolve(t,e.ctx))},d.prototype.superResolve=function(e,t){var r=h(e);return r?this.resolve(e,r,t).subschema:e},d.prototype.resolve=function(e,t,r){if(t=r.resolve(t),r.schemas[t])return{subschema:r.schemas[t],switchSchema:t};var i=n.parse(t),a=i&&i.hash,o=a&&a.length&&t.substr(0,t.length-a.length);if(!o||!r.schemas[o])throw new l("no such schema <"+t+">",e);var c=s.objectGetPath(r.schemas[o],a.substr(1));if(void 0===c)throw new l("no such schema "+a+" located in <"+o+">",e);return{subschema:c,switchSchema:t}},d.prototype.testType=function(e,t,r,n,i){if(void 0!==i){if(null===i)throw new l('Unexpected null in "type" keyword');if("function"==typeof this.types[i])return this.types[i].call(this,e);if(i&&"object"==typeof i){var s=this.validateSchema(e,i,r,n);return void 0===s||!(s&&s.errors.length)}return!0}};var p=d.prototype.types={};p.string=function(e){return"string"==typeof e},p.number=function(e){return"number"==typeof e&&isFinite(e)},p.integer=function(e){return"number"==typeof e&&e%1==0},p.boolean=function(e){return"boolean"==typeof e},p.array=function(e){return Array.isArray(e)},p.null=function(e){return null===e},p.date=function(e){return e instanceof Date},p.any=function(e){return!0},p.object=function(e){return e&&"object"==typeof e&&!Array.isArray(e)&&!(e instanceof Date)},e.exports=d},201:(e,t,r)=>{var n="function"==typeof Map&&Map.prototype,i=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,s=n&&i&&"function"==typeof i.get?i.get:null,a=n&&Map.prototype.forEach,o="function"==typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&o?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,l=o&&c&&"function"==typeof c.get?c.get:null,u=o&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,f=Boolean.prototype.valueOf,m=Object.prototype.toString,y=Function.prototype.toString,g=String.prototype.match,b=String.prototype.slice,v=String.prototype.replace,w=String.prototype.toUpperCase,_=String.prototype.toLowerCase,A=RegExp.prototype.test,x=Array.prototype.concat,S=Array.prototype.join,k=Array.prototype.slice,F=Math.floor,P="function"==typeof BigInt?BigInt.prototype.valueOf:null,E=Object.getOwnPropertySymbols,O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,j="function"==typeof Symbol&&"object"==typeof Symbol.iterator,C="function"==typeof Symbol&&Symbol.toStringTag&&(Symbol.toStringTag,1)?Symbol.toStringTag:null,R=Object.prototype.propertyIsEnumerable,T=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function I(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||A.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var n=e<0?-F(-e):F(e);if(n!==e){var i=String(n),s=b.call(t,i.length+1);return v.call(i,r,"$&_")+"."+v.call(v.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return v.call(t,r,"$&_")}var M=r(6553),B=M.custom,D=K(B)?B:null;function N(e,t,r){var n="double"===(r.quoteStyle||t)?'"':"'";return n+e+n}function $(e){return v.call(String(e),/"/g,"&quot;")}function z(e){return!("[object Array]"!==V(e)||C&&"object"==typeof e&&C in e)}function U(e){return!("[object RegExp]"!==V(e)||C&&"object"==typeof e&&C in e)}function K(e){if(j)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!O)return!1;try{return O.call(e),!0}catch(e){}return!1}e.exports=function e(t,n,i,o){var c=n||{};if(L(c,"quoteStyle")&&"single"!==c.quoteStyle&&"double"!==c.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(L(c,"maxStringLength")&&("number"==typeof c.maxStringLength?c.maxStringLength<0&&c.maxStringLength!==1/0:null!==c.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var m=!L(c,"customInspect")||c.customInspect;if("boolean"!=typeof m&&"symbol"!==m)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(L(c,"indent")&&null!==c.indent&&"\t"!==c.indent&&!(parseInt(c.indent,10)===c.indent&&c.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(L(c,"numericSeparator")&&"boolean"!=typeof c.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var w=c.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return W(t,c);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var A=String(t);return w?I(t,A):A}if("bigint"==typeof t){var F=String(t)+"n";return w?I(t,F):F}var E=void 0===c.depth?5:c.depth;if(void 0===i&&(i=0),i>=E&&E>0&&"object"==typeof t)return z(t)?"[Array]":"[Object]";var B,q=function(e,t){var r;if("\t"===e.indent)r="\t";else{if(!("number"==typeof e.indent&&e.indent>0))return null;r=S.call(Array(e.indent+1)," ")}return{base:r,prev:S.call(Array(t+1),r)}}(c,i);if(void 0===o)o=[];else if(Z(o,t)>=0)return"[Circular]";function H(t,r,n){if(r&&(o=k.call(o)).push(r),n){var s={depth:c.depth};return L(c,"quoteStyle")&&(s.quoteStyle=c.quoteStyle),e(t,s,i+1,o)}return e(t,c,i+1,o)}if("function"==typeof t&&!U(t)){var ee=function(e){if(e.name)return e.name;var t=g.call(y.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),te=X(t,H);return"[Function"+(ee?": "+ee:" (anonymous)")+"]"+(te.length>0?" { "+S.call(te,", ")+" }":"")}if(K(t)){var re=j?v.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):O.call(t);return"object"!=typeof t||j?re:G(re)}if((B=t)&&"object"==typeof B&&("undefined"!=typeof HTMLElement&&B instanceof HTMLElement||"string"==typeof B.nodeName&&"function"==typeof B.getAttribute)){for(var ne="<"+_.call(String(t.nodeName)),ie=t.attributes||[],se=0;se<ie.length;se++)ne+=" "+ie[se].name+"="+N($(ie[se].value),"double",c);return ne+=">",t.childNodes&&t.childNodes.length&&(ne+="..."),ne+"</"+_.call(String(t.nodeName))+">"}if(z(t)){if(0===t.length)return"[]";var ae=X(t,H);return q&&!function(e){for(var t=0;t<e.length;t++)if(Z(e[t],"\n")>=0)return!1;return!0}(ae)?"["+Y(ae,q)+"]":"[ "+S.call(ae,", ")+" ]"}if(function(e){return!("[object Error]"!==V(e)||C&&"object"==typeof e&&C in e)}(t)){var oe=X(t,H);return"cause"in Error.prototype||!("cause"in t)||R.call(t,"cause")?0===oe.length?"["+String(t)+"]":"{ ["+String(t)+"] "+S.call(oe,", ")+" }":"{ ["+String(t)+"] "+S.call(x.call("[cause]: "+H(t.cause),oe),", ")+" }"}if("object"==typeof t&&m){if(D&&"function"==typeof t[D]&&M)return M(t,{depth:E-i});if("symbol"!==m&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!s||!e||"object"!=typeof e)return!1;try{s.call(e);try{l.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ce=[];return a&&a.call(t,(function(e,r){ce.push(H(r,t,!0)+" => "+H(e,t))})),Q("Map",s.call(t),ce,q)}if(function(e){if(!l||!e||"object"!=typeof e)return!1;try{l.call(e);try{s.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var le=[];return u&&u.call(t,(function(e){le.push(H(e,t))})),Q("Set",l.call(t),le,q)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return J("WeakMap");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return J("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return J("WeakRef");if(function(e){return!("[object Number]"!==V(e)||C&&"object"==typeof e&&C in e)}(t))return G(H(Number(t)));if(function(e){if(!e||"object"!=typeof e||!P)return!1;try{return P.call(e),!0}catch(e){}return!1}(t))return G(H(P.call(t)));if(function(e){return!("[object Boolean]"!==V(e)||C&&"object"==typeof e&&C in e)}(t))return G(f.call(t));if(function(e){return!("[object String]"!==V(e)||C&&"object"==typeof e&&C in e)}(t))return G(H(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if(t===r.g)return"{ [object globalThis] }";if(!function(e){return!("[object Date]"!==V(e)||C&&"object"==typeof e&&C in e)}(t)&&!U(t)){var ue=X(t,H),de=T?T(t)===Object.prototype:t instanceof Object||t.constructor===Object,he=t instanceof Object?"":"null prototype",pe=!de&&C&&Object(t)===t&&C in t?b.call(V(t),8,-1):he?"Object":"",fe=(de||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(pe||he?"["+S.call(x.call([],pe||[],he||[]),": ")+"] ":"");return 0===ue.length?fe+"{}":q?fe+"{"+Y(ue,q)+"}":fe+"{ "+S.call(ue,", ")+" }"}return String(t)};var q=Object.prototype.hasOwnProperty||function(e){return e in this};function L(e,t){return q.call(e,t)}function V(e){return m.call(e)}function Z(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1}function W(e,t){if(e.length>t.maxStringLength){var r=e.length-t.maxStringLength,n="... "+r+" more character"+(r>1?"s":"");return W(b.call(e,0,t.maxStringLength),t)+n}return N(v.call(v.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,H),"single",t)}function H(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+w.call(t.toString(16))}function G(e){return"Object("+e+")"}function J(e){return e+" { ? }"}function Q(e,t,r,n){return e+" ("+t+") {"+(n?Y(r,n):S.call(r,", "))+"}"}function Y(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+S.call(e,","+r)+"\n"+t.prev}function X(e,t){var r=z(e),n=[];if(r){n.length=e.length;for(var i=0;i<e.length;i++)n[i]=L(e,i)?t(e[i],e):""}var s,a="function"==typeof E?E(e):[];if(j){s={};for(var o=0;o<a.length;o++)s["$"+a[o]]=a[o]}for(var c in e)L(e,c)&&(r&&String(Number(c))===c&&c<e.length||j&&s["$"+c]instanceof Symbol||(A.call(/[^\w$]/,c)?n.push(t(c,e)+": "+t(e[c],e)):n.push(c+": "+t(e[c],e))));if("function"==typeof E)for(var l=0;l<a.length;l++)R.call(e,a[l])&&n.push("["+t(a[l])+"]: "+t(e[a[l]],e));return n}},2565:(e,t,r)=>{"use strict";var n=r(3298),i=/[\/\?<>\\:\*\|"]/g,s=/[\x00-\x1f\x80-\x9f]/g,a=/^\.+$/,o=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(e,t){if("string"!=typeof e)throw new Error("Input must be string");var r=e.replace(i,t).replace(s,t).replace(a,t).replace(o,t).replace(c,t);return n(r,255)}e.exports=function(e,t){var r=t&&t.replacement||"",n=l(e,r);return""===r?n:l(n,"")}},7319:(e,t,r)=>{"use strict";var n=r(4663),i=r(8531),s=r(3219)(),a=r(8337),o=n("%TypeError%"),c=n("%Math.floor%");e.exports=function(e,t){if("function"!=typeof e)throw new o("`fn` is not a function");if("number"!=typeof t||t<0||t>4294967295||c(t)!==t)throw new o("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],n=!0,l=!0;if("length"in e&&a){var u=a(e,"length");u&&!u.configurable&&(n=!1),u&&!u.writable&&(l=!1)}return(n||l||!r)&&(s?i(e,"length",t,!0,!0):i(e,"length",t)),e}},8959:(e,t,r)=>{"use strict";var n=r(4663),i=r(8608),s=r(201),a=n("%TypeError%"),o=n("%WeakMap%",!0),c=n("%Map%",!0),l=i("WeakMap.prototype.get",!0),u=i("WeakMap.prototype.set",!0),d=i("WeakMap.prototype.has",!0),h=i("Map.prototype.get",!0),p=i("Map.prototype.set",!0),f=i("Map.prototype.has",!0),m=function(e,t){for(var r,n=e;null!==(r=n.next);n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r};e.exports=function(){var e,t,r,n={assert:function(e){if(!n.has(e))throw new a("Side channel does not contain "+s(e))},get:function(n){if(o&&n&&("object"==typeof n||"function"==typeof n)){if(e)return l(e,n)}else if(c){if(t)return h(t,n)}else if(r)return function(e,t){var r=m(e,t);return r&&r.value}(r,n)},has:function(n){if(o&&n&&("object"==typeof n||"function"==typeof n)){if(e)return d(e,n)}else if(c){if(t)return f(t,n)}else if(r)return function(e,t){return!!m(e,t)}(r,n);return!1},set:function(n,i){o&&n&&("object"==typeof n||"function"==typeof n)?(e||(e=new o),u(e,n,i)):c?(t||(t=new c),p(t,n,i)):(r||(r={key:{},next:null}),function(e,t,r){var n=m(e,t);n?n.value=r:e.next={key:t,next:e.next,value:r}}(r,n,i))}};return n}},3298:(e,t,r)=>{"use strict";var n=r(2815),i=r(2875);e.exports=n.bind(null,i)},2815:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e,n,i){if("string"!=typeof n)throw new Error("Input must be string");for(var s,a,o=n.length,c=0,l=0;l<o;l+=1){if(s=n.charCodeAt(l),a=n[l],t(s)&&r(n.charCodeAt(l+1))&&(a+=n[l+=1]),(c+=e(a))===i)return n.slice(0,l+1);if(c>i)return n.slice(0,l-a.length+1)}return n}},9177:function(e,t,r){var n;e=r.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var s="object"==typeof r.g&&r.g;s.global!==s&&s.window!==s&&s.self;var a,o=2147483647,c=36,l=26,u=38,d=700,h=/^xn--/,p=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,m={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},y=c-1,g=Math.floor,b=String.fromCharCode;function v(e){throw new RangeError(m[e])}function w(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function _(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+w((e=e.replace(f,".")).split("."),t).join(".")}function A(e){for(var t,r,n=[],i=0,s=e.length;i<s;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<s?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function x(e){return w(e,(function(e){var t="";return e>65535&&(t+=b((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+b(e)})).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function k(e,t,r){var n=0;for(e=r?g(e/d):e>>1,e+=g(e/t);e>y*l>>1;n+=c)e=g(e/y);return g(n+(y+1)*e/(e+u))}function F(e){var t,r,n,i,s,a,u,d,h,p,f,m=[],y=e.length,b=0,w=128,_=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&v("not-basic"),m.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<y;){for(s=b,a=1,u=c;i>=y&&v("invalid-input"),((d=(f=e.charCodeAt(i++))-48<10?f-22:f-65<26?f-65:f-97<26?f-97:c)>=c||d>g((o-b)/a))&&v("overflow"),b+=d*a,!(d<(h=u<=_?1:u>=_+l?l:u-_));u+=c)a>g(o/(p=c-h))&&v("overflow"),a*=p;_=k(b-s,t=m.length+1,0==s),g(b/t)>o-w&&v("overflow"),w+=g(b/t),b%=t,m.splice(b++,0,w)}return x(m)}function P(e){var t,r,n,i,s,a,u,d,h,p,f,m,y,w,_,x=[];for(m=(e=A(e)).length,t=128,r=0,s=72,a=0;a<m;++a)(f=e[a])<128&&x.push(b(f));for(n=i=x.length,i&&x.push("-");n<m;){for(u=o,a=0;a<m;++a)(f=e[a])>=t&&f<u&&(u=f);for(u-t>g((o-r)/(y=n+1))&&v("overflow"),r+=(u-t)*y,t=u,a=0;a<m;++a)if((f=e[a])<t&&++r>o&&v("overflow"),f==t){for(d=r,h=c;!(d<(p=h<=s?1:h>=s+l?l:h-s));h+=c)_=d-p,w=c-p,x.push(b(S(p+_%w,0))),d=g(_/w);x.push(b(S(d,0))),s=k(r,y,n==i),r=0,++n}++r,++t}return x.join("")}a={version:"1.4.1",ucs2:{decode:A,encode:x},decode:F,encode:P,toASCII:function(e){return _(e,(function(e){return p.test(e)?"xn--"+P(e):e}))},toUnicode:function(e){return _(e,(function(e){return h.test(e)?F(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return a}.call(t,r,t,e))||(e.exports=n)}()},7032:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,n="RFC3986";e.exports={default:n,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:"RFC1738",RFC3986:n}},3184:(e,t,r)=>{"use strict";var n=r(1645),i=r(5610),s=r(7032);e.exports={formats:s,parse:i,stringify:n}},5610:(e,t,r)=>{"use strict";var n=r(8206),i=Object.prototype.hasOwnProperty,s=Array.isArray,a={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:n.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},o=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},l=function(e,t,r,n){if(e){var s=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,o=r.depth>0&&/(\[[^[\]]*])/.exec(s),l=o?s.slice(0,o.index):s,u=[];if(l){if(!r.plainObjects&&i.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var d=0;r.depth>0&&null!==(o=a.exec(s))&&d<r.depth;){if(d+=1,!r.plainObjects&&i.call(Object.prototype,o[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(o[1])}return o&&u.push("["+s.slice(o.index)+"]"),function(e,t,r,n){for(var i=n?t:c(t,r),s=e.length-1;s>=0;--s){var a,o=e[s];if("[]"===o&&r.parseArrays)a=[].concat(i);else{a=r.plainObjects?Object.create(null):{};var l="["===o.charAt(0)&&"]"===o.charAt(o.length-1)?o.slice(1,-1):o,u=parseInt(l,10);r.parseArrays||""!==l?!isNaN(u)&&o!==l&&String(u)===l&&u>=0&&r.parseArrays&&u<=r.arrayLimit?(a=[])[u]=i:"__proto__"!==l&&(a[l]=i):a={0:i}}i=a}return i}(u,t,r,n)}};e.exports=function(e,t){var r=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:a.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||n.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return r.plainObjects?Object.create(null):{};for(var u="string"==typeof e?function(e,t){var r,l={__proto__:null},u=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,h=u.split(t.delimiter,d),p=-1,f=t.charset;if(t.charsetSentinel)for(r=0;r<h.length;++r)0===h[r].indexOf("utf8=")&&("utf8=%E2%9C%93"===h[r]?f="utf-8":"utf8=%26%2310003%3B"===h[r]&&(f="iso-8859-1"),p=r,r=h.length);for(r=0;r<h.length;++r)if(r!==p){var m,y,g=h[r],b=g.indexOf("]="),v=-1===b?g.indexOf("="):b+1;-1===v?(m=t.decoder(g,a.decoder,f,"key"),y=t.strictNullHandling?null:""):(m=t.decoder(g.slice(0,v),a.decoder,f,"key"),y=n.maybeMap(c(g.slice(v+1),t),(function(e){return t.decoder(e,a.decoder,f,"value")}))),y&&t.interpretNumericEntities&&"iso-8859-1"===f&&(y=o(y)),g.indexOf("[]=")>-1&&(y=s(y)?[y]:y),i.call(l,m)?l[m]=n.combine(l[m],y):l[m]=y}return l}(e,r):e,d=r.plainObjects?Object.create(null):{},h=Object.keys(u),p=0;p<h.length;++p){var f=h[p],m=l(f,u[f],r,"string"==typeof e);d=n.merge(d,m,r)}return!0===r.allowSparse?d:n.compact(d)}},1645:(e,t,r)=>{"use strict";var n=r(8959),i=r(8206),s=r(7032),a=Object.prototype.hasOwnProperty,o={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,l=Array.prototype.push,u=function(e,t){l.apply(e,c(t)?t:[t])},d=Date.prototype.toISOString,h=s.default,p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:i.encode,encodeValuesOnly:!1,format:h,formatter:s.formatters[h],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},f={},m=function e(t,r,s,a,o,l,d,h,m,y,g,b,v,w,_,A){for(var x,S=t,k=A,F=0,P=!1;void 0!==(k=k.get(f))&&!P;){var E=k.get(t);if(F+=1,void 0!==E){if(E===F)throw new RangeError("Cyclic object value");P=!0}void 0===k.get(f)&&(F=0)}if("function"==typeof h?S=h(r,S):S instanceof Date?S=g(S):"comma"===s&&c(S)&&(S=i.maybeMap(S,(function(e){return e instanceof Date?g(e):e}))),null===S){if(o)return d&&!w?d(r,p.encoder,_,"key",b):r;S=""}if("string"==typeof(x=S)||"number"==typeof x||"boolean"==typeof x||"symbol"==typeof x||"bigint"==typeof x||i.isBuffer(S))return d?[v(w?r:d(r,p.encoder,_,"key",b))+"="+v(d(S,p.encoder,_,"value",b))]:[v(r)+"="+v(String(S))];var O,j=[];if(void 0===S)return j;if("comma"===s&&c(S))w&&d&&(S=i.maybeMap(S,d)),O=[{value:S.length>0?S.join(",")||null:void 0}];else if(c(h))O=h;else{var C=Object.keys(S);O=m?C.sort(m):C}for(var R=a&&c(S)&&1===S.length?r+"[]":r,T=0;T<O.length;++T){var I=O[T],M="object"==typeof I&&void 0!==I.value?I.value:S[I];if(!l||null!==M){var B=c(S)?"function"==typeof s?s(R,I):R:R+(y?"."+I:"["+I+"]");A.set(t,F);var D=n();D.set(f,A),u(j,e(M,B,s,a,o,l,"comma"===s&&w&&c(S)?null:d,h,m,y,g,b,v,w,_,D))}}return j};e.exports=function(e,t){var r,i=e,l=function(e){if(!e)return p;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var r=s.default;if(void 0!==e.format){if(!a.call(s.formatters,e.format))throw new TypeError("Unknown format option provided.");r=e.format}var n=s.formatters[r],i=p.filter;return("function"==typeof e.filter||c(e.filter))&&(i=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:void 0===e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}}(t);"function"==typeof l.filter?i=(0,l.filter)("",i):c(l.filter)&&(r=l.filter);var d,h=[];if("object"!=typeof i||null===i)return"";d=t&&t.arrayFormat in o?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var f=o[d];if(t&&"commaRoundTrip"in t&&"boolean"!=typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var y="comma"===f&&t&&t.commaRoundTrip;r||(r=Object.keys(i)),l.sort&&r.sort(l.sort);for(var g=n(),b=0;b<r.length;++b){var v=r[b];l.skipNulls&&null===i[v]||u(h,m(i[v],v,f,y,l.strictNullHandling,l.skipNulls,l.encode?l.encoder:null,l.filter,l.sort,l.allowDots,l.serializeDate,l.format,l.formatter,l.encodeValuesOnly,l.charset,g))}var w=h.join(l.delimiter),_=!0===l.addQueryPrefix?"?":"";return l.charsetSentinel&&("iso-8859-1"===l.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),w.length>0?_+w:""}},8206:(e,t,r)=>{"use strict";var n=r(7032),i=Object.prototype.hasOwnProperty,s=Array.isArray,a=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),o=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r};e.exports={arrayToObject:o,assign:function(e,t){return Object.keys(t).reduce((function(e,r){return e[r]=t[r],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],n=0;n<t.length;++n)for(var i=t[n],a=i.obj[i.prop],o=Object.keys(a),c=0;c<o.length;++c){var l=o[c],u=a[l];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:a,prop:l}),r.push(u))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(s(r)){for(var n=[],i=0;i<r.length;++i)void 0!==r[i]&&n.push(r[i]);t.obj[t.prop]=n}}}(t),e},decode:function(e,t,r){var n=e.replace(/\+/g," ");if("iso-8859-1"===r)return n.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(n)}catch(e){return n}},encode:function(e,t,r,i,s){if(0===e.length)return e;var o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===r)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",l=0;l<o.length;++l){var u=o.charCodeAt(l);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||s===n.RFC1738&&(40===u||41===u)?c+=o.charAt(l):u<128?c+=a[u]:u<2048?c+=a[192|u>>6]+a[128|63&u]:u<55296||u>=57344?c+=a[224|u>>12]+a[128|u>>6&63]+a[128|63&u]:(l+=1,u=65536+((1023&u)<<10|1023&o.charCodeAt(l)),c+=a[240|u>>18]+a[128|u>>12&63]+a[128|u>>6&63]+a[128|63&u])}return c},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(s(e)){for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)},merge:function e(t,r,n){if(!r)return t;if("object"!=typeof r){if(s(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(n&&(n.plainObjects||n.allowPrototypes)||!i.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var a=t;return s(t)&&!s(r)&&(a=o(t,n)),s(t)&&s(r)?(r.forEach((function(r,s){if(i.call(t,s)){var a=t[s];a&&"object"==typeof a&&r&&"object"==typeof r?t[s]=e(a,r,n):t.push(r)}else t[s]=r})),t):Object.keys(r).reduce((function(t,s){var a=r[s];return i.call(t,s)?t[s]=e(t[s],a,n):t[s]=a,t}),a)}}},8526:(e,t,r)=>{"use strict";var n=r(9177);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var s=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,o=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),u=["%","/","?",";","#"].concat(l),d=["/","?","#"],h=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},m={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=r(3184);function b(e,t,r){if(e&&"object"==typeof e&&e instanceof i)return e;var n=new i;return n.parse(e,t,r),n}i.prototype.parse=function(e,t,r){if("string"!=typeof e)throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),a=-1!==i&&i<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!r&&1===e.split("#").length){var v=o.exec(b);if(v)return this.path=b,this.href=b,this.pathname=v[1],v[2]?(this.search=v[2],this.query=t?g.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=s.exec(b);if(w){var _=(w=w[0]).toLowerCase();this.protocol=_,b=b.substr(w.length)}if(r||w||b.match(/^\/\/[^@/]+@[^@/]+/)){var A="//"===b.substr(0,2);!A||w&&m[w]||(b=b.substr(2),this.slashes=!0)}if(!m[w]&&(A||w&&!y[w])){for(var x,S,k=-1,F=0;F<d.length;F++)-1!==(P=b.indexOf(d[F]))&&(-1===k||P<k)&&(k=P);for(-1!==(S=-1===k?b.lastIndexOf("@"):b.lastIndexOf("@",k))&&(x=b.slice(0,S),b=b.slice(S+1),this.auth=decodeURIComponent(x)),k=-1,F=0;F<u.length;F++){var P;-1!==(P=b.indexOf(u[F]))&&(-1===k||P<k)&&(k=P)}-1===k&&(k=b.length),this.host=b.slice(0,k),b=b.slice(k),this.parseHost(),this.hostname=this.hostname||"";var E="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!E)for(var O=this.hostname.split(/\./),j=(F=0,O.length);F<j;F++){var C=O[F];if(C&&!C.match(h)){for(var R="",T=0,I=C.length;T<I;T++)C.charCodeAt(T)>127?R+="x":R+=C[T];if(!R.match(h)){var M=O.slice(0,F),B=O.slice(F+1),D=C.match(p);D&&(M.push(D[1]),B.unshift(D[2])),B.length&&(b="/"+B.join(".")+b),this.hostname=M.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),E||(this.hostname=n.toASCII(this.hostname));var N=this.port?":"+this.port:"",$=this.hostname||"";this.host=$+N,this.href+=this.host,E&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!f[_])for(F=0,j=l.length;F<j;F++){var z=l[F];if(-1!==b.indexOf(z)){var U=encodeURIComponent(z);U===z&&(U=escape(z)),b=b.split(z).join(U)}}var K=b.indexOf("#");-1!==K&&(this.hash=b.substr(K),b=b.slice(0,K));var q=b.indexOf("?");if(-1!==q?(this.search=b.substr(q),this.query=b.substr(q+1),t&&(this.query=g.parse(this.query)),b=b.slice(0,q)):t&&(this.search="",this.query={}),b&&(this.pathname=b),y[_]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){N=this.pathname||"";var L=this.search||"";this.path=N+L}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,s="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=g.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var a=this.search||s&&"?"+s||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(r=r.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if("string"==typeof e){var t=new i;t.parse(e,!1,!0),e=t}for(var r=new i,n=Object.keys(this),s=0;s<n.length;s++){var a=n[s];r[a]=this[a]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var o=Object.keys(e),c=0;c<o.length;c++){var l=o[c];"protocol"!==l&&(r[l]=e[l])}return y[r.protocol]&&r.hostname&&!r.pathname&&(r.pathname="/",r.path=r.pathname),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!y[e.protocol]){for(var u=Object.keys(e),d=0;d<u.length;d++){var h=u[d];r[h]=e[h]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||m[e.protocol])r.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),r.pathname=p.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var f=r.pathname||"",g=r.search||"";r.path=f+g}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var b=r.pathname&&"/"===r.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=v||b||r.host&&e.pathname,_=w,A=r.pathname&&r.pathname.split("/")||[],x=(p=e.pathname&&e.pathname.split("/")||[],r.protocol&&!y[r.protocol]);if(x&&(r.hostname="",r.port=null,r.host&&(""===A[0]?A[0]=r.host:A.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),w=w&&(""===p[0]||""===A[0])),v)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,A=p;else if(p.length)A||(A=[]),A.pop(),A=A.concat(p),r.search=e.search,r.query=e.query;else if(null!=e.search)return x&&(r.host=A.shift(),r.hostname=r.host,(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.hostname=E.shift(),r.host=r.hostname)),r.search=e.search,r.query=e.query,null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!A.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var S=A.slice(-1)[0],k=(r.host||e.host||A.length>1)&&("."===S||".."===S)||""===S,F=0,P=A.length;P>=0;P--)"."===(S=A[P])?A.splice(P,1):".."===S?(A.splice(P,1),F++):F&&(A.splice(P,1),F--);if(!w&&!_)for(;F--;F)A.unshift("..");!w||""===A[0]||A[0]&&"/"===A[0].charAt(0)||A.unshift(""),k&&"/"!==A.join("/").substr(-1)&&A.push("");var E,O=""===A[0]||A[0]&&"/"===A[0].charAt(0);return x&&(r.hostname=O?"":A.length?A.shift():"",r.host=r.hostname,(E=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=E.shift(),r.hostname=E.shift(),r.host=r.hostname)),(w=w||r.host&&A.length)&&!O&&A.unshift(""),A.length>0?r.pathname=A.join("/"):(r.pathname=null,r.path=null),null===r.pathname&&null===r.search||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},i.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)},t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){return"string"==typeof e&&(e=b(e)),e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i},2875:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function r(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var n=e.length,i=0,s=null,a=null,o=0;o<n;o++)r(s=e.charCodeAt(o))?null!=a&&t(a)?i+=1:i+=3:s<=127?i+=1:s>=128&&s<=2047?i+=2:s>=2048&&s<=65535&&(i+=3),a=s;return i}},6553:()=>{}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={id:n,loaded:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.loaded=!0,s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{"use strict";const e=e=>new Promise(((t,r)=>{chrome.tabs.get(e,(e=>{chrome.tabs.captureVisibleTab(e.windowId,{format:"jpeg",quality:100},(async e=>{t(e)}))}))}));var t,n=r(2565),i=r.n(n);function s(e,t=!1){const r=Math.floor(e/1e3);let n;n=t?Math.round(e/1e3%60*10)/10:r%60;const i=Math.floor(r/60)%60,s=Math.floor(r/3600);return s>0?s+"h"+String(i).padStart(2,"0")+"m"+String(n).padStart(2,"0")+"s":i+"m"+String(n).padStart(2,"0")+"s"}function a(e,t,r){if(0===t.length)return e.text;const n=[e.start,e.end];return i=t.filter((e=>function(e,t){const r=Math.max(0,e.end-e.start);if(0===r)return!1;const n=Math.max(e.start,t[0]);return Math.min(e.end,t[1])-n>=r/2}(e,n))).filter((e=>void 0===r||e.track===r)),i.filter((e=>""!==e.text.trim())).map((e=>e.text)).join("\n");var i}function o(e,t){const r=window.URL.createObjectURL(e),n=document.createElement("a");document.body.appendChild(n),n.style.display="none",n.href=r,n.download=i()(t),n.click(),URL.revokeObjectURL(r),n.remove()}!function(e){e[e.forward=0]="forward",e[e.backward=1]="backward"}(t||(t={}));const c={},l=e=>e in c,u=(e,t)=>`${e.replaceAll(" ","_").substring(0,Math.min(e.length,24))}_${Math.floor(t)}`;class d{constructor(e,t,r){this._name=e,this._base64=t,this._extension=r}get name(){return this._name}get extension(){return this._extension}isAvailable(){return!0}async base64(){return this._base64}async blob(){return await this._blob()}async _blob(){return this.cachedBlob||(this.cachedBlob=await(await fetch(this._dataUrl())).blob()),this.cachedBlob}async dataUrl(){return this._dataUrl()}_dataUrl(){return"data:image/"+this.extension+";base64,"+this._base64}}class h{constructor(e,t,r,n){this._file=e,this._name=`${u(e.name,t)}.jpeg`,this._timestamp=t,this._maxWidth=r,this._maxHeight=n}get name(){return this._name}get extension(){return"jpeg"}isAvailable(){return!!this._file.blobUrl&&l(this._file.blobUrl)}async base64(){return new Promise(((e,t)=>{this._canvas().then((t=>{const r=t.toDataURL("image/jpeg");e(r.substring(r.indexOf(",")+1))})).catch(t)}))}async blob(){return new Promise(((e,t)=>{this._canvas().then((r=>{r.toBlob((r=>{null===r?t(new Error("Could not obtain blob")):e(r)}),"image/jpeg")})).catch(t)}))}async dataUrl(){return(await this._canvas()).toDataURL()}async _canvas(){return new Promise((async(e,t)=>{const r=this._videoElement(this._file);r.oncanplay=async t=>{const n=document.createElement("canvas");n.width=r.videoWidth,n.height=r.videoHeight;const i=n.getContext("2d");await r.play(),i.drawImage(r,0,0,n.width,n.height),await r.pause(),r.removeAttribute("src"),r.load(),r.remove(),this._maxWidth>0||this._maxHeight>0?(await((e,t,r,n)=>new Promise(((i,s)=>{const a=r<=0?1:r/e.width,o=n<=0?1:n/e.height,c=Math.min(1,Math.min(a,o));if(c<1){const r=e.width*c,n=e.height*c;createImageBitmap(e,{resizeWidth:r,resizeHeight:n,resizeQuality:"high"}).then((s=>{e.width=r,e.height=n,t.drawImage(s,0,0),i(e)})).catch((e=>s(e)))}else i(e)})))(n,i,this._maxWidth,this._maxHeight),e(n)):e(n)},r.onerror=()=>{t(r.error?.message??"Could not load video to obtain screenshot")}}))}_videoElement(e){const t=document.createElement("video");return t.src=e.blobUrl,t.preload="metadata",t.volume=0,t.currentTime=this._timestamp/1e3,t}}class p{constructor(e,t){this._name=u(e,t)}get name(){return this._name}get extension(){return"jpeg"}isAvailable(){return!1}base64(){throw new Error("Not supported")}dataUrl(){throw new Error("Not supported")}blob(){throw new Error("Not supported")}}class f{constructor(e){this.data=e}static fromCard(e,t,r){return e.image?f.fromBase64(e.subtitleFileName,e.subtitle.start,e.image.base64,e.image.extension):e.file?f.fromFile(e.file,e.mediaTimestamp??e.subtitle.start,t,r):void 0}static fromBase64(e,t,r,n){const i=e.substring(0,e.lastIndexOf(".")),s=`${u(i,t)}.${n}`;return new f(new d(s,r,n))}static fromFile(e,t,r,n){return new f(new h(e,t,r,n))}static fromMissingFile(e,t){return new f(new p(e,t))}get name(){return this.data.name}get extension(){return this.data.extension}isAvailable(){return this.data.isAvailable()}async base64(){return await this.data.base64()}async dataUrl(){return await this.data.dataUrl()}async blob(){return await this.data.blob()}async pngBlob(){return new Promise((async(e,t)=>{try{createImageBitmap(await this.blob()).then((r=>{const n=document.createElement("canvas");n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0),n.toBlob((r=>{r?e(r):t("Failed to convert to PNG")}),"image/png")}))}catch(e){t(e)}}))}async download(){o(await this.data.blob(),this.data.name)}}var m,y,g,b,v;!function(e){e[e.drmProtected=1]="drmProtected",e[e.fileLinkLost=2]="fileLinkLost"}(m||(m={})),function(e){e[e.none=0]="none",e[e.showAnkiDialog=1]="showAnkiDialog",e[e.updateLastCard=2]="updateLastCard",e[e.exportCard=3]="exportCard"}(y||(y={})),function(e){e[e.remember=0]="remember",e[e.play=1]="play",e[e.pause=2]="pause"}(g||(g={})),function(e){e[e.atStart=1]="atStart",e[e.atEnd=2]="atEnd"}(b||(b={})),function(e){e[e.normal=1]="normal",e[e.condensed=2]="condensed",e[e.autoPause=3]="autoPause",e[e.fastForward=4]="fastForward",e[e.repeat=5]="repeat"}(v||(v={}));class w{async fetch(e,t){const r=await fetch(e,{method:"POST",body:JSON.stringify(t)});return await r.json()}}class _ extends Error{}const A=["version","action","params"],x=["guiAddCards","deckNames","modelNames","modelFieldNames","findNotes","guiBrowse","requestPermission","findNotes","notesInfo","updateNoteFields","addNote","storeMediaFile","version","addTags"],S=Object.keys({ankiConnectUrl:!0,deck:!0,noteType:!0,sentenceField:!0,definitionField:!0,audioField:!0,imageField:!0,wordField:!0,sourceField:!0,urlField:!0,track1Field:!0,track2Field:!0,track3Field:!0,customAnkiFields:!0,tags:!0,preferMp3:!0,audioPaddingStart:!0,audioPaddingEnd:!0,maxImageWidth:!0,maxImageHeight:!0,surroundingSubtitlesCountRadius:!0,surroundingSubtitlesTimeRadius:!0,ankiFieldSettings:!0,customAnkiFieldSettings:!0}),k=Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0}),F=Object.keys({subtitleColor:!0,subtitleSize:!0,subtitleThickness:!0,subtitleOutlineThickness:!0,subtitleOutlineColor:!0,subtitleShadowThickness:!0,subtitleShadowColor:!0,subtitleBackgroundOpacity:!0,subtitleBackgroundColor:!0,subtitleFontFamily:!0,subtitleCustomStyles:!0,subtitleBlur:!0,imageBasedSubtitleScaleFactor:!0,subtitlePositionOffset:!0,subtitleAlignment:!0,subtitleTracksV2:!0});var P;!function(e){e.noSubtitleList="noSubtitleList",e.app="app"}(P||(P={}));const E=(navigator.userAgentData?.platform??navigator.platform)?.toUpperCase()?.indexOf("MAC")>-1,O={ankiConnectUrl:"http://127.0.0.1:8765",deck:"",noteType:"",sentenceField:"",definitionField:"",audioField:"",imageField:"",wordField:"",sourceField:"",urlField:"",track1Field:"",track2Field:"",track3Field:"",ankiFieldSettings:{sentence:{order:1,display:!0},definition:{order:2,display:!0},word:{order:3,display:!0},audio:{order:4,display:!0},image:{order:5,display:!0},source:{order:6,display:!0},url:{order:7,display:!0},track1:{order:8,display:!1},track2:{order:9,display:!1},track3:{order:10,display:!1}},customAnkiFieldSettings:{},subtitleSize:36,subtitleColor:"#ffffff",subtitleThickness:700,subtitleOutlineThickness:0,subtitleOutlineColor:"#000000",subtitleShadowThickness:3,subtitleShadowColor:"#000000",subtitleBackgroundColor:"#000000",subtitleBackgroundOpacity:0,subtitleFontFamily:"",subtitlePreview:"Aa",subtitleCustomStyles:[],subtitleBlur:!1,subtitlePositionOffset:75,subtitleAlignment:"bottom",subtitleTracksV2:[],audioPaddingStart:0,audioPaddingEnd:500,maxImageWidth:0,maxImageHeight:0,surroundingSubtitlesCountRadius:2,surroundingSubtitlesTimeRadius:1e4,autoPausePreference:b.atEnd,speedChangeStep:.1,fastForwardModePlaybackRate:2.7,keyBindSet:{togglePlay:{keys:"space"},toggleAutoPause:{keys:E?"+P":"shift+P"},toggleCondensedPlayback:{keys:E?"+O":"shift+O"},toggleFastForwardPlayback:{keys:E?"+F":"shift+F"},toggleSubtitles:{keys:"down"},toggleVideoSubtitleTrack1:{keys:"1"},toggleVideoSubtitleTrack2:{keys:"2"},toggleVideoSubtitleTrack3:{keys:"3"},toggleAsbplayerSubtitleTrack1:{keys:"W+1"},toggleAsbplayerSubtitleTrack2:{keys:"W+2"},toggleAsbplayerSubtitleTrack3:{keys:"W+3"},toggleAsbplayerBlurTrack1:{keys:"B+1"},toggleAsbplayerBlurTrack2:{keys:"B+2"},toggleAsbplayerBlurTrack3:{keys:"B+3"},seekBackward:{keys:"A"},seekForward:{keys:"D"},seekToPreviousSubtitle:{keys:"left"},seekToNextSubtitle:{keys:"right"},seekToBeginningOfCurrentSubtitle:{keys:"up"},adjustOffsetToPreviousSubtitle:{keys:E?"+left":"ctrl+left"},adjustOffsetToNextSubtitle:{keys:E?"+right":"ctrl+right"},decreaseOffset:{keys:E?"++right":"ctrl+shift+right"},increaseOffset:{keys:E?"++left":"ctrl+shift+left"},resetOffset:{keys:E?"++down":"ctrl+shift+down"},copySubtitle:{keys:E?"++Z":"ctrl+shift+Z"},ankiExport:{keys:E?"++X":"ctrl+shift+X"},updateLastCard:{keys:E?"++U":"ctrl+shift+U"},takeScreenshot:{keys:E?"++V":"ctrl+shift+V"},decreasePlaybackRate:{keys:E?"++[":"ctrl+shift+["},increasePlaybackRate:{keys:E?"++]":"ctrl+shift+]"},toggleSidePanel:{keys:"`"},toggleRepeat:{keys:E?"+R":"shift+R"}},preferMp3:!0,tabName:"asbplayer",miningHistoryStorageLimit:25,preCacheSubtitleDom:!0,clickToMineDefaultAction:y.showAnkiDialog,postMiningPlaybackState:g.remember,themeType:"dark",copyToClipboardOnMine:!1,rememberSubtitleOffset:!0,lastSubtitleOffset:0,autoCopyCurrentSubtitle:!1,alwaysPlayOnSubtitleRepeat:!0,subtitleRegexFilter:"",subtitleRegexFilterTextReplacement:"",language:"en",customAnkiFields:{},tags:[],imageBasedSubtitleScaleFactor:1,streamingAppUrl:"https://killergerbah.github.io/asbplayer",streamingDisplaySubtitles:!0,streamingRecordMedia:!0,streamingTakeScreenshot:!0,streamingCleanScreenshot:!0,streamingCropScreenshot:!0,streamingSubsDragAndDrop:!0,streamingAutoSync:!1,streamingLastLanguagesSynced:{},streamingCondensedPlaybackMinimumSkipIntervalMs:1e3,streamingScreenshotDelay:1e3,streamingSubtitleListPreference:P.noSubtitleList,streamingEnableOverlay:!0,webSocketClientEnabled:!1,webSocketServerUrl:"ws://127.0.0.1:8766/ws"},j=(e,t)=>{if(void 0===t){const t=t=>{const r=e[t];for(const n of e.subtitleTracksV2)if(!R(n[t],r))return!1;return!0};let r={};for(const n of k)t(n)?r[n]=e[n]:r[n]=void 0;return r}return 0===t||t>e.subtitleTracksV2.length?Object.fromEntries(k.map((t=>[t,e[t]]))):e.subtitleTracksV2[t-1]},C=(e,t,r)=>{if(void 0===r){const r=[];for(let n=0;n<t.subtitleTracksV2.length;++n)r.push({...t.subtitleTracksV2[n],...e});return{...e,subtitleTracksV2:r}}if(0===r)return{...e};const n=[...t.subtitleTracksV2],i=j(t,0);for(;n.length<r;)n.push(i);n[r-1]={...n[r-1],...e};let s=0;for(let e=n.length-1;e>=0&&R(i,n[e]);--e)++s;return s>0&&n.splice(n.length-s),{subtitleTracksV2:n}},R=(Object.fromEntries(Object.entries(O).map((([e,t])=>{if("string"==typeof t)return[e,e=>e];if("boolean"==typeof t)return[e,e=>"true"===e];if("number"==typeof t)return[e,e=>Number(e)];if("object"==typeof t)return[e,e=>JSON.parse(e)];throw new Error("Could not determine deserializer for setting")}))),(e,t)=>{if(typeof e!=typeof t)return!1;if("object"!=typeof e)return e===t;const r=Object.keys(e),n=Object.keys(t);if(e.length!==t.length)return!1;for(const n of r)if(!R(e[n],t[n]))return!1;for(const r of n)if(!R(e[r],t[r]))return!1;return!0}),T=Object.fromEntries(Object.keys(O).filter((e=>"object"==typeof O[e])).map((e=>[e,!0])));class I{constructor(e){this._complexValues={},this._storage=e}async getAll(){return this.get(Object.keys(O))}async getSingle(e){return(await this.get([e]))[e]}async get(e){let t={};for(const r of e)t[r]=O[r];const r=await this._storage.get(t),n={};for(const e in t){const t=r[e]??O[e];if(T[e]){const r=this._complexValues[e];void 0!==r&&R(r,t)?n[e]=r:(this._complexValues[e]=t,n[e]=t)}else n[e]=t}return this._ensureConsistencyOnRead(n)}_ensureConsistencyOnRead(e){let t=!1,r={},n=!1,i={};if(void 0!==e.keyBindSet){const n=e.keyBindSet;for(const e of Object.keys(O.keyBindSet)){const i=e;void 0===n[i]?(r[i]=O.keyBindSet[i],t=!0):r[i]=n[i]}}if(void 0!==e.ankiFieldSettings){const t=e.ankiFieldSettings;for(const e of Object.keys(O.ankiFieldSettings)){const r=e;void 0===t[r]?(i[r]=O.ankiFieldSettings[r],n=!0):i[r]=t[r]}}return n||t?{...e,ankiFieldSettings:i,keyBindSet:r}:e}async set(e){await this._storage.set(await this._ensureConsistencyOnWrite(e))}async _ensureConsistencyOnWrite(e){if(void 0===e.customAnkiFields)return e;const t=e.customAnkiFieldSettings??(await this._storage.get({customAnkiFieldSettings:O.customAnkiFieldSettings})).customAnkiFieldSettings;let r=!1;for(const n of Object.keys(t))n in e.customAnkiFields||(delete t[n],r=!0);return r?{...e,customAnkiFieldSettings:t}:e}async activeProfile(){return await this._storage.activeProfile()}async setActiveProfile(e){await this._storage.setActiveProfile(e)}async profiles(){return await this._storage.profiles()}async addProfile(e){await this._storage.addProfile(e)}async removeProfile(e){await this._storage.removeProfile(e)}}const M=(e,t)=>`${(e=>`_prof_${e}_`)(t)}${e}`,B=(e,t)=>e.substring(t.length+7),D=(e,t)=>{const r={};for(const n of Object.keys(e))r[M(n,t)]=e[n];return r};r(4445);const N=["en","es","de","ja","pl","pt_BR","zh_CN","ru"],$="activeSettingsProfile",z="settingsProfiles";class U{constructor(e){this._storage=e??chrome.storage.local}async get(e){const t=await this.activeProfile();return void 0===t?await this._storage.get(e):((e,t)=>{const r={};for(const n of Object.keys(e))r[B(n,t)]=e[n];return r})(await this._storage.get(D(e,t.name)),t.name)}async set(e){const t=await this.activeProfile();void 0===t?await this._storage.set(e):await this._storage.set(D(e,t.name))}async activeProfile(){const e=(await this._storage.get($))[$];if(void 0!==e)return(await this.profiles()).find((t=>t.name===e))}async setActiveProfile(e){if(void 0===e)await this._storage.remove($);else{const t=void 0!==(await this.profiles()).find((t=>t.name===e));if(!t)throw new Error(`Cannot set active profile to non-existant profile ${e}`);await this._storage.set({[$]:e})}}async profiles(){return(await this._storage.get({[z]:[]}))[z]??[]}async addProfile(e){const t=await this.profiles(),r=t.find((t=>t.name===e));void 0===r&&t.push({name:e}),await this._storage.set({[z]:t});const n=await this._storage.get(Object.keys(O));await this._storage.set(D(n,e))}async removeProfile(e){const t=await this.profiles(),r=await this.activeProfile();if(e===r?.name)throw new Error("Cannot remove active profile");const n=t.filter((t=>t.name!==e)),i=Object.keys(D(O,e));await this._storage.remove(i),await this._storage.set({[z]:n})}async clear(){await this._storage.clear()}}const K=new I(new U),q=chrome.storage.local,L=async(e=!1)=>{if(!e){const e=(await q.get(["config"])).config;if("-"===e)return;if(void 0!==e&&("number"!=typeof e.ttl||Date.now()<e.ttl))return e}try{const e=`${await K.getSingle("streamingAppUrl")}/extension.json`,t=await(await fetch(e)).json();if(V(t))return await q.set({config:t}),t}catch(e){console.error(e)}},V=e=>void 0!==e&&Z(e.latest)&&W(e.languages),Z=e=>"string"==typeof e.version&&"string"==typeof e.url,W=e=>{if(void 0===e||"object"!=typeof e||!Array.isArray(e))return!1;for(const t of e)if("string"!=typeof t.code||"string"!=typeof t.url||"number"!=typeof t.version)return!1;return!0},H=e=>`locVersion-${e}`,G=new I(new U),J=async e=>{try{let t=await L();if(void 0===t)return;const r=t.languages.find((t=>t.code===e))??(await L(!0))?.languages.find((t=>t.code===e));if(void 0===r)return;const n=H(e),i=(await chrome.storage.local.get(n))[n];(void 0===i||i<r.version)&&await Q(r)}catch(e){console.error(e)}},Q=async({code:e,url:t,version:r})=>{const n=await G.getSingle("streamingAppUrl"),i=t.startsWith("http://")||t.startsWith("https://")?t:`${n}/${t}`;try{const t=await(await fetch(i)).json();if("object"==typeof t){const n=H(e),i=`locStrings-${e}`;await chrome.storage.local.set({[i]:t,[n]:r})}}catch(e){console.error(e)}};class Y{constructor(){this._pongReceived=!1,this._pingPromises=[]}get socket(){return this._socket}async bind(e){this._pingInterval&&clearInterval(this._pingInterval),this._pingInterval=setInterval((()=>{if(void 0===this._lastPingTimestampMs||this._pongReceived)this.ping().catch(console.info);else{console.log("Did not receive pong - reconnecting");for(const e of this._pingPromises)e.reject("Timed out");this._pingPromises=[],this._connect(e)}}),1e4),await this._connect(e)}async _connect(e){if(this._disconnect(),!e)throw new Error("Invalid URL");return new Promise(((t,r)=>{this._connectPromise={resolve:t,reject:r};const n=new WebSocket(e);n.onmessage=async e=>{if("PONG"===e.data){this._pongReceived=!0;for(const e of this._pingPromises)e.resolve(void 0);this._pingPromises=[]}else{const t=JSON.parse(e.data);if("mine-subtitle"===t.command){const e={command:"response",messageId:t.messageId,body:{published:await(this.onMineSubtitle?.(t))??!1}};this._socket?.send(JSON.stringify(e))}}},n.onclose=e=>{console.log(`Socket closed - reason: ${e.reason}`),this._connectPromise?.reject("Socket closed"),this._connectPromise=void 0},n.onerror=()=>{console.log("Socket error"),this._connectPromise?.reject("Socket error"),this._connectPromise=void 0},n.onopen=()=>{this.ping().catch(console.error),this._connectPromise?.resolve(void 0),this._connectPromise=void 0},this._socket=n}))}async ping(){return new Promise(((e,t)=>{this._socket&&this._socket.readyState===this._socket.OPEN?(this._socket.send("PING"),this._lastPingTimestampMs=Date.now(),this._pongReceived=!1,this._pingPromises.push({resolve:e,reject:t})):t("Not connected")}))}_disconnect(){this._socket&&(this._socket.readyState!==this._socket.CLOSED&&this._socket.readyState!==this._socket.CLOSING&&this._socket.close(),this._socket=void 0)}unbind(){this._disconnect(),void 0!==this._pingInterval&&(clearInterval(this._pingInterval),this._pingInterval=void 0);for(const e of this._pingPromises)e.reject("Disconnecting");this._pingPromises=[],this._lastPingTimestampMs=void 0,this._pongReceived=!1,this._connectPromise?.reject("Disconnecting"),this._connectPromise=void 0,this.onMineSubtitle=void 0}}let X;const ee=async(e,t)=>{X?.unbind();const r=await e.getSingle("webSocketServerUrl");r&&(X=new Y,X.bind(r),X.onMineSubtitle=async({body:{fields:r,postMineAction:n}})=>new Promise(((i,s)=>{chrome.tabs.query({active:!0,currentWindow:!0},(async s=>{const a=await e.get(S),o=r??{},c=o[a.wordField]||void 0,l=o[a.definitionField]||void 0,u=o[a.sentenceField]||void 0,d=Object.fromEntries(Object.entries(a.customAnkiFields).map((([e,t])=>{const r=o[t];if(void 0!==r)return[e,r]})).filter((e=>void 0!==e))),h=n??y.showAnkiDialog;let p=!1;const f=t.publishCommandToVideoElements((e=>{if(e.loadedSubtitles&&void 0!==s.find((t=>t.id===e.tab.id)))return p=!0,{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",word:c,definition:l,text:u,postMineAction:h,customFieldValues:d},src:e.src}})),m=await t.publishCommandToAsbplayers({commandFactory:e=>{if(!e.sidePanel&&e.loadedSubtitles)return p=!0,{sender:"asbplayer-extension-to-player",message:{command:"copy-subtitle-with-additional-fields",word:c,definition:l,text:u,postMineAction:h,customFieldValues:d},asbplayerId:e.id}}});await f,await m,i(p)}))})))},te=()=>{X?.unbind()},re="tabRequestingActiveTabPermission";var ne,ie=new Uint8Array(16);function se(){if(!ne&&!(ne="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ne(ie)}const ae=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var oe=[],ce=0;ce<256;++ce)oe.push((ce+256).toString(16).substr(1));const le=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(oe[e[t+0]]+oe[e[t+1]]+oe[e[t+2]]+oe[e[t+3]]+"-"+oe[e[t+4]]+oe[e[t+5]]+"-"+oe[e[t+6]]+oe[e[t+7]]+"-"+oe[e[t+8]]+oe[e[t+9]]+"-"+oe[e[t+10]]+oe[e[t+11]]+oe[e[t+12]]+oe[e[t+13]]+oe[e[t+14]]+oe[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&ae.test(e)}(r))throw TypeError("Stringified UUID is invalid");return r},ue=function(e,t,r){var n=(e=e||{}).random||(e.rng||se)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return le(n)};class de{static async encode(e,t){return new Promise((async(r,n)=>{var i=new FileReader;i.onload=async e=>{try{const i=new AudioContext;if(null===e.target)return void n(new Error("Could not obtain buffer to encode"));const s=await i.decodeAudioData(e.target.result),a=[];for(let e=0;e<s.numberOfChannels;++e)a.push(s.getChannelData(e));const o=t(),c=o instanceof Worker?o:await o;c.postMessage({command:"encode",audioBuffer:{channels:a,numberOfChannels:s.numberOfChannels,length:s.length,sampleRate:s.sampleRate}}),c.onmessage=e=>{r(new Blob(e.data.buffer,{type:"audio/mp3"})),c.terminate()},c.onerror=e=>{const t=e?.error??new Error("MP3 encoding failed: "+e?.message);n(t),c.terminate()}}catch(e){n(e)}},i.readAsArrayBuffer(e)}))}}const he=(e,t)=>`${e.replaceAll(" ","_").substring(0,Math.min(e.length,24))}_${Math.floor(t)}`;class pe{constructor(e,t,r,n,i,s,a){this._name=he(e,t),this._start=t,this._end=r,this.playbackRate=n,this._base64=i,this._extension=s,this._error=a}get name(){return this._name}get extension(){return this._extension}get start(){return this._start}get end(){return this._end}async base64(){return this._base64}async blob(){return await this._blob()}async play(){if(this.playingAudio)return void this.stop();const e=await this._blob(),t=new Audio;t.src=URL.createObjectURL(e),t.preload="metadata",this.playingAudio=t,await t.play(),this.stopAudioTimeout=setTimeout((()=>{this.stopAudio(t),this.playingAudio=void 0,this.stopAudioTimeout=void 0}),(this._end-this._start)/this.playbackRate+100)}stop(){this.playingAudio&&(this.stopAudio(this.playingAudio),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0)}stopAudio(e){e.pause();const t=e.src;e.removeAttribute("src"),e.load(),URL.revokeObjectURL(t)}async _blob(){return this.cachedBlob||(this.cachedBlob=await(await fetch("data:audio/"+this.extension+";base64,"+this._base64)).blob()),this.cachedBlob}slice(e,t){return this}isSliceable(){return!1}get error(){return this._error}}class fe{constructor(e,t,r,n,i){const[s,a]=function(){const e={"audio/ogg;codecs=opus":"ogg","audio/webm;codecs=opus":"webm"};return Object.keys(e).filter(MediaRecorder.isTypeSupported).map((t=>[t,e[t]]))[0]}();this.recorderMimeType=s,this.file=e,this._name=he(e.name,t),this._start=t,this._end=r,this.playbackRate=n,this.trackId=i,this._extension=a}get name(){return this._name}get extension(){return this._extension}get start(){return this._start}get end(){return this._end}async base64(){return new Promise((async(e,t)=>{var r=new FileReader;const n=await this.blob();void 0===n?t("Did not finish recording blob"):(r.readAsDataURL(n),r.onloadend=()=>{const t=r.result,n=t.substring(t.indexOf(",")+1);e(n)})}))}async play(){if(!this._blob)return void(this._blob=await this._clipAudio());if(this.playingAudio)return void this._stopPlayingAudio();const e=await this._audioElement(URL.createObjectURL(this._blob),!1);e.currentTime=0,await e.play(),this.playingAudio=e,this.stopAudioTimeout=setTimeout((()=>{this.stopAudio(e,!0),this.stopAudioTimeout=void 0,this.playingAudio=void 0}),(this._end-this._start)/this.playbackRate+100)}stop(){this.playingAudio&&this._stopPlayingAudio(),this.clippingAudio&&this._stopClippingAudio()}async blob(){if(this._blob||(this._blob=await this._clipAudio()),void 0===this._blob)throw new Error("Did not finish recording blob");return this._blob}async _clipAudio(){if(!this.clippingAudio)return new Promise((async(e,t)=>{try{const r=await this._audioElement(this.file.blobUrl,!0);r.oncanplay=async n=>{r.play();const i=this._captureStream(r),s=new MediaRecorder(i,{mimeType:this.recorderMimeType}),a=[];s.ondataavailable=e=>{a.push(e.data)};let o=!1;s.onstop=t=>{o&&e(new Blob(a,{type:this.recorderMimeType}))},s.start(),this.clippingAudioReject=t,this.clippingAudio=r,this.stopClippingTimeout=setTimeout((()=>{this.stopAudio(r,!1),this.clippingAudio=void 0,this.stopClippingTimeout=void 0,this.clippingAudioReject=void 0,o=!0,s.stop();for(const e of i.getAudioTracks())e.stop()}),(this._end-this._start)/this.playbackRate+100),r.oncanplay=null}}catch(e){t(e)}}));this._stopClippingAudio()}_stopClippingAudio(){this.clippingAudio&&(this.stopAudio(this.clippingAudio,!1),clearTimeout(this.stopClippingTimeout),this.clippingAudioReject?.("Did not finish recording blob"),this.clippingAudio=void 0,this.stopClippingTimeout=void 0,this.clippingAudioReject=void 0)}_stopPlayingAudio(){this.playingAudio&&(this.stopAudio(this.playingAudio,!0),clearTimeout(this.stopAudioTimeout),this.playingAudio=void 0,this.stopAudioTimeout=void 0)}_audioElement(e,t){const r=new Audio;return r.preload="metadata",r.src=e,new Promise(((e,n)=>{r.onloadedmetadata=()=>{if(t&&this.trackId&&r.audioTracks&&r.audioTracks.length>0)for(const e of r.audioTracks)e.enabled=this.trackId===e.id;r.currentTime=this._start/1e3,r.playbackRate=this.playbackRate,e(r)},r.onerror=()=>{n(r.error?.message??"Could not load audio")}}))}stopAudio(e,t){e.pause();const r=e.src;e.removeAttribute("src"),e.load(),t&&URL.revokeObjectURL(r)}_captureStream(e){let t;if("function"==typeof e.captureStream&&(t=e.captureStream()),"function"==typeof e.mozCaptureStream&&(t=e.mozCaptureStream()),void 0===t)throw new Error("Unable to capture stream from audio");const r=new MediaStream;for(const e of t.getVideoTracks())e.stop();for(const e of t.getAudioTracks())e.enabled&&r.addTrack(e);return r}slice(e,t){return new fe(this.file,e,t,this.playbackRate,this.trackId)}isSliceable(){return!0}get error(){if(this.file.blobUrl)return l(this.file.blobUrl)?void 0:m.fileLinkLost}}class me{constructor(e,t){this.data=e,this.workerFactory=t}get name(){return this.data.name}get extension(){return"mp3"}get start(){return this.data.start}get end(){return this.data.end}async base64(){return new Promise((async(e,t)=>{try{var r=new FileReader;r.readAsDataURL(await this.blob()),r.onloadend=()=>{const t=r.result,n=t.substring(t.indexOf(",")+1);e(n)}}catch(e){t(e)}}))}async play(){await this.data.play()}stop(){this.data.stop()}async blob(){return this._blob||(this._blob=await de.encode(await this.data.blob(),this.workerFactory)),this._blob}slice(e,t){return new me(this.data.slice(e,t),this.workerFactory)}isSliceable(){return this.data.isSliceable()}get error(){return this.data.error}}class ye{constructor(e){this.data=e}static fromCard(e,t,r){if(e.audio){const t=e.audio.start??e.subtitle.start,r=e.audio.end??e.subtitle.end;return ye.fromBase64(e.subtitleFileName,Math.max(0,t-(e.audio.paddingStart??0)),r+(e.audio.paddingEnd??0),e.audio.playbackRate??1,e.audio.base64,e.audio.extension,e.audio.error)}if(e.file)return ye.fromFile(e.file,Math.max(0,e.subtitle.start-t),e.subtitle.end+r,e.file?.playbackRate??1,e.file?.audioTrack)}static fromBase64(e,t,r,n,i,s,a){return new ye(new pe(e.substring(0,e.lastIndexOf(".")),t,r,n,i,s,a))}static fromFile(e,t,r,n,i){return new ye(new fe(e,t,r,n,i))}get start(){return this.data.start}get end(){return this.data.end}get name(){return this.data.name+"."+this.data.extension}get extension(){return this.data.extension}async play(){await this.data.play()}stop(){this.data.stop()}async base64(){return await this.data.base64()}async download(){o(await this.data.blob(),this.name)}toMp3(e){return this.data instanceof me||"mp3"===this.data.extension?this:new ye(new me(this.data,e))}slice(e,t){return new ye(this.data.slice(e,t))}isSliceable(){return this.data.isSliceable()}get error(){return this.data.error}get errorLocKey(){if(void 0!==this.data.error)switch(this.data.error){case m.drmProtected:return"audioCaptureFailed.message";case m.fileLinkLost:return"ankiDialog.audioFileLinkLost"}}}const ge=['"',"*","_","\\",":"],be=e=>{const t=/(.*)\.(.*)/.exec(e);if(null===t||t.length<3)return e;const r=t[1],n=t[2];return`${r}_${(()=>{let e="";for(let t=0;t<8;++t)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return e})()}.${n}`},ve="<([^/ >])*[^>]*>(.*?)</\\1>",we=e=>{const t=new RegExp(ve);let r=e,n=[e];for(;;){const e=t.exec(r);if(null===e||e.length<3)break;r=e[2],n.push(r)}return n};async function _e(e,t,r){const n=new Ae(t),i=(o=e.subtitleFileName,0===(c=e.mediaTimestamp)?o:`${o} (${s(c)})`);var o,c;let l=void 0===e.audio?void 0:ye.fromBase64(i,e.subtitle.start,e.subtitle.end,e.audio.playbackRate??1,e.audio.base64,e.audio.extension,e.audio.error);return await n.export({text:e.text??a(e.subtitle,e.surroundingSubtitles),track1:a(e.subtitle,e.surroundingSubtitles,0),track2:a(e.subtitle,e.surroundingSubtitles,1),track3:a(e.subtitle,e.surroundingSubtitles,2),definition:e.definition,audioClip:l,image:void 0===e.image?void 0:f.fromBase64(i,e.subtitle.start,e.image.base64,e.image.extension),word:e.word,source:i,url:e.url,customFieldValues:e.customFieldValues??{},tags:t.tags,mode:r})}class Ae{constructor(e,t=new w){this.settingsProvider=e,this.fetcher=t}async deckNames(e){return(await this._executeAction("deckNames",null,e)).result}async modelNames(e){return(await this._executeAction("modelNames",null,e)).result}async modelFieldNames(e,t){return(await this._executeAction("modelFieldNames",{modelName:e},t)).result}async findNotesWithWord(e,t){return(await this._executeAction("findNotes",{query:this.settingsProvider.wordField+":"+this._escapeQuery(e)},t)).result}async findNotesWithWordGui(e,t){return(await this._executeAction("guiBrowse",{query:this.settingsProvider.wordField+":"+this._escapeQuery(e)},t)).result}_escapeQuery(e){let t="";for(let r=0;r<e.length;++r){const n=e[r];ge.includes(n)?t+=`\\${n}`:t+=n}return`"${t}"`}async requestPermission(e){return(await this._executeAction("requestPermission",null,e)).result}async version(e){return(await this._executeAction("version",null,e)).result}async export({text:e,track1:t,track2:r,track3:n,definition:i,audioClip:s,image:a,word:o,source:c,url:l,customFieldValues:u,tags:d,mode:h,ankiConnectUrl:p}){const f={};if(this._appendField(f,this.settingsProvider.sentenceField,e,!0),this._appendField(f,this.settingsProvider.track1Field,t,!0),this._appendField(f,this.settingsProvider.track2Field,r,!0),this._appendField(f,this.settingsProvider.track3Field,n,!0),this._appendField(f,this.settingsProvider.definitionField,i,!0),this._appendField(f,this.settingsProvider.wordField,o,!1),this._appendField(f,this.settingsProvider.sourceField,c,!1),this._appendField(f,this.settingsProvider.urlField,l,!1),u)for(const e of Object.keys(u))this._appendField(f,this.settingsProvider.customAnkiFields[e],u[e],!0);const m={note:{deckName:this.settingsProvider.deck,modelName:this.settingsProvider.noteType,tags:d,options:{allowDuplicate:!1,duplicateScope:"deck",duplicateScopeOptions:{deckName:this.settingsProvider.deck,checkChildren:!1}}}},y="gui"===h,g="updateLast"===h;if(this.settingsProvider.audioField&&s&&void 0===s.error){const e=this._sanitizeFileName(s.name),t=await s.base64();if(t)if(y||g){const r=(await this._storeMediaFile(e,t,p)).result;this._appendField(f,this.settingsProvider.audioField,`[sound:${r}]`,!1)}else m.note.audio={filename:e,data:t,fields:[this.settingsProvider.audioField]}}if(this.settingsProvider.imageField&&a&&a.isAvailable()){const e=this._sanitizeFileName(a.name),t=await a.base64();if(t)if(y||g){const r=(await this._storeMediaFile(e,t,p)).result;this._appendField(f,this.settingsProvider.imageField,`<img src="${r}">`,!1)}else m.note.picture={filename:e,data:t,fields:[this.settingsProvider.imageField]}}switch(m.note.fields=f,h){case"gui":return(await this._executeAction("guiAddCards",m,p)).result;case"updateLast":const e=(await this._executeAction("findNotes",{query:"added:1"},p)).result.sort();if(0===e.length)throw new Error("Could not find note to update");const t=e[e.length-1];m.note.id=t;const r=await this._executeAction("notesInfo",{notes:[t]});if(r.result.length>0&&r.result[0].noteId===t){const e=r.result[0];if(this.settingsProvider.sentenceField&&e.fields&&"string"==typeof e.fields[this.settingsProvider.sentenceField]?.value&&"string"==typeof m.note.fields[this.settingsProvider.sentenceField]&&(m.note.fields[this.settingsProvider.sentenceField]=((e,t)=>{const r=new RegExp(ve,"ig"),n=t.replaceAll("<br>","");let i=e;for(;;){const e=r.exec(n);if(null===e||e.length<3)break;let t=i;if(!i.includes(e[0])){const r=we(e[2]);for(const n of r)if(t=i.replace(n,e[0]),t!==i)break}i=t}return i})(m.note.fields[this.settingsProvider.sentenceField],e.fields[this.settingsProvider.sentenceField].value)),await this._executeAction("updateNoteFields",m,p),d.length>0&&await this._executeAction("addTags",{notes:[t],tags:d.join(" ")},p),!this.settingsProvider.wordField||!e.fields)return e.noteId;const n=e.fields[this.settingsProvider.wordField];return n&&n.value?n.value:e.noteId}throw new Error("Could not update last card because the card info could not be fetched");case"default":return(await this._executeAction("addNote",m,p)).result;default:throw new Error("Unknown export mode: "+h)}}_appendField(e,t,r,n){if(!t||!r)return;let i=n?r.split("\n").join("<br>"):r;const s=e[t];s&&(i=s+"<br>"+i),e[t]=i}_sanitizeFileName(e){return i()(e,{replacement:"_"})}async _storeMediaFile(e,t,r){return this._executeAction("storeMediaFile",{filename:be(e),data:t,deleteExisting:!1},r)}async _executeAction(e,t,r){const n={action:e,version:6};t&&(n.params=t);const i=await this.fetcher.fetch(r||this.settingsProvider.ankiConnectUrl,n);if(i.error)throw new Error(i.error);return i}}const xe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:global,Se=Object.keys,ke=Array.isArray;function Fe(e,t){return"object"!=typeof t||Se(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||xe.Promise||(xe.Promise=Promise);const Pe=Object.getPrototypeOf,Ee={}.hasOwnProperty;function Oe(e,t){return Ee.call(e,t)}function je(e,t){"function"==typeof t&&(t=t(Pe(e))),("undefined"==typeof Reflect?Se:Reflect.ownKeys)(t).forEach((r=>{Re(e,r,t[r])}))}const Ce=Object.defineProperty;function Re(e,t,r,n){Ce(e,t,Fe(r&&Oe(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function Te(e){return{from:function(t){return e.prototype=Object.create(t.prototype),Re(e.prototype,"constructor",e),{extend:je.bind(null,e.prototype)}}}}const Ie=Object.getOwnPropertyDescriptor;function Me(e,t){let r;return Ie(e,t)||(r=Pe(e))&&Me(r,t)}const Be=[].slice;function De(e,t,r){return Be.call(e,t,r)}function Ne(e,t){return t(e)}function $e(e){if(!e)throw new Error("Assertion Failed")}function ze(e){xe.setImmediate?setImmediate(e):setTimeout(e,0)}function Ue(e,t){return e.reduce(((e,r,n)=>{var i=t(r,n);return i&&(e[i[0]]=i[1]),e}),{})}function Ke(e,t){if(Oe(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,i=t.length;n<i;++n){var s=Ke(e,t[n]);r.push(s)}return r}var a=t.indexOf(".");if(-1!==a){var o=e[t.substr(0,a)];return void 0===o?void 0:Ke(o,t.substr(a+1))}}function qe(e,t,r){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){$e("string"!=typeof r&&"length"in r);for(var n=0,i=t.length;n<i;++n)qe(e,t[n],r[n])}else{var s=t.indexOf(".");if(-1!==s){var a=t.substr(0,s),o=t.substr(s+1);if(""===o)void 0===r?ke(e)&&!isNaN(parseInt(a))?e.splice(a,1):delete e[a]:e[a]=r;else{var c=e[a];c&&Oe(e,a)||(c=e[a]={}),qe(c,o,r)}}else void 0===r?ke(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function Le(e){var t={};for(var r in e)Oe(e,r)&&(t[r]=e[r]);return t}const Ve=[].concat;function Ze(e){return Ve.apply([],e)}const We="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(Ze([8,16,32,64].map((e=>["Int","Uint","Float"].map((t=>t+e+"Array")))))).filter((e=>xe[e])),He=We.map((e=>xe[e]));Ue(We,(e=>[e,!0]));let Ge=null;function Je(e){Ge="undefined"!=typeof WeakMap&&new WeakMap;const t=Qe(e);return Ge=null,t}function Qe(e){if(!e||"object"!=typeof e)return e;let t=Ge&&Ge.get(e);if(t)return t;if(ke(e)){t=[],Ge&&Ge.set(e,t);for(var r=0,n=e.length;r<n;++r)t.push(Qe(e[r]))}else if(He.indexOf(e.constructor)>=0)t=e;else{const r=Pe(e);for(var i in t=r===Object.prototype?{}:Object.create(r),Ge&&Ge.set(e,t),e)Oe(e,i)&&(t[i]=Qe(e[i]))}return t}const{toString:Ye}={};function Xe(e){return Ye.call(e).slice(8,-1)}const et="undefined"!=typeof Symbol?Symbol.iterator:"@@iterator",tt="symbol"==typeof et?function(e){var t;return null!=e&&(t=e[et])&&t.apply(e)}:function(){return null},rt={};function nt(e){var t,r,n,i;if(1===arguments.length){if(ke(e))return e.slice();if(this===rt&&"string"==typeof e)return[e];if(i=tt(e)){for(r=[];!(n=i.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}const it="undefined"!=typeof Symbol?e=>"AsyncFunction"===e[Symbol.toStringTag]:()=>!1;var st="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function at(e,t){st=e,ot=t}var ot=()=>!0;const ct=!new Error("").stack;function lt(){if(ct)try{throw lt.arguments,new Error}catch(e){return e}return new Error}function ut(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(ot).map((e=>"\n"+e)).join("")):""}var dt=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],ht=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(dt),pt={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function ft(e,t){this._e=lt(),this.name=e,this.message=t}function mt(e,t){return e+". Errors: "+Object.keys(t).map((e=>t[e].toString())).filter(((e,t,r)=>r.indexOf(e)===t)).join("\n")}function yt(e,t,r,n){this._e=lt(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=mt(e,t)}function gt(e,t){this._e=lt(),this.name="BulkError",this.failures=Object.keys(t).map((e=>t[e])),this.failuresByPos=t,this.message=mt(e,t)}Te(ft).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ut(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Te(yt).from(ft),Te(gt).from(ft);var bt=ht.reduce(((e,t)=>(e[t]=t+"Error",e)),{});const vt=ft;var wt=ht.reduce(((e,t)=>{var r=t+"Error";function n(e,n){this._e=lt(),this.name=r,e?"string"==typeof e?(this.message=`${e}${n?"\n "+n:""}`,this.inner=n||null):"object"==typeof e&&(this.message=`${e.name} ${e.message}`,this.inner=e):(this.message=pt[t]||r,this.inner=null)}return Te(n).from(vt),e[t]=n,e}),{});wt.Syntax=SyntaxError,wt.Type=TypeError,wt.Range=RangeError;var _t=dt.reduce(((e,t)=>(e[t+"Error"]=wt[t],e)),{}),At=ht.reduce(((e,t)=>(-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=wt[t]),e)),{});function xt(){}function St(e){return e}function kt(e,t){return null==e||e===St?t:function(r){return t(e(r))}}function Ft(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function Pt(e,t){return e===xt?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?Ft(n,this.onsuccess):n),i&&(this.onerror=this.onerror?Ft(i,this.onerror):i),void 0!==s?s:r}}function Et(e,t){return e===xt?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?Ft(r,this.onsuccess):r),n&&(this.onerror=this.onerror?Ft(n,this.onerror):n)}}function Ot(e,t){return e===xt?t:function(r){var n=e.apply(this,arguments);Fe(r,n);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?Ft(i,this.onsuccess):i),s&&(this.onerror=this.onerror?Ft(s,this.onerror):s),void 0===n?void 0===a?void 0:a:Fe(n,a)}}function jt(e,t){return e===xt?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function Ct(e,t){return e===xt?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return r.then((function(){return t.apply(n,s)}))}return t.apply(this,arguments)}}At.ModifyError=yt,At.DexieError=ft,At.BulkError=gt;var Rt={};const[Tt,It,Mt]="undefined"==typeof Promise?[]:(()=>{let e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,Pe(e),e];const t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,Pe(t),e]})(),Bt=It&&It.then,Dt=Tt&&Tt.constructor,Nt=!!Mt;var $t=!1,zt=Mt?()=>{Mt.then(lr)}:xe.setImmediate?setImmediate.bind(null,lr):xe.MutationObserver?()=>{var e=document.createElement("div");new MutationObserver((()=>{lr(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:()=>{setTimeout(lr,0)},Ut=function(e,t){Jt.push([e,t]),qt&&(zt(),qt=!1)},Kt=!0,qt=!0,Lt=[],Vt=[],Zt=null,Wt=St,Ht={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Tr,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((e=>{try{Tr(e[0],e[1])}catch(e){}}))}},Gt=Ht,Jt=[],Qt=0,Yt=[];function Xt(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=xt,this._lib=!1;var t=this._PSD=Gt;if(st&&(this._stackHolder=lt(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==Rt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&nr(this,this._value))}this._state=null,this._value=null,++t.ref,rr(this,e)}const er={get:function(){var e=Gt,t=vr;function r(r,n){var i=!e.global&&(e!==Gt||t!==vr);const s=i&&!xr();var a=new Xt(((t,a)=>{sr(this,new tr(Cr(r,e,i,s),Cr(n,e,i,s),t,a,e))}));return st&&cr(a,this),a}return r.prototype=Rt,r},set:function(e){Re(this,"then",e&&e.prototype===Rt?er:{get:function(){return e},set:er.set})}};function tr(e,t,r,n,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=i}function rr(e,t){try{t((t=>{if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&ur();t&&"function"==typeof t.then?rr(e,((e,r)=>{t instanceof Xt?t._then(e,r):t.then(e,r)})):(e._state=!0,e._value=t,ir(e)),r&&dr()}}),nr.bind(null,e))}catch(t){nr(e,t)}}function nr(e,t){if(Vt.push(t),null===e._state){var r=e._lib&&ur();t=Wt(t),e._state=!1,e._value=t,st&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,r){try{e.apply(null,void 0)}catch(e){}}((()=>{var r=Me(t,"stack");t._promise=e,Re(t,"stack",{get:()=>$t?r&&(r.get?r.get.apply(t):r.value):e.stack})})),function(e){Lt.some((t=>t._value===e._value))||Lt.push(e)}(e),ir(e),r&&dr()}}function ir(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)sr(e,t[r]);var i=e._PSD;--i.ref||i.finalize(),0===Qt&&(++Qt,Ut((()=>{0==--Qt&&hr()}),[]))}function sr(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Qt,Ut(ar,[r,e,t])}else e._listeners.push(t)}function ar(e,t,r){try{Zt=t;var n,i=t._value;t._state?n=e(i):(Vt.length&&(Vt=[]),n=e(i),-1===Vt.indexOf(i)&&function(e){for(var t=Lt.length;t;)if(Lt[--t]._value===e._value)return void Lt.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Zt=null,0==--Qt&&hr(),--r.psd.ref||r.psd.finalize()}}function or(e,t,r){if(t.length===r)return t;var n="";if(!1===e._state){var i,s,a=e._value;null!=a?(i=a.name||"Error",s=a.message||a,n=ut(a,0)):(i=a,s=""),t.push(i+(s?": "+s:"")+n)}return st&&((n=ut(e._stackHolder,2))&&-1===t.indexOf(n)&&t.push(n),e._prev&&or(e._prev,t,r)),t}function cr(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function lr(){ur()&&dr()}function ur(){var e=Kt;return Kt=!1,qt=!1,e}function dr(){var e,t,r;do{for(;Jt.length>0;)for(e=Jt,Jt=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(Jt.length>0);Kt=!0,qt=!0}function hr(){var e=Lt;Lt=[],e.forEach((e=>{e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Yt.slice(0),r=t.length;r;)t[--r]()}function pr(e){return new Xt(Rt,!1,e)}function fr(e,t){var r=Gt;return function(){var n=ur(),i=Gt;try{return Pr(r,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{Pr(i,!1),n&&dr()}}}je(Xt.prototype,{then:er,_then:function(e,t){sr(this,new tr(null,null,e,t,Gt))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],r=arguments[1];return"function"==typeof t?this.then(null,(e=>e instanceof t?r(e):pr(e))):this.then(null,(e=>e&&e.name===t?r(e):pr(e)))},finally:function(e){return this.then((t=>(e(),t)),(t=>(e(),pr(t))))},stack:{get:function(){if(this._stack)return this._stack;try{$t=!0;var e=or(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{$t=!1}}},timeout:function(e,t){return e<1/0?new Xt(((r,n)=>{var i=setTimeout((()=>n(new wt.Timeout(t))),e);this.then(r,n).finally(clearTimeout.bind(null,i))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&Re(Xt.prototype,Symbol.toStringTag,"Dexie.Promise"),Ht.env=Er(),je(Xt,{all:function(){var e=nt.apply(null,arguments).map(Sr);return new Xt((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach(((i,s)=>Xt.resolve(i).then((r=>{e[s]=r,--n||t(e)}),r)))}))},resolve:e=>{if(e instanceof Xt)return e;if(e&&"function"==typeof e.then)return new Xt(((t,r)=>{e.then(t,r)}));var t=new Xt(Rt,!0,e);return cr(t,Zt),t},reject:pr,race:function(){var e=nt.apply(null,arguments).map(Sr);return new Xt(((t,r)=>{e.map((e=>Xt.resolve(e).then(t,r)))}))},PSD:{get:()=>Gt,set:e=>Gt=e},totalEchoes:{get:()=>vr},newPSD:_r,usePSD:Or,scheduler:{get:()=>Ut,set:e=>{Ut=e}},rejectionMapper:{get:()=>Wt,set:e=>{Wt=e}},follow:(e,t)=>new Xt(((r,n)=>_r(((t,r)=>{var n=Gt;n.unhandleds=[],n.onunhandled=r,n.finalize=Ft((function(){!function(e){Yt.push((function t(){e(),Yt.splice(Yt.indexOf(t),1)})),++Qt,Ut((()=>{0==--Qt&&hr()}),[])}((()=>{0===this.unhandleds.length?t():r(this.unhandleds[0])}))}),n.finalize),e()}),t,r,n)))}),Dt&&(Dt.allSettled&&Re(Xt,"allSettled",(function(){const e=nt.apply(null,arguments).map(Sr);return new Xt((t=>{0===e.length&&t([]);let r=e.length;const n=new Array(r);e.forEach(((e,i)=>Xt.resolve(e).then((e=>n[i]={status:"fulfilled",value:e}),(e=>n[i]={status:"rejected",reason:e})).then((()=>--r||t(n)))))}))})),Dt.any&&"undefined"!=typeof AggregateError&&Re(Xt,"any",(function(){const e=nt.apply(null,arguments).map(Sr);return new Xt(((t,r)=>{0===e.length&&r(new AggregateError([]));let n=e.length;const i=new Array(n);e.forEach(((e,s)=>Xt.resolve(e).then((e=>t(e)),(e=>{i[s]=e,--n||r(new AggregateError(i))}))))}))})));const mr={awaits:0,echoes:0,id:0};var yr=0,gr=[],br=0,vr=0,wr=0;function _r(e,t,r,n){var i=Gt,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++wr;var a=Ht.env;s.env=Nt?{Promise:Xt,PromiseProp:{value:Xt,configurable:!0,writable:!0},all:Xt.all,race:Xt.race,allSettled:Xt.allSettled,any:Xt.any,resolve:Xt.resolve,reject:Xt.reject,nthen:Rr(a.nthen,s),gthen:Rr(a.gthen,s)}:{},t&&Fe(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var o=Or(s,e,r,n);return 0===s.ref&&s.finalize(),o}function Ar(){return mr.id||(mr.id=++yr),++mr.awaits,mr.echoes+=100,mr.id}function xr(){return!!mr.awaits&&(0==--mr.awaits&&(mr.id=0),mr.echoes=100*mr.awaits,!0)}function Sr(e){return mr.echoes&&e&&e.constructor===Dt?(Ar(),e.then((e=>(xr(),e)),(e=>(xr(),Ir(e))))):e}function kr(e){++vr,mr.echoes&&0!=--mr.echoes||(mr.echoes=mr.id=0),gr.push(Gt),Pr(e,!0)}function Fr(){var e=gr[gr.length-1];gr.pop(),Pr(e,!1)}function Pr(e,t){var r=Gt;if((t?!mr.echoes||br++&&e===Gt:!br||--br&&e===Gt)||jr(t?kr.bind(null,e):Fr),e!==Gt&&(Gt=e,r===Ht&&(Ht.env=Er()),Nt)){var n=Ht.env.Promise,i=e.env;It.then=i.nthen,n.prototype.then=i.gthen,(r.global||e.global)&&(Object.defineProperty(xe,"Promise",i.PromiseProp),n.all=i.all,n.race=i.race,n.resolve=i.resolve,n.reject=i.reject,i.allSettled&&(n.allSettled=i.allSettled),i.any&&(n.any=i.any))}}function Er(){var e=xe.Promise;return Nt?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(xe,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:It.then,gthen:e.prototype.then}:{}}function Or(e,t,r,n,i){var s=Gt;try{return Pr(e,!0),t(r,n,i)}finally{Pr(s,!1)}}function jr(e){Bt.call(Tt,e)}function Cr(e,t,r,n){return"function"!=typeof e?e:function(){var i=Gt;r&&Ar(),Pr(t,!0);try{return e.apply(this,arguments)}finally{Pr(i,!1),n&&jr(xr)}}}function Rr(e,t){return function(r,n){return e.call(this,Cr(r,t),Cr(n,t))}}function Tr(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,i={promise:t,reason:e};if(xe.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),Fe(n,i)):xe.CustomEvent&&Fe(n=new CustomEvent("unhandledrejection",{detail:i}),i),n&&xe.dispatchEvent&&(dispatchEvent(n),!xe.PromiseRejectionEvent&&xe.onunhandledrejection))try{xe.onunhandledrejection(n)}catch(e){}st&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${e.stack||e}`)}catch(e){}}-1===(""+Bt).indexOf("[native code]")&&(Ar=xr=xt);var Ir=Xt.reject;function Mr(e,t,r,n){if(e.idbdb&&(e._state.openComplete||Gt.letThrough||e._vip)){var i=e._createTransaction(t,r,e._dbSchema);try{i.create(),e._state.PR1398_maxLoop=3}catch(i){return i.name===bt.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Mr(e,t,r,n)))):Ir(i)}return i._promise(t,((e,t)=>_r((()=>(Gt.trans=i,n(e,t,i)))))).then((e=>i._completion.then((()=>e))))}if(e._state.openComplete)return Ir(new wt.DatabaseClosed(e._state.dbOpenError));if(!e._state.isBeingOpened){if(!e._options.autoOpen)return Ir(new wt.DatabaseClosed);e.open().catch(xt)}return e._state.dbReadyPromise.then((()=>Mr(e,t,r,n)))}const Br=String.fromCharCode(65535),Dr="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Nr=[],$r="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),zr=$r,Ur=$r,Kr=e=>!/(dexie\.js|dexie\.min\.js)/.test(e);function qr(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}const Lr={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Vr(e){return"string"!=typeof e||/\./.test(e)?e=>e:t=>(void 0===t[e]&&e in t&&delete(t=Je(t))[e],t)}class Zr{_trans(e,t,r){const n=this._tx||Gt.trans,i=this.name;function s(e,r,n){if(!n.schema[i])throw new wt.NotFound("Table "+i+" not part of transaction");return t(n.idbtrans,n)}const a=ur();try{return n&&n.db===this.db?n===Gt.trans?n._promise(e,s,r):_r((()=>n._promise(e,s,r)),{trans:n,transless:Gt.transless||Gt}):Mr(this.db,e,[this.name],s)}finally{a&&dr()}}get(e,t){return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(t=>this.core.get({trans:t,key:e}).then((e=>this.hook.reading.fire(e))))).then(t)}where(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(ke(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const t=Se(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter((e=>e.compound&&t.every((t=>e.keyPath.indexOf(t)>=0))&&e.keyPath.every((e=>t.indexOf(e)>=0))))[0];if(r&&this.db._maxKey!==Br)return this.where(r.name).equals(r.keyPath.map((t=>e[t])));!r&&st&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${t.join("+")}]`);const{idxByName:n}=this.schema,i=this.db._deps.indexedDB;function s(e,t){try{return 0===i.cmp(e,t)}catch(e){return!1}}const[a,o]=t.reduce((([t,r],i)=>{const a=n[i],o=e[i];return[t||a,t||!a?qr(r,a&&a.multi?e=>{const t=Ke(e,i);return ke(t)&&t.some((e=>s(o,e)))}:e=>s(o,Ke(e,i))):r]}),[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(o):r?this.filter(o):this.where(t).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,ke(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const t=t=>{if(!t)return t;const r=Object.create(e.prototype);for(var n in t)if(Oe(t,n))try{r[n]=t[n]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e}defineClass(){return this.mapToClass((function(e){Fe(this,e)}))}add(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let i=e;return n&&r&&(i=Vr(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"add",keys:null!=t?[t]:null,values:[i]}))).then((e=>e.numFailures?Xt.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{qe(e,n,t)}catch(e){}return t}))}update(e,t){if("object"!=typeof e||ke(e))return this.where(":id").equals(e).modify(t);{const r=Ke(e,this.schema.primKey.keyPath);if(void 0===r)return Ir(new wt.InvalidArgument("Given object does not contain its primary key"));try{"function"!=typeof t?Se(t).forEach((r=>{qe(e,r,t[r])})):t(e,{value:e,primKey:r})}catch(e){}return this.where(":id").equals(r).modify(t)}}put(e,t){const{auto:r,keyPath:n}=this.schema.primKey;let i=e;return n&&r&&(i=Vr(n)(e)),this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"put",values:[i],keys:null!=t?[t]:null}))).then((e=>e.numFailures?Xt.reject(e.failures[0]):e.lastResult)).then((t=>{if(n)try{qe(e,n,t)}catch(e){}return t}))}delete(e){return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:[e]}))).then((e=>e.numFailures?Xt.reject(e.failures[0]):void 0))}clear(){return this._trans("readwrite",(e=>this.core.mutate({trans:e,type:"deleteRange",range:Lr}))).then((e=>e.numFailures?Xt.reject(e.failures[0]):void 0))}bulkGet(e){return this._trans("readonly",(t=>this.core.getMany({keys:e,trans:t}).then((e=>e.map((e=>this.hook.reading.fire(e)))))))}bulkAdd(e,t,r){const n=Array.isArray(t)?t:void 0,i=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:s}=this.schema.primKey;if(s&&n)throw new wt.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new wt.InvalidArgument("Arguments objects and keys must have the same length");const a=e.length;let o=s&&r?e.map(Vr(s)):e;return this.core.mutate({trans:t,type:"add",keys:n,values:o,wantResults:i}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return i?t:r;throw new gt(`${this.name}.bulkAdd(): ${e} of ${a} operations failed`,n)}))}))}bulkPut(e,t,r){const n=Array.isArray(t)?t:void 0,i=(r=r||(n?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(t=>{const{auto:r,keyPath:s}=this.schema.primKey;if(s&&n)throw new wt.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(n&&n.length!==e.length)throw new wt.InvalidArgument("Arguments objects and keys must have the same length");const a=e.length;let o=s&&r?e.map(Vr(s)):e;return this.core.mutate({trans:t,type:"put",keys:n,values:o,wantResults:i}).then((({numFailures:e,results:t,lastResult:r,failures:n})=>{if(0===e)return i?t:r;throw new gt(`${this.name}.bulkPut(): ${e} of ${a} operations failed`,n)}))}))}bulkDelete(e){const t=e.length;return this._trans("readwrite",(t=>this.core.mutate({trans:t,type:"delete",keys:e}))).then((({numFailures:e,lastResult:r,failures:n})=>{if(0===e)return r;throw new gt(`${this.name}.bulkDelete(): ${e} of ${t} operations failed`,n)}))}}function Wr(e){var t={},r=function(r,n){if(n){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[r].subscribe.apply(null,s),e}if("string"==typeof r)return t[r]};r.addEventType=s;for(var n=1,i=arguments.length;n<i;++n)s(arguments[n]);return r;function s(e,n,i){if("object"==typeof e)return a(e);n||(n=jt),i||(i=xt);var s={subscribers:[],fire:i,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=n(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(n,i)}};return t[e]=r[e]=s,s}function a(e){Se(e).forEach((function(t){var r=e[t];if(ke(r))s(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new wt.InvalidArgument("Invalid event config");var n=s(t,St,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){ze((function(){e.apply(null,t)}))}))}))}}))}}function Hr(e,t){return Te(t).from({prototype:e}),t}function Gr(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Jr(e,t){e.filter=qr(e.filter,t)}function Qr(e,t,r){var n=e.replayFilter;e.replayFilter=n?()=>qr(n(),t()):t,e.justLimit=r&&!n}function Yr(e,t){if(e.isPrimKey)return t.primaryKey;const r=t.getIndexByKeyPath(e.index);if(!r)throw new wt.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Xr(e,t,r){const n=Yr(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function en(e,t,r,n){const i=e.replayFilter?qr(e.filter,e.replayFilter()):e.filter;if(e.or){const s={},a=(e,r,n)=>{if(!i||i(r,n,(e=>r.stop(e)),(e=>r.fail(e)))){var a=r.primaryKey,o=""+a;"[object ArrayBuffer]"===o&&(o=""+new Uint8Array(a)),Oe(s,o)||(s[o]=!0,t(e,r,n))}};return Promise.all([e.or._iterate(a,r),tn(Xr(e,n,r),e.algorithm,a,!e.keysOnly&&e.valueMapper)])}return tn(Xr(e,n,r),qr(e.algorithm,i),t,!e.keysOnly&&e.valueMapper)}function tn(e,t,r,n){var i=fr(n?(e,t,i)=>r(n(e),t,i):r);return e.then((e=>{if(e)return e.start((()=>{var r=()=>e.continue();t&&!t(e,(e=>r=e),(t=>{e.stop(t),r=xt}),(t=>{e.fail(t),r=xt}))||i(e.value,e,(e=>r=e)),r()}))}))}function rn(e,t){try{const r=nn(e),n=nn(t);if(r!==n)return"Array"===r?1:"Array"===n?-1:"binary"===r?1:"binary"===n?-1:"string"===r?1:"string"===n?-1:"Date"===r?1:"Date"!==n?NaN:-1;switch(r){case"number":case"Date":case"string":return e>t?1:e<t?-1:0;case"binary":return function(e,t){const r=e.length,n=t.length,i=r<n?r:n;for(let r=0;r<i;++r)if(e[r]!==t[r])return e[r]<t[r]?-1:1;return r===n?0:r<n?-1:1}(sn(e),sn(t));case"Array":return function(e,t){const r=e.length,n=t.length,i=r<n?r:n;for(let r=0;r<i;++r){const n=rn(e[r],t[r]);if(0!==n)return n}return r===n?0:r<n?-1:1}(e,t)}}catch(e){}return NaN}function nn(e){const t=typeof e;if("object"!==t)return t;if(ArrayBuffer.isView(e))return"binary";const r=Xe(e);return"ArrayBuffer"===r?"binary":r}function sn(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}class an{_read(e,t){var r=this._ctx;return r.error?r.table._trans(null,Ir.bind(null,r.error)):r.table._trans("readonly",e).then(t)}_write(e){var t=this._ctx;return t.error?t.table._trans(null,Ir.bind(null,t.error)):t.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var t=this._ctx;t.algorithm=qr(t.algorithm,e)}_iterate(e,t){return en(this._ctx,e,t,this._ctx.table.core)}clone(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Fe(r,e),t._ctx=r,t}raw(){return this._ctx.valueMapper=null,this}each(e){var t=this._ctx;return this._read((r=>en(t,e,r,t.table.core)))}count(e){return this._read((e=>{const t=this._ctx,r=t.table.core;if(Gr(t,!0))return r.count({trans:e,query:{index:Yr(t,r.schema),range:t.range}}).then((e=>Math.min(e,t.limit)));var n=0;return en(t,(()=>(++n,!1)),e,r).then((()=>n))})).then(e)}sortBy(e,t){const r=e.split(".").reverse(),n=r[0],i=r.length-1;function s(e,t){return t?s(e[r[t]],t-1):e[n]}var a="next"===this._ctx.dir?1:-1;function o(e,t){var r=s(e,i),n=s(t,i);return r<n?-a:r>n?a:0}return this.toArray((function(e){return e.sort(o)})).then(t)}toArray(e){return this._read((e=>{var t=this._ctx;if("next"===t.dir&&Gr(t,!0)&&t.limit>0){const{valueMapper:r}=t,n=Yr(t,t.table.core.schema);return t.table.core.query({trans:e,limit:t.limit,values:!0,query:{index:n,range:t.range}}).then((({result:e})=>r?e.map(r):e))}{const r=[];return en(t,(e=>r.push(e)),e,t.table.core).then((()=>r))}}),e)}offset(e){var t=this._ctx;return e<=0||(t.offset+=e,Gr(t)?Qr(t,(()=>{var t=e;return(e,r)=>0===t||(1===t?(--t,!1):(r((()=>{e.advance(t),t=0})),!1))})):Qr(t,(()=>{var t=e;return()=>--t<0}))),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Qr(this._ctx,(()=>{var t=e;return function(e,r,n){return--t<=0&&r(n),t>=0}}),!0),this}until(e,t){return Jr(this._ctx,(function(r,n,i){return!e(r.value)||(n(i),t)})),this}first(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)}last(e){return this.reverse().first(e)}filter(e){var t,r;return Jr(this._ctx,(function(t){return e(t.value)})),t=this._ctx,r=e,t.isMatch=qr(t.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))}keys(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)}primaryKeys(e){var t=this._ctx;if("next"===t.dir&&Gr(t,!0)&&t.limit>0)return this._read((e=>{var r=Yr(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((({result:e})=>e)).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys((function(e){return e[0]})).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return Jr(this._ctx,(function(e){var t=e.primaryKey.toString(),n=Oe(r,t);return r[t]=!0,!n})),this}modify(e){var t=this._ctx;return this._write((r=>{var n;if("function"==typeof e)n=e;else{var i=Se(e),s=i.length;n=function(t){for(var r=!1,n=0;n<s;++n){var a=i[n],o=e[a];Ke(t,a)!==o&&(qe(t,a,o),r=!0)}return r}}const a=t.table.core,{outbound:o,extractKey:c}=a.schema.primaryKey,l=this.db._options.modifyChunkSize||200,u=[];let d=0;const h=[],p=(e,t)=>{const{failures:r,numFailures:n}=t;d+=e-n;for(let e of Se(r))u.push(r[e])};return this.clone().primaryKeys().then((i=>{const s=u=>{const d=Math.min(l,i.length-u);return a.getMany({trans:r,keys:i.slice(u,u+d),cache:"immutable"}).then((h=>{const f=[],m=[],y=o?[]:null,g=[];for(let e=0;e<d;++e){const t=h[e],r={value:Je(t),primKey:i[u+e]};!1!==n.call(r,r.value,r)&&(null==r.value?g.push(i[u+e]):o||0===rn(c(t),c(r.value))?(m.push(r.value),o&&y.push(i[u+e])):(g.push(i[u+e]),f.push(r.value)))}const b=Gr(t)&&t.limit===1/0&&("function"!=typeof e||e===on)&&{index:t.index,range:t.range};return Promise.resolve(f.length>0&&a.mutate({trans:r,type:"add",values:f}).then((e=>{for(let t in e.failures)g.splice(parseInt(t),1);p(f.length,e)}))).then((()=>(m.length>0||b&&"object"==typeof e)&&a.mutate({trans:r,type:"put",keys:y,values:m,criteria:b,changeSpec:"function"!=typeof e&&e}).then((e=>p(m.length,e))))).then((()=>(g.length>0||b&&e===on)&&a.mutate({trans:r,type:"delete",keys:g,criteria:b}).then((e=>p(g.length,e))))).then((()=>i.length>u+d&&s(u+l)))}))};return s(0).then((()=>{if(u.length>0)throw new yt("Error modifying one or more objects",u,d,h);return i.length}))}))}))}delete(){var e=this._ctx,t=e.range;return Gr(e)&&(e.isPrimKey&&!Ur||3===t.type)?this._write((r=>{const{primaryKey:n}=e.table.core.schema,i=t;return e.table.core.count({trans:r,query:{index:n,range:i}}).then((t=>e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then((({failures:e,lastResult:r,results:n,numFailures:i})=>{if(i)throw new yt("Could not delete some values",Object.keys(e).map((t=>e[t])),t-i);return t-i}))))})):this.modify(on)}}const on=(e,t)=>t.value=null;function cn(e,t){return e<t?-1:e===t?0:1}function ln(e,t){return e>t?-1:e===t?0:1}function un(e,t,r){var n=e instanceof yn?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function dn(e){return new e.Collection(e,(()=>mn(""))).limit(0)}function hn(e,t,r,n,i,s){for(var a=Math.min(e.length,n.length),o=-1,c=0;c<a;++c){var l=t[c];if(l!==n[c])return i(e[c],r[c])<0?e.substr(0,c)+r[c]+r.substr(c+1):i(e[c],n[c])<0?e.substr(0,c)+n[c]+r.substr(c+1):o>=0?e.substr(0,o)+t[o]+r.substr(o+1):null;i(e[c],l)<0&&(o=c)}return a<n.length&&"next"===s?e+r.substr(e.length):a<e.length&&"prev"===s?e.substr(0,r.length):o<0?null:e.substr(0,o)+n[o]+r.substr(o+1)}function pn(e,t,r,n){var i,s,a,o,c,l,u,d=r.length;if(!r.every((e=>"string"==typeof e)))return un(e,"String expected.");function h(e){i=function(e){return"next"===e?e=>e.toUpperCase():e=>e.toLowerCase()}(e),s=function(e){return"next"===e?e=>e.toLowerCase():e=>e.toUpperCase()}(e),a="next"===e?cn:ln;var t=r.map((function(e){return{lower:s(e),upper:i(e)}})).sort((function(e,t){return a(e.lower,t.lower)}));o=t.map((function(e){return e.upper})),c=t.map((function(e){return e.lower})),l=e,u="next"===e?"":n}h("next");var p=new e.Collection(e,(()=>fn(o[0],c[d-1]+n)));p._ondirectionchange=function(e){h(e)};var f=0;return p._addAlgorithm((function(e,r,n){var i=e.key;if("string"!=typeof i)return!1;var h=s(i);if(t(h,c,f))return!0;for(var p=null,m=f;m<d;++m){var y=hn(i,h,o[m],c[m],a,l);null===y&&null===p?f=m+1:(null===p||a(p,y)>0)&&(p=y)}return r(null!==p?function(){e.continue(p+u)}:n),!1})),p}function fn(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function mn(e){return{type:1,lower:e,upper:e}}class yn{get Collection(){return this._ctx.table.db.Collection}between(e,t,r,n){r=!1!==r,n=!0===n;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?dn(this):new this.Collection(this,(()=>fn(e,t,!r,!n)))}catch(e){return un(this,Dr)}}equals(e){return null==e?un(this,Dr):new this.Collection(this,(()=>mn(e)))}above(e){return null==e?un(this,Dr):new this.Collection(this,(()=>fn(e,void 0,!0)))}aboveOrEqual(e){return null==e?un(this,Dr):new this.Collection(this,(()=>fn(e,void 0,!1)))}below(e){return null==e?un(this,Dr):new this.Collection(this,(()=>fn(void 0,e,!1,!0)))}belowOrEqual(e){return null==e?un(this,Dr):new this.Collection(this,(()=>fn(void 0,e)))}startsWith(e){return"string"!=typeof e?un(this,"String expected."):this.between(e,e+Br,!0,!0)}startsWithIgnoreCase(e){return""===e?this.startsWith(e):pn(this,((e,t)=>0===e.indexOf(t[0])),[e],Br)}equalsIgnoreCase(e){return pn(this,((e,t)=>e===t[0]),[e],"")}anyOfIgnoreCase(){var e=nt.apply(rt,arguments);return 0===e.length?dn(this):pn(this,((e,t)=>-1!==t.indexOf(e)),e,"")}startsWithAnyOfIgnoreCase(){var e=nt.apply(rt,arguments);return 0===e.length?dn(this):pn(this,((e,t)=>t.some((t=>0===e.indexOf(t)))),e,Br)}anyOf(){const e=nt.apply(rt,arguments);let t=this._cmp;try{e.sort(t)}catch(e){return un(this,Dr)}if(0===e.length)return dn(this);const r=new this.Collection(this,(()=>fn(e[0],e[e.length-1])));r._ondirectionchange=r=>{t="next"===r?this._ascending:this._descending,e.sort(t)};let n=0;return r._addAlgorithm(((r,i,s)=>{const a=r.key;for(;t(a,e[n])>0;)if(++n,n===e.length)return i(s),!1;return 0===t(a,e[n])||(i((()=>{r.continue(e[n])})),!1)})),r}notEqual(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=nt.apply(rt,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return un(this,Dr)}const t=e.reduce(((e,t)=>e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,t){const r=this._cmp,n=this._ascending,i=this._descending,s=this._min,a=this._max;if(0===e.length)return dn(this);if(!e.every((e=>void 0!==e[0]&&void 0!==e[1]&&n(e[0],e[1])<=0)))return un(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",wt.InvalidArgument);const o=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;let l,u=n;function d(e,t){return u(e[0],t[0])}try{l=e.reduce((function(e,t){let n=0,i=e.length;for(;n<i;++n){const i=e[n];if(r(t[0],i[1])<0&&r(t[1],i[0])>0){i[0]=s(i[0],t[0]),i[1]=a(i[1],t[1]);break}}return n===i&&e.push(t),e}),[]),l.sort(d)}catch(e){return un(this,Dr)}let h=0;const p=c?e=>n(e,l[h][1])>0:e=>n(e,l[h][1])>=0,f=o?e=>i(e,l[h][0])>0:e=>i(e,l[h][0])>=0;let m=p;const y=new this.Collection(this,(()=>fn(l[0][0],l[l.length-1][1],!o,!c)));return y._ondirectionchange=e=>{"next"===e?(m=p,u=n):(m=f,u=i),l.sort(d)},y._addAlgorithm(((e,t,r)=>{for(var i=e.key;m(i);)if(++h,h===l.length)return t(r),!1;return!!function(e){return!p(e)&&!f(e)}(i)||(0===this._cmp(i,l[h][1])||0===this._cmp(i,l[h][0])||t((()=>{u===n?e.continue(l[h][0]):e.continue(l[h][1])})),!1)})),y}startsWithAnyOf(){const e=nt.apply(rt,arguments);return e.every((e=>"string"==typeof e))?0===e.length?dn(this):this.inAnyRange(e.map((e=>[e,e+Br]))):un(this,"startsWithAnyOf() only works with strings")}}function gn(e){return fr((function(t){return bn(t),e(t.target.error),!1}))}function bn(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}const vn=Wr(null,"storagemutated");class wn{_lock(){return $e(!Gt.global),++this._reculock,1!==this._reculock||Gt.global||(Gt.lockOwnerFor=this),this}_unlock(){if($e(!Gt.global),0==--this._reculock)for(Gt.global||(Gt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Or(e[1],e[0])}catch(e){}}return this}_locked(){return this._reculock&&Gt.lockOwnerFor!==this}create(e){if(!this.mode)return this;const t=this.db.idbdb,r=this.db._state.dbOpenError;if($e(!this.idbtrans),!e&&!t)switch(r&&r.name){case"DatabaseClosedError":throw new wt.DatabaseClosed(r);case"MissingAPIError":throw new wt.MissingAPI(r.message,r);default:throw new wt.OpenFailed(r)}if(!this.active)throw new wt.TransactionInactive;return $e(null===this._completion._state),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):t.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=fr((t=>{bn(t),this._reject(e.error)})),e.onabort=fr((t=>{bn(t),this.active&&this._reject(new wt.Abort(e.error)),this.active=!1,this.on("abort").fire(t)})),e.oncomplete=fr((()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&vn.storagemutated.fire(e.mutatedParts)})),this}_promise(e,t,r){if("readwrite"===e&&"readwrite"!==this.mode)return Ir(new wt.ReadOnly("Transaction is readonly"));if(!this.active)return Ir(new wt.TransactionInactive);if(this._locked())return new Xt(((n,i)=>{this._blockedFuncs.push([()=>{this._promise(e,t,r).then(n,i)},Gt])}));if(r)return _r((()=>{var e=new Xt(((e,r)=>{this._lock();const n=t(e,r,this);n&&n.then&&n.then(e,r)}));return e.finally((()=>this._unlock())),e._lib=!0,e}));var n=new Xt(((e,r)=>{var n=t(e,r,this);n&&n.then&&n.then(e,r)}));return n._lib=!0,n}_root(){return this.parent?this.parent._root():this}waitFor(e){var t=this._root();const r=Xt.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((()=>r));else{t._waitingFor=r,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var i=t._waitingFor;return new Xt(((e,n)=>{r.then((r=>t._waitingQueue.push(fr(e.bind(null,r)))),(e=>t._waitingQueue.push(fr(n.bind(null,e))))).finally((()=>{t._waitingFor===i&&(t._waitingFor=null)}))}))}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new wt.Abort))}table(e){const t=this._memoizedTables||(this._memoizedTables={});if(Oe(t,e))return t[e];const r=this.schema[e];if(!r)throw new wt.NotFound("Table "+e+" not part of transaction");const n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n,n}}function _n(e,t,r,n,i,s,a){return{name:e,keyPath:t,unique:r,multi:n,auto:i,compound:s,src:(r&&!a?"&":"")+(n?"*":"")+(i?"++":"")+An(t)}}function An(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function xn(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:Ue(r,(e=>[e.name,e]))}}let Sn=e=>{try{return e.only([[]]),Sn=()=>[[]],[[]]}catch(e){return Sn=()=>Br,Br}};function kn(e){return null==e?()=>{}:"string"==typeof e?function(e){return 1===e.split(".").length?t=>t[e]:t=>Ke(t,e)}(e):t=>Ke(t,e)}function Fn(e){return[].slice.call(e)}let Pn=0;function En(e){return null==e?":id":"string"==typeof e?e:`[${e.join("+")}]`}function On(e,t,r){function n(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:r,upper:n,lowerOpen:i,upperOpen:s}=e;return void 0===r?void 0===n?null:t.upperBound(n,!!s):void 0===n?t.lowerBound(r,!!i):t.bound(r,n,!!i,!!s)}const{schema:i,hasGetAll:s}=function(e,t){const r=Fn(e.objectStoreNames);return{schema:{name:e.name,tables:r.map((e=>t.objectStore(e))).map((e=>{const{keyPath:t,autoIncrement:r}=e,n=ke(t),i=null==t,s={},a={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:i,compound:n,keyPath:t,autoIncrement:r,unique:!0,extractKey:kn(t)},indexes:Fn(e.indexNames).map((t=>e.index(t))).map((e=>{const{name:t,unique:r,multiEntry:n,keyPath:i}=e,a={name:t,compound:ke(i),keyPath:i,unique:r,multiEntry:n,extractKey:kn(i)};return s[En(i)]=a,a})),getIndexByKeyPath:e=>s[En(e)]};return s[":id"]=a.primaryKey,null!=t&&(s[En(t)]=a.primaryKey),a}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,r),a=i.tables.map((e=>function(e){const t=e.name;return{name:t,schema:e,mutate:function({trans:e,type:r,keys:i,values:s,range:a}){return new Promise(((o,c)=>{o=fr(o);const l=e.objectStore(t),u=null==l.keyPath,d="put"===r||"add"===r;if(!d&&"delete"!==r&&"deleteRange"!==r)throw new Error("Invalid operation type: "+r);const{length:h}=i||s||{length:1};if(i&&s&&i.length!==s.length)throw new Error("Given keys array must have same length as given values array.");if(0===h)return o({numFailures:0,failures:{},results:[],lastResult:void 0});let p;const f=[],m=[];let y=0;const g=e=>{++y,bn(e)};if("deleteRange"===r){if(4===a.type)return o({numFailures:y,failures:m,results:[],lastResult:void 0});3===a.type?f.push(p=l.clear()):f.push(p=l.delete(n(a)))}else{const[e,t]=d?u?[s,i]:[s,null]:[i,null];if(d)for(let n=0;n<h;++n)f.push(p=t&&void 0!==t[n]?l[r](e[n],t[n]):l[r](e[n])),p.onerror=g;else for(let t=0;t<h;++t)f.push(p=l[r](e[t])),p.onerror=g}const b=e=>{const t=e.target.result;f.forEach(((e,t)=>null!=e.error&&(m[t]=e.error))),o({numFailures:y,failures:m,results:"delete"===r?i:f.map((e=>e.result)),lastResult:t})};p.onerror=e=>{g(e),b(e)},p.onsuccess=b}))},getMany:({trans:e,keys:r})=>new Promise(((n,i)=>{n=fr(n);const s=e.objectStore(t),a=r.length,o=new Array(a);let c,l=0,u=0;const d=e=>{const t=e.target;o[t._pos]=t.result,++u===l&&n(o)},h=gn(i);for(let e=0;e<a;++e)null!=r[e]&&(c=s.get(r[e]),c._pos=e,c.onsuccess=d,c.onerror=h,++l);0===l&&n(o)})),get:({trans:e,key:r})=>new Promise(((n,i)=>{n=fr(n);const s=e.objectStore(t).get(r);s.onsuccess=e=>n(e.target.result),s.onerror=gn(i)})),query:function(e){return r=>new Promise(((i,s)=>{i=fr(i);const{trans:a,values:o,limit:c,query:l}=r,u=c===1/0?void 0:c,{index:d,range:h}=l,p=a.objectStore(t),f=d.isPrimaryKey?p:p.index(d.name),m=n(h);if(0===c)return i({result:[]});if(e){const e=o?f.getAll(m,u):f.getAllKeys(m,u);e.onsuccess=e=>i({result:e.target.result}),e.onerror=gn(s)}else{let e=0;const t=o||!("openKeyCursor"in f)?f.openCursor(m):f.openKeyCursor(m),r=[];t.onsuccess=n=>{const s=t.result;return s?(r.push(o?s.value:s.primaryKey),++e===c?i({result:r}):void s.continue()):i({result:r})},t.onerror=gn(s)}}))}(s),openCursor:function({trans:e,values:r,query:i,reverse:s,unique:a}){return new Promise(((o,c)=>{o=fr(o);const{index:l,range:u}=i,d=e.objectStore(t),h=l.isPrimaryKey?d:d.index(l.name),p=s?a?"prevunique":"prev":a?"nextunique":"next",f=r||!("openKeyCursor"in h)?h.openCursor(n(u),p):h.openKeyCursor(n(u),p);f.onerror=gn(c),f.onsuccess=fr((t=>{const r=f.result;if(!r)return void o(null);r.___id=++Pn,r.done=!1;const n=r.continue.bind(r);let i=r.continuePrimaryKey;i&&(i=i.bind(r));const s=r.advance.bind(r),a=()=>{throw new Error("Cursor not stopped")};r.trans=e,r.stop=r.continue=r.continuePrimaryKey=r.advance=()=>{throw new Error("Cursor not started")},r.fail=fr(c),r.next=function(){let e=1;return this.start((()=>e--?this.continue():this.stop())).then((()=>this))},r.start=e=>{const t=new Promise(((e,t)=>{e=fr(e),f.onerror=gn(t),r.fail=t,r.stop=t=>{r.stop=r.continue=r.continuePrimaryKey=r.advance=a,e(t)}})),o=()=>{if(f.result)try{e()}catch(e){r.fail(e)}else r.done=!0,r.start=()=>{throw new Error("Cursor behind last entry")},r.stop()};return f.onsuccess=fr((e=>{f.onsuccess=o,o()})),r.continue=n,r.continuePrimaryKey=i,r.advance=s,o(),t},o(r)}),c)}))},count({query:e,trans:r}){const{index:i,range:s}=e;return new Promise(((e,a)=>{const o=r.objectStore(t),c=i.isPrimaryKey?o:o.index(i.name),l=n(s),u=l?c.count(l):c.count();u.onsuccess=fr((t=>e(t.target.result))),u.onerror=gn(a)}))}}}(e))),o={};return a.forEach((e=>o[e.name]=e)),{stack:"dbcore",transaction:e.transaction.bind(e),table(e){if(!o[e])throw new Error(`Table '${e}' not found`);return o[e]},MIN_KEY:-1/0,MAX_KEY:Sn(t),schema:i}}function jn({_novip:e},t){const r=t.db,n=function(e,t,{IDBKeyRange:r,indexedDB:n},i){const s=function(e,t){return t.reduce(((e,{create:t})=>({...e,...t(e)})),e)}(On(t,r,i),e.dbcore);return{dbcore:s}}(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach((t=>{const r=t.name;e.core.schema.tables.some((e=>e.name===r))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function Cn({_novip:e},t,r,n){r.forEach((r=>{const i=n[r];t.forEach((t=>{const n=Me(t,r);(!n||"value"in n&&void 0===n.value)&&(t===e.Transaction.prototype||t instanceof e.Transaction?Re(t,r,{get(){return this.table(r)},set(e){Ce(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,i))}))}))}function Rn({_novip:e},t){t.forEach((t=>{for(let r in t)t[r]instanceof e.Table&&delete t[r]}))}function Tn(e,t){return e._cfg.version-t._cfg.version}function In(e,t,r,n){const i=e._dbSchema,s=e._createTransaction("readwrite",e._storeNames,i);s.create(r),s._completion.catch(n);const a=s._reject.bind(s),o=Gt.transless||Gt;_r((()=>{Gt.trans=s,Gt.transless=o,0===t?(Se(i).forEach((e=>{Bn(r,e,i[e].primKey,i[e].indexes)})),jn(e,r),Xt.follow((()=>e.on.populate.fire(s))).catch(a)):function({_novip:e},t,r,n){const i=[],s=e._versions;let a=e._dbSchema=Nn(0,e.idbdb,n),o=!1;return s.filter((e=>e._cfg.version>=t)).forEach((s=>{i.push((()=>{const i=a,c=s._cfg.dbschema;$n(e,i,n),$n(e,c,n),a=e._dbSchema=c;const l=Mn(i,c);l.add.forEach((e=>{Bn(n,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((e=>{if(e.recreate)throw new wt.Upgrade("Not yet support for changing primary key");{const t=n.objectStore(e.name);e.add.forEach((e=>Dn(t,e))),e.change.forEach((e=>{t.deleteIndex(e.name),Dn(t,e)})),e.del.forEach((e=>t.deleteIndex(e)))}}));const u=s._cfg.contentUpgrade;if(u&&s._cfg.version>t){jn(e,n),r._memoizedTables={},o=!0;let t=Le(c);l.del.forEach((e=>{t[e]=i[e]})),Rn(e,[e.Transaction.prototype]),Cn(e,[e.Transaction.prototype],Se(t),t),r.schema=t;const s=it(u);let a;s&&Ar();const d=Xt.follow((()=>{if(a=u(r),a&&s){var e=xr.bind(null,null);a.then(e,e)}}));return a&&"function"==typeof a.then?Xt.resolve(a):d.then((()=>a))}})),i.push((t=>{o&&zr||function(e,t){[].slice.call(t.db.objectStoreNames).forEach((r=>null==e[r]&&t.db.deleteObjectStore(r)))}(s._cfg.dbschema,t),Rn(e,[e.Transaction.prototype]),Cn(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}))})),function e(){return i.length?Xt.resolve(i.shift()(r.idbtrans)).then(e):Xt.resolve()}().then((()=>{var e,t;t=n,Se(e=a).forEach((r=>{t.db.objectStoreNames.contains(r)||Bn(t,r,e[r].primKey,e[r].indexes)}))}))}(e,t,s,r).catch(a)}))}function Mn(e,t){const r={del:[],add:[],change:[]};let n;for(n in e)t[n]||r.del.push(n);for(n in t){const i=e[n],s=t[n];if(i){const e={name:n,def:s,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(s.primKey.keyPath||"")||i.primKey.auto!==s.primKey.auto&&!$r)e.recreate=!0,r.change.push(e);else{const t=i.idxByName,n=s.idxByName;let a;for(a in t)n[a]||e.del.push(a);for(a in n){const r=t[a],i=n[a];r?r.src!==i.src&&e.change.push(i):e.add.push(i)}(e.del.length>0||e.add.length>0||e.change.length>0)&&r.change.push(e)}}else r.add.push([n,s])}return r}function Bn(e,t,r,n){const i=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((e=>Dn(i,e))),i}function Dn(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function Nn(e,t,r){const n={};return De(t.objectStoreNames,0).forEach((e=>{const t=r.objectStore(e);let i=t.keyPath;const s=_n(An(i),i||"",!1,!1,!!t.autoIncrement,i&&"string"!=typeof i,!0),a=[];for(let e=0;e<t.indexNames.length;++e){const r=t.index(t.indexNames[e]);i=r.keyPath;var o=_n(r.name,i,!!r.unique,!!r.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(o)}n[e]=xn(e,s,a)})),n}function $n({_novip:e},t,r){const n=r.db.objectStoreNames;for(let i=0;i<n.length;++i){const s=n[i],a=r.objectStore(s);e._hasGetAll="getAll"in a;for(let e=0;e<a.indexNames.length;++e){const r=a.indexNames[e],n=a.index(r).keyPath,i="string"==typeof n?n:"["+De(n).join("+")+"]";if(t[s]){const e=t[s].idxByName[i];e&&(e.name=r,delete t[s].idxByName[i],t[s].idxByName[r]=e)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&xe.WorkerGlobalScope&&xe instanceof xe.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}class zn{_parseStoresSpec(e,t){Se(e).forEach((r=>{if(null!==e[r]){var n=e[r].split(",").map(((e,t)=>{const r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return _n(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),ke(n),0===t)})),i=n.shift();if(i.multi)throw new wt.Schema("Primary key cannot be multi-valued");n.forEach((e=>{if(e.auto)throw new wt.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new wt.Schema("Index must have a name and cannot be an empty string")})),t[r]=xn(r,i,n)}}))}stores(e){const t=this.db;this._cfg.storesSource=this._cfg.storesSource?Fe(this._cfg.storesSource,e):e;const r=t._versions,n={};let i={};return r.forEach((e=>{Fe(n,e._cfg.storesSource),i=e._cfg.dbschema={},e._parseStoresSpec(n,i)})),t._dbSchema=i,Rn(t,[t._allTables,t,t.Transaction.prototype]),Cn(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],Se(i),i),t._storeNames=Se(i),this}upgrade(e){return this._cfg.contentUpgrade=Ct(this._cfg.contentUpgrade||xt,e),this}}function Un(e,t){let r=e._dbNamesDB;return r||(r=e._dbNamesDB=new ci("__dbnames",{addons:[],indexedDB:e,IDBKeyRange:t}),r.version(1).stores({dbnames:"name"})),r.table("dbnames")}function Kn(e){return e&&"function"==typeof e.databases}function qn(e){return _r((function(){return Gt.letThrough=!0,e()}))}function Ln(){var e;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(t){var r=function(){return indexedDB.databases().finally(t)};e=setInterval(r,100),r()})).finally((function(){return clearInterval(e)})):Promise.resolve()}function Vn(e){var t=t=>e.next(t),r=i(t),n=i((t=>e.throw(t)));function i(e){return t=>{var i=e(t),s=i.value;return i.done?s:s&&"function"==typeof s.then?s.then(r,n):ke(s)?Promise.all(s).then(r,n):r(s)}}return i(t)()}function Zn(e,t,r){var n=arguments.length;if(n<2)throw new wt.InvalidArgument("Too few arguments");for(var i=new Array(n-1);--n;)i[n-1]=arguments[n];return r=i.pop(),[e,Ze(i),r]}function Wn(e,t,r,n,i){return Xt.resolve().then((()=>{const s=Gt.transless||Gt,a=e._createTransaction(t,r,e._dbSchema,n),o={trans:a,transless:s};if(n)a.idbtrans=n.idbtrans;else try{a.create(),e._state.PR1398_maxLoop=3}catch(n){return n.name===bt.InvalidState&&e.isOpen()&&--e._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),e._close(),e.open().then((()=>Wn(e,t,r,null,i)))):Ir(n)}const c=it(i);let l;c&&Ar();const u=Xt.follow((()=>{if(l=i.call(a,a),l)if(c){var e=xr.bind(null,null);l.then(e,e)}else"function"==typeof l.next&&"function"==typeof l.throw&&(l=Vn(l))}),o);return(l&&"function"==typeof l.then?Xt.resolve(l).then((e=>a.active?e:Ir(new wt.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn")))):u.then((()=>l))).then((e=>(n&&a._resolve(),a._completion.then((()=>e))))).catch((e=>(a._reject(e),Ir(e))))}))}function Hn(e,t,r){const n=ke(e)?e.slice():[e];for(let e=0;e<r;++e)n.push(t);return n}const Gn={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return{...e,table(t){const r=e.table(t),{schema:n}=r,i={},s=[];function a(e,t,r){const n=En(e),o=i[n]=i[n]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,u={...r,isVirtual:l,keyTail:t,keyLength:c,extractKey:kn(e),unique:!l&&r.unique};return o.push(u),u.isPrimaryKey||s.push(u),c>1&&a(2===c?e[0]:e.slice(0,c-1),t+1,r),o.sort(((e,t)=>e.keyTail-t.keyTail)),u}const o=a(n.primaryKey.keyPath,0,n.primaryKey);i[":id"]=[o];for(const e of n.indexes)a(e.keyPath,0,e);function c(t){const r=t.query.index;return r.isVirtual?{...t,query:{index:r,range:(n=t.query.range,i=r.keyTail,{type:1===n.type?2:n.type,lower:Hn(n.lower,n.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Hn(n.upper,n.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}:t;var n,i}const l={...r,schema:{...n,primaryKey:o,indexes:s,getIndexByKeyPath:function(e){const t=i[En(e)];return t&&t[0]}},count:e=>r.count(c(e)),query:e=>r.query(c(e)),openCursor(t){const{keyTail:n,isVirtual:i,keyLength:s}=t.query.index;return i?r.openCursor(c(t)).then((r=>r&&function(r){const i=Object.create(r,{continue:{value:function(i){null!=i?r.continue(Hn(i,t.reverse?e.MAX_KEY:e.MIN_KEY,n)):t.unique?r.continue(r.key.slice(0,s).concat(t.reverse?e.MIN_KEY:e.MAX_KEY,n)):r.continue()}},continuePrimaryKey:{value(t,i){r.continuePrimaryKey(Hn(t,e.MAX_KEY,n),i)}},primaryKey:{get:()=>r.primaryKey},key:{get(){const e=r.key;return 1===s?e[0]:e.slice(0,s)}},value:{get:()=>r.value}});return i}(r))):r.openCursor(t)}};return l}}}};function Jn(e,t,r,n){return r=r||{},n=n||"",Se(e).forEach((i=>{if(Oe(t,i)){var s=e[i],a=t[i];if("object"==typeof s&&"object"==typeof a&&s&&a){const e=Xe(s);e!==Xe(a)?r[n+i]=t[i]:"Object"===e?Jn(s,a,r,n+i+"."):s!==a&&(r[n+i]=t[i])}else s!==a&&(r[n+i]=t[i])}else r[n+i]=void 0})),Se(t).forEach((i=>{Oe(e,i)||(r[n+i]=t[i])})),r}const Qn={stack:"dbcore",name:"HooksMiddleware",level:2,create:e=>({...e,table(t){const r=e.table(t),{primaryKey:n}=r.schema,i={...r,mutate(e){const i=Gt.trans,{deleting:s,creating:a,updating:o}=i.table(t).hook;switch(e.type){case"add":if(a.fire===xt)break;return i._promise("readwrite",(()=>c(e)),!0);case"put":if(a.fire===xt&&o.fire===xt)break;return i._promise("readwrite",(()=>c(e)),!0);case"delete":if(s.fire===xt)break;return i._promise("readwrite",(()=>c(e)),!0);case"deleteRange":if(s.fire===xt)break;return i._promise("readwrite",(()=>function(e){return l(e.trans,e.range,1e4)}(e)),!0)}return r.mutate(e);function c(e){const t=Gt.trans,i=e.keys||function(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}(n,e);if(!i)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?{...e,keys:i}:{...e}).type&&(e.values=[...e.values]),e.keys&&(e.keys=[...e.keys]),function(e,t,r){return"add"===t.type?Promise.resolve([]):e.getMany({trans:t.trans,keys:r,cache:"immutable"})}(r,e,i).then((c=>{const l=i.map(((r,i)=>{const l=c[i],u={onerror:null,onsuccess:null};if("delete"===e.type)s.fire.call(u,r,l,t);else if("add"===e.type||void 0===l){const s=a.fire.call(u,r,e.values[i],t);null==r&&null!=s&&(r=s,e.keys[i]=r,n.outbound||qe(e.values[i],n.keyPath,r))}else{const n=Jn(l,e.values[i]),s=o.fire.call(u,n,r,l,t);if(s){const t=e.values[i];Object.keys(s).forEach((e=>{Oe(t,e)?t[e]=s[e]:qe(t,e,s[e])}))}}return u}));return r.mutate(e).then((({failures:t,results:r,numFailures:n,lastResult:s})=>{for(let n=0;n<i.length;++n){const s=r?r[n]:i[n],a=l[n];null==s?a.onerror&&a.onerror(t[n]):a.onsuccess&&a.onsuccess("put"===e.type&&c[n]?e.values[n]:s)}return{failures:t,results:r,numFailures:n,lastResult:s}})).catch((e=>(l.forEach((t=>t.onerror&&t.onerror(e))),Promise.reject(e))))}))}function l(e,t,i){return r.query({trans:e,values:!1,query:{index:n,range:t},limit:i}).then((({result:r})=>c({type:"delete",keys:r,trans:e}).then((n=>n.numFailures>0?Promise.reject(n.failures[0]):r.length<i?{failures:[],numFailures:0,lastResult:void 0}:l(e,{...t,lower:r[r.length-1],lowerOpen:!0},i)))))}}};return i}})};function Yn(e,t,r){try{if(!t)return null;if(t.keys.length<e.length)return null;const n=[];for(let i=0,s=0;i<t.keys.length&&s<e.length;++i)0===rn(t.keys[i],e[s])&&(n.push(r?Je(t.values[i]):t.values[i]),++s);return n.length===e.length?n:null}catch(e){return null}}const Xn={stack:"dbcore",level:-1,create:e=>({table:t=>{const r=e.table(t);return{...r,getMany:e=>{if(!e.cache)return r.getMany(e);const t=Yn(e.keys,e.trans._cache,"clone"===e.cache);return t?Xt.resolve(t):r.getMany(e).then((t=>(e.trans._cache={keys:e.keys,values:"clone"===e.cache?Je(t):t},t)))},mutate:e=>("add"!==e.type&&(e.trans._cache=null),r.mutate(e))}}})};function ei(e){return!("from"in e)}const ti=function(e,t){if(!this){const t=new ti;return e&&"d"in e&&Fe(t,e),t}Fe(this,arguments.length?{d:1,from:e,to:arguments.length>1?t:e}:{d:0})};function ri(e,t,r){const n=rn(t,r);if(isNaN(n))return;if(n>0)throw RangeError();if(ei(e))return Fe(e,{from:t,to:r,d:1});const i=e.l,s=e.r;if(rn(r,e.from)<0)return i?ri(i,t,r):e.l={from:t,to:r,d:1,l:null,r:null},si(e);if(rn(t,e.to)>0)return s?ri(s,t,r):e.r={from:t,to:r,d:1,l:null,r:null},si(e);rn(t,e.from)<0&&(e.from=t,e.l=null,e.d=s?s.d+1:1),rn(r,e.to)>0&&(e.to=r,e.r=null,e.d=e.l?e.l.d+1:1);const a=!e.r;i&&!e.l&&ni(e,i),s&&a&&ni(e,s)}function ni(e,t){ei(t)||function e(t,{from:r,to:n,l:i,r:s}){ri(t,r,n),i&&e(t,i),s&&e(t,s)}(e,t)}function ii(e){let t=ei(e)?null:{s:0,n:e};return{next(e){const r=arguments.length>0;for(;t;)switch(t.s){case 0:if(t.s=1,r)for(;t.n.l&&rn(e,t.n.from)<0;)t={up:t,n:t.n.l,s:1};else for(;t.n.l;)t={up:t,n:t.n.l,s:1};case 1:if(t.s=2,!r||rn(e,t.n.to)<=0)return{value:t.n,done:!1};case 2:if(t.n.r){t.s=3,t={up:t,n:t.n.r,s:0};continue}case 3:t=t.up}return{done:!0}}}}function si(e){var t,r;const n=((null===(t=e.r)||void 0===t?void 0:t.d)||0)-((null===(r=e.l)||void 0===r?void 0:r.d)||0),i=n>1?"r":n<-1?"l":"";if(i){const t="r"===i?"l":"r",r={...e},n=e[i];e.from=n.from,e.to=n.to,e[i]=n[i],r[i]=n[t],e[t]=r,r.d=ai(r)}e.d=ai(e)}function ai({r:e,l:t}){return(e?t?Math.max(e.d,t.d):e.d:t?t.d:0)+1}je(ti.prototype,{add(e){return ni(this,e),this},addKey(e){return ri(this,e,e),this},addKeys(e){return e.forEach((e=>ri(this,e,e))),this},[et](){return ii(this)}});const oi={stack:"dbcore",level:0,create:e=>{const t=e.schema.name,r=new ti(e.MIN_KEY,e.MAX_KEY);return{...e,table:n=>{const i=e.table(n),{schema:s}=i,{primaryKey:a}=s,{extractKey:o,outbound:c}=a,l={...i,mutate:e=>{const a=e.trans,o=a.mutatedParts||(a.mutatedParts={}),c=e=>{const r=`idb://${t}/${n}/${e}`;return o[r]||(o[r]=new ti)},l=c(""),u=c(":dels"),{type:d}=e;let[h,p]="deleteRange"===e.type?[e.range]:"delete"===e.type?[e.keys]:e.values.length<50?[[],e.values]:[];const f=e.trans._cache;return i.mutate(e).then((e=>{if(ke(h)){"delete"!==d&&(h=e.results),l.addKeys(h);const t=Yn(h,f);t||"add"===d||u.addKeys(h),(t||p)&&function(e,t,r,n){t.indexes.forEach((function(t){const i=e(t.name||"");function s(e){return null!=e?t.extractKey(e):null}const a=e=>t.multiEntry&&ke(e)?e.forEach((e=>i.addKey(e))):i.addKey(e);(r||n).forEach(((e,t)=>{const i=r&&s(r[t]),o=n&&s(n[t]);0!==rn(i,o)&&(null!=i&&a(i),null!=o&&a(o))}))}))}(c,s,t,p)}else if(h){const e={from:h.lower,to:h.upper};u.add(e),l.add(e)}else l.add(r),u.add(r),s.indexes.forEach((e=>c(e.name).add(r)));return e}))}},u=({query:{index:t,range:r}})=>{var n,i;return[t,new ti(null!==(n=r.lower)&&void 0!==n?n:e.MIN_KEY,null!==(i=r.upper)&&void 0!==i?i:e.MAX_KEY)]},d={get:e=>[a,new ti(e.key)],getMany:e=>[a,(new ti).addKeys(e.keys)],count:u,query:u,openCursor:u};return Se(d).forEach((e=>{l[e]=function(s){const{subscr:a}=Gt;if(a){const l=e=>{const r=`idb://${t}/${n}/${e}`;return a[r]||(a[r]=new ti)},u=l(""),h=l(":dels"),[p,f]=d[e](s);if(l(p.name||"").add(f),!p.isPrimaryKey){if("count"!==e){const t="query"===e&&c&&s.values&&i.query({...s,values:!1});return i[e].apply(this,arguments).then((r=>{if("query"===e){if(c&&s.values)return t.then((({result:e})=>(u.addKeys(e),r)));const e=s.values?r.result.map(o):r.result;s.values?u.addKeys(e):h.addKeys(e)}else if("openCursor"===e){const e=r,t=s.values;return e&&Object.create(e,{key:{get:()=>(h.addKey(e.primaryKey),e.key)},primaryKey:{get(){const t=e.primaryKey;return h.addKey(t),t}},value:{get:()=>(t&&u.addKey(e.primaryKey),e.value)}})}return r}))}h.add(r)}}return i[e].apply(this,arguments)}})),l}}}};class ci{constructor(e,t){this._middlewares={},this.verno=0;const r=ci.dependencies;this._options=t={addons:ci.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...t},this._deps={indexedDB:t.indexedDB,IDBKeyRange:t.IDBKeyRange};const{addons:n}=t;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:xt,dbReadyPromise:null,cancelOpen:xt,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var s;i.dbReadyPromise=new Xt((e=>{i.dbReadyResolve=e})),i.openCanceller=new Xt(((e,t)=>{i.cancelOpen=t})),this._state=i,this.name=e,this.on=Wr(this,"populate","blocked","versionchange","close",{ready:[Ct,xt]}),this.on.ready.subscribe=Ne(this.on.ready.subscribe,(e=>(t,r)=>{ci.vip((()=>{const n=this._state;if(n.openComplete)n.dbOpenError||Xt.resolve().then(t),r&&e(t);else if(n.onReadyBeingFired)n.onReadyBeingFired.push(t),r&&e(t);else{e(t);const n=this;r||e((function e(){n.on.ready.unsubscribe(t),n.on.ready.unsubscribe(e)}))}}))})),this.Collection=(s=this,Hr(an.prototype,(function(e,t){this.db=s;let r=Lr,n=null;if(t)try{r=t()}catch(e){n=e}const i=e._ctx,a=i.table,o=a.hook.reading.fire;this._ctx={table:a,index:i.index,isPrimKey:!i.index||a.schema.primKey.keyPath&&i.index===a.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:i.or,valueMapper:o!==St?o:null}}))),this.Table=function(e){return Hr(Zr.prototype,(function(t,r,n){this.db=e,this._tx=n,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:Wr(null,{creating:[Pt,xt],reading:[kt,St],updating:[Ot,xt],deleting:[Et,xt]})}))}(this),this.Transaction=function(e){return Hr(wn.prototype,(function(t,r,n,i,s){this.db=e,this.mode=t,this.storeNames=r,this.schema=n,this.chromeTransactionDurability=i,this.idbtrans=null,this.on=Wr(this,"complete","error","abort"),this.parent=s||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Xt(((e,t)=>{this._resolve=e,this._reject=t})),this._completion.then((()=>{this.active=!1,this.on.complete.fire()}),(e=>{var t=this.active;return this.active=!1,this.on.error.fire(e),this.parent?this.parent._reject(e):t&&this.idbtrans&&this.idbtrans.abort(),Ir(e)}))}))}(this),this.Version=function(e){return Hr(zn.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Hr(yn.prototype,(function(t,r,n){this.db=e,this._ctx={table:t,index:":id"===r?null:r,or:n};const i=e._deps.indexedDB;if(!i)throw new wt.MissingAPI;this._cmp=this._ascending=i.cmp.bind(i),this._descending=(e,t)=>i.cmp(t,e),this._max=(e,t)=>i.cmp(e,t)>0?e:t,this._min=(e,t)=>i.cmp(e,t)<0?e:t,this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(e=>{e.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()})),this.on("blocked",(e=>{!e.newVersion||e.newVersion<e.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${e.oldVersion/10}`)})),this._maxKey=Sn(t.IDBKeyRange),this._createTransaction=(e,t,r,n)=>new this.Transaction(e,t,r,this._options.chromeTransactionDurability,n),this._fireOnBlocked=e=>{this.on("blocked").fire(e),Nr.filter((e=>e.name===this.name&&e!==this&&!e._state.vcFired)).map((t=>t.on("versionchange").fire(e)))},this.use(Gn),this.use(Qn),this.use(oi),this.use(Xn),this.vip=Object.create(this,{_vip:{value:!0}}),n.forEach((e=>e(this)))}version(e){if(isNaN(e)||e<.1)throw new wt.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new wt.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const t=this._versions;var r=t.filter((t=>t._cfg.version===e))[0];return r||(r=new this.Version(e),t.push(r),t.sort(Tn),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Gt.letThrough||this._vip)?e():new Xt(((e,t)=>{if(this._state.openComplete)return t(new wt.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void t(new wt.DatabaseClosed);this.open().catch(xt)}this._state.dbReadyPromise.then(e,t)})).then(e)}use({stack:e,create:t,level:r,name:n}){n&&this.unuse({stack:e,name:n});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:t,level:null==r?10:r,name:n}),i.sort(((e,t)=>e.level-t.level)),this}unuse({stack:e,name:t,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter((e=>r?e.create!==r:!!t&&e.name!==t))),this}open(){return function(e){const t=e._state,{indexedDB:r}=e._deps;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((()=>t.dbOpenError?Ir(t.dbOpenError):e));st&&(t.openCanceller._stackHolder=lt()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;const n=t.openCanceller;function i(){if(t.openCanceller!==n)throw new wt.DatabaseClosed("db.open() was cancelled")}let s=t.dbReadyResolve,a=null,o=!1;return Xt.race([n,("undefined"==typeof navigator?Xt.resolve():Ln()).then((()=>new Xt(((n,s)=>{if(i(),!r)throw new wt.MissingAPI;const c=e.name,l=t.autoSchema?r.open(c):r.open(c,Math.round(10*e.verno));if(!l)throw new wt.MissingAPI;l.onerror=gn(s),l.onblocked=fr(e._fireOnBlocked),l.onupgradeneeded=fr((n=>{if(a=l.transaction,t.autoSchema&&!e._options.allowEmptyDB){l.onerror=bn,a.abort(),l.result.close();const e=r.deleteDatabase(c);e.onsuccess=e.onerror=fr((()=>{s(new wt.NoSuchDatabase(`Database ${c} doesnt exist`))}))}else{a.onerror=gn(s);var i=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;o=i<1,e._novip.idbdb=l.result,In(e,i/10,a,s)}}),s),l.onsuccess=fr((()=>{a=null;const r=e._novip.idbdb=l.result,i=De(r.objectStoreNames);if(i.length>0)try{const n=r.transaction(1===(s=i).length?s[0]:s,"readonly");t.autoSchema?function({_novip:e},t,r){e.verno=t.version/10;const n=e._dbSchema=Nn(0,t,r);e._storeNames=De(t.objectStoreNames,0),Cn(e,[e._allTables],Se(n),n)}(e,r,n):($n(e,e._dbSchema,n),function(e,t){const r=Mn(Nn(0,e.idbdb,t),e._dbSchema);return!(r.add.length||r.change.some((e=>e.add.length||e.change.length)))}(e,n)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),jn(e,n)}catch(e){}var s;Nr.push(e),r.onversionchange=fr((r=>{t.vcFired=!0,e.on("versionchange").fire(r)})),r.onclose=fr((t=>{e.on("close").fire(t)})),o&&function({indexedDB:e,IDBKeyRange:t},r){!Kn(e)&&"__dbnames"!==r&&Un(e,t).put({name:r}).catch(xt)}(e._deps,c),n()}),s)}))))]).then((()=>(i(),t.onReadyBeingFired=[],Xt.resolve(qn((()=>e.on.ready.fire(e.vip)))).then((function r(){if(t.onReadyBeingFired.length>0){let n=t.onReadyBeingFired.reduce(Ct,xt);return t.onReadyBeingFired=[],Xt.resolve(qn((()=>n(e.vip)))).then(r)}}))))).finally((()=>{t.onReadyBeingFired=null,t.isBeingOpened=!1})).then((()=>e)).catch((r=>{t.dbOpenError=r;try{a&&a.abort()}catch(e){}return n===t.openCanceller&&e._close(),Ir(r)})).finally((()=>{t.openComplete=!0,s()}))}(this)}_close(){const e=this._state,t=Nr.indexOf(this);if(t>=0&&Nr.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(e){}this._novip.idbdb=null}e.dbReadyPromise=new Xt((t=>{e.dbReadyResolve=t})),e.openCanceller=new Xt(((t,r)=>{e.cancelOpen=r}))}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new wt.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,t=this._state;return new Xt(((r,n)=>{const i=()=>{this.close();var e=this._deps.indexedDB.deleteDatabase(this.name);e.onsuccess=fr((()=>{!function({indexedDB:e,IDBKeyRange:t},r){!Kn(e)&&"__dbnames"!==r&&Un(e,t).delete(r).catch(xt)}(this._deps,this.name),r()})),e.onerror=gn(n),e.onblocked=this._fireOnBlocked};if(e)throw new wt.InvalidArgument("Arguments not allowed in db.delete()");t.isBeingOpened?t.dbReadyPromise.then(i):i()}))}backendDB(){return this.idbdb}isOpen(){return null!==this.idbdb}hasBeenClosed(){const e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name}hasFailed(){return null!==this._state.dbOpenError}dynamicallyOpened(){return this._state.autoSchema}get tables(){return Se(this._allTables).map((e=>this._allTables[e]))}transaction(){const e=Zn.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,t,r){let n=Gt.trans;n&&n.db===this&&-1===e.indexOf("!")||(n=null);const i=-1!==e.indexOf("?");let s,a;e=e.replace("!","").replace("?","");try{if(a=t.map((e=>{var t=e instanceof this.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)s="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new wt.InvalidArgument("Invalid transaction mode: "+e);s="readwrite"}if(n){if("readonly"===n.mode&&"readwrite"===s){if(!i)throw new wt.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");n=null}n&&a.forEach((e=>{if(n&&-1===n.storeNames.indexOf(e)){if(!i)throw new wt.SubTransaction("Table "+e+" not included in parent transaction.");n=null}})),i&&n&&!n.active&&(n=null)}}catch(e){return n?n._promise(null,((t,r)=>{r(e)})):Ir(e)}const o=Wn.bind(null,this,s,a,n,r);return n?n._promise(s,o,"lock"):Gt.trans?Or(Gt.transless,(()=>this._whenReady(o))):this._whenReady(o)}table(e){if(!Oe(this._allTables,e))throw new wt.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const li="undefined"!=typeof Symbol&&"observable"in Symbol?Symbol.observable:"@@observable";class ui{constructor(e){this._subscribe=e}subscribe(e,t,r){return this._subscribe(e&&"function"!=typeof e?e:{next:e,error:t,complete:r})}[li](){return this}}function di(e,t){return Se(t).forEach((r=>{ni(e[r]||(e[r]=new ti),t[r])})),e}function hi(e){return new ui((t=>{const r=it(e);let n=!1,i={},s={};const a={get closed(){return n},unsubscribe:()=>{n=!0,vn.storagemutated.unsubscribe(u)}};t.start&&t.start(a);let o=!1,c=!1;function l(){return Se(s).some((e=>i[e]&&function(e,t){const r=ii(t);let n=r.next();if(n.done)return!1;let i=n.value;const s=ii(e);let a=s.next(i.from),o=a.value;for(;!n.done&&!a.done;){if(rn(o.from,i.to)<=0&&rn(o.to,i.from)>=0)return!0;rn(i.from,o.from)<0?i=(n=r.next(o.from)).value:o=(a=s.next(i.from)).value}return!1}(i[e],s[e])))}const u=e=>{di(i,e),l()&&d()},d=()=>{if(o||n)return;i={};const h={},p=function(t){r&&Ar();const n=()=>_r(e,{subscr:t,trans:null}),i=Gt.trans?Or(Gt.transless,n):n();return r&&i.then(xr,xr),i}(h);c||(vn("storagemutated",u),c=!0),o=!0,Promise.resolve(p).then((e=>{o=!1,n||(l()?d():(i={},s=h,t.next&&t.next(e)))}),(e=>{o=!1,t.error&&t.error(e),a.unsubscribe()}))};return d(),a}))}let pi;try{pi={indexedDB:xe.indexedDB||xe.mozIndexedDB||xe.webkitIndexedDB||xe.msIndexedDB,IDBKeyRange:xe.IDBKeyRange||xe.webkitIDBKeyRange}}catch(xe){pi={indexedDB:null,IDBKeyRange:null}}const fi=ci;function mi(e){let t=yi;try{yi=!0,vn.storagemutated.fire(e)}finally{yi=t}}je(fi,{...At,delete:e=>new fi(e,{addons:[]}).delete(),exists:e=>new fi(e,{addons:[]}).open().then((e=>(e.close(),!0))).catch("NoSuchDatabaseError",(()=>!1)),getDatabaseNames(e){try{return function({indexedDB:e,IDBKeyRange:t}){return Kn(e)?Promise.resolve(e.databases()).then((e=>e.map((e=>e.name)).filter((e=>"__dbnames"!==e)))):Un(e,t).toCollection().primaryKeys()}(fi.dependencies).then(e)}catch(e){return Ir(new wt.MissingAPI)}},defineClass:()=>function(e){Fe(this,e)},ignoreTransaction:e=>Gt.trans?Or(Gt.transless,e):e(),vip:qn,async:function(e){return function(){try{var t=Vn(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Xt.resolve(t)}catch(e){return Ir(e)}}},spawn:function(e,t,r){try{var n=Vn(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:Xt.resolve(n)}catch(e){return Ir(e)}},currentTransaction:{get:()=>Gt.trans||null},waitFor:function(e,t){const r=Xt.resolve("function"==typeof e?fi.ignoreTransaction(e):e).timeout(t||6e4);return Gt.trans?Gt.trans.waitFor(r):r},Promise:Xt,debug:{get:()=>st,set:e=>{at(e,"dexie"===e?()=>!0:Kr)}},derive:Te,extend:Fe,props:je,override:Ne,Events:Wr,on:vn,liveQuery:hi,extendObservabilitySet:di,getByKeyPath:Ke,setByKeyPath:qe,delByKeyPath:function(e,t){"string"==typeof t?qe(e,t,void 0):"length"in t&&[].map.call(t,(function(t){qe(e,t,void 0)}))},shallowClone:Le,deepClone:Je,getObjectDiff:Jn,cmp:rn,asap:ze,minKey:-1/0,addons:[],connections:Nr,errnames:bt,dependencies:pi,semVer:"3.2.3",version:"3.2.3".split(".").map((e=>parseInt(e))).reduce(((e,t,r)=>e+t/Math.pow(10,2*r)))}),fi.maxKey=Sn(fi.dependencies.IDBKeyRange),"undefined"!=typeof dispatchEvent&&"undefined"!=typeof addEventListener&&(vn("storagemutated",(e=>{if(!yi){let t;$r?(t=document.createEvent("CustomEvent"),t.initCustomEvent("x-storagemutated-1",!0,!0,e)):t=new CustomEvent("x-storagemutated-1",{detail:e}),yi=!0,dispatchEvent(t),yi=!1}})),addEventListener("x-storagemutated-1",(({detail:e})=>{yi||mi(e)})));let yi=!1;if("undefined"!=typeof BroadcastChannel){const e=new BroadcastChannel("x-storagemutated-1");"function"==typeof e.unref&&e.unref(),vn("storagemutated",(t=>{yi||e.postMessage(t)})),e.onmessage=e=>{e.data&&mi(e.data)}}else if("undefined"!=typeof self&&"undefined"!=typeof navigator){vn("storagemutated",(e=>{try{yi||("undefined"!=typeof localStorage&&localStorage.setItem("x-storagemutated-1",JSON.stringify({trig:Math.random(),changedParts:e})),"object"==typeof self.clients&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach((t=>t.postMessage({type:"x-storagemutated-1",changedParts:e}))))}catch(e){}})),"undefined"!=typeof addEventListener&&addEventListener("storage",(e=>{if("x-storagemutated-1"===e.key){const t=JSON.parse(e.newValue);t&&mi(t.changedParts)}}));const e=self.document&&navigator.serviceWorker;e&&e.addEventListener("message",(function({data:e}){e&&"x-storagemutated-1"===e.type&&mi(e.changedParts)}))}Xt.rejectionMapper=function(e,t){if(!e||e instanceof ft||e instanceof TypeError||e instanceof SyntaxError||!e.name||!_t[e.name])return e;var r=new _t[e.name](t||e.message,e);return"stack"in e&&Re(r,"stack",{get:function(){return this.inner.stack}}),r},at(st,Kr);class gi extends ci{constructor(){super("CopyHistoryDatabase"),this.version(1).stores({copyHistoryItems:"++index,id,timestamp"}),this.version(2).stores({copyHistoryItems:"++index,id,timestamp"}).upgrade((e=>e.table("copyHistoryItems").toCollection().modify((e=>{const t={text:e.text,textImage:e.textImage,start:e.start,end:e.end,originalStart:e.originalStart,originalEnd:e.originalEnd,track:e.track};if(e.subtitle=t,delete e.text,delete e.textImage,delete e.start,delete e.end,delete e.originalStart,delete e.originalEnd,delete e.track,e.videoFileName||e.audioFileName){const t={name:e.videoFileName||e.audioFileName,blobUrl:"",playbackRate:e.filePlaybackRate,audioTrack:e.audioTrack};e.file=t,delete e.videoFileName,delete e.audioFileName,delete e.filePlaybackRate,delete e.audioTrack}}))))}}class bi{constructor(e){this._db=new gi,this._limit=e}set limit(e){this._limit=e}async clear(){await this._db.delete()}async fetch(e){if(e<=0)return[];const t=await await this._db.copyHistoryItems.reverse().limit(e).toArray();return t.reverse(),t}liveFetch(e){return hi((()=>this.fetch(e)))}async save(e){if(this._limit<=0)return;const t={id:e.id,timestamp:e.timestamp,subtitle:e.subtitle,surroundingSubtitles:e.surroundingSubtitles,subtitleFileName:e.subtitleFileName,url:e.url,image:e.image,audio:e.audio,file:e.file,mediaTimestamp:e.mediaTimestamp},r=await this._db.copyHistoryItems.where("id").equals(e.id).primaryKeys();r.length>0&&(t.index=r[0]);const n=await this._db.copyHistoryItems.put(t);await this._prune(n)}async _prune(e){if(await this._db.copyHistoryItems.count()>this._limit){const t=await this._db.copyHistoryItems.where("index").belowOrEqual(e-this._limit).primaryKeys();t.length>0&&await this._db.copyHistoryItems.bulkDelete(t)}}async delete(e){const t=await this._db.copyHistoryItems.where("id").equals(e).primaryKeys();await this._db.copyHistoryItems.bulkDelete(t)}}const vi=navigator.userAgent.toLowerCase().includes("android")??navigator.userAgentData?.mobile??!1,wi="lastUpdateAlertVersion";chrome.storage.session.setAccessLevel({accessLevel:"TRUSTED_AND_UNTRUSTED_CONTEXTS"});const _i=new I(new U);chrome.runtime.onInstalled.addListener((async e=>{if(e.reason!==chrome.runtime.OnInstalledReason.INSTALL)return;const t=chrome.i18n.getUILanguage();(await(async()=>{const e=await L();return void 0===e?N:e.languages.map((e=>e.code))})()).includes(t)&&(await _i.set({language:t}),J(t)),vi&&await _i.set({streamingTakeScreenshot:!1,subtitleSize:18,subtitlePositionOffset:25}),chrome.tabs.create({url:chrome.runtime.getURL("ftue-ui.html"),active:!0})})),chrome.runtime.onInstalled.addListener((async e=>{e.reason===chrome.runtime.OnInstalledReason.UPDATE&&(async()=>{(await chrome.storage.local.get(wi))[wi]!==chrome.runtime.getManifest().version&&await chrome.storage.local.set({shouldShowUpdateAlert:!0})})()})),chrome.runtime.onStartup.addListener((async()=>{J(await _i.getSingle("language"))}));const Ai=new class{constructor(e){this._onNoSyncedElementsCallbacks=[],this._onSyncedElementCallbacks=[],this._onAsbplayerInstanceCallbacks=[],this._settings=e,chrome.tabs.onRemoved.addListener(((e,t)=>{this._videoElements()})),chrome.tabs.onUpdated.addListener(((e,t)=>{"loading"===t.status&&void 0===t.url?(this._videoElements((t=>{let r=!1;for(const[n,i]of Object.entries(t))i.tab.id===e&&(delete t[n],r=!0);return r})),this._asbplayers((t=>{let r=!1;for(const[n,i]of Object.entries(t))i.tab?.id===e&&(delete t[n],r=!0);return r}))):this._videoElements()}))}async _fetchVideoElementState(){return(await chrome.storage.session.get("tabRegistryVideoElements")).tabRegistryVideoElements??{}}async _saveVideoElementState(e){await chrome.storage.session.set({tabRegistryVideoElements:e})}async _videoElements(e){const t=await chrome.tabs.query({}),r=await this._fetchVideoElementState(),n={...r};let i=!1;for(const e in r){const n=r[e],s=void 0===t.find((e=>e.id===n.tab.id&&e.url===n.tab.url));s&&(i=!0,delete r[e])}void 0!==e&&(i=e(r)||i),i&&await this._saveVideoElementState(r);const s=void 0!==Object.values(n).find((e=>e.synced)),a=void 0!==Object.values(r).find((e=>e.synced));if(this._onNoSyncedElementsCallbacks.length>0&&s&&!a)for(const e of this._onNoSyncedElementsCallbacks)e();else if(this._onSyncedElementCallbacks.length>0&&!s&&a)for(const e of this._onSyncedElementCallbacks)e();return r}async _fetchAsbplayerState(){return(await chrome.storage.session.get("tabRegistryAsbplayers")).tabRegistryAsbplayers??{}}async _saveAsbplayerState(e){await chrome.storage.session.set({tabRegistryAsbplayers:e})}async _asbplayers(e){const t=await chrome.tabs.query({}),r=await this._fetchAsbplayerState(),n={...r},i=Date.now();let s=!1;for(const e in r){const n=r[e],a=n.sidePanel&&i-n.timestamp>=5e3||void 0!==n.tab&&void 0===t.find((e=>e.id===n.tab?.id&&e.url===n.tab?.url));a&&(s=!0,delete r[e])}void 0!==e&&(s=e(r)||s);let a=!1;if(s&&(await this._saveAsbplayerState(r),a=Object.keys(r).some((e=>!(e in n)))),a)for(const e of this._onAsbplayerInstanceCallbacks)e();return r}async onAsbplayerHeartbeat(e,{id:t,videoPlayer:r,sidePanel:n,receivedTabs:i,loadedSubtitles:s}){this._updateAsbplayers(e,t,r,n??!1,s??!1,i);try{const t={sender:"asbplayer-extension-to-player",message:{command:"tabs",tabs:await this.activeVideoElements(),asbplayers:await this._asbplayerInstances(),ackRequested:!1}};e?.id?await chrome.tabs.sendMessage(e.id,t):await chrome.runtime.sendMessage(t)}catch(e){}}async onAsbplayerAckTabs(e,{id:t,sidePanel:r,receivedTabs:n}){this._updateAsbplayers(e,t,!1,r??!1,!1,n)}async _updateAsbplayers(e,t,r,n,i,s){const a=void 0===e||void 0===e.id?void 0:{id:e.id,title:e.title??"",url:e.url??""};await this._asbplayers((e=>(e[t]={tab:a,id:t,timestamp:Date.now(),receivedTabs:s,sidePanel:n,loadedSubtitles:i,videoPlayer:r},!0)))}async activeVideoElements(){const e=await this._videoElements(),t=[];for(const r in e){const n=e[r];if(n.tab.id){const e={id:n.tab.id,title:n.tab.title,src:n.src,subscribed:n.subscribed,synced:n.synced,syncedTimestamp:n.syncedTimestamp};t.push(e)}}return t}async _asbplayerInstances(){const e=await this._asbplayers(),t=[];for(const r of Object.values(e))t.push({id:r.id,tabId:r.tab?.id,sidePanel:r.sidePanel??!1,timestamp:r.timestamp,videoPlayer:r.videoPlayer});return t}async onVideoElementHeartbeat(e,t,{subscribed:r,synced:n,syncedTimestamp:i,loadedSubtitles:s}){if(void 0===e.id)return;const a=e.id;await this._videoElements((o=>(o[`${e.id}:${t}`]={tab:{id:a,title:e.title??"",url:e.url??""},src:t,subscribed:r,timestamp:Date.now(),synced:n,syncedTimestamp:i,loadedSubtitles:s},!0)))}async onVideoElementDisappeared(e,t){await this._videoElements((r=>{const n=`${e.id}:${t}`;return n in r&&(delete r[n],!0)}))}onNoSyncedElements(e){this._onNoSyncedElementsCallbacks.push(e)}onSyncedElement(e){this._onSyncedElementCallbacks.push(e)}onAsbplayerInstance(e){this._onAsbplayerInstanceCallbacks.push(e)}async publishTabsToAsbplayers(){const e={sender:"asbplayer-extension-to-player",message:{command:"tabs",tabs:await this.activeVideoElements(),asbplayers:await this._asbplayerInstances(),ackRequested:!0}};await this.publishCommandToAsbplayers({commandFactory:t=>t.videoPlayer?void 0:e})}async publishCommandToAsbplayers({asbplayerId:e,commandFactory:t}){const r=await this._asbplayers();if(void 0!==e){if(e in r){const n=t(r[e]);void 0!==n&&await this._sendCommand(r[e],n)}}else for(const e in r){const n=r[e],i=t(n);void 0!==i&&await this._sendCommand(n,i)}}async _sendCommand(e,t){try{void 0!==e.tab?.id?await chrome.tabs.sendMessage(e.tab.id,t):e.sidePanel&&await chrome.runtime.sendMessage(t)}catch(e){}}async publishCommandToVideoElements(e){const t=await this._videoElements();for(const r in t){const n=t[r],i=n.tab.id;if(void 0!==i){const t=e(n);void 0!==t&&chrome.tabs.sendMessage(i,t)}}}async publishCommandToVideoElementTabs(e){const t=await this._videoElements(),r=[];for(const e of Object.values(t))void 0===r.find((t=>t.id===e.tab.id))&&r.push(e.tab);if(r.length>0)for(const t of r){const r=e(t);void 0!==r&&chrome.tabs.sendMessage(t.id,r)}}async findAsbplayer(e){let t=null;const r=Date.now();let n=null;const i=await this._asbplayers();let s=0;for(const a in i){const o=i[a];if(o.sidePanel||++s,void 0===e||e(o)){const e=r-o.timestamp;(null===n||e<n)&&(n=e,t=o.id)}}return t||new Promise((async(t,r)=>{0===s&&await this._createNewTab(),this._anyAsbplayerTab(t,r,0,10,e)}))}async _createNewTab(){return new Promise((async(e,t)=>{const r=await chrome.tabs.query({active:!0}),n=r&&0!==r.length?r[0].index+1:void 0;chrome.tabs.create({active:!1,url:await this._settings.getSingle("streamingAppUrl"),index:n},e)}))}async _anyAsbplayerTab(e,t,r,n,i){if(r>=n)return void t(new Error("Could not find or create an asbplayer tab"));const s=await this._asbplayers();for(const t in s)if(void 0===i||i(s[t]))return void e(t);setTimeout((()=>this._anyAsbplayerTab(e,t,r+1,n,i)),1e3)}}(_i),xi=new class{constructor(e,t){this._tabRegistry=e,this._delegate=t}onAudioBase64(e){this._delegate.onAudioBase64(e)}async startWithTimeout(e,t,r){const n=this._delegate.startWithTimeout(e,t,r);this._notifyRecordingStarted(r);try{return await n}finally{this._notifyRecordingFinished(r)}}async start(e){try{await this._delegate.start(e),this._notifyRecordingStarted(e)}catch(t){throw this._notifyRecordingFinished(e),t}}async stop(e,t){const r=this._delegate.stop(e,t);return this._notifyRecordingFinished(t),await r}_notifyRecordingStarted({tabId:e,src:t}){const r={sender:"asbplayer-extension-to-player",message:{command:"recording-started"}};this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>e.sidePanel?r:void 0});const n={sender:"asbplayer-extension-to-video",message:{command:"recording-started"},src:t};chrome.tabs.sendMessage(e,n)}_notifyRecordingFinished({tabId:e,src:t}){const r={sender:"asbplayer-extension-to-player",message:{command:"recording-finished"}};this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>e.sidePanel?r:void 0});const n={sender:"asbplayer-extension-to-video",message:{command:"recording-finished"},src:t};chrome.tabs.sendMessage(e,n)}}(Ai,new class{onAudioBase64(e){this.audioBase64Resolve?.(e),this.audioBase64Resolve=void 0}async _ensureOffscreenDocument(){0===(await chrome.runtime.getContexts({contextTypes:[chrome.runtime.ContextType.OFFSCREEN_DOCUMENT]})).length&&await chrome.offscreen.createDocument({url:"offscreen-audio-recorder.html",reasons:[chrome.offscreen.Reason.USER_MEDIA],justification:"Audio recording"})}_mediaStreamId(e){return new Promise(((t,r)=>{chrome.tabCapture.getMediaStreamId({targetTabId:e},(e=>t(e)))}))}async startWithTimeout(e,t,{tabId:r,src:n}){if(await this._ensureOffscreenDocument(),void 0!==this.audioBase64Resolve)throw new Error("Already recording");const i={sender:"asbplayer-extension-to-offscreen-document",message:{command:"start-recording-audio-with-timeout",timeout:e,preferMp3:t,streamId:await this._mediaStreamId(r)}};if(!await chrome.runtime.sendMessage(i))throw void 0!==r&&this._requestActiveTab(r,n),new Error("Failed to start recording");return await this._audioBase64()}async start({tabId:e,src:t}){if(void 0!==this.audioBase64Resolve)throw new Error("Already recording");await this._ensureOffscreenDocument();const r={sender:"asbplayer-extension-to-offscreen-document",message:{command:"start-recording-audio",streamId:await this._mediaStreamId(e)}};if(!await chrome.runtime.sendMessage(r))throw void 0!==e&&this._requestActiveTab(e,t),new Error("Failed to start recording")}_requestActiveTab(e,t){const r={sender:"asbplayer-extension-to-video",message:{command:"request-active-tab-permission"},src:t};chrome.tabs.sendMessage(e,r)}async stop(e){const t={sender:"asbplayer-extension-to-offscreen-document",message:{command:"stop-recording-audio",preferMp3:e}};return chrome.runtime.sendMessage(t),await this._audioBase64()}_audioBase64(){return new Promise(((e,t)=>{this.audioBase64Resolve=e}))}}),Si=new class{constructor(e){this._capturing=!1,this.settings=e}get lastImageBase64(){return this._lastImageBase64}capture(e,t,r,n){return this._capturing?Promise.reject(new Error("Already capturing visible tab")):(this._lastImageBase64=void 0,void 0!==this.imageBase64Resolve&&void 0!==this.imageBase64Reject&&void 0!==this.imageBase64Promise?(this._captureWithDelay(e,t,r,n,this.imageBase64Resolve,this.imageBase64Reject),this.imageBase64Promise):(this.imageBase64Promise=new Promise(((i,s)=>{this.imageBase64Resolve=i,this.imageBase64Reject=s,this._captureWithDelay(e,t,r,n,this.imageBase64Resolve,this.imageBase64Reject)})),this.imageBase64Promise))}_captureWithDelay(t,r,n,i,s,a){const o=setTimeout((()=>{this._capturing=!0,e(t).then((async e=>{try{if(this._capturing=!1,o!==this.lastCaptureTimeoutId)return;const n=await this._cropAndResize(e,t,r,i);if(o!==this.lastCaptureTimeoutId)return;this._lastImageBase64=n.substring(n.indexOf(",")+1),s(this._lastImageBase64)}catch(e){a(e)}})).catch(a).finally((()=>{this._capturing=!1,this.imageBase64Promise=void 0,this.imageBase64Resolve=void 0,this.imageBase64Reject=void 0,this.lastCaptureTimeoutId=void 0}))}),n);this.lastCaptureTimeoutId=o}_cropAndResize(e,t,r,n){return new Promise((async(i,s)=>{try{if(!await this.settings.getSingle("streamingCropScreenshot"))return void i(e);const s={sender:"asbplayer-extension-to-video",message:{command:"crop-and-resize",dataUrl:e,...n},src:r};i((await chrome.tabs.sendMessage(t,s)).dataUrl)}catch(e){s(e)}}))}}(_i),ki=new class{constructor(e){this._settingsProvider=e}async publish(e,t,r,n){const i=ue(),s=this._saveCardToRepository(i,e);if(void 0!==r&&void 0!==n)try{t==y.showAnkiDialog?this._showAnkiDialog(e,i,n,r):t==y.updateLastCard?await this._updateLastCard(e,n,r):t===y.exportCard?await this._exportCard(e,n,r):t===y.none&&this._notifySaved(s,e,n,r)}catch(e){throw this._notifyError(e,n,r),e}}_notifySaved(e,t,r,n){e.then((e=>{if(e){const e={sender:"asbplayer-extension-to-video",message:{...t,command:"card-saved",cardName:t.subtitle.text||s(t.mediaTimestamp)},src:r};chrome.tabs.sendMessage(n,e)}}))}async _exportCard(e,t,r){const n=await this._settingsProvider.get(S),i=await _e(e,n,"default"),s={sender:"asbplayer-extension-to-video",message:{...e,command:"card-exported",cardName:`${i}`},src:t};chrome.tabs.sendMessage(r,s)}async _updateLastCard(e,t,r){const n=await this._settingsProvider.get(S),i=await _e(e,n,"updateLast"),s={sender:"asbplayer-extension-to-video",message:{...e,command:"card-updated",cardName:`${i}`},src:t};chrome.tabs.sendMessage(r,s)}_showAnkiDialog(e,t,r,n){const i={sender:"asbplayer-extension-to-video",message:{...e,id:t,command:"show-anki-ui"},src:r};chrome.tabs.sendMessage(n,i)}async _saveCardToRepository(e,t){try{const r=await this._settingsProvider.getSingle("miningHistoryStorageLimit");return new bi(r).save({...t,id:t.id??e,timestamp:Date.now()}),!0}catch(e){return console.error(e),!1}}_notifyError(e,t,r){let n;n=e instanceof Error?e.message:"string"==typeof e?e:String(e);const i={sender:"asbplayer-extension-to-video",message:{command:"notify-error",message:n},src:t};chrome.tabs.sendMessage(r,i)}}(_i),Fi=[new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"heartbeat"}handle(e,t){const r=e;return t.tab&&this.tabRegistry.onVideoElementHeartbeat(t.tab,r.src,r.message),!1}}(Ai),new class{constructor(e,t,r,n){this._audioRecorder=e,this._imageCapturer=t,this._cardPublisher=r,this._settingsProvider=n}get sender(){return"asbplayer-video"}get command(){return"record-media-and-forward-subtitle"}async handle(e,t){const r=t.tab,n=e;await this._recordAndForward(n,t,r)}async _recordAndForward(e,t,r){const n=e.message.subtitle;let i,s,a,o;const c=await this._settingsProvider.getSingle("preferMp3");if(e.message.record){const r=(n.end-n.start)/e.message.playbackRate+e.message.audioPaddingEnd;i=this._audioRecorder.startWithTimeout(r,c,{src:e.src,tabId:t.tab?.id})}if(e.message.screenshot){const{maxWidth:t,maxHeight:i,rect:a,frameId:o}=e.message;s=this._imageCapturer.capture(r.id,e.src,Math.min(n.end-n.start,e.message.imageDelay),{maxWidth:t,maxHeight:i,rect:a,frameId:o}),s.then((()=>{const t={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken"},src:e.src};chrome.tabs.sendMessage(r.id,t)}))}if(i){const{audioPaddingStart:t,audioPaddingEnd:r,playbackRate:n}=e.message,s={base64:"",extension:c?"mp3":"webm",paddingStart:t,paddingEnd:r,playbackRate:n};try{const e=await i;o={...s,base64:e}}catch(e){if(!(e instanceof _))throw e;o={...s,error:m.drmProtected}}}s&&(await s,a={base64:this._imageCapturer.lastImageBase64,extension:"jpeg"});const l={image:a,audio:o,...e.message};this._cardPublisher.publish(l,e.message.postMineAction,r.id,e.src)}}(xi,Si,ki,_i),new class{constructor(e,t,r){this._settingsProvider=e,this._audioRecorder=t,this._cardPublisher=r}get sender(){return"asbplayer-video"}get command(){return"rerecord-media"}async handle(e,t){const r=e,n=await this._settingsProvider.getSingle("preferMp3"),i={base64:"",extension:n?"mp3":"webm",paddingStart:r.message.audioPaddingStart,paddingEnd:r.message.audioPaddingEnd,start:r.message.timestamp,end:r.message.timestamp+r.message.duration/r.message.playbackRate,playbackRate:r.message.playbackRate};let s;try{s={...i,base64:await this._audioRecorder.startWithTimeout(r.message.duration/r.message.playbackRate+r.message.audioPaddingEnd,n,{src:r.src,tabId:t.tab?.id})}}catch(e){if(!(e instanceof _))throw e;s={...i,error:m.drmProtected}}this._cardPublisher.publish({audio:s,image:r.message.uiState.image,url:r.message.uiState.url,subtitle:r.message.uiState.subtitle,surroundingSubtitles:r.message.uiState.surroundingSubtitles,subtitleFileName:r.message.subtitleFileName,mediaTimestamp:r.message.timestamp},void 0,t.tab.id,r.src);const a={sender:"asbplayer-extension-to-video",message:{command:"show-anki-ui-after-rerecord",uiState:{...r.message.uiState,audio:s,lastAppliedTimestampIntervalToAudio:r.message.uiState.timestampInterval}},src:r.src};chrome.tabs.sendMessage(t.tab.id,a)}}(_i,xi,ki),new class{constructor(e,t,r,n){this._audioRecorder=e,this._imageCapturer=t,this._cardPublisher=r,this._settings=n}get sender(){return"asbplayer-video"}get command(){return"start-recording-media"}async handle(e,t){const r=e;let n,i;if(r.message.record)try{await this._audioRecorder.start({src:r.src,tabId:t.tab?.id})}catch(e){if(!(e instanceof _))throw e;n=e}if(r.message.screenshot){const e=r.message.record?r.message.imageDelay:0,{maxWidth:n,maxHeight:s,rect:a,frameId:o}=r.message;i=await this._imageCapturer.capture(t.tab.id,r.src,e,{maxWidth:n,maxHeight:s,rect:a,frameId:o});const c={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken"},src:r.src};chrome.tabs.sendMessage(t.tab.id,c)}if(!r.message.record||void 0!==n){const e=r.message.mediaTimestamp,s={text:"",start:e,originalStart:e,end:e,originalEnd:e,track:0};let a;i&&(a={base64:i,extension:"jpeg"});const o=await this._settings.getSingle("preferMp3"),c=void 0===n?void 0:{base64:"",extension:o?"mp3":"webm",paddingStart:0,paddingEnd:0,start:e,end:e,playbackRate:1,error:m.drmProtected};this._cardPublisher.publish({subtitle:s,surroundingSubtitles:[],image:a,audio:c,url:r.message.url,subtitleFileName:r.message.subtitleFileName,mediaTimestamp:r.message.mediaTimestamp},r.message.postMineAction,t.tab.id,r.src)}}}(xi,Si,ki,_i),new class{constructor(e,t,r,n){this._audioRecorder=e,this._imageCapturer=t,this._cardPublisher=r,this._settingsProvider=n}get sender(){return"asbplayer-video"}get command(){return"stop-recording-media"}async handle(e,t){const r=e,n=r.message.subtitle??{text:"",start:r.message.startTimestamp,end:r.message.endTimestamp,originalStart:r.message.startTimestamp,originalEnd:r.message.startTimestamp,track:0},i=r.message.surroundingSubtitles??function(e,t,r){const n=[e],i=e.start-e.originalStart;if(e.end<t){const r=Math.min(t,e.end+5e3);n.push({text:"",start:e.end,end:r,originalStart:e.end-i,originalEnd:r-i,track:e.track})}if(e.start>0){const t=Math.max(0,e.start-5e3);n.unshift({text:"",start:t,end:e.start,originalStart:t-i,originalEnd:e.start-i,track:e.track})}return n}(n,r.message.videoDuration);let s;if(r.message.screenshot){let e=this._imageCapturer.lastImageBase64;if(void 0===e){const{maxWidth:n,maxHeight:i,rect:s,frameId:a}=r.message;e=await this._imageCapturer.capture(t.tab.id,r.src,0,{maxWidth:n,maxHeight:i,rect:s,frameId:a})}s={base64:e,extension:"jpeg"}}const a=await this._settingsProvider.getSingle("preferMp3"),o={base64:await this._audioRecorder.stop(a,{tabId:t.tab.id,src:r.src}),extension:a?"mp3":"webm",paddingStart:0,paddingEnd:0,start:r.message.startTimestamp,end:r.message.endTimestamp,playbackRate:r.message.playbackRate};this._cardPublisher.publish({subtitle:n,surroundingSubtitles:i,image:s,audio:o,url:r.message.url,subtitleFileName:r.message.subtitleFileName,mediaTimestamp:r.message.startTimestamp},r.message.postMineAction,t.tab.id,r.src)}}(xi,Si,ki,_i),new class{constructor(e,t){this._imageCapturer=e,this._cardPublisher=t}get sender(){return"asbplayer-video"}get command(){return"take-screenshot"}async handle(e,t){const r=t.tab,n=e,{maxWidth:i,maxHeight:s,rect:a,frameId:o}=n.message,c=await this._imageCapturer.capture(t.tab.id,n.src,0,{maxWidth:i,maxHeight:s,rect:a,frameId:o});let l;n.message.ankiUiState&&(l=n.message.ankiUiState,l.image={base64:c,extension:"jpeg"},this._cardPublisher.publish({audio:l.audio,image:l.image,file:l.file,url:l.url,subtitle:l.subtitle,surroundingSubtitles:l.surroundingSubtitles,subtitleFileName:n.message.subtitleFileName,mediaTimestamp:n.message.mediaTimestamp},void 0,r.id,n.src));const u={sender:"asbplayer-extension-to-video",message:{command:"screenshot-taken",ankiUiState:l},src:n.src};chrome.tabs.sendMessage(r.id,u)}}(Si,ki),new class{constructor(e,t){this.settings=e,this.tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return"toggle-subtitles"}async handle(e,t){const r=await this.settings.getSingle("streamingDisplaySubtitles");await this.settings.set({streamingDisplaySubtitles:!r}),this.tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src})))}}(_i,Ai),new class{constructor(e,t){this.settings=e,this.tabRegistry=t}get sender(){return"asbplayer-video"}get command(){return"blur-subtitles"}async handle(e,t){const r=e.message,n=await this.settings.get(F);let i={...n};for(let e=0;e<r.trackCount;++e){const t=j(n,e).subtitleBlur,s=e===r.track?!t:t,a=C({subtitleBlur:s},i,e);i={...i,...a}}await this.settings.set(i),this.tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src})))}}(_i,Ai),new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"sync"}async handle(e,t){try{const r=e;await this.tabRegistry.publishTabsToAsbplayers();const n=await this.tabRegistry.findAsbplayer((e=>void 0!==e.receivedTabs&&void 0!==t.tab&&!e.sidePanel&&void 0!==e.receivedTabs.find((e=>e.id===t.tab.id&&e.src===r.src)))),i={sender:"asbplayer-extension-to-player",message:{command:"syncv2",subtitles:r.message.subtitles,flatten:r.message.flatten},src:r.src,tabId:t.tab.id};this.tabRegistry.publishCommandToAsbplayers({asbplayerId:n,commandFactory:()=>i})}catch(e){console.error(e)}}}(Ai),new class{constructor(){}get sender(){return["asbplayer-video","asbplayer-video-tab","asbplayer-popup"]}get command(){return"http-post"}handle(e,t,r){const n=e.message;if(this._validateBody(n.body))return fetch(n.url,{method:"POST",body:JSON.stringify(n.body)}).then((e=>e.json())).then((e=>r(e))).catch((e=>r({error:e.message}))),!0;r({error:"Invalid request"})}_validateBody(e){const t=Object.keys(e);for(const e of t)if(!A.includes(e))return!1;const r=e.version;if(void 0!==r&&"number"!=typeof r)return!1;const n=e.action;return!(void 0!==n&&!x.includes(n))}},new class{constructor(e){this._tabRegistry=e}get sender(){return["asbplayer-video-tab","asbplayerv2"]}get command(){return"toggle-side-panel"}handle(e,t){let r=!1;return this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>{if(e.sidePanel)return r=!0,{sender:"asbplayer-extension-to-player",message:{command:"close-side-panel"}}}}),r||chrome.windows.getLastFocused((e=>chrome.sidePanel.open({windowId:e.id}))),!1}}(Ai),new class{get sender(){return["asbplayer-video","asbplayer-video-tab"]}get command(){return"open-asbplayer-settings"}async handle(e,t){chrome.runtime.openOptionsPage()}},new class{constructor(){}get sender(){return["asbplayer-video","asbplayer-video-tab"]}get command(){return"copy-to-clipboard"}handle(e,t,r){const n=t.tab?.id;if(void 0===n)return;const i={sender:"asbplayer-extension-to-video",message:e.message};return chrome.tabs.sendMessage(n,i),!1}},new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"video-disappeared"}handle(e,t,r){if(void 0===t.tab)return;const n=e;return this._tabRegistry.onVideoElementDisappeared(t.tab,n.src),!1}}(Ai),new class{get sender(){return"asbplayer-video"}get command(){return"requesting-active-tab-permission"}handle(e,t){const r=e;return void 0!==t.tab?.id&&(async(e,t,r)=>{if(r){const r=await(async e=>(await chrome.tabs.query({})).find((t=>t.id===e)))(e);void 0===r?await chrome.storage.session.remove(re):await chrome.storage.session.set({[re]:{tabId:e,src:t,url:r.url}})}else await chrome.storage.session.remove(re)})(t.tab.id,r.src,r.message.requesting),!1}},new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"copy-subtitle"}handle(e,t){const r=e;return this._tabRegistry.publishCommandToVideoElements((e=>{if(e.src===r.src&&e.tab.id===r.tabId)return{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:r.message.postMineAction,subtitle:r.message.subtitle,surroundingSubtitles:r.message.surroundingSubtitles},src:e.src}})),!1}}(Ai),new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"load-subtitles"}handle(e,t){const r=e,n={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};return this._tabRegistry.publishCommandToVideoElementTabs((e=>e.id===r.tabId?n:void 0)),!1}}(Ai),new class{constructor(e){this._cardPublisher=e}get sender(){return"asbplayerv2"}get command(){return"publish-card"}handle(e,t){const r=e.message;return this._cardPublisher.publish(r),!1}}(ki),new class{constructor(e){this._tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return"ack-message"}handle(e,t,r){const n={sender:"asbplayer-extension-to-player",message:e.message};return this._tabRegistry.publishCommandToAsbplayers({commandFactory:()=>n}),!1}}(Ai),new class{constructor(e){this._audioRecorder=e}get sender(){return["asbplayer-offscreen-document","asbplayer-video"]}get command(){return"audio-base64"}handle(e,t){const r=e;return this._audioRecorder.onAudioBase64(r.message.base64),!1}}(xi),new class{get sender(){return"asbplayer-video"}get command(){return"update-mobile-overlay-model"}async handle(e,t){void 0!==t.tab?.id&&chrome.tabs.sendMessage(t.tab.id,{...e,sender:"asbplayer-video-to-mobile-overlay"})}},new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayer-video"}get command(){return null}handle(e,t){const r=e;if(void 0!==t.tab?.id){const n={sender:"asbplayer-extension-to-player",message:e.message,tabId:t.tab.id,src:r.src};this.tabRegistry.publishCommandToAsbplayers({commandFactory:()=>n})}return!1}}(Ai),new class{get sender(){return"asbplayer"}get command(){return null}handle(e,t){const r=e,n={sender:"asbplayer-extension-to-video",message:r.message,src:r.src};return chrome.tabs.sendMessage(r.tabId,n),!1}},new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"heartbeat"}handle(e,t){const r=e.message;return this.tabRegistry.onAsbplayerHeartbeat(t.tab,r),!1}}(Ai),new class{constructor(e){this.tabRegistry=e}get sender(){return"asbplayerv2"}get command(){return"ackTabs"}handle(e,t){const r=e.message;return this.tabRegistry.onAsbplayerAckTabs(t.tab,r),!1}}(Ai),new class{constructor(e,t){this._tabRegistry=e,this._settingsProvider=t}get sender(){return"asbplayerv2"}get command(){return"settings-updated"}handle(e,t){const r=e;return this._settingsProvider.get(["language","webSocketClientEnabled"]).then((({language:e,webSocketClientEnabled:t})=>{J(e),t?ee(this._settingsProvider,this._tabRegistry):te()})),this._tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src}))),this._tabRegistry.publishCommandToAsbplayers({commandFactory:e=>{if(void 0===r.asbplayerId||r.asbplayerId!==e.id)return{sender:"asbplayer-extension-to-player",message:{command:"settings-updated"}}}}),!1}}(Ai,_i),new class{get sender(){return"asbplayerv2"}get command(){return"open-extension-shortcuts"}handle(e,t){return chrome.tabs.create({active:!0,url:"chrome://extensions/shortcuts"}),!1}},new class{get sender(){return"asbplayerv2"}get command(){return"extension-commands"}handle(e,t,r){return chrome.commands.getAll((e=>{const t={};for(const r of e)r.name&&r.shortcut&&(t[r.name]=r.shortcut);r(t)})),!0}},new class{constructor(){}get sender(){return"asbplayerv2"}get command(){return null}handle(e,t){const r=e;if(r.tabId){const e={sender:"asbplayer-extension-to-video",message:r.message,src:r.src};chrome.tabs.sendMessage(r.tabId,e)}return!1}},new class{constructor(e,t){this._tabRegistry=e,this._settingsProvider=t}get sender(){return["asbplayer-popup","asbplayer-settings","asbplayer-mobile-overlay"]}get command(){return"settings-updated"}handle(e,t){return this._settingsProvider.get(["language","webSocketClientEnabled"]).then((({language:e,webSocketClientEnabled:t})=>{J(e),t?ee(this._settingsProvider,this._tabRegistry):te()})),this._tabRegistry.publishCommandToVideoElements((e=>({sender:"asbplayer-extension-to-video",message:{command:"settings-updated"},src:e.src}))),this._tabRegistry.publishCommandToAsbplayers({commandFactory:()=>({sender:"asbplayer-extension-to-player",message:{command:"settings-updated"}})}),!1}}(Ai,_i),new class{get sender(){return"asbplayer-foreground"}get command(){return"capture-visible-tab"}handle(t,r,n){if(void 0!==r.tab&&void 0!==r.tab.id)return e(r.tab.id).then((e=>{n(e)})),!0}},new class{get sender(){return"asbplayer-mobile-overlay-to-video"}get command(){return"request-mobile-overlay-model"}handle(e,t,r){if(void 0!==t.tab?.id)return chrome.tabs.sendMessage(t.tab.id,e).then((e=>r(e))),!0}},new class{get sender(){return"asbplayer-mobile-overlay"}get command(){return"current-tab"}handle(e,t,r){return r(t.tab?.id),!1}}];chrome.runtime.onMessage.addListener(((e,t,r)=>{for(const n of Fi)if(("string"==typeof n.sender&&n.sender===e.sender||"object"==typeof n.sender&&n.sender.includes(e.sender))&&(null===n.command||n.command===e.message.command)){if(!0===n.handle(e,t,r))return!0;break}})),chrome.runtime.onInstalled.addListener((()=>{chrome.contextMenus?.create({id:"load-subtitles",title:chrome.i18n.getMessage("contextMenuLoadSubtitles"),contexts:["page","video"]}),chrome.contextMenus?.create({id:"mine-subtitle",title:chrome.i18n.getMessage("contextMenuMineSubtitle"),contexts:["page","video"]})})),chrome.contextMenus?.onClicked.addListener((e=>{if("load-subtitles"===e.menuItemId){const t={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};Ai.publishCommandToVideoElementTabs((r=>{if(e.pageUrl===r.url)return t}))}else"mine-subtitle"===e.menuItemId&&Ai.publishCommandToVideoElements((t=>{if(!(void 0!==e.srcUrl&&t.src!==e.srcUrl||void 0===e.srcUrl&&e.pageUrl!==t.tab.url))return{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:y.showAnkiDialog},src:t.src}}))})),chrome.commands?.onCommand.addListener((e=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{const r=e=>{if(e.sidePanel)return!1;const r=e.tab;return!r||void 0!==t.find((e=>e.id===r.id))};switch(e){case"copy-subtitle":case"update-last-card":case"copy-subtitle-with-dialog":const n=function(e){switch(e){case"copy-subtitle":return y.none;case"copy-subtitle-with-dialog":return y.showAnkiDialog;case"update-last-card":return y.updateLastCard;default:throw new Error("Cannot determine post mine action for unknown command "+e)}}(e);Ai.publishCommandToVideoElements((e=>{if(void 0!==t.find((t=>t.id===e.tab.id)))return{sender:"asbplayer-extension-to-video",message:{command:"copy-subtitle",postMineAction:n},src:e.src}})),Ai.publishCommandToAsbplayers({commandFactory:e=>{if(r(e))return{sender:"asbplayer-extension-to-player",message:{command:"copy-subtitle",postMineAction:n},asbplayerId:e.id}}});break;case"toggle-video-select":for(const e of t)if(void 0!==e.id){const t={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};chrome.tabs.sendMessage(e.id,t)}break;case"take-screenshot":Ai.publishCommandToVideoElements((e=>{if(void 0!==t.find((t=>t.id===e.tab.id)))return{sender:"asbplayer-extension-to-video",message:{command:"take-screenshot"},src:e.src}})),Ai.publishCommandToAsbplayers({commandFactory:e=>{if(r(e))return{sender:"asbplayer-extension-to-player",message:{command:"take-screenshot"}}}});break;case"toggle-recording":Ai.publishCommandToVideoElements((e=>{if(void 0!==t.find((t=>t.id===e.tab.id)))return{sender:"asbplayer-extension-to-video",message:{command:"toggle-recording"},src:e.src}}));break;default:throw new Error("Unknown command "+e)}}))}));const Pi=()=>{_i.getSingle("webSocketClientEnabled").then((e=>{e?ee(_i,Ai):te()}))};Pi(),Ai.onAsbplayerInstance(Pi),Ai.onSyncedElement(Pi);vi||chrome.action.setPopup({popup:"popup-ui.html"}),chrome.action.onClicked.addListener((e=>{if(vi){if(void 0!==e.id){const t={sender:"asbplayer-extension-to-video",message:{command:"toggle-video-select"}};chrome.tabs.sendMessage(e.id,t)}}else chrome.action.openPopup()}))})()})();