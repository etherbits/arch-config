(()=>{"use strict";setTimeout((()=>{const e="webvtt-lssdh-ios8",t=new RegExp("manifest|licensedManifest"),n=new Map;function s(){if("undefined"!=typeof netflix)return netflix?.appContext?.state?.playerApp?.getAPI?.()}function i(){return s()?.videoPlayer}function r(){const e=i();if(e){const t=e.getAllPlayerSessionIds?.()||[];if(0===t.length)return void console.error("No Netflix player session IDs");const n=t[t.length-1];return e.getVideoPlayerBySessionId?.(n)}console.error("Missing netflix global")}function o(t){if(t.isForcedNarrative||t.isNoneTrack||!t.cdnlist?.length||!t.ttDownloadables)return;const n=t.ttDownloadables[e];return n?.downloadUrls?n.downloadUrls[t.cdnlist.find((e=>n.downloadUrls[e.id]))?.id]:void 0}function a(t){if(t.isForcedNarrative||t.isNoneTrack||!t.ttDownloadables)return;const n=t.ttDownloadables[e];return n?.urls&&0!==n.urls.length?n.urls[0].url:void 0}async function l(e,t){if(t<=0)return`${e}`;const[n,i]=function(e){const t=s()?.getVideoMetadataByVideoId?.(e)?.getCurrentVideo?.(),n=t?.getTitle?.();if("string"!=typeof n)return[`${e}`,!0];let i=n;if(!0===t?.isEpisodic?.()){const e=`${t?.getSeason()?._season?.seq}`.padStart(2,"0"),n=`${t?.getEpisodeNumber?.()}`.padStart(2,"0"),s=t?.getEpisodeTitle?.();i+=` S${e}E${n} ${s}`}return[i,!1]}(e);return i?(await new Promise((e=>setTimeout(e,1e3))),await l(e,--t)):n}document.addEventListener("asbplayer-netflix-seek",(e=>{r()?.seek(e.detail)})),document.addEventListener("asbplayer-netflix-play",(()=>{r()?.play()})),document.addEventListener("asbplayer-netflix-pause",(()=>{r()?.pause()})),document.addEventListener("asbplayer-get-synced-data",(async()=>{const e={error:"",basename:"",subtitles:[]},t=r(),s=t?.getMovieId();if(!t||!s)return e.error="Netflix Player or Title Id not found...",document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:e}));e.basename=await l(s,5);const i=n.get(s)||new Map;e.subtitles=t.getTimedTextTrackList().filter((e=>i.has(e.trackId))).map((e=>({label:`${e.bcp47} - ${e.displayName}${"CLOSEDCAPTIONS"===e.rawTrackType?" [CC]":""}`,language:e.bcp47.toLowerCase(),url:i.get(e.trackId),extension:"nfvtt"}))),document.dispatchEvent(new CustomEvent("asbplayer-synced-data",{detail:e}))}),!1);const d=JSON.stringify;JSON.stringify=function(n){if("string"==typeof n?.url&&-1<n.url.search(t))for(let t of Object.values(n))t?.profiles?.unshift(e);return d.apply(this,arguments)};const c=JSON.parse;JSON.parse=function(){const e=c.apply(this,arguments);return e?.result?.movieId&&function(e){const t=e.timedtexttracks||[];for(const s of t){const t=o(s)??a(s);t&&(n.has(e.movieId)||n.set(e.movieId,new Map),n.get(e.movieId).set(s.new_track_id,t))}}(e.result),e},Function.prototype.apply=new Proxy(Function.prototype.apply,{apply:function(e,t,n){if(n&&n[1]&&"string"==typeof n[1][0]){const e=n[1][0];if("preciseSeeking"===e||"preciseseeking"===e||"preciseseekingontwocoredevice"===e)return!0}return e.call(t,...n)}}),document.addEventListener("asbplayer-query-netflix",(()=>{document.dispatchEvent(new CustomEvent("asbplayer-netflix-enabled",{detail:void 0!==i()}))}))}),0)})();